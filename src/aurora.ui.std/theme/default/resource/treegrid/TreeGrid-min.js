$A.TreeGrid=Ext.extend($A.Grid,{initComponent:function(e){$A.TreeGrid.superclass.initComponent.call(this,e);delete e.marginheight;delete e.marginwidth;var d=(this.selectable&&this.lockColumns.length==1)||this.lockColumns.length==0;if(this.lockColumns.length>0){var c=this.id+"_lb_tree",f=this.createTreeConfig(e,this.lockColumns,c,!d,this);this.lb.set({id:c}).addClass("item-treegrid");var b=this.lockTree=new $A.Tree(f);b.body=this.lb;b.treegrid=this;b.on("render",function(){this.processData();Ext.DomHelper.insertHtml("beforeEnd",this.lb.dom,'<div style="height:17px"></div>')},this);b.on("expand",function(j,k){this.unlockTree.getNodeById(k.id).expand()},this);b.on("collapse",function(j,k){this.unlockTree.getNodeById(k.id).collapse()},this)}var g=this.id+"_ub_tree",a=this.createTreeConfig(e,this.unlockColumns,g,d,this);this.ub.set({id:g}).addClass("item-treegrid");var i=this.unlockTree=new $A.Tree(a);i.body=this.ub;i.treegrid=this;i.on("render",this.processData,this);if(b&&d){i.on("expand",function(j,k){this.lockTree.getNodeById(k.id).expand()},this);i.on("collapse",function(j,k){this.lockTree.getNodeById(k.id).collapse()},this)}},initTemplate:function(){$A.TreeGrid.superclass.initTemplate.call(this);this.cbTpl=new Ext.Template('<center style="width:{width}px"><div class="{cellcls}" style="height:13px;padding:0px;" id="'+this.id+'_{name}_{recordid}"></div></center>')},createTemplateData:function(b,a){return{width:b.width-2,recordid:a.id,visibility:b.hidden===true?"hidden":"visible",name:b.name}},createTreeConfig:function(b,e,i,a,d){var g=e[0];if((g.type=="rowcheck"||g.type=="rowradio")&&e.length>1){g=e[1]}var f=g?g.width:150;return Ext.apply(b,{sw:20,id:i,showSkeleton:a,width:f,column:g,displayfield:g.name,renderer:g.renderer,initColumns:function(c){if(c.isRoot()&&c.ownerTree.showRoot==false){return}Ext.each(e,function(n){var j=n.name,k=c.record;if(n.type=="rowcheck"||n.type=="rowradio"){new Ext.Template(d.createCell(n,k,true)).insertFirst(c.els.itemNodeTr,{},true)}else{if(j==c.ownerTree.displayfield){return}else{var m=document.createElement("td"),l=n.align;c.els[j+"_td"]=m;if(l){m.style.textAlign=l}m.recordid=k.id;m._type_="text";m.atype="grid-cell";m.dataindex=j;m.appendChild(c.els[j+"_text"]=Ext.DomHelper.insertHtml("afterBegin",m,d.createCell(n,k,false)));c.els.itemNodeTr.appendChild(m);Ext.fly(m).setWidth(n.width-2).addClass("node-text")}}})},createTreeNode:function(c){return new $A.Tree.TreeGridNode(c)},onNodeSelect:function(c){c.itemNodeTable.style.backgroundColor="#dfeaf5"},onNodeUnSelect:function(c){c.itemNodeTable.style.backgroundColor=""}})},processData:function(a,b){if(!b){return}var c=[];if(a.showRoot){this.processNode(c,b)}else{Ext.each(b.children,function(d){this.processNode(c,d)},this)}this.dataset.data=c},onLoad:function(){this.drawFootBar();$A.Masker.unmask(this.wb)},processNode:function(a,b){a.add(b.record);Ext.each(b.children,function(c){this.processNode(a,c)},this)},bind:function(a){if(typeof(a)==="string"){a=$A.CmpManager.get(a);if(!a){return}}this.dataset=a;this.processDataSetLiestener("on");if(this.lockTree){this.lockTree.bind(a)}this.unlockTree.bind(a);this.drawFootBar()},setColumnSize:function(b,d){$A.TreeGrid.superclass.setColumnSize.call(this,b,d);var e=this.findColByName(b),a=e.lock==true?this.lockTree:this.unlockTree;e.width=d;if(b==a.displayfield){a.width=d}a.root.setWidth(b,d)},renderLockArea:function(){var a=0;Ext.each(this.columns,function(b){if(b.lock===true&&b.hidden!==true){a+=b.width}});this.lockWidth=a},focusRow:function(f){var b=this.dataset.getAll()[f],e=this.unlockTree.getNodeById(b.id).els;if(!e){return}var c=this.ub,d=c.getScroll().top,a=Ext.fly(e.element).getTop()-c.getTop()+d;r=25,h=c.getHeight(),sh=c.dom.scrollWidth>c.dom.clientWidth?16:0;if(a<d){c.scrollTo("top",a-1)}else{if(a+r>(d+h-sh)){c.scrollTo("top",a+r-h+sh)}}},onMouseWheel:function(a){},onAdd:function(){}});$A.Tree.TreeGridNode=Ext.extend($A.Tree.TreeNode,{createNode:function(a){return new $A.Tree.TreeGridNode(a)},createCellEl:function(d){var b=this.getOwnerTree(),a=b.column,f=a.align,c=this.record,e=this.els[d+"_td"];this.els[d+"_text"]=Ext.DomHelper.insertHtml("afterBegin",this.els[d+"_td"],b.treegrid.createCell(a,c,false));e.dataindex=d;e.atype="grid-cell";e.recordid=c.id;if(f){e.style.textAlign=f}},paintText:function(){},render:function(){$A.Tree.TreeGridNode.superclass.render.call(this);var a=this.getOwnerTree();this.setWidth(a.displayfield,a.width)}});