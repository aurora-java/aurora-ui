(function(){var r="",a="scroll-disabled",h="tab-scroll-left-over",j="tab-scroll-right-over",b="tab-scroll-left",u="tab-scroll-right",l="tab-close",d="tab-btn-over",m="tab-btn-down",c="tab-scroll",o="right",p="left",i="active",e="unactive",n="none",v="block",q="select",k="beforeopen",t="padding-left",f="strip",s="."+f,g="销毁Tab出错: ";$A.Tab=Ext.extend($A.Component,{constructor:function(w){$A.Tab.superclass.constructor.call(this,w)},initComponent:function(y){$A.Tab.superclass.initComponent.call(this,y);this.scriptwidth=y.scriptwidth||60;var x=this.wrap,A=this.head=x.child("div[atype=tab.strips]"),z=this.script=A.parent();this.body=x.child("div.item-tab-body");this.scrollLeft=x.child("div[atype=scroll-left]");this.scrollRight=x.child("div[atype=scroll-right]");this.sp=z.parent();this.selectTab(y.selected||0)},processListener:function(w){$A.Tab.superclass.processListener.call(this,w);this.sp[w]("mousedown",this.onMouseDown,this)[w]("mouseup",this.onMouseUp,this)[w]("mouseover",this.onMouseOver,this)[w]("mouseout",this.onMouseOut,this);this.script[w]("click",this.onClick,this)[w]("mousewheel",this.onMouseWheel,this)},initEvents:function(){$A.Tab.superclass.initEvents.call(this);this.addEvents(q,k)},selectTab:function(D,I){var x=this.getTab(D);if(!x){return}var D=x.index,C=x.strip,J=x.body;if(C.hasClass(a)){this.selectTab(D+1);return}this.selectedIndex=D;if(this.activeTab){this.activeTab.replaceClass(i,e)}this.activeTab=C;C.replaceClass(e,i);var F=this.script,B=this.scrollLeft,y=this.scrollRight,A=C.dom.offsetLeft,H=C.getWidth(),z=F.getScroll().left,G=F.getWidth(),E=this.head.getWidth();tr=A+H-z-G,tl=z-A;if(tr>0){y.removeClass(a);B.removeClass(a);F.scrollTo(p,z+tr)}else{if(tl>0){B.removeClass(a);F.scrollTo(p,z-tl);y.removeClass(a)}}if(G+F.getScroll().left>=E){F.scrollTo(p,E-G);y.addClass(a)}else{if(D==0){F.scrollTo(p,0);B.addClass(a)}}if(J){if(this.activeBody){this.activeBody.setStyle({left:"-1000px",top:"-1000px"})}this.activeBody=J;J.setStyle({left:0,top:0})}if(this.items[D].ref&&(J.loaded!=true||I)){this.load(this.items[D].ref,J,D);J.loaded=true}else{this.fireEvent(q,this,D)}},stripTpl:['<div class="strip unactive"  unselectable="on" onselectstart="return false;"><div style="height:26px;width:{stripwidth2}px">','<div class="strip-left"></div>','<div style="width:{stripwidth}px;" class="strip-center"><div class="tab-close"></div>{prompt}</div>','<div class="strip-right"></div>',"</div></div>"],bodyTpl:'<div style="width:{bodywidth}px;height:{bodyheight}px;left:-10000px;top:-10000px;" class="tab"></div>',openTab:function(y,x){var A=0,D=this.items,z=D.length;for(;A<z;A++){var G=D[A];if(G.ref&&G.ref==y){this.selectTab(A);return}}if(this.fireEvent(k,this,z)!==false){D.push({ref:y});var B=Math.max($A.TextMetrics.measure(document.body,x).width+20,this.scriptwidth),F=this.head,C=this.body,E=this.script,w=F.getWidth()+B+6;F.setWidth(w);if(w>E.getWidth()){this.scrollLeft.setStyle({display:v});this.scrollRight.setStyle({display:v});E.setStyle(t,"1px")}new Ext.Template(this.stripTpl).append(F.dom,{prompt:x,stripwidth:B,stripwidth2:B+6});new Ext.Template(this.bodyTpl).append(C.dom,{bodywidth:C.getWidth(),bodyheight:C.getHeight()});this.selectTab(z)}},closeTab:function(D){var C=this.getTab(D);if(!C){return}var B=C.strip,w=C.body,y=C.index;if(!B.child("div."+l)){$A.showWarningMessage("警告","该Tab页无法被关闭!");return}if(this.activeBody==C.body){this.activeBody=null;this.activeTab=null}this.items.splice(y,1);var z=this.head,x=this.script,A=z.getWidth()-B.getWidth();z.setWidth(A);if(A<=x.getWidth()){this.scrollLeft.setStyle({display:n});this.scrollRight.setStyle({display:n});x.setStyle(t,"0")}B.remove();w.remove();delete w.loaded;setTimeout(function(){Ext.iterate(w.cmps,function(E,F){if(F.destroy){try{F.destroy()}catch(G){alert(g+G)}}})},10);this.selectTab(y)},destroy:function(){Ext.each(this.body.dom.children,function(w){Ext.iterate(Ext.fly(w).cmps,function(x,y){if(y.destroy){try{y.destroy()}catch(z){alert(g+z)}}})});$A.Tab.superclass.destroy.call(this)},setDisabled:function(w){var y=this.getTab(w);if(!y){return}if(this.items.length>1){var x=y.strip,w=y.index;if(this.activeTab==x){this.selectTab(w+(this.getTab(w+1)?1:-1))}x.addClass(a)}},setEnabled:function(w){var x=this.getTab(w);if(!x){return}x.strip.removeClass(a)},getTab:function(A){var x=this.body.dom.children,z=this.head.dom.children,y,w;if(Ext.isNumber(A)){if(A<0){A+=z.length}A=Math.round(A);if(z[A]){y=Ext.get(z[A]);w=Ext.get(x[A])}}else{A=Ext.get(A);A=Ext.each(z,function(C,B){if(C==A.dom){y=A;w=Ext.get(x[B]);return false}})}return y?{strip:y,body:w,index:A}:null},scrollTo:function(A){var z=this.script,y=this.scrollRight,B=this.scrollLeft,x=z.getScroll().left,w=this.scriptwidth;if(A==p){z.scrollTo(p,x-w);y.removeClass(a);if(z.getScroll().left<=0){B.addClass(a).replaceClass(h,b);this.stopScroll()}}else{if(A==o){z.scrollTo(p,x+w);B.removeClass(a);if(z.getScroll().left+z.getWidth()>=this.head.getWidth()){y.addClass(a).replaceClass(j,u);this.stopScroll()}}}},stopScroll:function(){if(this.scrollInterval){clearInterval(this.scrollInterval);delete this.scrollInterval}},onClick:function(y,w){var x=Ext.fly(w);if(x.hasClass(l)){this.closeTab(x.parent(s))}},onMouseWheel:function(w){var x=w.getWheelDelta();if(x>0){this.scrollTo(p);w.stopEvent()}else{this.scrollTo(o);w.stopEvent()}},onMouseDown:function(A,w){var y=Ext.fly(w),x=y.parent(s),z=this;if(y.hasClass(l)){y.removeClass(d).addClass(m)}else{if(y.hasClass(c)&&!y.hasClass(a)){if(y.hasClass(h)){z.scrollTo(p)}else{z.scrollTo(o)}z.scrollInterval=setInterval(function(){if(y.hasClass(c)&&!y.hasClass(a)){if(y.hasClass(h)){z.scrollTo(p)}else{z.scrollTo(o)}if(y.hasClass(a)){clearInterval(z.scrollInterval)}}},100)}else{if(x&&x.hasClass(f)&&!x.hasClass(i)&&!x.hasClass(a)){z.selectTab(x)}}}},onMouseUp:function(w){this.stopScroll()},onMouseOver:function(A,x){var z=Ext.fly(x),y=z.parent(s);if(z.hasClass(c)&&!z.hasClass(a)){if(z.hasClass(b)){z.replaceClass(b,h)}else{if(z.hasClass(u)){z.replaceClass(u,j)}}}else{if(z.hasClass(l)){z.addClass(d)}}if(y){z=y.child("div."+l);if(z){var w=this.currentBtn;if(w){w.hide()}this.currentBtn=z;z.show()}}},onMouseOut:function(z,w){var y=Ext.fly(w),x=y.parent(s);if(y.hasClass(c)&&!y.hasClass(a)){this.stopScroll();if(y.hasClass(h)){y.replaceClass(h,b)}else{if((y.hasClass(j))){y.replaceClass(j,u)}}}else{if(y.hasClass(l)){y.removeClass([d,m])}}if(x){y=x.child("div."+l);if(y){y.hide()}}},showLoading:function(w){w.setStyle({"text-align":"center","line-height":5}).update(_lang["tab.loading"])},clearLoading:function(w){w.setStyle({"text-align":r,"line-height":r}).update(r)},reloadTab:function(x,w){x=Ext.isEmpty(x)?this.selectedIndex:x;var y=this.getTab(x);if(!y){return}if(w){this.items[x].ref=w}Ext.iterate(y.body.cmps,function(z,A){if(A.destroy){try{A.destroy()}catch(B){alert(g+B)}}});this.selectTab(x,true)},load:function(y,A,x){var z=this,w=Ext.get(A);w.cmps={};z.showLoading(w);Ext.Ajax.request({url:Ext.urlAppend(y,"_vw="+this.width+"&_vh="+(this.height-this.head.getHeight())),success:function(B,D){var G;try{G=Ext.decode(B.responseText)}catch(H){}if(G&&G.success==false){if(G.error){if(G.error.code&&G.error.code=="session_expired"){$A.showErrorMessage(_lang["ajax.error"],_lang["session.expired"])}else{$A.manager.fireEvent("ajaxfailed",$A.manager,D.url,D.para,G);var C=G.error.stackTrace,F=G.error.message;C=C?C.replaceAll("\r\n","</br>"):r;$A.showErrorMessage(_lang["window.error"],F?F+"</br>"+C:C,null,400,F&&C==r?150:250)}}return}var E=B.responseText;z.clearLoading(w);w.update(E,true,function(){z.fireEvent(q,z,x)},w)}})},setWidth:function(E){E=Math.max(E,2);if(this.width==E){return}$A.Tab.superclass.setWidth.call(this,E);var A=this.body,C=this.head,D=this.script,y=this.scrollLeft,x=this.scrollRight;A.setWidth(E-2);D.setWidth(E-38);if(E-38<C.getWidth()){y.setStyle({display:v});x.setStyle({display:v});D.setStyle(t,"1px");var z=D.getScroll().left,F=D.getWidth(),B=C.getWidth();if(z<=0){y.addClass(a)}else{y.removeClass(a)}if(z+F>=B){if(!x.hasClass(a)){x.addClass(a)}else{D.scrollTo(p,B-F)}}else{x.removeClass(a)}}else{y.setStyle({display:n});x.setStyle({display:n});D.setStyle(t,"0").scrollTo(p,0)}Ext.each(A.dom.children,function(w){Ext.fly(w).setWidth(E-4)})},setHeight:function(x){x=Math.max(x,25);if(this.height==x){return}$A.Tab.superclass.setHeight.call(this,x);var w=this.body;w.setHeight(x-26);Ext.each(w.dom.children,function(y){Ext.fly(y).setHeight(x-28)})}})})();