(function(t){var u="",a="scroll-disabled",i="tab-scroll-left-over",k="tab-scroll-right-over",b="tab-scroll-left",x="tab-scroll-right",m="tab-close",e="tab-btn-over",n="tab-btn-down",c="tab-scroll",q="right",r="left",j="active",f="unactive",o="none",y="block",s="select",l="beforeopen",w="padding-left",g="strip",v="."+g,h="销毁Tab出错: ",p=['<div class="strip unactive"  unselectable="on" onselectstart="return false;"><div style="height:26px;width:{stripwidth2}px">','<div class="strip-left"></div>','<div style="width:{stripwidth}px;" class="strip-center"><div class="tab-close"></div>{prompt}</div>','<div class="strip-right"></div>',"</div></div>"],d='<div style="width:{bodywidth}px;height:{bodyheight}px;left:-10000px;top:-10000px;" class="tab"></div>';t.Tab=Ext.extend(t.Component,{constructor:function(z){t.Tab.superclass.constructor.call(this,z)},initComponent:function(A){t.Tab.superclass.initComponent.call(this,A);var D=this,z=D.wrap,C=D.head=z.child("div[atype=tab.strips]"),B=D.script=C.parent();D.scriptwidth=A.scriptwidth||60;D.body=z.child("div.item-tab-body");D.scrollLeft=z.child("div[atype=scroll-left]");D.scrollRight=z.child("div[atype=scroll-right]");D.sp=B.parent();D.selectTab(A.selected||0)},processListener:function(z){var A=this;t.Tab.superclass.processListener.call(A,z);A.sp[z]("mousedown",A.onMouseDown,A)[z]("mouseup",A.onMouseUp,A)[z]("mouseover",A.onMouseOver,A)[z]("mouseout",A.onMouseOut,A);A.script[z]("click",A.onClick,A)[z]("mousewheel",A.onMouseWheel,A)},initEvents:function(){t.Tab.superclass.initEvents.call(this);this.addEvents(s,l)},selectTab:function(G,L){var F=this,A=F.getTab(G);if(!A){return}var G=A.index,E=A.strip,M=A.body;if(E.hasClass(a)){F.selectTab(G+1);return}F.selectedIndex=G;if(F.activeTab){F.activeTab.replaceClass(j,f)}F.activeTab=E;E.replaceClass(f,j);var I=F.script,D=F.scrollLeft,z=F.scrollRight,C=E.dom.offsetLeft,K=E.getWidth(),B=I.getScroll().left,J=I.getWidth(),H=F.head.getWidth();tr=C+K-B-J,tl=B-C;if(tr>0){z.removeClass(a);D.removeClass(a);I.scrollTo(r,B+tr)}else{if(tl>0){D.removeClass(a);I.scrollTo(r,B-tl);z.removeClass(a)}}if(J+I.getScroll().left>=H){I.scrollTo(r,H-J);z.addClass(a)}else{if(G==0){I.scrollTo(r,0);D.addClass(a)}}if(M){if(F.activeBody){F.activeBody.setStyle({left:"-1000px",top:"-1000px"})}F.activeBody=M.setStyle({left:0,top:0})}if(F.items[G].ref&&(M.loaded!=true||L)){F.load(F.items[G].ref,M,G);M.loaded=true}else{F.fireEvent(s,F,G)}},openTab:function(B,A){var G=this,D=0,H=G.items,C=H.length;for(;D<C;D++){var K=H[D];if(K.ref&&K.ref==B){G.selectTab(D);return}}if(G.fireEvent(l,G,C)!==false){H.push({ref:B});var E=Math.max(t.TextMetrics.measure(document.body,A).width+20,G.scriptwidth),J=G.head,F=G.body,I=G.script,z=J.getWidth()+E+6;J.setWidth(z);if(z>I.getWidth()){G.scrollLeft.setStyle({display:y});G.scrollRight.setStyle({display:y});I.setStyle(w,"1px")}new Ext.Template(p).append(J.dom,{prompt:A,stripwidth:E,stripwidth2:E+6});new Ext.Template(d).append(F.dom,{bodywidth:F.getWidth(),bodyheight:F.getHeight()});G.selectTab(C)}},closeTab:function(B){var E=this,C=E.getTab(B);if(!C){return}var A=C.strip,D=C.body,F=C.index;if(!A.child("div."+m)){t.showWarningMessage("警告","该Tab页无法被关闭!");return}if(E.activeBody==C.body){E.activeBody=null;E.activeTab=null}E.items.splice(F,1);var G=E.head,H=E.script,z=G.getWidth()-A.getWidth();G.setWidth(z);if(z<=H.getWidth()){E.scrollLeft.setStyle({display:o});E.scrollRight.setStyle({display:o});H.setStyle(w,"0")}A.remove();D.remove();delete D.loaded;(function(){Ext.iterate(D.cmps,function(I,J){if(J.destroy){try{J.destroy()}catch(K){alert(h+K)}}})}).defer(10);if(F==E.selectedIndex){E.selectTab(F-1)}},destroy:function(){Ext.each(this.body.dom.children,function(z){Ext.iterate(Ext.get(z).cmps,function(A,B){if(B.destroy){try{B.destroy()}catch(C){alert(h+C)}}})});t.Tab.superclass.destroy.call(this)},setDisabled:function(z){var C=this,B=C.getTab(z);if(!B){return}if(C.items.length>1){var A=B.strip,z=B.index;if(C.activeTab==A){C.selectTab(z+(C.getTab(z+1)?1:-1))}A.addClass(a)}},setEnabled:function(z){var A=this.getTab(z);if(!A){return}A.strip.removeClass(a)},getTab:function(D){var A=this.body.dom.children,C=this.head.dom.children,B,z;if(Ext.isNumber(D)){if(D<0){D+=C.length}D=Math.round(D);if(C[D]){B=Ext.get(C[D]);z=Ext.get(A[D])}}else{D=Ext.get(D);D=Ext.each(C,function(F,E){if(F==D.dom){B=D;z=Ext.get(A[E]);return false}})}return B?{strip:B,body:z,index:D}:null},scrollTo:function(D){var E=this,C=E.script,B=E.scrollRight,F=E.scrollLeft,A=C.getScroll().left,z=E.scriptwidth;if(D==r){C.scrollTo(r,A-z);B.removeClass(a);if(C.getScroll().left<=0){F.addClass(a).replaceClass(i,b);E.stopScroll()}}else{if(D==q){C.scrollTo(r,A+z);F.removeClass(a);if(C.getScroll().left+C.getWidth()>=E.head.getWidth()){B.addClass(a).replaceClass(k,x);E.stopScroll()}}}},stopScroll:function(){if(this.scrollInterval){clearInterval(this.scrollInterval);delete this.scrollInterval}},onClick:function(B,z){var A=Ext.fly(z);if(A.hasClass(m)){this.closeTab(A.parent(v))}},onMouseWheel:function(z){var A=z.getWheelDelta();if(A>0){this.scrollTo(r);z.stopEvent()}else{if(A<0){this.scrollTo(q);z.stopEvent()}}},onMouseDown:function(D,z){var B=Ext.fly(z),A=B.parent(v),C=this;if(B.hasClass(m)){B.removeClass(e).addClass(n)}else{if(B.hasClass(c)&&!B.hasClass(a)){if(B.hasClass(i)){C.scrollTo(r)}else{C.scrollTo(q)}C.scrollInterval=setInterval(function(){if(B.hasClass(c)&&!B.hasClass(a)){if(B.hasClass(i)){C.scrollTo(r)}else{C.scrollTo(q)}if(B.hasClass(a)){clearInterval(C.scrollInterval)}}},100)}else{if(A&&A.hasClass(g)&&!A.hasClass(j)&&!A.hasClass(a)){C.selectTab(A)}}}},onMouseUp:function(z){this.stopScroll()},onMouseOver:function(D,A){var C=Ext.fly(A),B=C.parent(v);if(C.hasClass(c)&&!C.hasClass(a)){if(C.hasClass(b)){C.replaceClass(b,i)}else{if(C.hasClass(x)){C.replaceClass(x,k)}}}else{if(C.hasClass(m)){C.addClass(e)}}if(B){C=B.child("div."+m);if(C){var z=this.currentBtn;if(z){z.hide()}this.currentBtn=C;C.show()}}},onMouseOut:function(C,z){var B=Ext.fly(z),A=B.parent(v);if(B.hasClass(c)&&!B.hasClass(a)){this.stopScroll();if(B.hasClass(i)){B.replaceClass(i,b)}else{if((B.hasClass(k))){B.replaceClass(k,x)}}}else{if(B.hasClass(m)){B.removeClass([e,n])}}if(A){B=A.child("div."+m);if(B){B.hide()}}},showLoading:function(z){z.setStyle({"text-align":"center","line-height":5}).update(_lang["tab.loading"])},clearLoading:function(z){z.setStyle({"text-align":u,"line-height":u}).update(u)},reloadTab:function(A,z){A=Ext.isEmpty(A)?this.selectedIndex:A;var C=this,B=C.getTab(A);if(!B){return}if(z){C.items[A].ref=z}Ext.iterate(B.body.cmps,function(D,E){if(E.destroy){try{E.destroy()}catch(F){alert(h+F)}}});C.selectTab(A,true)},load:function(B,D,A){var C=this,z=Ext.get(D);z.cmps={};C.showLoading(z);Ext.Ajax.request({url:Ext.urlAppend(B,"_vw="+C.width+"&_vh="+(C.height-C.head.getHeight())),success:function(E,G){var J;try{J=Ext.decode(E.responseText)}catch(K){}if(J&&J.success==false){if(J.error){if(J.error.code&&J.error.code=="session_expired"){t.showErrorMessage(_lang["ajax.error"],_lang["session.expired"])}else{t.manager.fireEvent("ajaxfailed",t.manager,G.url,G.para,J);var F=J.error.stackTrace,I=J.error.message;F=F?F.replaceAll("\r\n","</br>"):u;t.showErrorMessage(_lang["window.error"],I?I+"</br>"+F:F,null,400,I&&F==u?150:250)}}return}var H=E.responseText;C.clearLoading(z);z.set({url:B});z.update(H,true,function(){C.fireEvent(s,C,A)},z)}})},setWidth:function(I){I=Math.max(I,2);var D=this;if(D.width==I){return}t.Tab.superclass.setWidth.call(D,I);var C=D.body,F=D.head,G=D.script,A=D.scrollLeft,z=D.scrollRight;C.setWidth(I-2);G.setWidth(I-38);if(I-38<F.getWidth()){A.setStyle({display:y});z.setStyle({display:y});G.setStyle(w,"1px");var B=G.getScroll().left,H=G.getWidth(),E=F.getWidth();if(B<=0){A.addClass(a)}else{A.removeClass(a)}if(B+H>=E){if(!z.hasClass(a)){z.addClass(a)}else{G.scrollTo(r,E-H)}}else{z.removeClass(a)}}else{A.setStyle({display:o});z.setStyle({display:o});G.setStyle(w,"0").scrollTo(r,0)}Ext.each(C.dom.children,function(J){Ext.fly(J).setWidth(I-4)})},setHeight:function(A){A=Math.max(A,25);if(this.height==A){return}t.Tab.superclass.setHeight.call(this,A);var z=this.body;z.setHeight(A-26);Ext.each(z.dom.children,function(B){Ext.fly(B).setHeight(A-28)})}})})($A);