(function(t){var u="",a="scroll-disabled",i="tab-scroll-left-over",k="tab-scroll-right-over",b="tab-scroll-left",y="tab-scroll-right",m="tab-close",e="tab-btn-over",n="tab-btn-down",c="tab-scroll",q="right",r="left",j="active",f="unactive",o="none",z="block",s="select",l="beforeopen",v="beforeselect",x="padding-left",g="strip",w="."+g,h="销毁Tab出错: ",p=['<div class="strip unactive"  unselectable="on" onselectstart="return false;"><div style="height:26px;width:{stripwidth2}px">','<div class="strip-left"></div>','<div style="width:{stripwidth}px;" class="strip-center"><div class="tab-close"></div>{prompt}</div>','<div class="strip-right"></div>',"</div></div>"],d='<div style="width:{bodywidth}px;height:{bodyheight}px;left:-10000px;top:-10000px;" class="tab"></div>';t.Tab=Ext.extend(t.Component,{constructor:function(A){t.Tab.superclass.constructor.call(this,A)},initComponent:function(B){t.Tab.superclass.initComponent.call(this,B);var E=this,A=E.wrap,D=E.head=A.child("div[atype=tab.strips]"),C=E.script=D.parent();E.scriptwidth=B.scriptwidth||60;E.body=A.child("div.item-tab-body");E.scrollLeft=A.child("div[atype=scroll-left]");E.scrollRight=A.child("div[atype=scroll-right]");E.sp=C.parent();E.selectTab(B.selected||0)},processListener:function(A){var B=this;t.Tab.superclass.processListener.call(B,A);B.sp[A]("mousedown",B.onMouseDown,B)[A]("mouseup",B.onMouseUp,B);B.script[A]("click",B.onClick,B)[A]("mousewheel",B.onMouseWheel,B)},initEvents:function(){t.Tab.superclass.initEvents.call(this);this.addEvents(s,l,v)},setURL:function(B,A){var D=this,C=D.getTab(B);if(C){B=C.index;if(B==D.selectedIndex){D.reloadTab(B,A)}else{C.body.loaded=false;D.items[B].ref=A}}},selectTab:function(H,M){var G=this,B=G.getTab(H);if(!B){return}var H=B.index,F=B.strip,N=B.body;if(F.hasClass(a)){G.selectTab(H+1);return}if(G.fireEvent(v,G,H,B)){G.selectedIndex=H;if(G.activeTab){G.activeTab.replaceClass(j,f)}G.activeTab=F;F.replaceClass(f,j);var J=G.script,E=G.scrollLeft,A=G.scrollRight,D=F.dom.offsetLeft,L=F.getWidth(),C=J.getScroll().left,K=J.getWidth(),I=G.head.getWidth();tr=D+L-C-K,tl=C-D;if(tr>0){A.removeClass(a);E.removeClass(a);J.scrollTo(r,C+tr)}else{if(tl>0){E.removeClass(a);J.scrollTo(r,C-tl);A.removeClass(a)}}if(K+J.getScroll().left>=I){J.scrollTo(r,I-K);A.addClass(a)}else{if(H==0){J.scrollTo(r,0);E.addClass(a)}}if(N){if(G.activeBody){G.activeBody.setStyle({left:"-10000px",top:"-10000px"})}G.activeBody=N.setStyle({left:0,top:0})}if(G.items[H].ref&&!N.loading&&(N.loaded!=true||M)){N.loading=true;G.load(G.items[H].ref,N,H)}else{G.fireEvent(s,G,H,B)}}},openTab:function(C,B){var H=this,E=0,I=H.items,D=I.length;for(;E<D;E++){var L=I[E];if(L.ref&&L.ref==C){H.selectTab(E);return}}if(H.fireEvent(l,H,D)!==false){I.push({ref:C,prompt:B});var F=Math.max(t.TextMetrics.measure(document.body,B).width+20,H.scriptwidth),K=H.head,G=H.body,J=H.script,A=K.getWidth()+F+6;K.setWidth(A);if(A>J.getWidth()){H.scrollLeft.setStyle({display:z});H.scrollRight.setStyle({display:z});J.setStyle(x,"1px")}new Ext.Template(p).append(K.dom,{prompt:B,stripwidth:F,stripwidth2:F+6});new Ext.Template(d).append(G.dom,{bodywidth:G.getWidth(),bodyheight:G.getHeight()});H.selectTab(D)}},closeTab:function(C){var F=this,D=F.getTab(C);if(!D){return}var B=D.strip,E=D.body,G=D.index;if(!B.child("div."+m)){t.showWarningMessage("警告","该Tab页无法被关闭!");return}if(F.activeBody==D.body){F.activeBody=null;F.activeTab=null}F.items.splice(G,1);var H=F.head,I=F.script,A=H.getWidth()-B.getWidth();if(A<=I.getWidth()){F.scrollLeft.setStyle({display:o});F.scrollRight.setStyle({display:o});I.setStyle(x,"0")}B.remove();E.remove();delete E.loaded;(function(){Ext.iterate(E.cmps,function(J,K){if(K.destroy){try{K.destroy()}catch(L){alert(h+L)}}});H.setWidth(A)}).defer(10);if(G==F.selectedIndex){F.selectTab(G-1)}},destroy:function(){Ext.each(this.body.dom.children,function(A){Ext.iterate(Ext.get(A).cmps,function(B,C){if(C.destroy){try{C.destroy()}catch(D){alert(h+D)}}})});t.Tab.superclass.destroy.call(this)},setDisabled:function(A){var D=this,C=D.getTab(A);if(!C){return}if(D.items.length>1){var B=C.strip,A=C.index;if(D.activeTab==B){D.selectTab(A+(D.getTab(A+1)?1:-1))}B.addClass(a)}},setEnabled:function(A){var B=this.getTab(A);if(!B){return}B.strip.removeClass(a)},getTab:function(F){var E=this,B=E.body.query(">div.tab"),D=E.head.query("div.strip"),C,A;if(Ext.isNumber(F)){if(F<0){F+=D.length}F=Math.round(F);if(D[F]){C=Ext.get(D[F]);A=Ext.get(B[F])}}else{F=Ext.get(F);F=Ext.each(D,function(H,G){if(H==F.dom){C=F;A=Ext.get(B[G]);return false}})}if(C){A.loaded=!(E.items[F].ref&&A.loaded!=true);return{strip:C,body:A,index:F}}else{return null}},scrollTo:function(E){var F=this,D=F.script,C=F.scrollRight,G=F.scrollLeft,B=D.getScroll().left,A=F.scriptwidth;if(E==r){D.scrollTo(r,B-A);C.removeClass(a);if(D.getScroll().left<=0){G.addClass(a).replaceClass(i,b);F.stopScroll()}}else{if(E==q){D.scrollTo(r,B+A);G.removeClass(a);if(D.getScroll().left+D.getWidth()>=F.head.getWidth()){C.addClass(a).replaceClass(k,y);F.stopScroll()}}}},stopScroll:function(){if(this.scrollInterval){clearInterval(this.scrollInterval);delete this.scrollInterval}},onClick:function(C,A){var B=Ext.fly(A);if(B.hasClass(m)){this.closeTab(B.parent(w))}},onMouseWheel:function(A){var B=A.getWheelDelta();if(B>0){this.scrollTo(r);A.stopEvent()}else{if(B<0){this.scrollTo(q);A.stopEvent()}}},onMouseDown:function(E,A){var C=Ext.fly(A),B=C.parent(w),D=this;if(C.hasClass(m)){C.removeClass(e).addClass(n)}else{if(C.hasClass(c)&&!C.hasClass(a)){if(C.hasClass(i)){D.scrollTo(r)}else{D.scrollTo(q)}D.scrollInterval=setInterval(function(){if(C.hasClass(c)&&!C.hasClass(a)){if(C.hasClass(i)){D.scrollTo(r)}else{D.scrollTo(q)}if(C.hasClass(a)){clearInterval(D.scrollInterval)}}},100)}else{if(B&&B.hasClass(g)&&!B.hasClass(j)&&!B.hasClass(a)){D.selectTab(B)}}}},onMouseUp:function(A){this.stopScroll()},onMouseOver:function(E,B){var D=Ext.fly(B),C=D.parent(w);if(D.hasClass(c)&&!D.hasClass(a)){if(D.hasClass(b)){D.replaceClass(b,i)}else{if(D.hasClass(y)){D.replaceClass(y,k)}}}else{if(D.hasClass(m)){D.addClass(e)}}if(C){D=C.child("div."+m);if(D){var A=this.currentBtn;if(A){A.hide()}this.currentBtn=D;D.show()}}t.Tab.superclass.onMouseOver.call(this,E)},onMouseOut:function(D,A){var C=Ext.fly(A),B=C.parent(w);if(C.hasClass(c)&&!C.hasClass(a)){this.stopScroll();if(C.hasClass(i)){C.replaceClass(i,b)}else{if((C.hasClass(k))){C.replaceClass(k,y)}}}else{if(C.hasClass(m)){C.removeClass([e,n])}}if(B){C=B.child("div."+m);if(C){C.hide()}}t.Tab.superclass.onMouseOut.call(this,D)},showLoading:function(A){t.Masker.mask(A,_lang["tab.loading"])},clearLoading:function(A){t.Masker.unmask(A)},reloadTab:function(B,A){B=Ext.isEmpty(B)?this.selectedIndex:B;var D=this,C=D.getTab(B);if(!C){return}if(A){D.items[B].ref=A}D.selectTab(B,true)},load:function(C,E,B){var D=this,A=Ext.get(E);Ext.iterate(A.cmps,function(F,G){if(G.destroy){try{G.destroy()}catch(H){alert(h+H)}}});A.update(u);A.cmps={};D.showLoading(A);Ext.Ajax.request({url:C,failure:function(F,G){D.clearLoading(A);var H=['<div style="text-align:center;line-height:30px">'];switch(F.status){case 404:H.push("<H2>",F.status,_lang["ajax.error"],"</H2>",_lang["ajax.error.404"]+'"'+F.statusText+'"');break;case 500:H.push("<H2>",F.status,_lang["ajax.error"],"</H2>",_lang["tab.internet.error"],"<a href=\"javascript:$('"+D.id+"').selectTab("+B+')">',_lang["tab.internet.refresh"],"</a>");break;case 0:break;default:H.push(_lang["ajax.error"],F.statusText);break}H.push("</div>");A.update(H.join(""));A.loading=false},success:function(F,H){var K;try{K=Ext.decode(F.responseText)}catch(L){}if(K&&K.success==false){if(K.error){if(K.error.code&&K.error.code=="session_expired"){t.showErrorMessage(_lang["ajax.error"],_lang["session.expired"])}else{t.manager.fireEvent("ajaxfailed",t.manager,H.url,H.para,K);var G=K.error.stackTrace,J=K.error.message;G=G?G.replaceAll("\r\n","</br>"):u;t.showErrorMessage(_lang["window.error"],J?J+"</br>"+G:G,null,400,J&&G==u?150:250)}}A.loading=false;return}var I=F.responseText;A.set({url:C});A.update(I,true,function(){D.clearLoading(A);A.loaded=true;A.loading=false;D.fireEvent(s,D,B)},A)}})},setWidth:function(J){J=Math.max(J,2);var E=this;if(E.width==J){return}t.Tab.superclass.setWidth.call(E,J);var D=E.body,G=E.head,H=E.script,B=E.scrollLeft,A=E.scrollRight;D.setWidth(J-2);H.setWidth(J-38);if(J-38<G.getWidth()){B.setStyle({display:z});A.setStyle({display:z});H.setStyle(x,"1px");var C=H.getScroll().left,I=H.getWidth(),F=G.getWidth();if(C<=0){B.addClass(a)}else{B.removeClass(a)}if(C+I>=F){if(!A.hasClass(a)){A.addClass(a)}else{H.scrollTo(r,F-I)}}else{A.removeClass(a)}}else{B.setStyle({display:o});A.setStyle({display:o});H.setStyle(x,"0").scrollTo(r,0)}Ext.each(D.dom.children,function(K){Ext.fly(K).setWidth(J-4)})},setHeight:function(B){B=Math.max(B,25);if(this.height==B){return}t.Tab.superclass.setHeight.call(this,B);var A=this.body;A.setHeight(B-26);Ext.each(A.dom.children,function(C){Ext.fly(C).setHeight(B-28)})}})})($A);