(function(){Function.prototype.methodize=function(D){var C=this,B=Number(D||0);return function(){return C.apply(this,new Array(B).concat(Ext.toArray(arguments)))}};var e=document,a="http://www.w3.org/2000/svg",r="urn:schemas-microsoft-com:vml",m="none",t="transparent",j="px",k=!Ext.isIE9&&!!e.createElementNS&&!!e.createElementNS(a,"svg").createSVGRect,y="<v:fill color='{fillColor}' opacity='{fillOpacity}' angle='{angle}' colors='{colors}' type='{type}'></v:fill>",i="<v:stroke startarrow='{startArrow}' endarrow='{endArrow}' color='{strokeColor}' joinstyle='miter' weight='{strokeWidth}px' opacity='{strokeOpacity}'></v:stroke>",h="<v:shadow on='t' opacity='0.5' offset='5px,5px'></v:shadow>",f=/[\d-+.e]+/g,z=Math.cos,u=Math.sin,x=Math.PI,c=parseInt,n=function(B){return(B=B.trim()).toLowerCase().replace(/^./,B.charAt(0).toUpperCase())},g=function(B,D){var C=e.createElementNS(a,B);if(!Ext.isEmpty(D)){C.id=D}return Ext.get(C)},w=function(B,D){var C=e.createElement(B);if(!Ext.isEmpty(D)){C.id=D}return Ext.get(C)},q=function(B){if(k){B=B.dom||B;return B.namespaceURI==a}return false},d=function(B){if(!k){B=B.dom||B;return !!B.tagUrn&&B.tagUrn==r}return false},o=function(F,E){var C={},D,B=[];if(!Ext.isObject(F)){C[F]=E;F=C}for(D in F){B.push(D,":",F[D],";")}return B.join("")},s=function(B){if(!B){return{}}return Ext.util.JSON.decode("{"+B.replace(/^{|}$/g,"").replace(/[^:,]+:/g,function(C){return C.toLowerCase()})+"}")},l=function(B){return s(B.get("config"))},p=k?function(){var E,B=Ext.toArray(arguments);if(B.length&&Ext.isObject(B[0])){E=B.shift()}else{E=this.el||this.wrap}E=E.dom||E;var C=E.getAttribute("transform");if(!C){C="translate(0,0) scale(1,1) rotate(0,0 0)"}var D=C.split("rotate");E.setAttribute("transform",(D[0].replace(/\(([-.\d]+)\)/g,"($1,$1)")+"rotate"+D[1].replace(/\(([-.\d]+)\)/,"($1,0 0)")).replace(/[-.\d]+/g,function(F){var G=B.shift();return Ext.isEmpty(G)?F:G}))}:function(){var T,B=Ext.toArray(arguments),C={};if(B.length&&Ext.isObject(B[0])){T=Ext.get(B.shift())}else{T=this.el||this.wrap}if(!Ext.isEmpty(B[0])){T.setStyle("left",B[0]+j)}if(!Ext.isEmpty(B[1])){T.setStyle("top",B[1]+j)}if(!Ext.isEmpty(B[2])&&!Ext.isEmpty(B[3])){T.dom.coordsize.value=100/B[2]+","+100/B[3]}if(!Ext.isEmpty(B[4])){var F=T.getXY(),J=c(T.getStyle("left")||0),I=c(T.getStyle("top")||0),R=T.getWidth(),P=T.getHeight(),S=B[4],W=S*x/180,V=z(W),H=u(W),G=z(-W),N=u(-W),E=z(-W-x/2),L=u(-W-x/2),M=T.dx||J,K=T.dy||I,Q=Math.sqrt(M*M+K*K),U=Math.atan(-K/M)-W,J=J-M+Q*z(U),I=I-K-Q*u(U),D,O;if(N>=0){if(G>=0){D=J;O=I-R*N}else{D=J+P*E;O=I-R*N}}else{if(G>=0){D=J+P*E;O=I}else{D=J+R*G;O=I-P*L}}if(T.dom.tagName=="SPAN"){T.setStyle({filter:!Ext.isEmpty(S)?["progid:DXImageTransform.Microsoft.Matrix(M11=",V,", M12=",-H,", M13=100",", M21=",H,", M22=",V,", sizingMethod='auto expand')"].join(""):m,left:D+j,top:O+j})}else{T.setStyle({rotation:S})}}},A=function(){var C=1,B;return function(D){D=Ext.get(D);if(B!=D){B=D;if(q(B)){B.parent().appendChild(B)}else{B.setStyle("z-index",C++)}}}}();$A.Graphics=Ext.extend($A.Component,{constructor:function(B){var C=this;C.root=B.root;C.top=B.top||C;C.cmps=[];$A.Graphics.superclass.constructor.call(C,B);return C},initComponent:function(B){var C=this;$A.Graphics.superclass.initComponent.call(C,B);if(k){if(!C.wrap){C.initSVGWrap()}C.initSVGElement()}else{if(!C.wrap){C.initVMLWrap()}C.initVMLElement()}},initEvents:function(){$A.Graphics.superclass.initEvents.call(this);this.addEvents("click","drop","move","drawn")},processListener:function(C){var D=this,B={preventDefault:true};$A.Graphics.superclass.processListener.call(D,C);D.wrap[C]("click",D.onClick,D,B)[C]("mouseover",D.onMouseOver,D,B)[C]("mouseout",D.onMouseOut,D,B)[C]("mousedown",D.onMouseDown,D)},processDataSetLiestener:function(B){var C=this,D=C.dataset;if(D){D[B]("load",C.onLoad,C);D[B]("update",C.onUpdate,C);D[B]("add",C.onAdd,C);D[B]("remove",C.onRemove,C);D[B]("indexchange",C.onIndexChange,C)}},initSVGElement:function(){this.root=g("g").appendTo(g("svg").setStyle({height:"100%",width:"100%"}).appendTo(this.wrap))},initVMLElement:function(){if(!e.namespaces.hcv){e.namespaces.add("v",r);e.createStyleSheet().cssText="v\\:shadow,v\\:roundrect,v\\:oval,v\\:image,v\\:polyline,v\\:line,v\\:group,v\\:fill,v\\:path,v\\:shape,v\\:stroke{ behavior:url(#default#VML); display: inline-block; } "}this.root=w("v:group").setStyle({position:"absolute",width:100+j,height:100+j}).set({coordsize:"100,100"}).appendTo(this.wrap)},initProxy:function(){var C=this,B=C.wrap,D=B.dom.cloneNode(!!k);D.id=C.id+"_proxy";if(!k){new Ext.Template(B.dom.innerHTML.replace(/^<\?xml[^\/]*\/>/i,"").replace(/id\=([\S]*)/img,"id=$1_proxy")).append(D,{})}C.proxy=Ext.getBody().insertFirst(Ext.fly(D).setStyle({"background-color":t,border:m,position:"absolute","z-index":"99999"}))},onMouseDown:function(F,B){var D=this;D.fire("mousedown",F,B);if(D.candrawline){D.startLine(F,B)}else{var E=D.dataset;if(E){var C=D.getGElement(B);if(C&&C.record){E.locate(E.getAll().indexOf(C.record)+1)}}else{D.focus(B)}if(D.dropto||D.moveable){D.sw=$A.getViewportWidth();D.sh=$A.getViewportHeight();D.beforeMove(F)}}},beforeMove:function(G){var E=this,D=E.wrap,C=E.dropto,F=D.getXY();if(q(D)){var B=E.top.wrap.getXY();F[0]=E.x+B[0];F[1]=E.y+B[1]}E.relativeX=F[0]-G.getPageX();E.relativeY=F[1]-G.getPageY();if(C){if(!E.dropEl){E.dropEl=$(C)}if(!E.proxy){E.initProxy()}E.proxy.moveTo(F[0],F[1])}else{E.proxy=D}if(E.moveable){A(E.proxy)}Ext.fly(e).on("mousemove",E.onMouseMove,E).on("mouseup",E.onMouseUp,E)},onMouseMove:function(H){H.stopEvent();var G=this,D=H.getPageX()+G.relativeX,C=H.getPageY()+G.relativeY,K=G.width||G.rx*2,F=G.height||G.ry*2,I=Ext.fly(document).getScroll(),B=I.left,L=I.top,J=B+G.sw,E=L+G.sh;if(D<0){D=0}else{if((D+K)>=J){D=Math.max(J-K,0)}}if(C<0){C=0}else{if((C+F)>=E){C=Math.max(E-F,0)}}if(G.moveable){G.fireEvent("move",G,G.dataset,null,D,C)}G.proxy.moveTo(D,C)},onMouseUp:function(G){var E=this;Ext.fly(e).un("mousemove",E.onMouseMove,E).un("mouseup",E.onMouseUp,E);if(E.dropto){var C=E.dropEl.wrap,K=C.getXY(),D=K[0],J=K[1],B=D+C.getWidth(),I=J+C.getHeight(),H=G.getPageX(),F=G.getPageY();if(H>=K[0]&&F>=K[1]&&H<=B&&F<=I){E.dropEl.fireEvent("drop",E.proxy,E.top.dataset,H+E.relativeX-D+(k?4:0),F+E.relativeY-J+(k?4:0))}E.proxy.moveTo(-1000,-1000)}},onMouseOver:function(C,B){this.fire("mouseover",C,B)},onMouseOut:function(C,B){this.fire("mouseout",C,B)},onClick:function(C,B){this.fire("click",C,B)},getGElement:function(D){var C=D.id.match(/(.*)_(\d+)(_.*)*$/);if(C){var F=C[2];if(F){var E=this.top.dataset,B;if(E){B=E.findById(F)}if(C[1]){D=$(C[1]+"_"+F)}return{el:D,record:B}}}},fire:function(B,E,C){if(!C){return}var D=this.getGElement(C);if(D){this.fireEvent(B,E,D.el,this.dataset,D.record);return D.el}this.fireEvent(B,E,C)},create:function(F){var E=this,D=F.get("type"),C=l(F),G=E.renderer;C.id=E.id+"_"+F.id;if(G){var H=$A.getRenderer(G);if(H==null){alert("未找到"+G+"方法!");return}var B=H.call(window,F,D,C);if(!Ext.isEmpty(B)){if(Ext.isObject(B)){B=Ext.util.JSON.encode(B)}Ext.apply(C,s(B))}}E.createGElement(C.type||D,C)},moveTo:function(B,E){var C=this.wrap;if(q(C)){p(C,B,E)}else{var D=this.top.wrap.getXY();C.moveTo(D[0]+B,D[1]+E)}},syncFocusMask:function(C){var B=this.focusMask;if(!C.moveable){return B}var D=C.strokewidth/2+3;return B.setStyle({left:C.x-D+j,top:C.y-D+j}).setWidth(C.width+D*2).setHeight(C.height+D*2).set({title:C.info||""})},focus:function(B){var C=this;B=C.fire("focus",null,B);if(B){if(C.focusItem){C.blur()}if(C.editable){if(B.editable){B.showEditors()}if(B.moveable){if(!C.focusMask){C.focusMask=new Ext.Template('<div style="-moz-user-select:none;-webkit-user-select:none;cursor:pointer;background:none;position:absolute;border:1px dashed #000;z-index:999;"></div>').insertFirst(C.wrap.dom,{},true)}C.syncFocusMask(B).show().on("mousedown",B.onMouseDown,B)}}C.focusItem=B}else{C.fireEvent("focus")}},blur:function(){var D=this,C=D.focusItem,B=D.focusMask;if(C){if(C.editable){C.hideEditors()}if(C.moveable){if(B){B.hide().un("mousedown",C.onMouseDown,C)}}D.fire("blur",null,C);D.focusItem=null}},startLine:function(G,D){var F=this,C=F.focusMask,E=F.getGElement(C&&C.dom===D?F.focusItem:D);if(E){var B=F.wrap.getXY();F.startEl=E;F.drawLinePoints=[G.getPageX()-B[0],G.getPageY()-B[1]];Ext.fly(e).on("mousemove",F.drawLine,F).on("mouseup",F.endLine,F)}},drawLine:function(G){var F=this,I=F.wrap.getXY(),D=F.drawLinePoints[0],L=F.drawLinePoints[1],C=G.getPageX()-I[0],K=G.getPageY()-I[1],P=C-D,O=K-L,H=10,N;if(P==0){K+=O>0?-H:H}else{if(O==0){C+=P>0?-H:H}else{var J=Math.sqrt(P*P+O*O);C=(J-H)/J*P+D;K=(J-H)/J*O+L}}N=[D,",",L," ",Math.round(C),",",Math.round(K)].join("");if(!F.newline){var B=F.startEl.record,M=B.get(F.tableidfield)||B.get("table_id");F.newline=F.dataset.create({type:"line",config:'strokewidth:1,strokecolor:"#aaaaaa",strokeopacity:"1",titlecolor:"black",titlesize:14,titlex:0,titley:0,endarrow:"classic",points:"'+N+'",editable:true'+(Ext.isEmpty(M)?"":(",from:"+M))})}else{var E=l(F.newline);E.points=N;F.newline.set("config",Ext.util.JSON.encode(E))}},endLine:function(G,C){var F=this;Ext.fly(e).un("mousemove",F.drawLine,F).un("mouseup",F.endLine,F);if(F.newline){var D=F.getGElement(C);if(!D||D.el==F.startEl.el||D.record==F.newline){F.dataset.remove(F.newline)}else{var E=D.record,B=l(F.newline);B.to=E.get(F.tableidfield)||E.get("table_id");F.newline.set("config",Ext.util.JSON.encode(B));F.focus($(F.id+"_"+F.newline.id));F.fireEvent("drawn")}}delete F.drawLinePoints;delete F.newline;delete F.startEl},bind:function(D,B){var C=this;C.dataset=$(D);C.tableidfield=B||"table_id";C.processDataSetLiestener("on");C.onLoad()},onLoad:function(){var B=this;B.clear();Ext.each(B.dataset.getAll().sort(function(E,D){var C=E.get("type"),F=D.get("type");if(C==F){return 0}else{if(C==="line"){return 1}else{return -1}}}),function(C){if(!C.get("type")){C.data.type="rect";C.isNew=true}B.create(C)})},onAdd:function(D,B,C){this.create(B)},onRemove:function(E,B,C){var D=$(this.id+"_"+B.id);if(this.focusItem==D){this.focusItem=null}D.destroy()},onIndexChange:function(C,B){this.focus($(this.id+"_"+B.id))},onUpdate:function(P,E,Z,T,I){var X=this,D=$(X.id+"_"+E.id),W=l(E),G=E.get("type"),N=D.x,M=D.y,F=v[n(G)].processConfig;W.type=G,_proto=v[G=="image"?"Image":"Path"].prototype;if(F&&F(W)==false){E.set(Z,I);return}for(var Y in D.initConfig){if(Y!="dataset"&&Y!="top"&&Y!="root"&&Y!="id"){if(!Y in W){delete D[Y]}}}Ext.apply(D,W);D.initConfig=W;D.processListener("un");D.el.remove();if(D.text){D.text.remove()}if(k){D.initSVGElement=_proto.initSVGElement}else{D.initVMLElement=_proto.initVMLElement;D.vmlTpl=_proto.vmlTpl}D.initComponent(W);D.syncLineEditors(D.x-N,D.y-M);if(D==X.focusItem&&X.focusMask){X.syncFocusMask(D)}D.processListener("on");if(D.editors&&D.points){var V=0,O=D.editors,K=O[O.length-1],R=K.bindEl;if(R){var S=R.lineEditors;S.splice(S.indexOf(K),1);delete K.bindEl}for(var Q=D.points,U=Q.length;V<U;V++){var H=O[V],C=Q[V][0],B=Q[V][1];if(H){var L=H.x=C-H.width/2,J=H.y=B-H.height/2;if(k&&H.strokewidth%2==1&&D.shadow){L+=0.5;J+=0.5}H.moveTo(L,J)}else{D.createEditor(C,B)}}while(O.length>V){var H=O.pop();H.un("move",D.editorMove,D);H.destroy()}D.bindEditor(D.to)}},createGElement:function(C,B){var D=new v[n(C)](Ext.apply(B||{},{type:C,root:(B&&Ext.get(B.root))||this.root,top:this.top}));this.top.cmps.push(D);return D},createElement:function(B){return this.root.appendChild(k?g(B):w(B))},clear:function(){var B=this.cmps;while(B.length){B.pop().destroy()}this.focusItem=null},destroy:function(){var B=this;B.wrap.remove();if(B.proxy&&B.proxy!=B.wrap){B.proxy.remove()}$A.Graphics.superclass.destroy.call(B);B.processDataSetLiestener("un")},translate:p.methodize(),scale:p.methodize(2),rotate:p.methodize(4),setTopCmp:A,hasSVG:k});var v=function(){var C=0,D=function(N){var I=[],Q,H=false,L,K,O;function P(S){if(!S){I=[0,0,0,1]}else{if(S==t){I=[0,0,0,0]}else{if(S==m){I=m}else{if(/gradient/i.test(S)){H=true;var T=/^gradient\((.*)\)$/.exec(S)[1],R=/^([^stop]*),[^,]*stop/.exec(T)[1];L=/^[^,]*/.exec(R)[0];K=R.match(/[-\d%]+/g);O=function(V){var U=[];Ext.each(V,function(Y){var W=/\(([^\)]*\))\)$/.exec(Y)[1],X=/^([^,]*),(.*)$/.exec(W);U.push([X[1],X[2]])});return U}(T.match(/stop\([^\)]*\)\)/mg))}else{Q=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]?(?:\.[0-9]+)?)\s*\)/.exec(S);if(Q){I=[c(Q[1]),c(Q[2]),c(Q[3]),parseFloat(Q[4],10)]}else{Q=/^#([a-fA-F0-9]{1,2})([a-fA-F0-9]{1,2})([a-fA-F0-9]{1,2})$/.exec(S);if(Q){I=[c(J(Q[1]),16),c(J(Q[2]),16),c(J(Q[3]),16),1]}}}}}}}function J(R){return R.length==1?R+R:R}function G(S){var R=1;if(H){if(S==="gradient"){R={isGradient:H,type:L,linear:K,stops:O}}else{R=""}}else{if(S==="a"){if(!isNaN(I[3])){R=I[3]}}else{if(I&&!isNaN(I[0])){if(S==="hex"){R="#"+J(Number(I[0]).toString(16))+J(Number(I[1]).toString(16))+J(Number(I[2]).toString(16))}else{if(S==="rgb"){R="rgb("+I[0]+","+I[1]+","+I[2]+")"}else{R="rgba("+I.join(",")+")"}}}else{if(I==m){R=I}else{R=N}}}}return R}function M(S){if(I!=m&&isNumber(S)&&S!==0){var R;for(R=0;R<3;R++){I[R]+=c(S*255);if(I[R]<0){I[R]=0}if(I[R]>255){I[R]=255}}}return this}function F(R){if(N==t||I==m||Ext.isEmpty(R)){return this}I[3]=R;return this}P(N);return{get:G,brighten:M,setOpacity:F}},B=function(M,G,K,F,J){var N=G-F,L=K-J,H=M*3/2;if(N==0){K+=L>0?-H:H}else{if(L==0){G+=N>0?-H:H}else{var I=Math.sqrt(N*N+L*L);G=(I-H)/I*N+F;K=(I-H)/I*L+J}}return{x:G,y:K}},E=function(){var F={};return function(G,Q){G=G||this.d;if(F[G]){return F[G]}Q=Q||this.zoom||10000;var N=G.match(/\w|[\s\d-+.,e]*/g),P=[0,0],O=[0,0],R=[],L=function(X,Y){var S=Ext.isArray(X)?X:X.match(f);for(var W=0,T=S.length;W<T;W++){var V=O[0]+I(S[W]),U=O[1]+I(S[++W]);if(!Y||W/2%3==2){O[0]=V;O[1]=U}R=R.concat([V,U])}},K=function(ah,af){var Y=ah.match(f);while(Y.length&&Y.length%7==0){var U=I(Y.shift()),T=I(Y.shift()),X=Number(Y.shift()),V=Number(Y.shift()),ac=Number(Y.shift()),ab=I(Y.shift()),aa=I(Y.shift()),W,ae,S,Z;if(af){ab+=O[0];aa+=O[1]}var ag=Math.abs(ab-O[0]),ad=Math.abs(aa-O[1]);U=ag;T=ad;R.push(ac?"wa":"at");if((ac^V)^ab<O[0]){if(aa<O[1]){W=O[0];ae=O[1]-T}else{W=O[0]-U;ae=O[1]}}else{if(aa<O[1]){W=O[0]-U;ae=O[1]-(T<<1)}else{W=O[0]-(U<<1);ae=O[1]-T}}S=W+(U<<1);Z=ae+(T<<1);R.push(W,ae,S,Z,O[0],O[1],ab,aa);O=[ab,aa]}},J=function(T){var S=T.match(f).slice(-2);return[I(S[0]),I(S[1])]},I=function(S){return Number(Number(S*Q).toFixed(0))},H=function(V){for(var U=0,T=V.match(f),S=T.length;U<S;U++){R.push(I(T[U]))}};for(var M=0;M<N.length;M++){switch(N[M]){case"M":P=J(N[M+1]);case"C":case"L":O=J(N[M+1]);R.push(N[M]);H(N[++M]);break;case"m":R.push("M");L(N[++M]);P=[].concat(O);break;case"c":R.push("C");L(N[++M],true);break;case"l":R.push("L");L(N[++M]);break;case"h":R.push("L");L(N[++M]+" 0");break;case"v":R.push("L");L("0 "+N[++M]);break;case"H":R.push("L");O[0]=I(N[++M]);R.push(O[0],O[1]);break;case"V":R.push("L");O[1]=I(N[++M]);R.push(O[0],O[1]);break;case"A":K(N[++M]);break;case"a":K(N[++M],true);break;case"Z":case"z":R.push("X");O=[].concat(P);break}}R.push("E");F[G]=R.join(" ");return F[G]}}();return{Path:Ext.extend($A.Graphics,{zoom:10000,constructor:function(F){this.lineEditors=[];return v.Path.superclass.constructor.call(this,F)},initComponent:function(F){F.fillcolor=D(F.fillcolor).setOpacity(F.fillopacity);F.fillopacity=F.fillcolor.get("a");F.strokecolor=D(F.strokecolor).setOpacity(F.strokeopacity);F.strokeopacity=F.strokecolor.get("a");v.Path.superclass.initComponent.call(this,F);var G=this,H=G.title;if(k){if(H){G.initSVGTitle()}G.initSVGInfo();if(G.shadow){G.initSVGShadow()}}else{if(H){G.initVMLTitle()}G.initVMLInfo()}},initSVGWrap:function(){this.wrap=this.root.appendChild(g("g",this.id))},initVMLWrap:function(){this.wrap=this.root.appendChild(w("v:group",this.id))},initSVGElement:function(){var O=this,H=O.wrap,P=O.d,J={d:P,fill:O.createGradient(O.fillcolor.get("gradient"))},N=O.fillcolor.get(),K=O.strokecolor.get("hex"),V=O.strokewidth,I=O.strokeopacity,M=O.startarrow,U=O.endarrow,F=(O.el=g("path",O.id+"_el")).dom.style,S=O.x,Q=O.y;if(S||Q){if(V&&V%2==1&&!O.shadow){S+=0.5;Q+=0.5}p(H,S,Q)}F.cssText=o({fill:N,"fill-opacity":O.fillopacity,stroke:K,"stroke-width":V,"stroke-opacity":V?I:0,cursor:O.cursor||"pointer"})+O.style;if(V){if(!F.stroke){K=F.stroke="#000";I=F.strokeOpacity=0}if(M||U){var R=P.match(f),L=R.length,G="-"+K+"-"+I*100;if(M){J["marker-start"]="url(#start-arrow-"+M+G+")";var T=B(V,Number(R[0]),Number(R[1]),Number(R[2]),Number(R[3]));R[0]=T.x;R[1]=T.y;J.d=J.d.replace(/[\d-+.]+\s+[\d-+.]+/,T.x+" "+T.y)}if(U){J["marker-end"]="url(#end-arrow-"+U+G+")";var T=B(V,Number(R[L-2]),Number(R[L-1]),Number(R[L-4]),Number(R[L-3]));J.d=J.d.replace(/([\d-+.]+\s+[\d-+.]+)[^\d]*$/,T.x+" "+T.y)}new v.Arrow({color:K,width:V,opacity:I,endarrow:U,startarrow:M,root:O.root})}}H.insertFirst(O.el.set(J))},initVMLElement:function(){var I=this,G=I.fillcolor.get("rgb"),F=I.strokecolor.get("rgb"),L=true,K=true,J=true,H=I.zoom;if(Ext.isEmpty(I.strokewidth)){I.strokewidth=1}if(F==m||I.strokeopacity==0||I.strokewidth==0){L=false}if(G==m){K=false}I.wrap.setStyle({position:"absolute",width:100+j,height:100+j,left:(I.x||0)+j,top:(I.y||0)+j}).set({coordsize:"100,100",title:I.info||""});I.el=new Ext.Template(I.getVmlTpl(L,K,I.shadow)).insertFirst(I.wrap.dom,Ext.apply({id:I.id+"_el",style:I.style,path:I.path||E.call(I),zoom:H,fillColor:G,fillOpacity:I.fillopacity,strokeColor:F,strokeWidth:I.strokewidth,strokeOpacity:I.strokeopacity,endArrow:I.endarrow,startArrow:I.startarrow,cursor:I.cursor||"pointer"},I.createGradient(I.fillcolor.get("gradient"))),true)},createGradient:k?function(H){if(!H.isGradient){return m}var J="graphics-gradient"+C++,G=H.linear,F=this.root,I=(F.child("defs")||F.insertFirst(g("defs"))).appendChild(g(H.type+n("gradient"),J).set({x1:G[0],y1:G[1],x2:G[2],y2:G[3],gradientUnits:"userSpaceOnUse"}));Ext.each(H.stops,function(L){var K=D(L[1]);I.appendChild(g("stop").set({offset:L[0],"stop-color":K.get("rgb"),"stop-opacity":K.get("a")}))});return"url("+location.href+"#"+J+")"}:function(I){if(!I.isGradient){return{}}var K=I.type=="linear"?"gradient":"",H=I.linear,L=this.top,J=L.width,F=L.height,G=[];Ext.each(H,function(N,M){if(/\%/.test(N)){N=c(N)/100;H[M]=(M%2==0?J:F)*N}});Ext.each(I.stops,function(M){G.push(M[0]," ",D(M[1]).get("rgb"),";")});return{type:K,angle:Math.atan((H[2]-H[0])/(H[3]-H[1]))/(x/180)+180,colors:G.join(""),fillOpacity:1}},initSVGShadow:function(){var I="graphics-filter-shadow";if(!Ext.get(I)){var F=this.root,G=(F.child("defs")||F.insertFirst(g("defs"))).appendChild(g("filter",I).set({x:-0.25,y:-0.25,width:1.5,height:1.5,"color-interpolation-filters":"sRGB"}));G.appendChild(g("feGaussianBlur").set({result:"blur",stdDeviation:1,"in":"SourceAlpha"}));G.appendChild(g("feColorMatrix").set({values:"1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.6 0 ",type:"matrix",result:"bluralpha"}));G.appendChild(g("feOffset").set({result:"offsetBlur",dx:5,dy:5,"in":"bluralpha"}));var H=G.appendChild(g("feMerge"));H.appendChild(g("feMergeNode").set({"in":"offsetBlur"}));H.appendChild(g("feMergeNode").set({"in":"SourceGraphic"}))}this.el.setStyle({filter:"url(#"+I+")"})},initSVGTitle:function(){var F=this;F.text=v.Text.prototype.initSVGElement.call({text:F.title,id:F.id+"_title",size:F.titlesize||14,dx:F.titlex||0,dy:F.titley||0,color:F.titlecolor,fontfamily:F.titlefontfamily,rotation:F.titlerotation,wrap:F.wrap,style:"cursor:pointer;-webkit-user-select:none"})},initVMLTitle:function(){var J=this,F=J.titlex||0,K=J.titley||0,I=J.titlesize||14,G=J.wrap;if(J.type=="line"||J.type=="path"){F+=J.x;K+=J.y;G=J.top.wrap}else{var H=J.strokewidth;F+=H/2;K+=H/2}J.text=v.Text.prototype.initVMLElement.call({text:J.title,id:J.id+"_title",size:I,dx:F,dy:K,color:J.titlecolor,fontfamily:J.titlefontfamily,rotation:J.titlerotation,wrap:G,positionwrap:J,vmlTpl:v.Text.prototype.vmlTpl})},initSVGInfo:function(){var F=this,G=F.info;if(G){if(!F.infoEl){F.wrap.appendChild(F.infoEl=g("title"))}F.infoEl.dom.textContent=G}else{if(F.infoEl){F.infoEl.remove();F.infoEl=null}}},initVMLInfo:function(){this.wrap.set({title:this.info||""})},createEditors:function(){var F=this;if(F.editable){F.editors=[];Ext.each(F.points,function(G){F.createEditor(G[0],G[1])});F.bindEditor(F.from,true);F.bindEditor(F.to)}},bindEditor:function(K,F){if(!Ext.isEmpty(K)){var J=this.editors,I=this.top;tr=I.dataset.find(I.tableidfield,K);if(tr){var H=$(I.id+"_"+tr.id);if(H){var G=J[F?0:J.length-1];G.bindEl=H;H.lineEditors.push(G)}}}},syncLineEditors:function(G,F){Ext.each(this.lineEditors,function(H){H.moveTo(H.x+=G,H.y+=F);H.fireEvent("move")})},createEditor:function(F,J){var H=this,I=H.editors,G=I.length;I[G]=new v.Oval({id:H.id+"_editor"+G,x:F-5,y:J-5,height:10,width:10,strokewidth:1,strokecolor:"rgba(0,0,0,1)",fillcolor:t,root:H.root,top:H.top,moveable:true});I[G].on("move",H.editorMove,H)},editorMove:function(J,K,G,F,L){var G=this.getRecord(),H=l(G),I=[];Ext.each(this.editors,function(M){I.push((M.x+5)+","+(M.y+5))});H.points=I.join(" ");G.set("config",Ext.util.JSON.encode(H))},showEditors:function(){Ext.each(this.editors,function(F){A(F.wrap.show())})},hideEditors:function(){Ext.each(this.editors,function(F){F.wrap.hide()})},clearEditors:function(){var F=this;Ext.each(F.editors,function(G){var H=G.bindEl;if(H&&H.lineEditors){H.lineEditors.remove(G)}G.un("move",F.editorMove,F);G.destroy()});F.editors=null},onMouseDown:function(H){var F=this,G=F.top;if(G.editable&&!G.candrawline){if(F.dropto||F.moveable){F.beforeMove(H)}else{if(F.editable){A(F.wrap)}}}},onMouseMove:function(T){T.stopEvent();var Y=this,I=Y.wrap,M=Y.top,K=Y.width||Y.rx*2,R=Y.height||Y.ry*2,L=M.wrap,O=L.getWidth(),W=L.getHeight(),G=Y.strokewidth||0,S=L.getXY(),X=T.getPageX()+Y.relativeX-S[0],U=T.getPageY()+Y.relativeY-S[1],J=Y.x,H=Y.y,Q,P;b=0;if(G&&d(I)){b=-G/2}if(X<=b){X=b}else{if(X+K-b>O-2){X=O-2-K+b}}if(U<=b){U=b}else{if(U+R-b>W-2){U=W-2-R+b}}Q=Y.x=Math.round(X-b);P=Y.y=Math.round(U-b);if(Y.moveable){var N=M.dataset,F=N.getCurrentRecord(),V=l(F),G=V.strokewidth/2;V.x=Q;V.y=P;M.syncFocusMask(V);F.data.config=Ext.util.JSON.encode(V).replace(/^{|}$/g,"");F.dirty=true;Y.fireEvent("move",Y,N,F,Q-b,P-b);M.fireEvent("move",Y,N,F,Q-b,P-b)}if(q(I)){if(G%2==1&&!Y.shadow){X+=0.5;U+=0.5}p(Y.proxy,X,U)}else{Y.proxy.moveTo(X+S[0],U+S[1])}Y.syncLineEditors(Q-J,P-H)},getRecord:function(){var F=this.id.match(/(.*)_(\d+)(_.*)*$/),G=this.top.dataset;if(F&&G){return G.findById(F[2])}},destroy:function(){var G=this,F=G.focusMask,H=G.text;G.clearEditors();F&&F.un("mousedown",G.onMouseDown,G).remove();H&&H.remove&&H.remove();v.Path.superclass.destroy.call(G)},getVmlTpl:function(G,H,I){var F=['<v:shape id="{id}" filled="',H,'" stroked="',G,'" coordsize="{zoom},{zoom}" style="position:absolute;left:0;top:0;width:1px;height:1px;cursor:{cursor};{style}" path="{path}">'];if(H){F.push(y)}if(G){F.push(i)}if(I){F.push(h)}F.push("</v:shape>");return F}}),Group:Ext.extend($A.Graphics,{initSVGWrap:function(){this.wrap=this.root.appendChild(g("g",this.id))},initVMLWrap:function(){this.wrap=this.root.appendChild(w("v:group",this.id).setStyle({position:"absolute",width:100+j,height:100+j}).set({coordsize:"100,100"}))},initSVGElement:function(){},initVMLElement:function(){}}),Line:function(G){if(v.Line.processConfig(G)==false){return}var F=new v.Path(G);F.createEditors();F.hideEditors();return F},Oval:function(F){v.Oval.processConfig(F);return new v.Path(F)},Arc:function(F){v.Arc.processConfig(F);return new v.Path(F)},Rect:function(F){v.Rect.processConfig(F);return new v.Path(F)},Diamond:function(F){v.Diamond.processConfig(F);return new v.Path(F)},Arrow:function(){var F,I,M,K,L={viewBox:"0 0 100 100",refX:50,refY:50,orient:"auto"},G="start-arrow-",J="end-arrow-",H="M 100 0 L 0 50 L 100 100 L 66.66 50 z",O="M 0 0 L 100 50 L 0 100 L 33.33 50 z",N=function(R,Q){if(R){var P=(Q?G:J)+R+F;Ext.get(P)||new v.Path({fillcolor:I,fillopacity:M,d:Q?H:O,root:K.appendChild(g("marker",P).set(L))})}};return function(Q){if(!Q.startarrow&&!Q.endarrow){return}var P=Q.root;K=P.child("defs")||P.insertFirst(g("defs"));I=Q.color||"#000000";M=Q.opacity||1;F="-"+I+"-"+M*100;N(Q.startarrow,true);N(Q.endarrow)}}()}}();Ext.apply(v,{Image:Ext.extend(v.Path,{initSVGElement:function(){var D=this,C=D.wrap,B=D.x,F=D.y,E=(D.el=C.appendChild(g("image",D.id+"_el").set({x:0,y:0,width:D.width,height:D.height}))).dom;E.style.cssText=o({stroke:D.strokecolor,"stroke-width":D.strokewidth,"stroke-opacity":D.strokeopacity,"-moz-user-select":m})+D.style;E.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",D.image);if(B||F){p(C,B,F)}},initVMLElement:function(){var C=this,B=C.strokecolor;C.el=new Ext.Template(C.vmlTpl).append(C.wrap.setStyle({position:"absolute",width:100+j,height:100+j,left:C.x+j,top:C.y+j}).set({coordsize:"100,100"}).dom,{id:C.id+"_el",src:C.image,style:C.style,width:C.width,height:C.height,strokeColor:B||m,strokeWidth:B?C.strokewidth:0,strokeOpacity:B?(C.strokeopacity||1):0},true)},vmlTpl:['<v:image id="{id}" src="{src}" style="position:absolute;left:0;top:0;width:{width}px;height:{height}px;{style}">',i,"</v:image>"]}),Text:Ext.extend(v.Path,{initSVGWrap:function(){this.wrap=this.root.appendChild(g("g",this.id))},initVMLWrap:function(){this.wrap=this.root.appendChild(w("v:group",this.id))},initSVGElement:function(){var D=this,C=D.rotation,B=D.size||14,E=(D.el=D.wrap.appendChild(g("text",D.id+"_el").set({dx:D.dx+1,dy:D.dy+B-2}))).dom;E.style.cssText=o({fill:D.color,"font-size":B+j,"font-family":D.fontfamily,"line-height":B+j,cursor:"text"})+D.style;E.textContent=D.text;if(!Ext.isEmpty(C)){p(D.el,null,null,null,null,C)}return D.el},initVMLElement:function(){var G=this,E=G.size||14,D=G.rotation,C=G.positionwrap,F=G.el=new Ext.Template(G.vmlTpl).append(G.wrap.dom,{id:G.id+"_el",style:o({"line-height":E+j,"font-size":E+j,"font-family":G.fontfamily})+G.style,left:G.dx,top:G.dy,color:G.color||"black"},true).update(G.text);if(!Ext.isEmpty(D)){var B,H;if(C){B=C.x;H=C.y;F.dx=C.titlex;F.dy=C.titley}p(F,null,null,null,null,D,B,H)}return F},vmlTpl:"<span id='{id}' unselectable='on'  onselectstart='return false;' style='position:absolute;left:{left}px;top:{top}px;color:{color};cursor:pointer;white-space:nowrap;{style}'></span>"})});v.Line.processConfig=function(E){var D=E.points.match(f),G=[];if(!D){return false}for(var F=0,C=D.length;F<C;F+=2){G.push([D[F],D[F+1]])}if(G.length<2){return false}var B=Number(G[0][0]),H=Number(G[0][1]);D=["M",0,0,"L"];Ext.each(G,function(I){D.push(I[0]-B,I[1]-H)});E.d=D.join(" ");if(E.strokewidth==1){E.strokewidth=2}E.fillcolor=m;E.points=G;E.x=B;E.y=H};v.Rect.processConfig=function(F){var G=Number(F.height)||200,I=Number(F.width)||200,C=Math.min(Number(F.rx)||0,I/2),B=Math.min(Number(F.ry)||0,G/2),J=C>0&&B>0,E=C!=I/2,D=B!=G/2,H=["M",0,J?B:0];if(J){H.push("A",C,B,0,0,1,C,0)}if(E){H.push("H",I-(J?C:0))}if(J){H.push("A",C,B,0,0,1,I,B)}if(D){H.push("V",G-(J?B:0))}if(J){H.push("A",C,B,0,0,1,I-C,G)}if(E){H.push("H",J?C:0)}if(J){H.push("A",C,B,0,0,1,0,G-B)}if(D){H.push("Z")}F.d=H.join(" ")};v.Oval.processConfig=function(B){B.height=B.height||B.ry*2;B.width=B.width||B.rx*2;B.ry=B.height/2;B.rx=B.width/2;v.Rect.processConfig(B)};v.Arc.processConfig=k?function(N){var L=N.x,K=N.y,D=N.start%(2*x),I=N.r,E=N.end%(2*x)-0.000001,J=N.innerR||0,G=N.open,H=z(D),B=u(D),C=z(E),M=u(E),F=(E>D?E:E+2*x)-D<x?0:1;N.d=["M",L+I*H,K-I*B,"A",I,I,0,F,0,L+I*C,K-I*M,G?"M":"L",L+J*C,K-J*M,"A",J,J,0,F,1,L+J*H,K-J*B,G?"":"Z"].join(" ");N.x=0;N.y=0}:function(P){var N=P.zoom||10000,L=P.x*N,K=P.y*N,D=P.start,E=P.end,H=P.r*N,G=z(D),B=u(D),C=z(E),M=u(E),J=(P.innerR||0)*N,O=0.08/H,F=(J&&0.1/J)||0,I;if(E-D===0){return["x"]}I=["at",c(-H),c(-H),c(H),c(H),c(H*G),c(-H*B),c(H*C),c(-H*M)];if(J){I.push("wa",c(-J),c(-J),c(J),c(J),c(J*C),c(-J*M),c(J*G),c(-J*B))}I.push("x","e");P.path=I.join(" ")};v.Diamond.processConfig=function(C){var D=Number(C.height)||100,B=Number(C.width)||200,E=["M",0,D/2,"L",B/2,0,B,D/2,B/2,D,"Z"];C.d=E.join(" ")}})();