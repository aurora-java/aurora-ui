(function(aH){var aL=document,bd=aL.documentElement,am=Ext.each,ao=Ext.isEmpty,O=false,ak=true,aE=null,a9=aH.CheckBox,al="_",k="__",w=".",r=" ",x="",E="]",aF="-c",au="-u",aT="-l-",aN="-u-",aU="on",at="px",ba="tr",a="td",bf="th",b="_tb",aw="div",n="top",c="left",aq="none",Y="width",R="center",az="hidden",aX="cursor",av="",aG="default",ae="w-resize",g="outline",aY="1px dotted blue",aZ="atype",e="append",aS="insertBefore",a4="insertAfter",f="before",l="_navbar",a7="text-overflow",D="recordid",W="dataindex",ah="row-selected",T="required",aP="item-notBlank",ay="item-invalid",d="row-alt",F="grid-rowbox",a2=w+F,u="grid.rowcheck",B="grid.rowradio",G="grid.head",bb="grid-ckb ",aj="grid-select-all",ap="multiple",aC="checkedvalue",y="-readonly",J="item-ckb",ab=J+"-self",bc=w+ab,aM=J+au,aV=J+aF,Q=J+y+au,aa=J+y+aF,ac="item-radio-img",a3=ac+aF,aR=ac+au,X=ac+y+aF,I=ac+y+au,a8=bc+r+w+aV,q="grid-cell",h="cell-editor",P="cellcheck",ad="rowcheck",af="rowradio",ax="rownumber",j="grid-",bh=j+ax,aW="desc",o="asc",i=j+aW,aO=j+o,p="click",be="dblclick",N="cellclick",v="render",a6="rowclick",aA="editorshow",Z="nexteditorshow",a0="keydown",ar="select",z="mousedown",aD="mousemove",an="mouseup",t="createrow",M="addrow",ag="未找到",aQ="方法!",S="tr[class!=grid-hl]",s="div[atype=grid.headcheck]",a1="["+W+"=",bg=bf+a1,ai=a+a1,m={autoadjust:ak,forexport:ak,hidden:O,lock:O,resizable:ak,rowspan:1,sortable:ak,width:100},aK=function(C,A){return C},V=function(C,U,bk,bj){if(U.length){var bi=[],A=[],bl=U.shift();if(Ext.isDefined(bk)){bi.value=bk;bi.colname=bj}am(C,function(bo){var bm=bo.get(bl);var bn=L(A,bm);if(!bn){A.push(bn=[]);if(ao(bm)){bn.value=K(bo,bl)}else{bn.value=bm}bn.colname=bl}bn.push(bo)});am(A,function(bn,bm){bi.push(V(bn,[].concat(U),bn.value,bn.colname))});return bi}else{return C}},aJ=function(A){var C=[];am(A,function(U){if(Ext.isArray(U)){C=C.concat(aJ(U))}else{C.push(U)}});return C},L=function(A,C){var U=null;am(A,function(bi){if(bi.value==C){U=bi;return O}});return U},aB=function(A,C){var U=null;am(A,function(bi){if(bi.value==C||bi.value&&(bi=aB(bi,C))){U=bi;return O}});return U},a5=function(A,C){var U=null;am(A,function(bi){if(bi.value?a5(bi,C):bi===C){U=bi;return O}});return U},aI=function(C,U,A){am(C,function(bi){if(Ext.isArray(bi)){aI(bi,U,C)}else{C.remove(U);return O}});if(C&&!C.length&&A){A.remove(C)}},H=function(){function A(C,U,bj){var bl=O,bi=bj.shift(),bk;if(!bi){return U}bk=U.get(bi);if(ao(bk)){bk=K(U,bi)}else{am(C,function(bm){if(Ext.isArray(bm)){if(bk==bm.value){bl=bm;return O}}})}if(!bl&&bi){bl=[];bl.colname=bi;bl.value=bk}bl.add(A(bl,U,bj));return bl}return function(C,U,bj){var bi=[];Ext.each(bj,function(bk){if(bk.group){bi.push(bk.name)}});C.add(A(C,U,bi));am(aJ(a5(C,U)),function(bk){if(bk!==U){var bl=bk.ds;bl[bk.isSelected?"select":"unSelect"](U);return O}})}}(),K=function(A,C){return"____empty__group__"+A.id+"__"+C+"___"};aH.Grid=Ext.extend(aH.Component,{constructor:function(A){var C=this;C.selectedId=aE;C.lockWidth=0;C.editorborder=ak;C.autofocus=ak;aH.Grid.superclass.constructor.call(C,A);aH.onReady(function(){C.autofocus&&C.focus()})},initComponent:function(A){aH.Grid.superclass.initComponent.call(this,A);var U=this,C=U.wrap,bi=U.wb=Ext.get(U.id+"_wrap");U.fb=bi.child("div[atype=grid.fb]");if(U.fb){U.uf=U.fb.child("div[atype=grid.uf]")}U.uc=C.child("div[atype=grid.uc]");U.uh=C.child("div[atype=grid.uh]");U.ub=C.child("div[atype=grid.ub]");U.uht=C.child("table[atype=grid.uht]");U.lc=C.child("div[atype=grid.lc]");U.lh=C.child("div[atype=grid.lh]");U.lb=C.child("div[atype=grid.lb]");U.lht=C.child("table[atype=grid.lht]");U.sp=C.child("div[atype=grid.spliter]");Ext.getBody().insertFirst(U.sp);U.classfiyColumns();U.initTemplate()},processListener:function(A){var C=this;aH.Grid.superclass.processListener.call(C,A);C.wrap[A](z,C.onMouseDown,C);if(C.canwheel!==O){C.wb[A]("mousewheel",C.onMouseWheel,C)}C.wb[A](Ext.isOpera?"keypress":a0,C.handleKeyDown,C)[A]("keyup",C.handleKeyUp,C)[A]("focus",C.onFocus,C)[A]("blur",C.onBlur,C);C.ub[A]("scroll",C.syncScroll,C)[A](p,C.onClick,C)[A](be,C.onDblclick,C);C.uht[A](aD,C.onUnLockHeadMove,C);C.uh[A](z,C.onHeadMouseDown,C)[A](p,C.onHeadClick,C);if(C.lb){C.lb[A]("scroll",C.syncScroll,C)[A](p,C.onClick,C)[A](be,C.onDblclick,C)}if(C.lht){C.lht[A](aD,C.onLockHeadMove,C)}if(C.lh){C.lh[A](z,C.onHeadMouseDown,C)[A](p,C.onHeadClick,C)}C[A](N,C.onCellClick,C)},initEvents:function(){aH.Grid.superclass.initEvents.call(this);this.addEvents(v,a0,be,N,a6,aA,Z,t)},syncScroll:function(U,A){var C=this;C.hideEditor();C.uh.dom.scrollLeft=C.ub.dom.scrollLeft;if(C.lb){if(C.lb.dom===A){C.ub.dom.scrollTop=C.lb.dom.scrollTop}else{C.lb.dom.scrollTop=C.ub.dom.scrollTop}}if(C.uf){C.uf.dom.scrollLeft=C.ub.dom.scrollLeft}},handleKeyUp:function(A){if(A.getKey()==9){this.showEditorByRecord()}},handleKeyDown:function(bi){var C=this,A=bi.getKey(),U=C.dataset;if(bi.ctrlKey&&bi.keyCode==86&&C.canpaste){var bj=window.clipboardData.getData("text");if(bj){am(bj.split("\n"),function(bn){var bl=bn.split("\t");if(bl==x){return}var bm={},bk=0;am(C.columns,function(bo){if(C.isFunctionCol(bo.type)){return}if(bo.hidden!==ak){bm[bo.name]=bl[bk];bk++}});U.create(bm)})}}else{if(A==9){C.showEditorByRecord()}else{if(A==38||A==40||A==33||A==34){if(U.loading==ak){return}switch(bi.getKey()){case 33:U.prePage();break;case 34:U.nextPage();break;case 38:if(!bi.ctrlKey){U.pre()}break;case 40:if(!bi.ctrlKey){U.next()}break}bi.stopEvent()}}}C.fireEvent(a0,C,bi)},processDataSetLiestener:function(A){var C=this,U=C.dataset;if(U){U[A]("ajaxfailed",C.onAjaxFailed,C);U[A]("metachange",C.onRefresh,C);U[A]("update",C.onUpdate,C);U[A]("reject",C.onUpdate,C);U[A]("add",C.onAdd,C);U[A]("submit",C.onBeforSubmit,C);U[A]("submitfailed",C.onAfterSuccess,C);U[A]("submitsuccess",C.onAfterSuccess,C);U[A]("query",C.onBeforeLoad,C);U[A]("load",C.onLoad,C);U[A]("loadfailed",C.onAjaxFailed,C);U[A]("valid",C.onValid,C);U[A]("beforeremove",C.onBeforeRemove,C);U[A]("remove",C.onLoad,C);U[A]("clear",C.onLoad,C);U[A]("refresh",C.onRefresh,C);U[A]("fieldchange",C.onFieldChange,C);U[A]("indexchange",C.onIndexChange,C);U[A]("select",C.onSelect,C);U[A]("unselect",C.onUnSelect,C);U[A]("selectall",C.onSelectAll,C);U[A]("unselectall",C.onUnSelectAll,C);U[A]("wait",C.onWait,C);U[A]("afterwait",C.onAfterSuccess,C)}},bind:function(C){if(Ext.isString(C)){C=$(C);if(!C){return}}var A=this;A.dataset=C;A.processDataSetLiestener(aU);if(C.autopagesize===ak&&C.fetchall!==ak){C.pagesize=Math.max(0,Math.floor((A.ub.getHeight()||parseFloat(A.ub.dom.style.height))/25)-1);if(isNaN(C.pagesize)||C.pagesize==0){C.pagesize=1}if(C.getAll().length||C.qtId){C.query();return}}A.onLoad()},initTemplate:function(){var A=this;A.rowTdTpl=new Ext.Template(["<td {rowSpan} ",aZ,'="{',aZ,'}" class="',F,' item-ckb-self" ',D,'="{',D,'}">']);A.rowNumTdTpl=new Ext.Template(['<td {rowSpan} style="text-align:{align}" class="',bh,'" ',aZ,'="',bh,'" ',D,'="{',D,'}">']);A.rowNumCellTpl=new Ext.Template(['<div class="',q,'">{text}</div>']);A.tdTpl=new Ext.Template(['<td class="{celltdcls}" {rowSpan} style="visibility:{visibility};text-align:{align}" ',W,'="{name}" ',aZ,'="',q,'" ',D,'="{',D,'}">']);A.cellTpl=new Ext.Template(['<div class="',q,' {cellcls}" style="',Y,":{",Y,'}px" id="',A.id,'_{name}_{recordid}" title="{title}">{celleditordiv}<span>{text}</span></div>']);A.cbTpl=new Ext.Template(['<center><div class="{cellcls}" id="',A.id,"_{name}_{",D,'}"></div></center>'])},getCheckBoxStatus:function(A,bi,U){var bk=A.getField(bi),C=bk.get(aC),bj=A.data[bi];return J+(U?y:x)+((bj&&bj==C)?aF:au)},createTemplateData:function(C,A){return{recordid:A.id,visibility:C.hidden===ak?az:av,name:C.name}},createCell:function(bm,bi,bn,bj){var bw=this,bx=bw.createTemplateData(bm,bi),bp,bv=bw.tdTpl,U=x,bu=x,bl=bm.type,br,bk=bw.getEditor(bm,bi,ak),A=[];if(bk!=x){var bt=aH.CmpManager.get(bk);if(bt&&(bt instanceof a9)){bl=P}else{if(bw.editorborder){U=h}else{bx.celleditordiv='<div class="cell-editor-div"></div>'}}}else{if(bm.name&&!ao(bi.getField(bm.name).get(aC))){bl=P;br=ak}}if(bl==ad||bl==af){var bs=bw.dataset,bo=bs.getSelected().indexOf(bi)==-1?au:aF;br=bs.execSelectFunction(bi)?x:y;bv=bw.rowTdTpl;Ext.apply(bx,{align:R,atype:bl==ad?u:B,cellcls:bl==ad?bb+J+br+bo:"grid-radio "+ac+br+bo});bp=bw.cbTpl}else{if(bl==P){Ext.apply(bx,{align:R,cellcls:bb+bw.getCheckBoxStatus(bi,bm.name,br)});bp=bw.cbTpl}else{var C=bi.getMeta().getField(bm.name);if(C&&ao(bi.data[bm.name])&&bi.isNew==ak&&C.get(T)==ak){U=U+r+aP}var bq=bw.renderText(bi,bm,bi.data[bm.name]);Ext.apply(bx,{align:bm.align||c,cellcls:U,celltdcls:bu,text:bq,title:bm.showtitle?$A.unescapeHtml(String(bq).replace(/<[^<>]+>/mg,x)):""});if(bl==ax){bv=bw.rowNumTdTpl;bp=bw.rowNumCellTpl}else{bp=bw.cellTpl}}}if(bj){bx.rowSpan="rowSpan="+bj}if(!bn){A.push(bv.applyTemplate(bx))}else{if(bn!=ak&&bu){Ext.fly(bn).addClass(bu)}}A.push(bp.applyTemplate(bx));if(!bn){A.push("</td>")}return A.join(x)},createRow:function(bk,bp,bm,bn,bq,C){var bi=this;if(Ext.isArray(bn)){return bn.map(function(bt,br,bs){if(bs=bt.colname){bq=bq||{};bq[bs]=aJ(bt).length;bq[bs+"_count"]=ak}return bi.createRow(bk,bp,bm,bt,bq,!br)}).join("")}else{var A={},bj=aE,bo=O,U=bi.parseCss(bi.renderRow(bn,bp));bi.fireEvent(t,bi,bp,bn,A,bm);if(A.height){U.style=(U.style||"")+";height:"+A.height+"px;"}var bl=['<tr id="',bi.id,bk,bn.id,'"  _row="'+bn.id+'" class="',(bp%2==0?x:d),r,U.cls,'"','style="',U.style,'" height="25">'];am(bm,function(br){if(br.hidden&&br.visiable==O){return}var bs;if(bi.isFunctionCol(br.type)){bs="__rowbox__"}else{bs=br.name;if(A.name&&!A.height&&!bo){bj=aE;if(bs==A.name){bo=ak}else{bj=2}}}bj=bq&&bq[bs];if(!bj||bq[bs+"_count"]){bl.push(bi.createCell(br,bn,aE,bj))}if(bq&&bq[bs+"_count"]){bq[bs+"_count"]=O}});bl.push("</tr>");bl.push(A.html||"");return bl.join(x)}},parseCss:function(U){var bj=x,A=x;if(Ext.isArray(U)){for(var C=0;C<U.length;C++){var bi=this.parseCss(U[C]);bj+=";"+bi.style;A+=r+bi.cls}}else{if(Ext.isString(U)){var bk=!!U.match(/^([^,:;]+:[^:;]+;)*[^,:;]+:[^:;]+;*$/);A=bk?x:U;bj=bk?U:x}}return{style:bj,cls:A}},renderText:function(A,C,bj){var bi=C.renderer,bj=$A.escapeHtml(bj);if(bi){var U=aH.getRenderer(bi);if(U==aE){alert(ag+bi+aQ);return bj}bj=U(bj,A,C.name)}return bj==aE?x:bj},renderRow:function(A,bj){var bi=this.rowrenderer,C=aE;if(bi){var U=aH.getRenderer(bi);if(U==aE){alert(ag+bi+aQ);return C}C=U(A,bj);return !C?x:C}return C},createTH:function(U){var bj=['<tr class="grid-hl">'];for(var C=0,A=U.length;C<A;C++){var bi=U[C];if(bi.hidden&&bi.visiable==O){continue}bj.push("<th ",W,'="',bi.name,'" style="height:0px;width:',bi.width,at,'"></th>')}bj.push("</tr>");return bj.join(x)},onBeforeRemove:function(){aH.Masker.mask(this.wb,_lang["grid.mask.remove"])},onWait:function(){aH.Masker.mask(this.wb,_lang["grid.mask.waiting"])},onBeforeLoad:function(){this.ub.scrollTo(c,0);this.uh.scrollTo(c,0);aH.Masker.mask(this.wb,_lang["grid.mask.loading"])},onBeforSubmit:function(A){if(this.submask==ak){aH.Masker.mask(this.wb,_lang["grid.mask.submit"])}},onFetching:function(A){var C=this;C.isFetching=ak;aH.Masker.mask(C.wb,_lang["grid.mask.fetching"]);A.on("fetched",C.onFetched,C)},onFetched:function(A){var C=this;C.isFetching=O;aH.Masker.unmask(C.wb);A.un("fetched",C.onFetched,C);A.un("fetching",C.onFetching,C)},onAfterSuccess:function(){aH.Masker.unmask(this.wb)},preLoad:function(){},onLoad:function(){var U=this,bi=U.dataset,C=bi.getCurrentRecord(),A=bi.getAll().length;U.isSelectAll=O;U.clearDomRef();U.preLoad();U.processGroups();if(!A||bi.getSelected().length!=A){U.wrap.removeClass(aj);U.initHeadCheckStatus(O)}else{U.initHeadCheckStatus(ak)}if(U.lb){U.renderLockArea()}U.renderUnLockAread();U.drawFootBar();C&&U.onIndexChange(bi,C);aH.Masker.unmask(U.wb);U.fireEvent(v,U)},processGroups:function(){var C=this,U=C.dataset,A=[];C.groups=[].concat(U.getAll());Ext.each(C.columns,function(bi){bi.group&&A.push(bi.name)});if(A.length){aJ(C.groups=V(C.groups,A))}},initHeadCheckStatus:function(C){var U=this,A=U.wrap.child(s);if(A&&U.selectable&&U.selectionmodel==ap){U.setCheckBoxStatus(A,C)}},clearDomRef:function(){this.selectlockTr=aE;this.selectUnlockTr=aE},customize:function(bm){var bn=location.pathname,U=bn.indexOf("modules");if(U==-1){U=bn.indexOf(bm)+bm.length+1}var bk=bn.substring(U,bn.length),bl=bk.substring(bk.lastIndexOf("/")+1,bk.length),C=bn.substring(0,U),bi=this.wrap.parent("[url]");if(bi){var A=bi.getAttributeNS("","url");if(A){A=A.split("?")[0];if(A.indexOf(C)==-1){var bj=A.lastIndexOf("/");if(bj!=-1){A=A.substring(bj+1,A.length)}bk=bk.replaceAll(bl,A)}else{bk=A.substring(A.indexOf(C)+new String(C).length,A.length)}}}new Aurora.Window({id:"sys_customization_grid",url:C+"modules/sys/sys_customization_grid.screen?source_file="+bk+"&id="+this.id+"&did="+this.dataset.id,title:"个性化设置",height:530,width:560})},onAjaxFailed:function(C,A){aH.Masker.unmask(this.wb)},onMouseWheel:function(U){var A=this,bi=U.getWheelDelta(),C=A.dataset;if(A.editing==ak||!A.hasFocus||!C.getAll().length){return}U.stopEvent();if(bi>0){C.pre()}else{if(bi<0){C.next()}}},onMouseDown:function(bj,U){U=(U=Ext.fly(U)).is(a)?U:U.parent(a);var bi=this,C=U.getAttribute(aZ),A;if((A=bi.currentEditor)&&A.editor instanceof a9&&C==q&&U.getAttribute(W)==A.name){if(bj.shiftKey){bi._begin=A.record;bj.stopEvent()}else{if((U=U.child(".grid-ckb"))&&U.dom.className.search(/readonly/)==-1){bj.stopEvent();A.editor.focus.defer(Ext.isIE?1:0,A.editor)}}}},focus:function(){this.wb.focus()},onFocus:function(){this.hasFocus=ak},blur:function(){this.wb.blur()},onBlur:function(){this.hasFocus=O},renderLockArea:function(){var A=this,C=A.lockColumns,U=['<TABLE cellSpacing="0" atype="grid.lbt" cellPadding="0" border="0"  ',Y,'="',A.lockWidth,'"><TBODY>',A.createTH(C)];am(A.groups,function(bl,bi){var bj,bk;if(bk=bl.colname){bj={};bj[bk]=aJ(bl).length;bj[bk+"_count"]=ak;if(A.groupselect){bj.__rowbox__=bj[bk];bj.__rowbox___count=bj[bk+"_count"]}}U.push(A.createRow(aT,bi,C,bl,bj,!bi))},A);U.push('</TBODY></TABLE><DIV style="height:17px"></DIV>');A.lbt=A.lb.update(U.join(x)).child("table[atype=grid.lbt]")},renderUnLockAread:function(){var A=this,C=A.unlockColumns,U=['<TABLE cellSpacing="0" atype="grid.ubt" cellPadding="0" border="0" ',Y,'="',A.unlockWidth,'"><TBODY>',A.createTH(C)];am(A.groups,function(bk,bi){var bj;if(bk.colname){bj={};bj[bk.colname]=aJ(bk).length;bj[bk.colname+"_count"]=ak}U.push(A.createRow(aN,bi,C,bk,bj,!bi))},A);U.push("</TBODY></TABLE>");A.ubt=A.ub.update(U.join(x)).child("table[atype=grid.ubt]")},isOverSplitLine:function(A){var U=this,C=0,bi=O;U.overColIndex=-1;am(U.columns,function(bk,bj){if(bk.hidden!==ak){C+=bk.width}if(A<C+3&&A>C-3&&bk.resizable!=O){bi=ak;U.overColIndex=bj;return O}});return bi},onRefresh:function(){var A=this;A.onLoad();if(A.selectable){var C=A.dataset;am(C.selected,function(U){A.onSelect(C,U)})}},onIndexChange:function(U,C){var A=this.getDataIndex(C.id);if(A==-1){return}this.selectRow(A,O)},isFunctionCol:function(A){return A==ad||A==af||A==ax},onAdd:function(bt,bn,bp,bz){var U=bp,bA=this,bj=bA.columns,by=bA.groups,A=by.length,bo=bt.data.length,bq=bA.parseCss(bA.renderRow(bn,bp)),bi=((A==bo?bp:A)%2==0?x:d);H(by,bn,bj);if(bA.lbt){var bx=Ext.get(aL.createElement(ba)),bm=bA.lbt.child("tbody:first");bx.set({id:bA.id+aT+bn.id,style:bq.style,_row:bn.id,height:25})}var bw=Ext.get(aL.createElement(ba)),bl=bA.ubt.child("tbody:first");bw.set({id:bA.id+aN+bn.id,style:bq.style,_row:bn.id,height:25});am(bj,function(bC){if(bC.hidden&&bC.visiable==O){return ak}var bE=bC.name,bF=O;if(bC.group){var bB=0;bA[bC.lock===ak?"lbt":"ubt"].select(ai+bE+E).each(function(bM,bI){var bL=bA.dataset.findById(bM.parent(ba).getAttributeNS(x,"_row")),bJ=bn.get(bE);if(bL&&!ao(bJ)&&bL.get(bE)==bJ){var bH=aB(by,bJ),bK=aJ(bH).length;bB+=bK;bM.dom.rowSpan=bK;bF=ak;bp=bB-1;bi=bM.parent(ba).hasClass(d)?d:x;if(by.indexOf(bH)!=-1&&bj[0].type){bA.lbt.query("td[recordid="+bL.id+"]:first")[0].rowSpan=bK;if(bn!==bL){bx.select("td[recordid="+bn.id+"]:first").remove()}}return O}else{bB+=bM.dom.rowSpan}});if(!bF){bp=U}}if(bF){return}var bG=Ext.get(aL.createElement(a));if(bC.type==ad){bG.set({recordid:bn.id,atype:u}).addClass(F);if(bA.isSelectAll){bG.addClass(ab)}}else{if(bC.type==af){bG.set({recordid:bn.id,atype:B}).addClass(F)}else{if(bC.hidden){bG.hide()}bG.setStyle({"text-align":bC.align||c});var bD={recordid:bn.id,atype:q};if(!bA.isFunctionCol(bC.type)){bD.dataindex=bE}if(bC.type==ax){bG.addClass(bh);bD.atype=bh}bG.set(bD)}}bG.update(bA.createCell(bC,bn,bG));if(bC.lock===ak){bx.appendChild(bG)}else{bw.appendChild(bG)}});bx&&bx.addClass(bi+r+bq.cls);bw.addClass(bi+r+bq.cls);if(bp===bo-1){bm&&bm.appendChild(bx);bl.appendChild(bw)}else{var br=function(bC,bB){if(bB<bp){return O}},bu=bm&&bm.select(S).filter(br),bs=bl.select(S).filter(br),C=bs.item(0),bk=(C&&bi==(C.hasClass(d)?d:x)),bv=a5(bn);bx&&bx.insertBefore(bu.item(0));bw.insertBefore(C);bk&&setTimeout(function(){br=function(bB){if(a5(bt.findById(bB.getAttributeNS(x,"_row")))===bv){return O}};bu&&bu.filter(br).toggleClass(d);bs.filter(br).toggleClass(d)},1);bu&&bu.each(function(bB){bB.select(".grid-rownumber div").each(function(bC){bC.update(Number(bC.dom.innerHTML)+1)});bB.select(a2).each(function(bC){bA.setSelectStatus(bt.findById(bC.getAttributeNS(x,D)))})})}bA.setSelectStatus(bn);bA.drawFootBar();if(bz!==O){bA.fireEvent(M,bA,bn)}},renderEditor:function(bj,A,bi,C){var U=bj.parent(a);U.update(this.createCell(bi,A,U.dom))},onUpdate:function(U,bj,C,bp,bi){var bm=this,bn=bm.findColByName(C),A,bo,bq;if(bn&&bn.group){bj.data[C]=bi;var bl=bm.ubt.query(S).indexOf(bm.ubt.child("tr[_row="+bj.id+"]").dom);bm.onRemove(U,bj);bj.data[C]=bp;bm.onAdd(U,bj,bl,O);!ao(bi)&&am(aJ(aB(bm.groups,bi)),function(br){if(br!==bj){br.set(C,bp)}});bm.selectRow(bm.dataset.indexOf(bj))}if(A=Ext.get([bm.id,C,bj.id].join(al))){var bk=bm.getEditor(bn,bj);if(bk!=x?($(bk) instanceof a9):(C&&!ao(bj.getField(C).get(aC)))){bm.renderEditor(A,bj,bn,bk)}else{(A.child("span")||A).update(bq=bm.renderText(bj,bn,bp));bn.showtitle&&A.set({title:$A.unescapeHtml(String(bq).replace(/<[^<>]+>/mg,x))})}}am(bm.columns,function(br){if(br.name!=C&&(bo=Ext.get([bm.id,br.name,bj.id].join(al)))){if(br.editorfunction){bm.renderEditor(bo,bj,br,bm.getEditor(br,bj))}if(br.renderer){(bo.child("span")||bo).update(bq=bm.renderText(bj,br,bj.get(br.name)));br.showtitle&&bo.set({title:$A.unescapeHtml(String(bq).replace(/<[^<>]+>/mg,x))})}}});bm.setSelectStatus(bj);bm.drawFootBar(C)},onValid:function(bi,A,C,U){var bk=this.findColByName(C);if(bk){var bj=aK.call(this,Ext.get([this.id,C,A.id].join(al)));if(bj){if(U==O){bj.addClass(ay)}else{bj.removeClass([aP,ay])}}}},onRemove:function(bi,A){var U=this,C=Ext.get(U.id+aT+A.id),bj=Ext.get(U.id+aN+A.id);if(C){C.remove()}if(bj){bj.remove()}aI(U.groups,A);am(U.columns,function(bk){var bl=bk.name;if(bl){U.removeCompositeEditor(bl,A)}if(bk.group){U.wrap.select(ai+bl+E).each(function(bo){var bn=U.dataset.findById(bo.parent(ba).getAttributeNS(x,"_row")),bm;if(bn&&bn.get(bl)==A.get(bl)){if((bm=bo.getAttribute("rowspan"))&&(bm-=1)>1){bo.dom.rowSpan=bm}return O}})}});if(Ext.isIE||Ext.isIE9){U.syncScroll()}U.clearDomRef();aH.Masker.unmask(U.wb);U.drawFootBar()},onClear:function(){},onFieldChange:function(bi,A,bj,C,U){if(C==T){var bk=aK.call(this,Ext.get([this.id,bj.name,A.id].join(al)));if(bk){bk[U==ak?"addClass":"removeClass"](aP)}}},getDataIndex:function(U){for(var C=0,bi=this.dataset.data,A=bi.length;C<A;C++){if(bi[C].id==U){return C}}return -1},onSelect:function(bi,C,bj){if(!C||bj){return}var U=this,A=Ext.get(U.id+k+C.id);if(A){A.parent(a2).addClass(ab);if(U.selectionmodel==ap){U.setCheckBoxStatus(A,ak);if(bi.selected.length==bi.data.length){U.initHeadCheckStatus(ak)}}else{U.setRadioStatus(A,ak);bi.locate((bi.currentPage-1)*bi.pagesize+bi.indexOf(C)+1)}U.setSelectStatus(C)}U.groupselect&&am(!bj&&aJ(a5(U.groups,C)),function(bk){if(bk!==C){bi.select(bk)}})},onUnSelect:function(bi,C,bj){if(!C||bj){return}var U=this,A=Ext.get(U.id+k+C.id);if(A){A.parent(a2).addClass(ab);if(U.selectionmodel==ap){U.setCheckBoxStatus(A,O);U.initHeadCheckStatus(O)}else{U.setRadioStatus(A,O)}U.setSelectStatus(C)}U.groupselect&&am(!bj&&aJ(a5(U.groups,C)),function(bk){if(bk!==C){bi.unSelect(bk)}})},onSelectAll:function(){var A=this;A.clearChecked();A.isSelectAll=ak;A.isUnSelectAll=O;A.wrap.addClass(aj);A.initHeadCheckStatus(ak)},onUnSelectAll:function(){var A=this;A.clearChecked();A.isSelectAll=O;A.isUnSelectAll=ak;A.wrap.removeClass(aj);A.initHeadCheckStatus(O)},clearChecked:function(){var A=this.wrap;A.select(a8).replaceClass(aV,aM);A.select(bc).removeClass(ab)},onDblclick:function(bj,C){if(C=Ext.fly(C).parent("td[atype=grid-cell]")){var U=this,bi=U.dataset,A=bi.findById(C.getAttributeNS(x,D));U.fireEvent(be,U,A,bi.indexOf(A),C.getAttributeNS(x,W))}},onClick:function(bl,bo){var bm=(bo=Ext.fly(bo)).is(a)?bo:bo.parent(a);if(bm){var bk=this,U=bm.getAttributeNS(x,aZ),bn=bm.getAttributeNS(x,D),C=bk.dataset;if(U==q){var bj=C.findById(bn),bp=C.indexOf(bj),A=bm.getAttributeNS(x,W);bk.fireEvent(N,bk,bp,A,bj,!bo.hasClass("grid-ckb"));bk.fireEvent(a6,bk,bp,bj)}else{if(U==bh){var bj=C.findById(bn),bp=C.indexOf(bj);if(bj.id!=bk.selectedId){bk.selectRow(bp)}}else{if(U==u){var bi=Ext.get(bk.id+k+bn);if(bi.hasClass(Q)||bi.hasClass(aa)){return}if(bk.isSelectAll&&!bi.parent(bc)){bi.replaceClass(aM,aV)}else{if(bk.isUnselectAll&&!bi.parent(bc)){bi.replaceClass(aV,aM)}}bi.hasClass(aV)?C.unSelect(bn):C.select(bn)}else{if(U==B){var bi=Ext.get(bk.id+k+bn);if(bi.hasClass(I)||bi.hasClass(X)){return}C.select(bn)}}}}}},onCellClick:function(U,bi,C,A,bj){this.adjustColumn(C);this.showEditor(bi,C,bj)},adjustColumn:function(bi){var bl=this,U=bl.findColByName(bi);if(!U||!U.autoadjust||U.hidden){return}var bk=bl.wrap.select("tr.grid-hl "+bg+bi+E),C=parseInt(bk.elements[0].style.width),A=C,bm=12,bj=Math.min(bl.width-(bl.selectable?23:0)-20,U.maxadjustwidth||Number.MAX_VALUE);bl.wrap.select(ai+bi+"] span").each(function(bn){if(Ext.isIE||Ext.isIE9){bn.parent().setStyle(a7,"clip")}A=Math.max(bn.getWidth()+bm,A);if(Ext.isIE||Ext.isIE9){bn.parent().setStyle(a7,x)}if(A>bj){A=bj;return O}});A>C&&bl.setColumnSize(bi,A)},setColumnPrompt:function(C,A){this.wrap.select("td.grid-hc"+a1+C+"] div").update(A);this.findColByName(C).prompt=A},setEditor:function(C,U){var A=this.findColByName(C),bi=Ext.get([this.id,C,this.selectedId].join(al));A.editor=U;if(bi){if(U==x){bi.removeClass(h)}else{if(!$(U) instanceof a9){bi.addClass(h)}}}},getEditor:function(bi,C,bj){var U=bi.editor||x;if(bi.editorfunction){var A=aH.getRenderer(bi.editorfunction);if(A==aE){alert(ag+bi.editorfunction+aQ);return aE}U=A(C,bi.name)||x}if(!bj&&U&&!Ext.get([this.id,bi.name,C.id].join(al))){U=x}return U},positionEditor:function(){var bi=this,U=bi.currentEditor,C=U.editor,A=C instanceof a9,bk=aK.call(bi,Ext.get([bi.id,U.name,U.record.id].join(al)),A),bj=bk.getXY();if(A){C.move(bj[0],bj[1]-3)}else{C.move(bj[0],bj[1])}},showEditor:function(bn,A,bm){if(bn==-1){return}var bk=this,U=bk.findColByName(A);if(!U){return}var C=bk.dataset,bi=C.getAt(bn);if(!bi){return}if(bi.id!=bk.selectedId){bk.selectRow(bn)}else{bk.focusRecord(bi)}bk.focusColumn(A);var bl=bk.getEditor(U,bi);bk.setEditor(A,bl);if(bl!=x){var bj=$(bl);(function(){var bq=bi.get(A),bu=aK.call(bk,Ext.get([bk.id,A,bi.id].join(al))),bp;bj.bind(C,A);bj.render(bi);bj.el.on(a0,bk.onEditorKeyDown,bk);Ext.fly(bd).on(z,bk.onEditorBlur,bk);bp=bk.currentEditor={record:bi,ov:bq,name:A,editor:bj};bk.positionEditor();if(bj instanceof a9){var bo=bk._begin;if(bk._begin){var bt=C.indexOf(bo),bs=C.indexOf(bi);if(bt>bs){var br=bs;bs=bt;bt=br}bs++;for(;bt<bs;bt++){C.getAt(bt).set(A,bo.get(A))}delete bk._begin}else{if(bm){bj.focus()}else{bj.onClick()}}}else{if(bj instanceof aH.Field&&!bj instanceof aH.TextArea){bj.el.setStyle("text-align",U.align||c)}else{if(bj instanceof aH.Lov){bj.on("fetching",bk.onFetching,bk)}}if(!(bj instanceof aH.TextArea)){bj.setHeight(bu.getHeight()-2)}bj.setWidth(bu.getWidth()-5);bj.isEditor=ak;bj.isFireEvent=ak;bj.isHidden=O;bj.focus();bj.on(ar,bk.onEditorSelect,bk);if(Ext.isFunction(bm)){bm(bj)}bk.fireEvent(aA,bk,bj,bn,A,bi)}bk.editing=ak}).defer(10)}},showEditorByRecord:function(A){var C=this,U=C.dataset,bi=A?U.indexOf(A):0;A=A||U.getAt(0);if(!A&&C.autoappend){A=U.create()}if(A){am(C.columns,function(bj){if(bj.hidden!=ak&&C.getEditor(bj,A)!=x){C.fireEvent(N,C,bi,bj.name,A,function(){});C.fireEvent(a6,C,bi,A);return O}})}},onEditorSelect:function(){(function(){this.hideEditor()}).defer(1,this)},onEditorKeyDown:function(bj){var U=this,bi=bj.keyCode,C=U.currentEditor;if(bi==27){if(C){var A=C.editor;if(A){A.clearInvalid();A.render(A.binder.ds.getCurrentRecord())}}U.hideEditor()}else{if(bi==13){if(!(C&&C.editor&&C.editor instanceof aH.TextArea)){U.showEditorBy(39)}}else{if(bi==9){bj.stopEvent();U.showEditorBy(bj.shiftKey?37:39)}else{if(bj.ctrlKey&&(bi==37||bi==38||bi==39||bi==40)){U.showEditorBy(bi);bj.stopEvent()}}}}},findEditorBy:function(bl){var bo=this,C,bn;if((C=bo.currentEditor)&&(bn=C.editor)){var br=bo.columns,bp=O,bk=bo.dataset,bj=bn.binder.name,A=bn.record,bt=bk.data.indexOf(A),U=aE,bq=O,bm=ak,bs=O,bi;if(bt!=-1){if(bl==37||bl==38){br=[].concat(br).reverse();bm=O}if(bl==38||bl==40){bs=ak;bi=bo.findColByName(bj)}while(A){if(!bs){am(br,function(bu){if(bp){if(bu.hidden!=ak&&bo.getEditor(bu,A)!=x){U=bu.name;return O}}else{if(bu.name==bj){bp=ak}}})}if(U){return{row:bt,name:U,record:A}}A=bk.getAt(bm?++bt:--bt);if(bm&&!A&&!bq&&bo.autoappend!==O){bo.hideEditor();bk.create();A=bk.getAt(bt);bq=ak}if(bs&&A&&bo.getEditor(bi,A)!=x){U=bj}}}}return aE},showEditorBy:function(U){var bi=this,bj=ak,C=bi.findEditorBy(U),A=bi.currentEditor;if(A){A=A.editor}if(C){(function(bl){function bm(){bl();A.un("fetched",bm)}function bk(){if(bi.isFetching){A.on("fetched",bm)}else{bl()}A.un("blur",bk)}if(A&&A instanceof aH.Lov){A.on("blur",bk);bi.hideEditor()}else{bi.hideEditor();bl()}})(function(){var bl=C.row,bk=C.record;bi.fireEvent(N,bi,bl,C.name,bk,bj);bi.fireEvent(a6,bi,bl,bk)})}},focusRecord:function(A){this.focusRow(aJ(this.groups).indexOf(A))},focusRow:function(bk){var bj=25,A=this.ub,U=A.getScroll().top,bi=A.getHeight(),C=A.dom.scrollWidth>A.dom.clientWidth?16:0;if(bk*bj<U){A.scrollTo(n,bk*bj-1)}else{if((bk+1)*bj>(U+bi-C)){A.scrollTo(n,(bk+1)*bj-bi+C)}}},focusColumn:function(U){var bm=this,A=25,C=bm.ub,bj=C.getScroll().left,bn=0,bl=0,bi=0,bk;am(bm.columns,function(bo){if(bo.name==U){bl=bo.width}if(bo.hidden!==ak){if(bo.lock===ak){bi+=bo.width}else{if(bl==0){bn+=bo.width}}}});bk=bn+bl;if(bn<bj){C.scrollTo(c,bn)}else{if((bk-bj)>(bm.width-bi)){C.scrollTo(c,bk-bm.width+bi+(C.dom.scrollHeight>C.dom.clientHeight?16:0))}}},hideEditor:function(){var bi=this,U=bi.currentEditor;if(U){var C=U.editor;if(C){if(!C.canHide||C.canHide()){C.el.un(a0,bi.onEditorKeyDown,bi);C.un(ar,bi.onEditorSelect,bi);Ext.fly(bd).un(z,bi.onEditorBlur,bi);C.move(-20000);var A=C.autocompleteview;if(A){A.hide()}bi.editing=O;C.blur();C.onBlur();C.isFireEvent=O;C.isHidden=ak;if(C.collapse){C.collapse()}delete bi.currentEditor}}}},onEditorBlur:function(bi,C){var U=this,A=U.currentEditor;if(A&&!A.editor.isEventFromComponent(C)){U.hideEditor.defer(Ext.isIE||Ext.isIE9?10:0,U)}},onLockHeadMove:function(C){var A=this;A.hmx=C.xy[0]-A.lht.getXY()[0];A.lh.setStyle(aX,A.isOverSplitLine(A.hmx)?ae:aG)},onUnLockHeadMove:function(U){var A=this;var C=A.uht;A.hmx=U.xy[0]-(C?C.getXY()[0]+C.getScroll().left:0)+A.lockWidth;A.uh.setStyle(aX,A.isOverSplitLine(A.hmx)?ae:aG)},onHeadMouseDown:function(C){var A=this;A.dragWidth=-1;if(A.overColIndex==undefined||A.overColIndex==-1){return}A.dragIndex=A.overColIndex;A.dragStart=C.getXY()[0];A.sp.setHeight(A.wrap.getHeight()).show().setStyle({top:A.wrap.getXY()[1]+at,left:C.xy[0]+at});Ext.get(bd).on(aD,A.onHeadMouseMove,A).on(an,A.onHeadMouseUp,A);C.stopEvent()},onHeadClick:function(bm,bq){var bk=this,bn=Ext.fly(bq).parent(a),A=bk.dataset,U;if(bn){U=bn.getAttributeNS(x,aZ)}if(U==G){var bl=bn.getAttributeNS(x,W),C=bk.findColByName(bl);if(C&&C.sortable===ak){if(A.isModified()&&A.sorttype=="remote"){aH.showInfoMessage("提示","有未保存数据!");return}var bo=bn.child(aw),bj=x;if(bk.currentSortTarget){bk.currentSortTarget.removeClass([aO,i])}bk.currentSortTarget=bo;if(ao(C.sorttype)){C.sorttype=aW;bo.removeClass(aO).addClass(i);bj=aW}else{if(C.sorttype==aW){C.sorttype=o;bo.removeClass(i).addClass(aO);bj=o}else{C.sorttype=x;bo.removeClass([i,aO])}}A.sort(bl,bj)}}else{if(U==u){var bi=bn.child(s);if(bi){var bp=bi.hasClass(aV);if(!bp){A.selectAll()}else{A.unSelectAll()}}}}},setRadioStatus:function(A,C){if(!C){A.removeClass(a3).addClass(aR)}else{A.addClass(a3).removeClass(aR)}},setCheckBoxStatus:function(A,C){if(!C){A.removeClass(aV).addClass(aM)}else{A.addClass(aV).removeClass(aM)}},setSelectDisable:function(U,C){var A=this.dataset.selected.indexOf(C)==-1;if(this.selectionmodel==ap){U.removeClass([aV,aM]).addClass(A?Q:aa)}else{U.removeClass([a3,aR,X,I]).addClass(A?I:X)}},setSelectEnable:function(U,C){var A=this.dataset.selected.indexOf(C)==-1;if(this.selectionmodel==ap){U.removeClass([Q,aa]).addClass(A?aM:aV)}else{U.removeClass([aR,a3,I,X]).addClass(A?aR:a3)}},setSelectStatus:function(C){var U=this,bi=U.dataset;if(bi.selectfunction){var A=Ext.get(U.id+k+C.id);if(A){if(!bi.execSelectFunction(C)){U.setSelectDisable(A,C)}else{U.setSelectEnable(A,C)}}}},onHeadMouseMove:function(bi){var U=this;bi.stopEvent();U.dragEnd=bi.getXY()[0];var C=U.dragEnd-U.dragStart,bj=U.columns[U.dragIndex],A=bj.width+C;if(A>30&&A<U.width){U.dragWidth=A;U.sp.setStyle(c,bi.xy[0]+at)}},onHeadMouseUp:function(C){var A=this;Ext.get(bd).un(aD,A.onHeadMouseMove,A).un(an,A.onHeadMouseUp,A);A.sp.hide();if(A.dragWidth!=-1){A.setColumnSize(A.columns[A.dragIndex].name,A.dragWidth)}A.syncScroll()},findColByName:function(A){var C;if(A){am(this.columns,function(U){if(U.name&&U.name.toLowerCase()===A.toLowerCase()){C=U;return O}})}return C},selectRow:function(bl,U){var bj=this,bk=bj.dataset,A=bk.getAt(bl),bi=(bk.currentPage-1)*bk.pagesize+bl+1,C=aJ(a5(bj.groups,A));bj.selectedId=A.id;if(bj.selectlockTr){bj.selectlockTr.removeClass(ah)}if(bj.selectUnlockTr){bj.selectUnlockTr.removeClass(ah)}bj.selectUnlockTr=bj.ubt&&bj.ubt.select(C.map(function(bm){return"#"+bj.id+aN+bm.id}).join(","));if(bj.selectUnlockTr){bj.selectUnlockTr.addClass(ah)}bj.selectlockTr=bj.lbt&&bj.lbt.select(C.map(function(bm){return"#"+bj.id+aT+bm.id}).join(","));if(bj.selectlockTr){bj.selectlockTr.addClass(ah)}bj.focusRecord(A);if(U!==O&&bi!=aE){bk.locate.defer(5,bk,[bi,O])}},setColumnSize:function(A,bo){var bj=this,bk,bi,U=0,C=0;am(bj.columns,function(bp){if(bp.name&&bp.name===A){if(bp.hidden===ak){return}bp.width=bo;if(bp.lock!==ak){bk=bj.uh.child(bg+A+E);bi=bj.ub.child(bg+A+E)}else{if(bj.lh){bk=bj.lh.child(bg+A+E)}if(bj.lb){bi=bj.lb.child(bg+A+E)}}}if(bp.hidden!==ak){bp.lock!==ak?(C+=bp.width):(U+=bp.width)}});bj.unlockWidth=C;bj.lockWidth=U;if(bk){bk.setStyle(Y,bo+at)}if(bi){bi.setStyle(Y,bo+at)}var bn=Math.max(bj.width-U,0);if(bj.fb){bj.fb.child(bg+A+E).setStyle(Y,bo+at);bj.uf.setStyle(Y,bn+at);bj.fb.child("table[atype=fb.ubt]").setStyle(Y,C+at);var bm=bj.fb.child("table[atype=fb.lbt]");if(bm){bj.fb.child("div[atype=grid.lf]").setStyle(Y,(U-1)+at);bm.setStyle(Y,U+at)}}if(bj.lc){var bl=Math.max(U-1,0);bj.lc.setStyle({width:bl+at,display:bl==0?aq:x})}if(bj.lht){bj.lht.setStyle(Y,U+at)}if(bj.lbt){bj.lbt.setStyle(Y,U+at)}bj.uc.setStyle(Y,bn+at);bj.uh.setStyle(Y,bn+at);bj.ub.setStyle(Y,bn+at);bj.uht.setStyle(Y,C+at);if(bj.ubt){bj.ubt.setStyle(Y,C+at)}bj.syncSize();if(Ext.isChrome){bj.wrap.setStyle({position:"relative"});(function(){bj.wrap.setStyle({position:""})}).defer(1)}},drawFootBar:function(C){var A=this;if(!A.fb){return}am([].concat(C?C:A.columns),function(bl){var bj=Ext.isString(bl)?A.findColByName(bl):bl;if(bj&&bj.footerrenderer){var bk=aH.getRenderer(bj.footerrenderer);if(bk==aE){alert(ag+bj.footerrenderer+aQ);return}var bi=bj.name,U=bk(A.dataset.data,bi);if(!ao(U)){A.fb.child(ai+bi+E).update(U)}}})},syncSize:function(){var A=this,U=0;am(A.columns,function(bi){if(bi.hidden!==ak){if(bi.lock===ak){U+=bi.width}}});if(U!=0){var C=A.width-U;A.uc.setWidth(C);A.uh.setWidth(C);A.ub.setWidth(C)}},classfiyColumns:function(){var A=this;A.lockColumns=[],A.unlockColumns=[];A.lockWidth=0,A.unlockWidth=0;am(A.columns,function(C){if(C.lock===ak){A.lockColumns.add(C);if(C.hidden!==ak){A.lockWidth+=C.width}}else{A.unlockColumns.add(C);if(C.hidden!==ak){A.unlockWidth+=C.width}}});A.columns=A.lockColumns.concat(A.unlockColumns)},showColumn:function(C){var A=this.findColByName(C);if(A&&A.visiable!=O){if(A.hidden===ak){delete A.hidden;A.forexport=ak;this.setColumnSize(C,A.hiddenwidth||A.width);delete A.hiddenwidth;this.wrap.select(ai+C+E).show()}}},hideColumn:function(C){var A=this.findColByName(C);if(A&&A.visiable!=O){if(A.hidden!==ak){A.hiddenwidth=A.width;this.setColumnSize(C,0,O);this.wrap.select(ai+C+E).hide();A.hidden=ak;A.forexport=O}}},removeColumn:function(A){var bm=this,bo=bm.columns,bp=[],bl=[];am(A,function(br){col=bm.findColByName(br);if(!col){return}if(col.lock){bp.push(br)}else{bl.push(br)}bo.splice(bo.indexOf(col),1)});var bk=bp.length,bj=bl.length,U=[];if(bk||bj){bm.classfiyColumns();if(bk){var C=bm.lockWidth,bq=bm.wrap.getWidth()-C;for(var bi=0;bi<bk;bi++){U.push(a1+bp[bi]+E)}if(C){bm.lht.setWidth(C);bm.lc.setWidth(C);bm.lbt.dom.width=C}else{bm.lc.remove()}bm.uc.setWidth(bq);bm.uh.setWidth(bq);bm.ub.setWidth(bq)}for(var bi=0;bi<bj;bi++){U.push(a1+bl[bi]+E)}bm.wrap.select(U.join(",")).remove();var bn=bm.unlockWidth;bm.uht.setWidth(bn);bm.ubt.setWidth(bn)}},createHead:Ext.isIE||Ext.isIE9?function(bl,bm,U,bk,C){var A=bk.query(ba),bi=Ext.fly(A[0]).child("th:last()"),bj;if(U){bj=bk.query(a1+U+E)[0]}if(bm==a4){bj=bj.nextSibling||aE;C++}else{if(bm==e){if(bi){bj=bi.dom}C=-1}}am(bl,function(br){var bo=Ext.get(aL.createElement(bf)),bq=Ext.get(A[1].insertCell(C)),bn=br.width,bp=br.name;if(C>-1){C++}bq.addClass("grid-hc").set({dataindex:bp,atype:G}).update("<div>"+br.prompt+"</div>");if(bj){A[0].insertBefore(bo.dom,bj)}else{A[0].appendChild(bo.dom)}bo.setStyle(Y,bn+at).set({dataindex:bp})})}:function(bl,bm,A,bj){var C=[],bi=[],U=bj.query(bm!=e?a1+A+E:ba),bk=Ext.fly(U[0]).child("th:last()");am(bl,function(bn){C.push('<th style="width:',bn.width,at,';" ',W,'="',bn.name,'"></th>');bi.push('<td class="grid-hc" atype="grid.head" ',W,'="',bn.name,'"><div>',bn.prompt,"</div></td>")});new Ext.Template(C.join(x))[bm](U[0],{});new Ext.Template(bi.join(x))[bm](U[1],{});if(bk){bk.appendTo(Ext.fly(U[0]))}},addColumn:function(bu,C,bk){var bl=this;if(bl.dataset.isModified()){aH.showInfoMessage(_lang["grid.info"],_lang["grid.info.continue"])}else{var bq=bl.columns,bm=bq.length,bt,br;if(C&&bk){var bi=bl.findColByName(C);if(bi){bt=bi.lock;br=bl[bt?"lockColumns":"unlockColumns"].indexOf(bi);bm=(bk==f?0:1)+bq.indexOf(bi)}else{alert("未找到列"+C);return}}var bs=[],bj=[];am(bu,function(bx){var bw=Ext.apply(Ext.apply({},m),bx),bv=bl.findColByName(bw.name);if(bv){return}if(bw.lock){bs.push(bw)}else{bj.push(bw)}});var U=bs.concat(bj);if(U.length){var A=bk?(bk==f?aS:a4):e,bp=umethod=A,bn=uname=C,bo=bl.wrap;if(bt){umethod=aS;uname=bl.unlockColumns[0].name}else{bp=e;bn=aE}bl.columns=bq.slice(0,bm).concat(U).concat(bq.slice(bm));bl.classfiyColumns();if(bs.length){if(!bl.lht){bl.lc=new Ext.Template("<DIV class='grid-la' atype='grid.lc' style='width:24px;'><DIV class='grid-lh' atype='grid.lh' unselectable='on' onselectstart='return false;' style='height:25px;'><TABLE cellSpacing='0' atype='grid.lht' cellPadding='0' border='0' style='width:25px'><TBODY><TR class='grid-hl'></TR><TR height=25></TR></TBODY></TABLE></DIV><DIV class='grid-lb' atype='grid.lb' style='width:100%;height:255px'></DIV></DIV>").insertFirst(bl.wrap.dom,{},ak);bl.lh=bo.child("div[atype=grid.lh]");bl.lb=bo.child("div[atype=grid.lb]");bl.lht=bo.child("table[atype=grid.lht]");bl.lb[aU](p,bl.onClick,bl)[aU](be,bl.onDblclick,bl);bl.lht[aU](aD,bl.onLockHeadMove,bl);bl.lh[aU](z,bl.onHeadMouseDown,bl)[aU](p,bl.onHeadClick,bl)}bl.createHead(bs,bp,bn,bl.lht,br)}if(bj.length){bl.createHead(bj,umethod,uname,bl.uht,br)}if(bl.lb){bl.lb.update(x)}bl.ub.update(x);am(U,function(bv){bl.setColumnSize(bv.name,bv.width)});bl.dataset.query()}}},insertColumnBefore:function(C,A){this.addColumn(A,C,f)},insertColumnAfter:function(C,A){this.addColumn(A,C,1)},setWidth:function(U){var bi=this;if(bi.width==U){return}bi.width=U;bi.wrap.setWidth(U);var C=aH.CmpManager.get(bi.id+b);if(C){C.setWidth(U)}var A=aH.CmpManager.get(bi.id+l);if(A){A.setWidth(U)}if(bi.fb){bi.fb.setWidth(U)}var bj=U-bi.lockWidth;bi.uc.setWidth(bj);bi.uh.setWidth(bj);bi.ub.setWidth(bj);if(bi.uf){bi.uf.setWidth(bj)}},setHeight:function(bi){var bj=this;if(bj.height==bi){return}bj.height=bi;var C=aH.CmpManager.get(bj.id+b);if(C){bi-=25}var A=aH.CmpManager.get(bj.id+l);if(A){bi-=25}if(bj.fb){bi-=25}bj.wrap.setHeight(bi);var U=bi-25;if(bj.lb){bj.lb.setHeight(U)}bj.ub.setHeight(U)},deleteSelectRows:function(U){var C=this.dataset,A=[].concat(C.getSelected());if(A.length>0){C.remove(A)}},remove:function(){var A=this.dataset.getSelected();if(A.length>0){aH.showConfirm(_lang["grid.remove.confirm"],_lang["grid.remove.confirmMsg"],this.deleteSelectRows.createDelegate(this))}else{aH.showInfoMessage(_lang["grid.info"],_lang["grid.remove.select"])}},clear:function(){var C=this.dataset,A=C.getSelected();while(A[0]){C.removeLocal(A[0])}},_export:function(U,C,bi,A){this.exportOptions=Ext.apply({type:"xls",filename:"excel"},arguments.length==1?U:{type:U||"xls",filename:C||"excel",separator:bi,param:A});this.showExportConfirm()},showExportConfirm:function(){var bi=this,bm=0,bl=bi.id+"_export",bk=['<div class="item-export-wrap" style="margin:15px;width:270px" id="',bl,'">','<div class="grid-uh" atype="grid.uh" style="width: 270px; -moz-user-select: none; text-align: left; height: 25px; cursor: default;" onselectstart="return false;" unselectable="on">','<table cellSpacing="0" cellPadding="0" border="0"><tbody><tr height="25px">','<td class="export-hc" style="width:22px;" atype="export.rowcheck"><center><div title="',_lang["grid.export.selectinfo"],'" atype="export.headcheck" class="',bb,aM,'"></div></center></td>','<td class="export-hc" style="width:222px;" atype="grid-type">',_lang["grid.export.column"],"</td>","</tr></tbody></table></div>",'<div style="overflow:auto;height:200px;"><table cellSpacing="0" cellPadding="0" border="0"><tbody>'],U=ak,A=370,bj=bi.exportOptions||(bi.exportOptions={}),C=bj&&bj.type;am(bi.columns,function(bo,bn){if(!bi.isFunctionCol(bo.type)){if(U){U=bo.forexport!==O}bk.push("<tr",(bm+bn)%2==0?x:' class="',d,'"','><td class="',F,'" style="width:22px;" ',D,'="',bn,'" atype="export.rowcheck"><center><div id="',bi.id,k,bn,'" class="',bb,bo.forexport===O?aM:aV,'"></div></center></td><td style="width:222px"><div class="',q,'">',bo.prompt,bo.hidden?['<div style="float:right;color:red">&lt;',_lang["grid.export.hidecolumn"],"&gt;</div>"].join(""):x,"</div></td></tr>")}else{bm++}});if(U){bk[9]=aV}bk.push("</tbody></table></div></div>");if(C=="xls"||C=="xlsx"){A+=30;bk.push('<div class="item-radio" class="item-radio" style="margin:15px;width:270px;height:30px">','<div class="item-radio-option" style="width:128px;float:left" itemvalue="xls">','<div class="item-radio-img  item-radio-img-',C=="xls"?"c":"u",'"></div>','<label class="item-radio-lb">excel2003</label>',"</div>",'<div class="item-radio-option" style="width:128px;float:left" itemvalue="xlsx">','<div class="item-radio-img  item-radio-img-',C=="xlsx"?"c":"u",'"></div>','<label class="item-radio-lb">excel2007</label>',"</div>","</div>")}bk.push('<div style="margin:15px;width:270px;color:red">',_lang["grid.export.confirmMsg"],"</div>");bi.exportwindow=aH.showOkCancelWindow(_lang["grid.export.config"],bk.join(x),function(bn){bi.doExport();bn.body.un(p,bi.onExportClick,bi)},aE,380,A);bi.exportwindow.body.on(p,bi.onExportClick,bi)},onExportClick:function(bl,br){br=Ext.fly(br);var bk=this,bn=br.parent("td.grid-rowbox")||br.parent("td.export-hc"),C=br.hasClass("item-radio-option")?br:br.parent("div.item-radio-option");if(bn){var U=bn.getAttributeNS(x,aZ);if(U=="export.rowcheck"){var bp=bn.getAttributeNS(x,D),bi=bn.child(aw),bo=bi.hasClass(aV),bj=bi.getAttributeNS(x,aZ),bm=bk.columns;bk.setCheckBoxStatus(bi,!bo);if(bj=="export.headcheck"){var bq=(bk.isFunctionCol(bm[0].type)?1:0)+(bk.isFunctionCol(bm[1].type)?1:0),A=bl.ctrlKey;bk.exportwindow.body.select("td[atype=export.rowcheck] div[atype!=export.headcheck]").each(function(bs,bu,bt){bu=bm[bt+bq];if(!A||!bu.hidden){bk.setCheckBoxStatus(bs,!bo);bu.forexport=!bo}})}else{bm[bp].forexport=!bo}}}else{if(C){bk.setRadioStatus(C.child("div"),ak);bk.setRadioStatus((C.prev()||C.next()).child("div"),O);bk.exportOptions.type=C.getAttributeNS(x,"itemvalue")}}},doExport:function(){var C=this,A=C.exportOptions||{};aH.doExport(C.dataset,C.columns,aE,A.type,A.separator,A.filename,A.param);delete C.exportOptions},destroy:function(){aH.Grid.superclass.destroy.call(this);this.processDataSetLiestener("un");this.sp.remove();delete this.sp},createCompositeEditor:function(bz,bi,bk,bo){var by=this,br=by.id,bq=by.dataset,bs=bk.id,bl=by.findColByName(bz),bx=bl.lock,U=Ext.get(br+(bx?aT:aN)+bs),bp=Ext.get(br+(bx?aN:aT)+bs),bw=bx?by.lbt:by.ubt,bm=this.dataset.indexOf(bk);if(by.currentEditor&&by.currentEditor.editor instanceof a9){by.hideEditor()}var bv=bw.dom,bj=bv.tBodies[0],bu=document.createElement(ba),bn=document.createElement(a);bu.id=br+"_cmp_"+bz+al+bs;Ext.fly(bu).addClass(bm%2==0?x:d);Ext.fly(bu).set({_row:bk.id});bn.colSpan=bi;bn.innerHTML=bo.html;bu.appendChild(bn);if(bq.indexOf(bk)>=bq.data.length-1){bj.appendChild(bu)}else{var A=bq.getAt(bq.indexOf(bk)+1);var C=Ext.get(br+(bx?aT:aN)+A.id);bj.insertBefore(bu,C.dom)}if(bp){bp.setHeight(bo.height)}Ext.each(U.dom.childNodes,function(bA){var bt=Ext.get(bA).getAttributeNS(x,W);if(bt==bz){return O}bA.rowSpan=2});this.hideEditor()},createCompositeRow:function(C,bk,bj,bm,A,bi){var U=[];bk.name=C;if(bi.find("name",C)){var bl=this.dataset.indexOf(A);U.push('<tr id="',this.id,"_cmp_",C,al,A.id,'" class="'+(bl%2==0?x:d)+'" _row="'+A.id+'"><td colSpan="',bm,'">');U.push(bj.html);U.push("</td></tr>");bk.html=U.join("")}else{bk.height=bj.height}},removeCompositeEditor:function(A,bj){var bk=this,C=bk.id,bo=bj.id,bi=bk.findColByName(A),bn=bi.lock,U=Ext.get(C+(bn?aT:aN)+bo),bm=Ext.get(C+(bn?aN:aT)+bo);if(bk.currentEditor&&bk.currentEditor.editor instanceof a9){bk.hideEditor()}if(bm){bm.setHeight(22)}Ext.each(U&&U.dom.childNodes,function(bp){if(Ext.get(bp).getAttributeNS(x,W)==A){return O}bp.rowSpan=1});var bl=Ext.get(C+"_cmp_"+A+al+bo);if(bl){bl.remove()}},show:function(){aH.Grid.superclass.show.call(this);this.wb.show()},hide:function(){aH.Grid.superclass.hide.call(this);this.wb.hide()}});aH.Grid.revision="$Rev$"})($A);