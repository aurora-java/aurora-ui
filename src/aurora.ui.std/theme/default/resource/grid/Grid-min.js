(function(av){var aw=document,aW=aw.documentElement,ad="_",k="__",v=".",r=" ",w="",D="]",at="-c",aj="-u",aE="$l-",ay="$u-",aF="on",ai="px",aT="tr",a="td",aY="th",b="_tb",al="div",n="top",c="left",ag="none",Q="width",L="center",ao="hidden",aI="cursor",ak="visible",au="default",X="w-resize",g="outline",aJ="1px dotted blue",aK="atype",e="append",aD="insertBefore",aP="insertAfter",f="before",l="_navbar",aR="text-overflow",B="recordid",O="dataindex",aa="row-selected",N="required",aA="item-notBlank",an="item-invalid",d="row-alt",E="grid-rowbox",aN=v+E,t="grid.rowcheck",z="grid.rowradio",F="grid.head",aU="grid-ckb ",ac="grid-select-all",af="multiple",aq="checkedvalue",x="-readonly",H="item-ckb",T=H+"-self",aV=v+T,ax=H+aj,aG=H+at,K=H+x+aj,S=H+x+at,V="item-radio-img",aO=V+at,aC=V+aj,P=V+x+at,G=V+x+aj,aS=aV+r+v+aG,q="grid-cell",h="cell-editor",J="cellcheck",W="rowcheck",Y="rowradio",am="rownumber",j="grid-",a0=j+am,aH="desc",o="asc",i=j+aH,az=j+o,p="click",aX="dblclick",I="cellclick",u="render",aQ="rowclick",ap="editorshow",R="nexteditorshow",aL="keydown",ah="select",y="mousedown",ar="mousemove",ae="mouseup",Z="未找到",aB="方法!",M="tr[class!=grid-hl]",s="div[atype=grid.headcheck]",aM="["+O+"=",aZ=aY+aM,ab=a+aM,m={autoadjust:true,forexport:true,hidden:false,lock:false,resizable:true,rowspan:1,sortable:true,width:100};av.Grid=Ext.extend(av.Component,{constructor:function(A){var C=this;C.selectedId=null;C.lockWidth=0;C.autofocus=A.autofocus||true;av.Grid.superclass.constructor.call(C,A)},initComponent:function(A){av.Grid.superclass.initComponent.call(this,A);var U=this,C=U.wrap;U.wb=Ext.get(U.id+"_wrap");U.fb=U.wb.child("div[atype=grid.fb]");if(U.fb){U.uf=U.fb.child("div[atype=grid.uf]")}U.uc=C.child("div[atype=grid.uc]");U.uh=C.child("div[atype=grid.uh]");U.ub=C.child("div[atype=grid.ub]");U.uht=C.child("table[atype=grid.uht]");U.lc=C.child("div[atype=grid.lc]");U.lh=C.child("div[atype=grid.lh]");U.lb=C.child("div[atype=grid.lb]");U.lht=C.child("table[atype=grid.lht]");U.sp=C.child("div[atype=grid.spliter]");Ext.getBody().insertFirst(U.sp);U.fs=C.child("a[atype=grid.focus]");U.classfiyColumns();U.initTemplate()},processListener:function(A){var C=this;av.Grid.superclass.processListener.call(C,A);C.wrap[A]("mouseover",C.onMouseOver,C)[A]("mouseout",C.onMouseOut,C)[A](p,C.focus,C);if(!(C.canwheel===false)){C.wb[A]("mousewheel",C.onMouseWheel,C)}C.fs[A](Ext.isOpera?"keypress":aL,C.handleKeyDown,C);C.ub[A]("scroll",C.syncScroll,C)[A](p,C.onClick,C)[A](aX,C.onDblclick,C);C.uht[A](ar,C.onUnLockHeadMove,C);C.uh[A](y,C.onHeadMouseDown,C)[A](p,C.onHeadClick,C);if(C.lb){C.lb[A](p,C.onClick,C)[A](aX,C.onDblclick,C)}if(C.lht){C.lht[A](ar,C.onLockHeadMove,C)}if(C.lh){C.lh[A](y,C.onHeadMouseDown,C)[A](p,C.onHeadClick,C)}C[A](I,C.onCellClick,C)},initEvents:function(){av.Grid.superclass.initEvents.call(this);this.addEvents(u,aL,aX,I,aQ,ap,R)},syncScroll:function(){var A=this;A.hideEditor();A.uh.dom.scrollLeft=A.ub.dom.scrollLeft;if(A.lb){A.lb.dom.scrollTop=A.ub.dom.scrollTop}if(A.uf){A.uf.dom.scrollLeft=A.ub.dom.scrollLeft}},handleKeyDown:function(a1){var C=this,A=a1.getKey(),U=C.dataset;if(a1.ctrlKey&&a1.keyCode==86&&C.canpaste){var a2=window.clipboardData.getData("text");if(a2){Ext.each(a2.split("\n"),function(a6){var a4=a6.split("\t");if(a4==w){return}var a5={},a3=0;Ext.each(C.columns,function(a7){if(C.isFunctionCol(a7.type)){return}if(a7.hidden!==true){a5[a7.name]=a4[a3];a3++}});U.create(a5)})}}else{if(A==38||A==40||A==33||A==34){if(U.loading==true){return}switch(a1.getKey()){case 33:U.prePage();break;case 34:U.nextPage();break;case 38:U.pre();break;case 40:U.next();break}}}C.fireEvent(aL,C,a1)},processDataSetLiestener:function(A){var C=this,U=C.dataset;if(U){U[A]("ajaxfailed",C.onAjaxFailed,C);U[A]("metachange",C.onRefresh,C);U[A]("update",C.onUpdate,C);U[A]("reject",C.onUpdate,C);U[A]("add",C.onAdd,C);U[A]("submit",C.onBeforSubmit,C);U[A]("submitfailed",C.onAfterSuccess,C);U[A]("submitsuccess",C.onAfterSuccess,C);U[A]("query",C.onBeforeLoad,C);U[A]("load",C.onLoad,C);U[A]("loadfailed",C.onAjaxFailed,C);U[A]("valid",C.onValid,C);U[A]("beforeremove",C.onBeforeRemove,C);U[A]("remove",C.onRemove,C);U[A]("clear",C.onLoad,C);U[A]("refresh",C.onRefresh,C);U[A]("fieldchange",C.onFieldChange,C);U[A]("indexchange",C.onIndexChange,C);U[A]("select",C.onSelect,C);U[A]("unselect",C.onUnSelect,C);U[A]("selectall",C.onSelectAll,C);U[A]("unselectall",C.onUnSelectAll,C)}},bind:function(C){if(Ext.isString(C)){C=$(C);if(!C){return}}var A=this;A.dataset=C;if(C.autopagesize===true){C.pagesize=Math.round(((A.ub.getHeight()||parseFloat(A.ub.dom.style.height))-16)/25)}A.processDataSetLiestener(aF);A.onLoad()},initTemplate:function(){var A=this;A.rowTdTpl=new Ext.Template(["<td ",aK,'="{',aK,'}" class="',E,'" ',B,'="{',B,'}">']);A.rowNumTdTpl=new Ext.Template(['<td style="text-align:{align}" class="',a0,'" ',aK,'="',a0,'" ',B,'="{',B,'}">']);A.rowNumCellTpl=new Ext.Template(['<div style="',Q,":{",Q,'}px">{text}</div>']);A.tdTpl=new Ext.Template(['<td style="visibility:{visibility};text-align:{align}" ',O,'="{name}" ',aK,'="',q,'" ',B,'="{',B,'}">']);A.cellTpl=new Ext.Template(['<div class="',q,' {cellcls}" style="',Q,":{",Q,'}px" id="',A.id,'_{name}_{recordid}" title="{title}"><span>{text}</span></div>']);A.cbTpl=new Ext.Template(['<center><div class="{cellcls}" id="',A.id,"_{name}_{",B,'}"></div></center>'])},getCheckBoxStatus:function(A,a1,U){var a3=this.dataset.getField(a1),C=a3.getPropertity(aq),a2=A.data[a1];return H+(U?x:w)+((a2&&a2==C)?at:aj)},createTemplateData:function(C,A){return{width:C.width-2,recordid:A.id,visibility:C.hidden===true?ao:ak,name:C.name}},createCell:function(C,a4,a6){var a7=this,a2=a7.createTemplateData(C,a4),bb,a1=a7.tdTpl,bd=w,U=C.type,a3,a5=a7.getEditor(C,a4),a9=[];if(a5!=w){var a8=av.CmpManager.get(a5);if(a8&&(a8 instanceof av.CheckBox)){U=J}else{bd=h}}else{if(C.name&&Ext.isDefined(a4.getField(C.name).get(aq))){U=J;a3=true}}if(U==W||U==Y){a3=a7.dataset.execSelectFunction(a4)?w:x;a1=a7.rowTdTpl;a2=Ext.apply(a2,{align:L,atype:U==W?t:z,cellcls:U==W?aU+H+a3+aj:"grid-radio "+V+a3+aj});bb=a7.cbTpl}else{if(U==J){a2=Ext.apply(a2,{align:L,cellcls:aU+a7.getCheckBoxStatus(a4,C.name,a3)});bb=a7.cbTpl}else{var ba=a4.getMeta().getField(C.name);if(ba&&Ext.isEmpty(a4.data[C.name])&&a4.isNew==true&&ba.get(N)==true){bd=bd+r+aA}var A=(bd.indexOf(h)!=-1)?5:2,bc=a7.renderText(a4,C,a4.data[C.name]);a2=Ext.apply(a2,{align:C.align||c,cellcls:bd,width:a2.width-A,text:bc,title:String(bc).replace(/<[^<>]*>/mg,w)});bb=a7.cellTpl;if(U==am){a1=a7.rowNumTdTpl;bb=a7.rowNumCellTpl}}}if(a6){a9.push(a1.applyTemplate(a2))}a9.push(bb.applyTemplate(a2));if(a6){a9.push("</td>")}return a9.join(w)},createRow:function(a2,a6,a4,a5){var a1=this,U=a1.parseCss(a1.renderRow(a5,a6)),a3=['<tr id="',a1.id,a2,a5.id,'" class="',(a6%2==0?w:d),U.cls,'"','style="',U.style,'">'];for(var C=0,A=a4.length;C<A;C++){a3.push(a1.createCell(a4[C],a5,true))}a3.push("</tr>");return a3.join(w)},parseCss:function(U){var a2=w,A=w;if(Ext.isArray(U)){for(var C=0;C<U.length;C++){var a1=this.parseCss(U[C]);a2+=";"+a1.style;A+=r+a1.cls}}else{if(Ext.isString(U)){var a3=!!U.match(/^([^,:;]+:[^:;]+;)*[^,:;]+:[^:;]+;*$/);A=a3?w:U;a2=a3?U:w}}return{style:a2,cls:A}},renderText:function(A,C,a2){var a1=C.renderer;if(a1){var U=av.getRenderer(a1);if(U==null){alert(Z+a1+aB);return a2}a2=U.call(window,a2,A,C.name);return a2==null?w:a2}return a2==null?w:a2},renderRow:function(A,a2){var a1=this.rowrenderer,C=null;if(a1){var U=av.getRenderer(a1);if(U==null){alert(Z+a1+aB);return C}C=U.call(window,A,a2);return !C?w:C}return C},createTH:function(U){var a2=['<tr class="grid-hl">'];for(var C=0,A=U.length;C<A;C++){var a1=U[C];a2.push("<th ",O,'="',a1.name,'" style="height:0px;width:',a1.hidden===true?0:a1.width,ai,'"></th>')}a2.push("</tr>");return a2.join(w)},onBeforeRemove:function(){av.Masker.mask(this.wb,_lang["grid.mask.remove"])},onBeforeLoad:function(){this.ub.scrollTo(c,0);this.uh.scrollTo(c,0);if(!Ext.isIE6){av.Masker.mask(this.wb,_lang["grid.mask.loading"])}},onBeforSubmit:function(A){av.Masker.mask(this.wb,_lang["grid.mask.submit"])},onAfterSuccess:function(){av.Masker.unmask(this.wb)},preLoad:function(){},onLoad:function(){var C=this;C.isSelectAll=false;C.clearDomRef();C.preLoad();var A=C.wrap.removeClass(ac).child(s);if(A&&C.selectable&&C.selectionmodel==af){C.setCheckBoxStatus(A,false)}if(C.lb){C.renderLockArea()}C.renderUnLockAread();C.drawFootBar();av.Masker.unmask(C.wb);C.fireEvent(u,C)},clearDomRef:function(){this.selectlockTr=null;this.selectUnlockTr=null},customize:function(){var a4=location.pathname,a5=a4.indexOf("modules"),a1=a4.substring(a5,a4.length),U=a1.substring(a1.lastIndexOf("/")+1,a1.length),C=a4.substring(0,a5),a3=this.wrap.parent("[url]");if(a3){var a2=a3.getAttributeNS("","url");if(a2){a2=a2.split("?")[0];if(a2.indexOf(C)==-1){var A=a2.lastIndexOf("/");if(A!=-1){a2=a2.substring(A+1,a2.length)}a1=a1.replaceAll(U,a2)}else{a1=a2.substring(a2.indexOf(C)+new String(C).length,a2.length)}}}new Aurora.Window({id:"sys_customization_grid",url:C+"modules/sys/sys_customization_grid.screen?source_file="+a1+"&id="+this.id+"&did="+this.dataset.id,title:"个性化设置",height:530,width:560})},onAjaxFailed:function(C,A){av.Masker.unmask(this.wb)},onMouseWheel:function(C){C.stopEvent();if(this.editing==true){return}var U=C.getWheelDelta(),A=this.dataset;if(U>0){A.pre()}else{if(U<0){A.next()}}},focus:function(){this.fs.focus()},renderLockArea:function(){var A=this,C=A.lockColumns,U=['<TABLE cellSpacing="0" atype="grid.lbt" cellPadding="0" border="0"  ',Q,'="',A.lockWidth,'"><TBODY>',A.createTH(C)];Ext.each(A.dataset.data,function(a2,a1){U.push(A.createRow(aE,a1,C,a2))},A);U.push('</TBODY></TABLE><DIV style="height:17px"></DIV>');A.lbt=A.lb.update(U.join(w)).child("table[atype=grid.lbt]")},renderUnLockAread:function(){var A=this,C=A.unlockColumns,U=['<TABLE cellSpacing="0" atype="grid.ubt" cellPadding="0" border="0" ',Q,'="',A.unlockWidth,'"><TBODY>',A.createTH(C)];Ext.each(A.dataset.data,function(a2,a1){U.push(A.createRow(ay,a1,C,a2))},A);U.push("</TBODY></TABLE>");A.ubt=A.ub.update(U.join(w)).child("table[atype=grid.ubt]")},isOverSplitLine:function(A){var U=this,C=0,a1=false;U.overColIndex=-1;Ext.each(U.columns,function(a3,a2){if(a3.hidden!==true){C+=a3.width}if(A<C+3&&A>C-3&&a3.resizable!=false){a1=true;U.overColIndex=a2;return false}});return a1},onRefresh:function(){var A=this;A.onLoad();if(A.selectable){var C=A.dataset;Ext.each(C.selected,function(U){A.onSelect(C,U)})}},onIndexChange:function(U,C){var A=this.getDataIndex(C.id);if(A==-1){return}this.selectRow(A,false)},isFunctionCol:function(A){return A==W||A==Y||A==am},onAdd:function(U,a4,bd){var a7=this,a2=a7.columns,bb=bd===U.data.length-1,a5=a7.parseCss(a7.renderRow(a4,bd)),bc=(bd%2==0?w:d+r)+a5.cls;if(a7.lbt){var C=aw.createElement(aT),ba=a7.lbt.dom.tBodies[0];C.id=a7.id+aE+a4.id;C.className=bc;Ext.fly(C).set({style:a5.style});Ext.each(a2,function(be){if(be.lock===true){var bg=aw.createElement(a);if(be.type==W){Ext.fly(bg).set({recordid:a4.id,atype:t});bg.className=E;if(a7.isSelectAll){bg.className+=r+T}}else{if(be.type==Y){Ext.fly(bg).set({recordid:a4.id,atype:z});bg.className=E}else{if(be.hidden){bg.style.visibility=ao}bg.style.textAlign=be.align||c;if(!a7.isFunctionCol(be.type)){bg.dataindex=be.name}var bf={recordid:a4.id,atype:q};if(be.type==am){bg.className=a0;bf.atype=a0}Ext.fly(bg).set(bf)}}bg.innerHTML=a7.createCell(be,a4,false);C.appendChild(bg)}});if(bb){ba.appendChild(C)}else{var a6=Ext.fly(ba).query(M);for(var a3=bd,a1=a6.length;a3<a1;a3++){var a8=Ext.fly(a6[a3]).toggleClass(d);a8.select(".grid-rownumber div").each(function(be){be.update(Number(be.dom.innerHTML)+1)});a8.select(aN).each(function(be){a7.setSelectStatus(U.findById(be.getAttributeNS(w,B)))})}ba.insertBefore(C,a6[bd])}}var A=aw.createElement(aT),a9=a7.ubt.dom.tBodies[0];A.id=a7.id+ay+a4.id;A.className=bc;Ext.fly(A).set({style:a5.style});Ext.each(a2,function(be){if(be.lock!==true){var bf=aw.createElement(a);bf.style.visibility=be.hidden===true?ao:ak;bf.style.textAlign=be.align||c;Ext.fly(bf).set({dataindex:be.name,recordid:a4.id,atype:q});bf.innerHTML=a7.createCell(be,a4,false);A.appendChild(bf)}});if(bb){a9.appendChild(A)}else{var a6=Ext.fly(a9).query(M);for(var a3=bd,a1=a6.length;a3<a1;a3++){Ext.fly(a6[a3]).toggleClass(d)}a9.insertBefore(A,a6[bd])}a7.setSelectStatus(a4)},renderEditor:function(a1,A,U,C){a1.parent(a).update(this.createCell(U,A,false))},onUpdate:function(a3,A,C,a2){this.setSelectStatus(A);var a1=this,a5=Ext.get([a1.id,C,A.id].join(ad));if(a5){var a4=a1.findColByName(C),U=a1.getEditor(a4,A);if(U!=w&&($(U) instanceof av.CheckBox)){a1.renderEditor(a5,A,a4,U)}else{a5.update(a1.renderText(A,a4,a2))}}Ext.each(a1.columns,function(a7){if(a7.name!=C){var a6=Ext.get([a1.id,a7.name,A.id].join(ad));if(a6){if(a7.editorfunction){a1.renderEditor(a6,A,a7,a1.getEditor(a7,A))}if(a7.renderer){a6.update(a1.renderText(A,a7,A.get(a7.name)))}}}});a1.drawFootBar(C)},onValid:function(a1,A,C,U){var a3=this.findColByName(C);if(a3){var a2=Ext.get([this.id,C,A.id].join(ad));if(a2){if(U==false){a2.addClass(an)}else{a2.removeClass([aA,an])}}}},onRemove:function(a2,A,C){var a1=this,U=Ext.get(a1.id+aE+A.id),a3=Ext.get(a1.id+ay+A.id);if(U){U.remove()}if(a3){a3.remove()}if(Ext.isIE||Ext.isIE9){a1.syncScroll()}a1.clearDomRef();av.Masker.unmask(a1.wb);a1.drawFootBar()},onClear:function(){},onFieldChange:function(a1,A,a2,C,U){if(C==N){var a3=Ext.get([this.id,a2.name,A.id].join(ad));if(a3){a3[U==true?"addClass":"removeClass"](aA)}}},getDataIndex:function(U){for(var C=0,a1=this.dataset.data,A=a1.length;C<A;C++){if(a1[C].id==U){return C}}return -1},onSelect:function(a1,C,a2){if(!C||a2){return}var U=this,A=Ext.get(U.id+k+C.id);A.parent(aN).addClass(T);if(A){if(U.selectionmodel==af){U.setCheckBoxStatus(A,true)}else{U.setRadioStatus(A,true);a1.locate((a1.currentPage-1)*a1.pagesize+a1.indexOf(C)+1)}U.setSelectStatus(C)}},onUnSelect:function(a1,C,a2){if(!C||a2){return}var U=this,A=Ext.get(U.id+k+C.id);A.parent(aN).addClass(T);if(A){if(U.selectionmodel==af){U.setCheckBoxStatus(A,false)}else{U.setRadioStatus(A,false)}U.setSelectStatus(C)}},onSelectAll:function(){var A=this;A.clearChecked();A.isSelectAll=true;A.isUnSelectAll=false;A.wrap.addClass(ac)},onUnSelectAll:function(){var A=this;A.clearChecked();A.isSelectAll=false;A.isUnSelectAll=true;A.wrap.removeClass(ac)},clearChecked:function(){var A=this.wrap;A.select(aS).replaceClass(aG,ax);A.select(aV).removeClass(T)},onDblclick:function(a4,U){var a3=Ext.fly(U).parent("td[atype=grid-cell]");if(a3){var a2=this.dataset,a1=a3.getAttributeNS(w,B),A=a2.findById(a1),a5=a2.indexOf(A),C=a3.getAttributeNS(w,O);this.fireEvent(aX,this,A,a5,C)}},onClick:function(a4,a7){var a5=Ext.fly(a7).parent(a);if(a5){var a3=this,U=a5.getAttributeNS(w,aK),a6=a5.getAttributeNS(w,B),C=a3.dataset;if(U==q){var a2=C.findById(a6),a8=C.indexOf(a2),A=a5.getAttributeNS(w,O);a3.fireEvent(I,a3,a8,A,a2);a3.fireEvent(aQ,a3,a8,a2)}else{if(U==a0){var a2=C.findById(a6),a8=C.indexOf(a2);if(a2.id!=a3.selectedId){a3.selectRow(a8)}}else{if(U==t){var a1=Ext.get(a3.id+k+a6);if(a1.hasClass(K)||a1.hasClass(S)){return}if(a3.isSelectAll&&!a1.parent(aV)){a1.replaceClass(ax,aG)}else{if(a3.isUnselectAll&&!a1.parent(aV)){a1.replaceClass(aG,ax)}}a1.hasClass(aG)?C.unSelect(a6):C.select(a6)}else{if(U==z){var a1=Ext.get(a3.id+k+a6);if(a1.hasClass(G)||a1.hasClass(P)){return}C.select(a6)}}}}}},onCellClick:function(U,a1,C,A,a2){this.adjustColumn(C);this.showEditor(a1,C,a2)},adjustColumn:function(a1){var a4=this,U=a4.findColByName(a1);if(!U||!U.autoadjust){return}var a3=a4.wrap.select("tr.grid-hl "+aZ+a1+D),C=Ext.fly(a3.elements[0]).getWidth(),A=C,a5=12,a2=Math.min(a4.width-(a4.selectable?23:0)-20,U.maxadjustwidth||Number.MAX_VALUE);a4.wrap.select(ab+a1+"] span").each(function(a6){if(Ext.isIE||Ext.isIE9){a6.parent().setStyle(aR,"clip")}A=Math.max(a6.getWidth()+a5,A);if(Ext.isIE||Ext.isIE9){a6.parent().setStyle(aR,w)}if(A>a2){A=a2;return false}});A>C&&a4.setColumnSize(a1,A)},setColumnPrompt:function(C,A){this.wrap.select("td.grid-hc"+aM+C+"] div").update(A)},setEditor:function(C,U){var A=this.findColByName(C),a1=Ext.get([this.id,C,this.selectedId].join(ad));A.editor=U;if(a1){if(U==w){a1.removeClass(h)}else{if(!$(U) instanceof av.CheckBox){a1.addClass(h)}}}},getEditor:function(a1,C){var U=a1.editor||w;if(a1.editorfunction){var A=window[a1.editorfunction];if(A==null){alert(Z+a1.editorfunction+aB);return null}U=A.call(window,C,a1.name)||w}return U},showEditor:function(a6,A,a5){if(a6==-1){return}var a3=this,U=a3.findColByName(A);if(!U){return}var C=a3.dataset,a1=C.getAt(a6);if(!a1){return}if(a1.id!=a3.selectedId){a3.selectRow(a6)}else{a3.focusRow(a6)}a3.focusColumn(A);var a4=a3.getEditor(U,a1);a3.setEditor(A,a4);if(a4!=w){var a2=$(a4);(function(){var a8=a1.get(A),bb=Ext.get([a3.id,A,a1.id].join(ad)),ba=bb.getXY(),a7;a2.bind(C,A);a2.render(a1);a2.el.on(aL,a3.onEditorKeyDown,a3);Ext.fly(aW).on(y,a3.onEditorBlur,a3);a7=a3.currentEditor={record:a1,ov:a8,name:A,editor:a2};if(a2 instanceof av.CheckBox){a2.move(-1000,ba[1]+5);if(a5){a2.focus()}else{a2.onClick()}a7.focusCheckBox=bb;bb.setStyle(g,aJ)}else{var a9=bb.parent();a2.move(ba[0],ba[1]);a2.setHeight(a9.getHeight()-5);a2.setWidth(a9.getWidth()-7);a2.isEditor=true;a2.isFireEvent=true;a2.isHidden=false;a2.focus();a3.editing=true;a2.on(ah,a3.onEditorSelect,a3);if(a5){a5.call(window,a2)}a3.fireEvent(ap,a3,a2,a6,A,a1)}}).defer(10)}},onEditorSelect:function(){(function(){this.hideEditor()}).defer(1,this)},onEditorKeyDown:function(a2){var U=this,a1=a2.keyCode,C=U.currentEditor;if(a1==27){if(C){var A=C.editor;if(A){A.clearInvalid();A.render(A.binder.ds.getCurrentRecord())}}U.hideEditor()}else{if(a1==13){if(!(C&&C.editor&&C.editor instanceof av.TextArea)){U.showNextEditor()}}else{if(a1==9){a2.stopEvent();U.showNextEditor()}}}},showNextEditor:function(){var a5=this,C=a5.currentEditor;a5.hideEditor();if(C){var a3=C.editor;if(a3){var a8=function(bb){if(bb instanceof av.Lov){bb.showLovWindow()}},a2=a5.dataset,a1=a3.binder.name,A=a3.record,ba=a2.data.indexOf(A),U=null;if(ba!=-1){var a9=a5.columns,a6=false,a4;Ext.each(a9,function(bb,bc){if(a6){if(bb.hidden!=true){a4=a5.getEditor(bb,A);if(a4!=w){U=bb.name;return false}}}else{if(bb.name==a1){a6=true}}});if(U){a5.fireEvent(I,a5,ba,U,A,a8)}else{var a7=a2.getAt(ba+1);if(!a7&&a5.autoappend!==false){a2.create();a7=a2.getAt(ba+1)}if(a7){a5.selectRow(ba+1);Ext.each(a9,function(bb){if(a5.getEditor(bb,a7)!=w){a5.fireEvent(I,a5,ba+1,bb.name,a7,a8);return false}})}}}a5.fireEvent(R,a5,ba,U)}}},focusRow:function(a3){var a2=25,A=this.ub,U=A.getScroll().top,a1=A.getHeight(),C=A.dom.scrollWidth>A.dom.clientWidth?16:0;if(a3*a2<U){A.scrollTo(n,a3*a2-1)}else{if((a3+1)*a2>(U+a1-C)){A.scrollTo(n,(a3+1)*a2-a1+C)}}if(this.autofocus){this.focus()}},focusColumn:function(U){var a5=this,A=25,C=a5.ub,a2=C.getScroll().left,a6=0,a4=0,a1=0,a3;Ext.each(a5.columns,function(a7){if(a7.name==U){a4=a7.width}if(a7.hidden!==true){if(a7.lock===true){a1+=a7.width}else{if(a4==0){a6+=a7.width}}}});a3=a6+a4;if(a6<a2){C.scrollTo(c,a6)}else{if((a3-a2)>(a5.width-a1)){C.scrollTo(c,a3-a5.width+a1+(C.dom.scrollHeight>C.dom.clientHeight?16:0))}}if(a5.autofocus){a5.focus()}},hideEditor:function(){var U=this,C=U.currentEditor;if(C){var A=C.editor;if(A){if(!A.canHide||A.canHide()){var a1=C.focusCheckBox;if(a1){a1.setStyle(g,ag);C.focusCheckBox=null}A.el.un(aL,U.onEditorKeyDown,U);A.un(ah,U.onEditorSelect,U);Ext.fly(aW).un(y,U.onEditorBlur,U);A.move(-10000,-10000);A.onBlur();A.isFireEvent=false;A.isHidden=true;U.editing=false}}}},onEditorBlur:function(a1,C){var U=this,A=U.currentEditor;if(A&&!A.editor.isEventFromComponent(C)){U.hideEditor.defer(Ext.isIE9?10:0,U)}},onLockHeadMove:function(C){var A=this;A.hmx=C.xy[0]-A.lht.getXY()[0];A.lh.setStyle(aI,A.isOverSplitLine(A.hmx)?X:au)},onUnLockHeadMove:function(U){var A=this;var C=A.uht;A.hmx=U.xy[0]-(C?C.getXY()[0]+C.getScroll().left:0)+A.lockWidth;A.uh.setStyle(aI,A.isOverSplitLine(A.hmx)?X:au)},onHeadMouseDown:function(C){var A=this;A.dragWidth=-1;if(A.overColIndex==undefined||A.overColIndex==-1){return}A.dragIndex=A.overColIndex;A.dragStart=C.getXY()[0];A.sp.setHeight(A.wrap.getHeight()).show().setStyle({top:A.wrap.getXY()[1]+ai,left:C.xy[0]+ai});Ext.get(aW).on(ar,A.onHeadMouseMove,A).on(ae,A.onHeadMouseUp,A)},onHeadClick:function(a5,ba){var a3=this,a6=Ext.fly(ba).parent(a),A=a3.dataset,U;if(a6){U=a6.getAttributeNS(w,aK)}if(U==F){var a4=a6.getAttributeNS(w,O),C=a3.findColByName(a4);if(C&&C.sortable===true){if(A.isModified()){av.showInfoMessage("提示","有未保存数据!");return}var a7=a6.child(al),a9=a4,a2=w;if(a3.currentSortTarget){a3.currentSortTarget.removeClass([az,i])}a3.currentSortTarget=a7;if(Ext.isEmpty(C.sorttype)){C.sorttype=aH;a7.removeClass(az).addClass(i);a2=aH}else{if(C.sorttype==aH){C.sorttype=o;a7.removeClass(i).addClass(az);a2=o}else{C.sorttype=w;a7.removeClass([i,az])}}A.sort(a9,a2)}}else{if(U==t){var a1=a6.child(s);if(a1){var a8=a1.hasClass(aG);a3.setCheckBoxStatus(a1,!a8);if(!a8){A.selectAll()}else{A.unSelectAll()}}}}},setRadioStatus:function(A,C){if(!C){A.removeClass(aO).addClass(aC)}else{A.addClass(aO).removeClass(aC)}},setCheckBoxStatus:function(A,C){if(!C){A.removeClass(aG).addClass(ax)}else{A.addClass(aG).removeClass(ax)}},setSelectDisable:function(U,C){var A=this.dataset.selected.indexOf(C)==-1;if(this.selectionmodel==af){U.removeClass([aG,ax]).addClass(A?K:S)}else{U.removeClass([aO,aC,P,G]).addClass(A?G:P)}},setSelectEnable:function(U,C){var A=this.dataset.selected.indexOf(C)==-1;if(this.selectionmodel==af){U.removeClass([K,S]).addClass(A?ax:aG)}else{U.removeClass([aC,aO,G,P]).addClass(A?aC:aO)}},setSelectStatus:function(C){var U=this,a1=U.dataset;if(a1.selectfunction){var A=Ext.get(U.id+k+C.id);if(!a1.execSelectFunction(C)){U.setSelectDisable(A,C)}else{U.setSelectEnable(A,C)}}},onHeadMouseMove:function(a1){var U=this;a1.stopEvent();U.dragEnd=a1.getXY()[0];var C=U.dragEnd-U.dragStart,a2=U.columns[U.dragIndex],A=a2.width+C;if(A>30&&A<U.width){U.dragWidth=A;U.sp.setStyle(c,a1.xy[0]+ai)}},onHeadMouseUp:function(C){var A=this;Ext.get(aW).un(ar,A.onHeadMouseMove,A).un(ae,A.onHeadMouseUp,A);A.sp.hide();if(A.dragWidth!=-1){A.setColumnSize(A.columns[A.dragIndex].name,A.dragWidth)}A.syncScroll()},findColByName:function(A){var C;if(A){Ext.each(this.columns,function(U){if(U.name&&U.name.toLowerCase()===A.toLowerCase()){C=U;return false}})}return C},selectRow:function(a3,C){var a1=this,a2=a1.dataset,A=a2.getAt(a3),U=(a2.currentPage-1)*a2.pagesize+a3+1;a1.selectedId=A.id;if(a1.selectlockTr){a1.selectlockTr.removeClass(aa)}if(a1.selectUnlockTr){a1.selectUnlockTr.removeClass(aa)}a1.selectUnlockTr=Ext.get(a1.id+ay+A.id);if(a1.selectUnlockTr){a1.selectUnlockTr.addClass(aa)}a1.selectlockTr=Ext.get(a1.id+aE+A.id);if(a1.selectlockTr){a1.selectlockTr.addClass(aa)}a1.focusRow(a3);a1.selectRecord=A;if(C!==false&&U!=null){a2.locate.defer(5,a2,[U,false])}},setColumnSize:function(A,a7){var a2=this,a3,a1,U=0,C=0;Ext.each(a2.columns,function(a8){if(a8.name&&a8.name===A){if(a8.hidden===true){return}a8.width=a7;if(a8.lock!==true){a3=a2.uh.child(aZ+A+D);a1=a2.ub.child(aZ+A+D)}else{if(a2.lh){a3=a2.lh.child(aZ+A+D)}if(a2.lb){a1=a2.lb.child(aZ+A+D)}}}if(a8.hidden!==true){a8.lock!==true?(C+=a8.width):(U+=a8.width)}});a2.wrap.select(ab+A+"] DIV.grid-cell").each(function(a8){a8.setStyle(Q,Math.max(a7-(a8.hasClass(h)?7:4),0)+ai)});a2.unlockWidth=C;a2.lockWidth=U;if(a3){a3.setStyle(Q,a7+ai)}if(a1){a1.setStyle(Q,a7+ai)}var a6=Math.max(a2.width-U,0);if(a2.fb){a2.fb.child(aZ+A+D).setStyle(Q,a7+ai);a2.uf.setStyle(Q,a6+ai);a2.fb.child("table[atype=fb.ubt]").setStyle(Q,C+ai);var a5=a2.fb.child("table[atype=fb.lbt]");if(a5){a2.fb.child("div[atype=grid.lf]").setStyle(Q,(U-1)+ai);a5.setStyle(Q,U+ai)}}if(a2.lc){var a4=Math.max(U-1,0);a2.lc.setStyle({width:a4+ai,display:a4==0?ag:w})}if(a2.lht){a2.lht.setStyle(Q,U+ai)}if(a2.lbt){a2.lbt.setStyle(Q,U+ai)}a2.uc.setStyle(Q,a6+ai);a2.uh.setStyle(Q,a6+ai);a2.ub.setStyle(Q,a6+ai);a2.uht.setStyle(Q,C+ai);if(a2.ubt){a2.ubt.setStyle(Q,C+ai)}a2.syncSize()},drawFootBar:function(C){var A=this;if(!A.fb){return}Ext.each([].concat(C?C:A.columns),function(a4){var a2=Ext.isString(a4)?A.findColByName(a4):a4;if(a2&&a2.footerrenderer){var a3=av.getRenderer(a2.footerrenderer);if(a3==null){alert(Z+a2.footerrenderer+aB);return}var a1=a2.name,U=a3.call(window,A.dataset.data,a1);if(!Ext.isEmpty(U)){A.fb.child(ab+a1+D).update(U)}}})},syncSize:function(){var A=this,U=0;Ext.each(A.columns,function(a1){if(a1.hidden!==true){if(a1.lock===true){U+=a1.width}}});if(U!=0){var C=A.width-U;A.uc.setWidth(C);A.uh.setWidth(C);A.ub.setWidth(C)}},classfiyColumns:function(){var A=this;A.lockColumns=[],A.unlockColumns=[];A.lockWidth=0,A.unlockWidth=0;Ext.each(A.columns,function(C){if(C.lock===true){A.lockColumns.add(C);if(C.hidden!==true){A.lockWidth+=C.width}}else{A.unlockColumns.add(C);if(C.hidden!==true){A.unlockWidth+=C.width}}});A.columns=A.lockColumns.concat(A.unlockColumns)},showColumn:function(C){var A=this.findColByName(C);if(A){if(A.hidden===true){delete A.hidden;this.setColumnSize(C,A.hiddenwidth||A.width);delete A.hiddenwidth;this.wrap.select(ab+C+D).show()}}},hideColumn:function(C){var A=this.findColByName(C);if(A){if(A.hidden!==true){A.hiddenwidth=A.width;this.setColumnSize(C,0,false);this.wrap.select(ab+C+D).hide();A.hidden=true}}},removeColumn:function(A){var a5=this,a7=a5.columns,a8=[],a4=[];Ext.each(A,function(a9){col=a5.findColByName(a9);if(!col){return}if(col.lock){a8.push(a9)}else{a4.push(a9)}a7.splice(a7.indexOf(col),1)});var a3=a8.length,a2=a4.length;if(a3||a2){a5.dataset.query();a5.classfiyColumns();if(a3){var C=a5.lockWidth<1?1:a5.lockWidth,U=[];for(var a1=0;a1<a3;a1++){U.push(aM+a8[a1]+D)}a5.lht.setWidth(a5.lockWidth).select(U.join(",")).remove();a5.lc.setWidth(C-1);a5.uc.setWidth(a5.wrap.getWidth()-C)}if(a2){var U=[];for(var a1=0;a1<a2;a1++){U.push(aM+a4[a1]+D)}a5.uht.select(U.join(",")).remove()}var a6=a5.unLockWidth;a5.uht.setWidth(a6);a5.uh.setWidth(a6);a5.ub.setWidth(a6)}},createHead:Ext.isIE||Ext.isIE9?function(a4,a5,U,a3,C){var A=a3.query(aT),a1=Ext.fly(A[0]).child("th[width=20]"),a2;if(U){a2=a3.query(aM+U+D)[0]}if(a5==aP){a2=a2.nextSibling||null;C++}else{if(a5==e){if(a1){a2=a1.dom}C=-1}}Ext.each(a4,function(ba){var a7=Ext.get(aw.createElement(aY)),a9=Ext.get(A[1].insertCell(C)),a6=ba.width,a8=ba.name;if(C>-1){C++}a9.addClass("grid-hc").set({dataindex:a8,atype:F}).update("<div>"+ba.prompt+"</div>");if(a2){A[0].insertBefore(a7.dom,a2)}else{A[0].appendChild(a7.dom)}a7.setStyle(Q,a6+ai).set({dataindex:a8})})}:function(a4,a5,A,a2){var C=[],a1=[],U=a2.query(a5!=e?aM+A+D:aT);Ext.each(a4,function(a6){C.push('<th style="width:',a6.width,ai,';" ',O,'="',a6.name,'"></th>');a1.push('<td class="grid-hc" atype="grid.head" ',O,'="',a6.name,'"><div>',a6.prompt,"</div></td>")});new Ext.Template(C.join(w))[a5](U[0],{});new Ext.Template(a1.join(w))[a5](U[1],{});var a3=Ext.fly(U[0]).child("th[width=20]");if(a3){a3.appendTo(Ext.fly(U[0]))}},addColumn:function(bd,C,a3){var a4=this;if(a4.dataset.isModified()){av.showInfoMessage(_lang["grid.info"],_lang["grid.info.continue"])}else{var a9=a4.columns,a5=a9.length,bc,ba;if(C&&a3){var a1=a4.findColByName(C);if(a1){bc=a1.lock;ba=a4[bc?"lockColumns":"unlockColumns"].indexOf(a1);a5=(a3==f?0:1)+a9.indexOf(a1)}else{alert("未找到列"+C);return}}var bb=[],a2=[];Ext.each(bd,function(bg){var bf=Ext.apply(Ext.apply({},m),bg),be=a4.findColByName(bf.name);if(be){return}if(bf.lock){bb.push(bf)}else{a2.push(bf)}});var U=bb.concat(a2);if(U.length){var A=a3?(a3==f?aD:aP):e,a8=umethod=A,a6=uname=C,a7=a4.wrap;if(bc){umethod=aD;uname=a4.unlockColumns[0].name}else{a8=e;a6=null}a4.columns=a9.slice(0,a5).concat(U).concat(a9.slice(a5));a4.classfiyColumns();if(bb.length){if(!a4.lht){a4.lc=new Ext.Template("<DIV class='grid-la' atype='grid.lc' style='width:24px;'><DIV class='grid-lh' atype='grid.lh' unselectable='on' onselectstart='return false;' style='height:25px;'><TABLE cellSpacing='0' atype='grid.lht' cellPadding='0' border='0' style='width:25px'><TBODY><TR class='grid-hl'></TR><TR height=25></TR></TBODY></TABLE></DIV><DIV class='grid-lb' atype='grid.lb' style='width:100%;height:255px'></DIV></DIV>").insertAfter(a4.fs.dom,{},true);a4.lh=a7.child("div[atype=grid.lh]");a4.lb=a7.child("div[atype=grid.lb]");a4.lht=a7.child("table[atype=grid.lht]");a4.lb[aF](p,a4.onClick,a4)[aF](aX,a4.onDblclick,a4);a4.lht[aF](ar,a4.onLockHeadMove,a4);a4.lh[aF](y,a4.onHeadMouseDown,a4)[aF](p,a4.onHeadClick,a4)}a4.createHead(bb,a8,a6,a4.lht,ba)}if(a2.length){a4.createHead(a2,umethod,uname,a4.uht,ba)}if(a4.lb){a4.lb.update(w)}a4.ub.update(w);Ext.each(U,function(be){a4.setColumnSize(be.name,be.width)});a4.dataset.query()}}},insertColumnBefore:function(C,A){this.addColumn(A,C,f)},insertColumnAfter:function(C,A){this.addColumn(A,C,1)},setWidth:function(U){var a1=this;if(a1.width==U){return}a1.width=U;a1.wrap.setWidth(U);var C=av.CmpManager.get(a1.id+b);if(C){C.setWidth(U)}var A=av.CmpManager.get(a1.id+l);if(A){A.setWidth(U)}if(a1.fb){a1.fb.setWidth(U)}var a2=U-a1.lockWidth;a1.uc.setWidth(a2);a1.uh.setWidth(a2);a1.ub.setWidth(a2);if(a1.uf){a1.uf.setWidth(a2)}},setHeight:function(a1){var a2=this;if(a2.height==a1){return}a2.height=a1;var C=av.CmpManager.get(a2.id+b);if(C){a1-=25}var A=av.CmpManager.get(a2.id+l);if(A){a1-=25}if(a2.fb){a1-=25}a2.wrap.setHeight(a1);var U=a1-25;if(a2.lb){a2.lb.setHeight(U)}a2.ub.setHeight(U)},deleteSelectRows:function(U){var C=this.dataset,A=[].concat(C.getSelected());if(A.length>0){C.remove(A)}U.close()},remove:function(){var A=this.dataset.getSelected();if(A.length>0){av.showConfirm(_lang["grid.remove.confirm"],_lang["grid.remove.confirmMsg"],this.deleteSelectRows.createDelegate(this))}},clear:function(){var C=this.dataset,A=C.getSelected();while(A[0]){C.removeLocal(A[0])}},_export:function(){this.showExportConfirm()},showExportConfirm:function(){this.initColumnPrompt();var C=this,a2=0,a1=C.id+"_export",U=['<div class="item-export-wrap" style="margin:15px;width:270px" id="',a1,'">','<div class="grid-uh" atype="grid.uh" style="width: 270px; -moz-user-select: none; text-align: left; height: 25px; cursor: default;" onselectstart="return false;" unselectable="on">','<table cellSpacing="0" cellPadding="0" border="0"><tbody><tr height="25px">','<td class="export-hc" style="width:22px;" atype="export.rowcheck"><center><div atype="export.headcheck" class="',aU,ax,'"></div></center></td>','<td class="export-hc" style="width:222px;" atype="grid-type">',_lang["grid.export.column"],"</td>","</tr></tbody></table></div>",'<div style="overflow:auto;height:200px;"><table cellSpacing="0" cellPadding="0" border="0"><tbody>'],A=true;Ext.each(C.columns,function(a4,a3){if(!C.isFunctionCol(a4.type)){if(A){A=a4.forexport!==false}U.push("<tr",(a2+a3)%2==0?w:' class="',d,'"','><td class="',E,'" style="width:22px;" ',B,'="',a3,'" atype="export.rowcheck"><center><div id="',C.id,k,a3,'" class="',aU,a4.forexport===false?ax:aG,'"></div></center></td><td><div class="',q,'" style="width:220px">',a4.prompt,"</div></td></tr>")}else{a2++}});if(A){U[7]=aG}U.push("</tbody></table></div></div>");C.exportwindow=av.showOkCancelWindow(_lang["grid.export.config"],U.join(w),function(a3){av.showConfirm(_lang["grid.export.confirm"],_lang["grid.export.confirmMsg"],function(a4){C.doExport();a4.close();a3.body.un(p,C.onExportClick,C);a3.close()});return false},null,null,300);C.exportwindow.body.on(p,C.onExportClick,C)},initColumnPrompt:function(){var A=this;if(!A.isPromptInit){Ext.each(A.columns,function(C){if(!A.isFunctionCol(C.type)){C.prompt=C.name?A.wrap.child("td.grid-hc"+aM+C.name+"] div").dom.innerHTML:(C.prompt||A.dataset.getField(C.name).pro.prompt)}});A.isPromptInit=true}},onExportClick:function(a2,a8){var a1=this,a3=Ext.fly(a8).parent(a);if(a3){var A=a3.getAttributeNS(w,aK);if(A=="export.rowcheck"){var a6=a3.getAttributeNS(w,B),C=a3.child(al),a5=C.hasClass(aG),U=C.getAttributeNS(w,aK),a4=a1.columns;a1.setCheckBoxStatus(C,!a5);if(U=="export.headcheck"){var a7=(a1.isFunctionCol(a4[0].type)?1:0)+(a1.isFunctionCol(a4[1].type)?1:0);a1.exportwindow.body.select("td[atype=export.rowcheck] div[atype!=export.headcheck]").each(function(a9,bb,ba){a1.setCheckBoxStatus(a9,!a5);a4[ba+a7].forexport=!a5})}else{a4[a6].forexport=!a5}}}},doExport:function(){this.initColumnPrompt();av.doExport(this.dataset,this.columns)},destroy:function(){av.Grid.superclass.destroy.call(this);this.processDataSetLiestener("un");this.sp.remove();delete this.sp}});av.Grid.revision="$Rev$"})($A);