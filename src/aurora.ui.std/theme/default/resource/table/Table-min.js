(function(){var ag="-",ai="__",ah="_",i=".",e=" ",j="",N="none",H="outline",y="left",aa="td",l="recordid",g="row-selected",r="required",J="item-notBlank",Z="item-invalid",ae="table-row-alt",u="table-rowbox",K=i+u,p="table.rowcheck",w="table.rowradio",v="table-ckb ",O="table-select-all",I="multiple",m="checkedvalue",f="-readonly",n="-c",d="-u",x="item-ckb",V=x+"-self",D=i+V,S=x+d,af=x+n,B=x+f+d,P=x+f+n,o="item-radio-img",c=o+n,ac=o+d,a=o+f+n,Y=o+f+d,b=D+e+i+af,ab="table-cell",L=ab+"-editor",s="cellcheck",z="rowcheck",Q="click",t="cellclick",G="render",A="rowclick",F="editorshow",ad="nexteditorshow",W="keydown",E="select",h="mousedown",q="resize",T="未找到",k="方法!";$A.Table=Ext.extend($A.Component,{initComponent:function(C){$A.Table.superclass.initComponent.call(this,C);var M=this.wrap;this.cb=M.child("div[atype=table.headcheck]");this.tbody=M.child("tbody");this.fb=M.child("tfoot");this.initTemplate()},processListener:function(C){$A.Table.superclass.processListener.call(this,C);this.tbody[C](Q,this.onClick,this);if(this.canwheel){this.tbody[C]("mousewheel",this.onMouseWheel,this)}if(this.cb){this.cb[C](Q,this.onHeadClick,this)}this[C](t,this.onCellClick,this)},processDataSetLiestener:function(C){var M=this.dataset;if(M){M[C]("ajaxfailed",this.onAjaxFailed,this);M[C]("metachange",this.onLoad,this);M[C]("update",this.onUpdate,this);M[C]("reject",this.onUpdate,this);M[C]("add",this.onAdd,this);M[C]("submit",this.onBeforSubmit,this);M[C]("submitfailed",this.onAfterSuccess,this);M[C]("submitsuccess",this.onAfterSuccess,this);M[C]("query",this.onBeforeLoad,this);M[C]("load",this.onLoad,this);M[C]("loadfailed",this.onAjaxFailed,this);M[C]("valid",this.onValid,this);M[C]("beforeremove",this.onBeforeRemove,this);M[C]("remove",this.onRemove,this);M[C]("clear",this.onLoad,this);M[C]("refresh",this.onLoad,this);M[C]("fieldchange",this.onFieldChange,this);M[C]("indexchange",this.onIndexChange,this);M[C](E,this.onSelect,this);M[C]("unselect",this.onUnSelect,this);M[C]("selectall",this.onSelectAll,this);M[C]("unselectall",this.onUnSelectAll,this)}},initEvents:function(){$A.Table.superclass.initEvents.call(this);this.addEvents(G,t,A,F,ad)},bind:function(C){if(Ext.isString(C)){C=$(C);if(!C){return}}this.dataset=C;this.processDataSetLiestener("on");this.onLoad()},initTemplate:function(){this.cellTpl=new Ext.Template(['<div class="table-cell {cellcls}" id="',this.id,'_{name}_{recordid}">{text}</div>']);this.cbTpl=new Ext.Template(['<center><div class="{cellcls}" id="',this.id,'_{name}_{recordid}"></div></center>'])},createRow:function(R,U,ak){if(ak){var C=this.wrap.query("tbody tr");for(var aj=U,M=C.length;aj<M;aj++){Ext.fly(C[aj]).toggleClass(ae).select(K).each(function(am){this.setSelectStatus(this.dataset.findById(am.getAttributeNS(j,l)))},this)}}var al=this.tbody.dom.insertRow(U),X=this.parseCss(this.renderRow(R,U));al.id=this.id+ag+R.id;al.style.cssText=X.style;al.className=(U%2==1?ae+e:j)+X.cls;Ext.each(this.columns,function(am){this.createCell(al,am,R)},this)},createEmptyRow:function(){this.emptyRow=this.tbody.dom.insertRow(-1);Ext.each(this.columns,function(C){Ext.fly(this.emptyRow.insertCell(-1)).set({atype:ab,dataindex:C.name}).setStyle({"text-align":C.align||y,display:C.hidden?N:j}).update("&#160;")},this)},removeEmptyRow:function(){if(this.emptyRow){this.tbody.dom.removeChild(this.emptyRow);this.emptyRow=null}},getCheckBoxStatus:function(C,U,R){var aj=this.dataset.getField(U),M=aj.getPropertity(m),X=C.data[U];return x+(R?f:j)+((X&&X==M)?n:d)},createCell:function(am,C,X){var aj=this.getEditor(C,X),M=C.type,al=C.name,U,ao=j,R;if(am.tagName.toLowerCase()=="tr"){R=am.insertCell(-1)}else{R=Ext.fly(am).parent(aa).dom}if(aj!=j){var ak=$A.CmpManager.get(aj);if(ak&&(ak instanceof $A.CheckBox)){M=s}else{ao=L}}else{if(al&&Ext.isDefined(X.getField(al).get(m))){M=s;U=true}}if(M==z||M=="rowradio"){U=this.dataset.execSelectFunction(X)?j:f;Ext.fly(R).set({atype:M==z?p:w,recordid:X.id}).addClass(u);R.innerHTML=this.cbTpl.applyTemplate({cellcls:M==z?v+x+U+d:"table-radio "+o+U+d,name:al,recordid:X.id})}else{Ext.fly(R).set({atype:ab,recordid:X.id,dataindex:al}).setStyle({"text-align":C.align||y,dLEFT:C.hidden?N:j});if(M==s){R.innerHTML=this.cbTpl.applyTemplate({cellcls:v+this.getCheckBoxStatus(X,al,U),name:al,recordid:X.id})}else{var an=X.getMeta().getField(al);if(an&&Ext.isEmpty(X.data[al])&&X.isNew==true&&an.get(r)==true){ao=ao+e+J}R.innerHTML=this.cellTpl.applyTemplate({text:this.renderText(X,C,X.data[al]),cellcls:ao,name:al,recordid:X.id})}}},onSelect:function(R,M,U){if(!M||U){return}var C=Ext.get(this.id+ai+M.id);C.parent(K).addClass(V);if(C){if(this.selectionmodel==I){this.setCheckBoxStatus(C,true)}else{this.setRadioStatus(C,true);var R=this.dataset;R.locate((R.currentPage-1)*R.pagesize+R.indexOf(M)+1)}this.setSelectStatus(M)}},onUnSelect:function(R,M,U){if(!M||U){return}var C=Ext.get(this.id+ai+M.id);C.parent(K).addClass(V);if(C){if(this.selectionmodel==I){this.setCheckBoxStatus(C,false)}else{this.setRadioStatus(C,false)}this.setSelectStatus(M)}},onSelectAll:function(){this.clearChecked();this.isSelectAll=true;this.isUnSelectAll=false;this.wrap.addClass(O)},onUnSelectAll:function(){this.clearChecked();this.isSelectAll=false;this.isUnSelectAll=true;this.wrap.removeClass(O)},clearChecked:function(){var C=this.wrap;C.select(b).replaceClass(af,S);C.select(D).removeClass(V)},setRadioStatus:function(C,M){if(!M){C.removeClass(c).addClass(ac)}else{C.addClass(c).removeClass(ac)}},setCheckBoxStatus:function(C,M){if(!M){C.removeClass(af).addClass(S)}else{C.addClass(af).removeClass(S)}},setSelectDisable:function(R,M){var C=this.dataset.selected.indexOf(M)==-1;if(this.selectionmodel==I){R.removeClass([af,S]).addClass(C?B:P)}else{R.removeClass([c,ac,a,Y]).addClass(C?Y:a)}},setSelectEnable:function(R,M){var C=this.dataset.selected.indexOf(M)==-1;if(this.selectionmodel==I){R.removeClass([B,P]).addClass(C?S:af)}else{R.removeClass([ac,c,Y,a]).addClass(C?ac:c)}},setSelectStatus:function(M){if(this.dataset.selectfunction){var C=Ext.get(this.id+ai+M.id);if(!this.dataset.execSelectFunction(M)){this.setSelectDisable(C,M)}else{this.setSelectEnable(C,M)}}},onHeadClick:function(U){var C=this.cb,R=this.dataset,M=C.hasClass(af);this.setCheckBoxStatus(C,!M);if(!M){R.selectAll()}else{R.unSelectAll()}},setEditor:function(M,R){var C=this.findColByName(M),U=Ext.get([this.id,M,this.selectedId].join(ah));C.editor=R;if(U){this.focusdiv=U;if(R==j){U.removeClass(L)}else{if(!$(R) instanceof $A.CheckBox){U.addClass(L)}}}},getEditor:function(U,M){var R=U.editor||j;if(U.editorfunction){var C=window[U.editorfunction];if(C==null){alert(T+U.editorfunction+k);return null}R=C.call(window,M,U.name)||j}return R},showEditor:function(am,C,al){if(am==-1){return}var M=this.findColByName(C);if(!M){return}var R=this.dataset.getAt(am);if(!R){return}if(R.id!=this.selectedId){this.selectRow(am)}var aj=this.getEditor(M,R);this.setEditor(C,aj);var X=this;if(X.currentEditor){X.currentEditor.editor.el.un(W,X.onEditorKeyDown,X);var ak=X.currentEditor.focusCheckBox;if(ak){ak.setStyle(H,N);X.currentEditor.focusCheckBox=null}}if(aj!=j){var U=$(aj);setTimeout(function(){var an=R.get(C),ap=Ext.get([X.id,C,R.id].join(ah)),ao=ap.getXY();X.currentEditor={record:R,ov:an,name:C,editor:U};U.bind(X.dataset,C);U.render(R);if(U instanceof $A.CheckBox){U.move(-1000,ao[1]+5);U.el.on(W,X.onEditorKeyDown,X);U.onClick();X.currentEditor.focusCheckBox=ap;ap.setStyle(H,"1px dotted blue")}else{if(aj){X.positionEditor();U.isEditor=true;U.isFireEvent=true;U.isHidden=false;U.focus();X.editing=true;U.el.on(W,X.onEditorKeyDown,X);U.on(E,X.onEditorSelect,X);Ext.fly(document.documentElement).on(h,X.onEditorBlur,X);Ext.fly(window).on(q,X.positionEditor,X);if(al){al.call(window,U)}X.fireEvent(F,X,U,am,C,R)}}},10)}},onEditorSelect:function(){var C=this;setTimeout(function(){C.hideEditor()},1)},onEditorKeyDown:function(U,M){var R=U.keyCode;if(R==27){if(this.currentEditor){var C=this.currentEditor.editor;if(C){C.clearInvalid();C.render(C.binder.ds.getCurrentRecord())}}this.hideEditor()}else{if(R==13){if(!(this.currentEditor&&this.currentEditor.editor&&this.currentEditor.editor instanceof $A.TextArea)){this.showNextEditor()}}else{if(R==9){U.stopEvent();this.showNextEditor()}}}},showNextEditor:function(){this.hideEditor();var ao=this;if(ao.currentEditor){var am=ao.currentEditor.editor;if(am){var ar=function(av){if(av instanceof $A.Lov){av.showLovWindow()}},aj=ao.dataset,X=am.binder.name,C=am.record,au=aj.data.indexOf(C),M=null;if(au!=-1){var at=ao.columns,R=0,an;for(var al=0,ak=at.length;al<ak;al++){if(at[al].name==X){R=al+1;break}}for(var al=R,ak=at.length;al<ak;al++){var U=at[al];if(U.hidden!=true){an=ao.getEditor(U,C);if(an!=j){M=U.name;break}}}if(ao.currentEditor){var ap=ao.currentEditor.focusCheckBox;if(ap){ap.setStyle(H,N);ao.currentEditor.focusCheckBox=null}}if(M){var am=$(an);if(am instanceof $A.CheckBox){ao.currentEditor={record:C,ov:C.get(M),name:M,editor:am};setTimeout(function(){am.bind(aj,M);am.render(C);var aw=Ext.get([ao.id,M,C.id].join(ah)),av=aw.getXY();am.move(-1000,av[1]);am.focus();am.el.on(W,ao.onEditorKeyDown,ao);ao.currentEditor.focusCheckBox=aw;aw.setStyle(H,"1px dotted blue")},10)}else{ao.fireEvent(t,ao,au,M,C,ar)}}else{var aq=aj.getAt(au+1);if(!aq&&ao.autoappend!==false){aj.create();aq=aj.getAt(au+1)}if(aq){ao.selectRow(au+1);for(var al=0,ak=at.length;al<ak;al++){var U=at[al],an=ao.getEditor(U,aq);if(an!=j){var am=$(an),M=U.name;if(am instanceof $A.CheckBox){ao.currentEditor={record:aq,ov:aq.get(M),name:M,editor:am};setTimeout(function(){am.bind(aj,M);am.render(aq);var aw=Ext.get([ao.id,M,aq.id].join(ah)),av=aw.getXY();am.move(-1000,av[1]);am.focus();am.el.on(W,ao.onEditorKeyDown,ao);ao.currentEditor.focusCheckBox=aw;aw.setStyle(H,"1px dotted blue")},10)}else{ao.fireEvent(t,ao,au+1,M,aq,ar)}break}}}}}ao.fireEvent(ad,ao,au,M)}}},positionEditor:function(){var C=this.currentEditor.editor,R=this.focusdiv,M=R.getXY();C.setHeight(R.getHeight()-2);C.setWidth(R.getWidth()-5<22?22:(R.getWidth()-5));C.move(M[0],M[1]);if(C.isExpanded&&C.isExpanded()){if(Ext.isIE){if(this.t){clearTimeout(this.t)}this.t=setTimeout(function(){C.syncPopup()},1)}else{C.syncPopup()}}},hideEditor:function(){if(this.currentEditor&&this.editing){var C=this.currentEditor.editor;if(C){if(!C.canHide||C.canHide()){C.el.un(W,this.onEditorKeyDown,this);C.un(E,this.onEditorSelect,this);Ext.fly(document.documentElement).un(h,this.onEditorBlur,this);Ext.fly(window).un(q,this.positionEditor,this);C.move(-10000,-10000);C.onBlur();C.isFireEvent=false;C.isHidden=true;this.editing=false}}}},selectRow:function(X,M){var U=this.dataset,C=U.getAt(X),R=(U.currentPage-1)*U.pagesize+X+1;this.selectedId=C.id;if(this.selectTr){this.selectTr.removeClass(g)}this.selectTr=Ext.get(this.id+ag+C.id);if(this.selectTr){this.selectTr.addClass(g)}this.selectRecord=C;if(M!==false&&R!=null){U.locate.defer(5,U,[R,false])}},drawFootBar:function(C){if(!this.fb){return}Ext.each([].concat((C)?C:this.columns),function(aj){var U=Ext.isString(aj)?this.findColByName(aj):aj;if(U&&U.footerrenderer){var X=$A.getRenderer(U.footerrenderer);if(X==null){alert(T+U.footerrenderer+k);return}var R=U.name,M=X.call(window,this.dataset.data,R);if(!Ext.isEmpty(M)){this.fb.child("td[dataindex="+R+"]").update(M)}}},this)},showColumn:function(M){var C=this.findColByName(M);if(C){if(C.hidden===true){delete C.hidden;this.wrap.select("td[dataindex="+M+"]").setStyle("display",j)}}},hideColumn:function(M){var C=this.findColByName(M);if(C){if(C.hidden!==true){this.wrap.select("td[dataindex="+M+"]").setStyle("display",N);C.hidden=true}}},findColByName:function(M){if(M){var U=this.columns;for(var R=0,C=U.length;R<C;R++){var X=U[R];if(X.name&&X.name.toLowerCase()===M.toLowerCase()){return X}}}return},parseCss:function(R){var X=j,C=j;if(Ext.isArray(R)){for(var M=0;M<R.length;M++){var U=this.parseCss(R[M]);X+=";"+U.style;C+=e+U.cls}}else{if(Ext.isString(R)){var aj=!!R.match(/^([^,:;]+:[^:;]+;)*[^,:;]+:[^:;]+;*$/);C=aj?j:R;X=aj?R:j}}return{style:X,cls:C}},renderText:function(C,M,X){var U=M.renderer;if(U){var R=$A.getRenderer(U);if(R==null){alert(T+U+k);return X}X=R.call(window,X,C,M.name);return X==null?j:X}return X==null?j:X},renderRow:function(C,X){var U=this.rowrenderer,M=null;if(U){var R=$A.getRenderer(U);if(R==null){alert(T+U+k);return M}M=R.call(window,C,X);return !M?j:M}return M},renderEditor:function(U,C,R,M){this.createCell(U.dom,R,C)},onClick:function(ak,an){var C=an.tagName.toLowerCase()==aa,al=C?Ext.fly(an):Ext.fly(an).parent(aa);if(al){var U=al.getAttributeNS(j,"atype"),am=al.getAttributeNS(j,l),R=this.dataset;if(U==ab){var aj=R.findById(am),ao=R.indexOf(aj),M=al.getAttributeNS(j,"dataindex");this.fireEvent(t,this,ao,M,aj);this.fireEvent(A,this,ao,aj)}else{if(U==p){var X=Ext.get(this.id+ai+am);if(X.hasClass(B)||X.hasClass(P)){return}if(this.isSelectAll&&!X.parent(D)){X.replaceClass(S,af)}else{if(this.isUnselectAll&&!X.parent(D)){X.replaceClass(af,S)}}X.hasClass(af)?R.unSelect(am):R.select(am)}else{if(U==w){var X=Ext.get(this.id+ai+am);if(X.hasClass(Y)||X.hasClass(a)){return}R.select(am)}}}}},onCellClick:function(R,U,M,C,X){this.showEditor(U,M,X)},onUpdate:function(R,aj,M,an){this.setSelectStatus(aj);var C=Ext.get([this.id,M,aj.id].join(ah));if(C){var al=this.findColByName(M);var ak=this.getEditor(al,aj);if(ak!=j&&($(ak) instanceof $A.CheckBox)){this.renderEditor(C,aj,al,ak)}else{var ao=this.renderText(aj,al,an);C.update(ao)}}var ap=this.columns;for(var X=0,U=ap.length;X<U;X++){var al=ap[X];if(al.name!=M){var am=Ext.get([this.id,al.name,aj.id].join(ah));if(am){if(al.editorfunction){var ak=this.getEditor(al,aj);this.renderEditor(am,aj,al,ak)}if(al.renderer){var ao=this.renderText(aj,al,aj.get(al.name));am.update(ao)}}}}this.drawFootBar(M)},onLoad:function(){var R=this.wrap,X=this.dataset.data;this.clearBody();var C=R.removeClass(O).child("div[atype=table.headcheck]");if(C&&this.selectable&&this.selectionmodel==I){this.setCheckBoxStatus(C,false)}var M=X.length;if(M==0){this.createEmptyRow()}else{for(var U=0;U<M;U++){this.createRow(X[U],U)}}this.drawFootBar();$A.Masker.unmask(R);this.fireEvent(G,this)},onValid:function(U,C,M,R){var aj=this.findColByName(M);if(aj){var X=Ext.get([this.id,M,C.id].join(ah));if(X){if(R==false){X.addClass(Z)}else{X.removeClass([J,Z])}}}},onAdd:function(R,C,M){this.removeEmptyRow();this.createRow(C,M,M!==this.dataset.data.length-1);this.selectRow(this.dataset.indexOf(C));this.setSelectStatus(C)},onRemove:function(R,C,M){var U=Ext.get(this.id+ag+C.id);if(U){U.remove()}this.selectTr=null;$A.Masker.unmask(this.wrap);this.drawFootBar()},clearBody:function(){while(this.tbody.dom.childNodes.length){this.tbody.dom.removeChild(this.tbody.dom.firstChild)}this.emptyRow=null},getDataIndex:function(R){for(var M=0,U=this.dataset.data,C=U.length;M<C;M++){if(U[M].id==R){return M}}return -1},onEditorBlur:function(M,C){if(this.currentEditor&&!this.currentEditor.editor.isEventFromComponent(C)){this.hideEditor.defer(Ext.isIE9?10:0,this)}},onMouseWheel:function(M){M.stopEvent();if(this.editing==true){return}var R=M.getWheelDelta(),C=this.dataset;if(R>0){C.pre()}else{if(R<0){C.next()}}},onIndexChange:function(R,M){var C=this.getDataIndex(M.id);if(C==-1){return}this.selectRow(C,false)},onFieldChange:function(U,C,X,M,R){if(M==r){var aj=Ext.get([this.id,X.name,C.id].join(ah));if(aj){aj[R==true?"addClass":"removeClass"](J)}}},onBeforeRemove:function(){$A.Masker.mask(this.wrap,_lang["grid.mask.remove"])},onBeforeLoad:function(){$A.Masker.mask(this.wrap,_lang["grid.mask.loading"])},onAfterSuccess:function(){$A.Masker.unmask(this.wrap)},onBeforSubmit:function(C){$A.Masker.mask(this.wrap,_lang["grid.mask.submit"])},onAjaxFailed:function(M,C){$A.Masker.unmask(this.wrap)}})})();