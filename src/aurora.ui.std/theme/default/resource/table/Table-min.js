(function(x){var T=document.documentElement,q=Ext.each,e=Ext.isEmpty,al=false,O=true,R=null,aq="_",at="__",ar="-",n=".",j=" ",p="",t="]",w="-c",h="-u",ah="td",Z="none",J="left",c="display",S="outline",ai="1px dotted blue",s="recordid",k="row-selected",D="required",X="item-notBlank",ag="item-invalid",am="table-row-alt",E="table-rowbox",Y=n+E,z="table.rowcheck",I="table.rowradio",F="table-ckb ",ad="table-select-all",V="multiple",u="checkedvalue",m="-readonly",N="item-ckb",d=N+"-self",y=n+d,H=N+h,W=N+w,ap=N+m+h,l=N+m+w,Q="item-radio-img",ak=Q+w,ac=Q+h,aa=Q+m+w,M=Q+m+h,g=y+j+n+W,a="table-cell",af=a+"-editor",f="cellcheck",an="rowcheck",i="click",P="cellclick",ao="render",v="rowclick",G="editorshow",K="nexteditorshow",r="keydown",o="select",b="mousedown",ab="resize",aj="未找到",L="方法!",ae="div[atype=table.headcheck]",B="td[dataindex=";x.Table=Ext.extend(x.Component,{initComponent:function(A){x.Table.superclass.initComponent.call(this,A);var U=this,C=U.wrap;U.cb=C.child(ae);U.tbody=C.child("tbody");U.fb=C.child("tfoot");U.initTemplate()},processListener:function(A){var C=this;x.Table.superclass.processListener.call(C,A);C.tbody[A](i,C.onClick,C);C.wrap[A]("focus",C.onFocus,C)[A]("blur",C.onBlur,C)[A](Ext.isOpera?"keypress":r,C.handleKeyUp,C)[A]("keyup",C.handleKeyUp,C);if(C.canwheel){C.tbody[A]("mousewheel",C.onMouseWheel,C)}if(C.cb){C.cb[A](i,C.onHeadClick,C)}C[A](P,C.onCellClick,C)},processDataSetLiestener:function(A){var C=this,U=C.dataset;if(U){U[A]("ajaxfailed",C.onAjaxFailed,C);U[A]("metachange",C.onLoad,C);U[A]("update",C.onUpdate,C);U[A]("reject",C.onUpdate,C);U[A]("add",C.onAdd,C);U[A]("submit",C.onBeforSubmit,C);U[A]("submitfailed",C.onAfterSuccess,C);U[A]("submitsuccess",C.onAfterSuccess,C);U[A]("query",C.onBeforeLoad,C);U[A]("load",C.onLoad,C);U[A]("loadfailed",C.onAjaxFailed,C);U[A]("valid",C.onValid,C);U[A]("beforeremove",C.onBeforeRemove,C);U[A]("remove",C.onRemove,C);U[A]("clear",C.onLoad,C);U[A]("refresh",C.onLoad,C);U[A]("fieldchange",C.onFieldChange,C);U[A]("indexchange",C.onIndexChange,C);U[A]("select",C.onSelect,C);U[A]("unselect",C.onUnSelect,C);U[A]("selectall",C.onSelectAll,C);U[A]("unselectall",C.onUnSelectAll,C)}},initEvents:function(){x.Table.superclass.initEvents.call(this);this.addEvents(ao,P,v,G,K)},bind:function(A){if(Ext.isString(A)){A=$(A);if(!A){return}}this.dataset=A;this.processDataSetLiestener("on");this.onLoad()},handleKeyUp:function(A){if(A.getKey()==9){this.showEditorByRecord()}},initTemplate:function(){this.cellTpl=new Ext.Template(['<div class="',a,' {cellcls}" id="',this.id,"_{name}_{",s,'}">{text}</div>']);this.cbTpl=new Ext.Template(['<center><div class="{cellcls}" id="',this.id,"_{name}_{",s,'}"></div></center>'])},createRow:function(U,ax,au){var aw=this,az=aw.tbody.dom.insertRow(ax),av=aw.parseCss(aw.renderRow(U,ax));az.id=aw.id+ar+U.id;az.style.cssText=av.style;az.className=(ax%2==1?am+j:p)+av.cls;q(aw.columns,function(aA){aw.createCell(az,aA,U)});if(au){var ay=aw.wrap.query("tbody tr");for(var C=ax+1,A=ay.length;C<A;C++){Ext.fly(ay[C]).toggleClass(am).select(Y).each(function(aA){aw.setSelectStatus(aw.dataset.findById(aA.getAttributeNS(p,s)))})}}},createEmptyRow:function(){var A=this;A.emptyRow=A.tbody.dom.insertRow(-1);q(A.columns,function(C){Ext.fly(A.emptyRow.insertCell(-1)).set({atype:a,dataindex:C.name}).setStyle({"text-align":C.align||J,display:C.hidden?Z:p}).update("&#160;")})},removeEmptyRow:function(){var A=this;if(A.emptyRow){A.tbody.dom.removeChild(A.emptyRow);A.emptyRow=R}},getCheckBoxStatus:function(A,au,U){var aw=this.dataset.getField(au),C=aw.getPropertity(u),av=A.data[au];return N+(U?m:p)+((av&&av==C)?w:h)},createCell:function(aA,A,av){var aw=this,ax=aw.getEditor(A,av),C=A.type,az=A.name,au,aC=p,U;if(aA.tagName.toLowerCase()=="tr"){U=aA.insertCell(-1)}else{U=Ext.fly(aA).parent(ah).dom}if(ax!=p){var ay=x.CmpManager.get(ax);if(ay&&(ay instanceof x.CheckBox)){C=f}else{aC=af}}else{if(az&&Ext.isDefined(av.getField(az).get(u))){C=f;au=O}}if(C==an||C=="rowradio"){au=aw.dataset.execSelectFunction(av)?p:m;Ext.fly(U).set({atype:C==an?z:I,recordid:av.id}).addClass(E);U.innerHTML=aw.cbTpl.applyTemplate({cellcls:C==an?F+N+au+h:"table-radio "+Q+au+h,name:az,recordid:av.id})}else{Ext.fly(U).set({atype:a,recordid:av.id,dataindex:az}).setStyle({"text-align":A.align||J,dLEFT:A.hidden?Z:p});if(C==f){U.innerHTML=aw.cbTpl.applyTemplate({cellcls:F+aw.getCheckBoxStatus(av,az,au),name:az,recordid:av.id})}else{var aB=av.getMeta().getField(az);if(aB&&e(av.data[az])&&av.isNew==O&&aB.get(D)==O){aC=aC+j+X}U.innerHTML=aw.cellTpl.applyTemplate({text:aw.renderText(av,A,av.data[az]),cellcls:aC,name:az,recordid:av.id})}}},onSelect:function(au,C,av){if(!C||av){return}var U=this,A=Ext.get(U.id+at+C.id);A.parent(Y).addClass(d);if(A){if(U.selectionmodel==V){U.setCheckBoxStatus(A,O)}else{U.setRadioStatus(A,O);au.locate((au.currentPage-1)*au.pagesize+au.indexOf(C)+1)}U.setSelectStatus(C)}},onUnSelect:function(au,C,av){if(!C||av){return}var U=this,A=Ext.get(U.id+at+C.id);A.parent(Y).addClass(d);if(A){if(U.selectionmodel==V){U.setCheckBoxStatus(A,al)}else{U.setRadioStatus(A,al)}U.setSelectStatus(C)}},onSelectAll:function(){var A=this;A.clearChecked();A.isSelectAll=O;A.isUnSelectAll=al;A.wrap.addClass(ad)},onUnSelectAll:function(){var A=this;A.clearChecked();A.isSelectAll=al;A.isUnSelectAll=O;A.wrap.removeClass(ad)},clearChecked:function(){var A=this.wrap;A.select(g).replaceClass(W,H);A.select(y).removeClass(d)},setRadioStatus:function(A,C){if(!C){A.removeClass(ak).addClass(ac)}else{A.addClass(ak).removeClass(ac)}},setCheckBoxStatus:function(A,C){if(!C){A.removeClass(W).addClass(H)}else{A.addClass(W).removeClass(H)}},setSelectDisable:function(U,C){var A=this.dataset.selected.indexOf(C)==-1;if(this.selectionmodel==V){U.removeClass([W,H]).addClass(A?ap:l)}else{U.removeClass([ak,ac,aa,M]).addClass(A?M:aa)}},setSelectEnable:function(U,C){var A=this.dataset.selected.indexOf(C)==-1;if(this.selectionmodel==V){U.removeClass([ap,l]).addClass(A?H:W)}else{U.removeClass([ac,ak,M,aa]).addClass(A?ac:ak)}},setSelectStatus:function(C){var U=this,au=U.dataset;if(au.selectfunction){var A=Ext.get(U.id+at+C.id);if(!au.execSelectFunction(C)){U.setSelectDisable(A,C)}else{U.setSelectEnable(A,C)}}},onHeadClick:function(au){var A=this.cb,U=this.dataset,C=A.hasClass(W);this.setCheckBoxStatus(A,!C);if(!C){U.selectAll()}else{U.unSelectAll()}},setEditor:function(C,U){var au=this,A=au.findColByName(C),av=Ext.get([au.id,C,au.selectedId].join(aq));A.editor=U;if(av){au.focusdiv=av;if(U==p){av.removeClass(af)}else{if(!$(U) instanceof x.CheckBox){av.addClass(af)}}}},getEditor:function(au,C){var U=au.editor||p;if(au.editorfunction){var A=window[au.editorfunction];if(A==R){alert(aj+au.editorfunction+L);return R}U=A.call(window,C,au.name)||p}return U},showEditor:function(az,A,ay){if(az==-1){return}var aw=this,U=aw.findColByName(A);if(!U){return}var C=aw.dataset,au=C.getAt(az);if(!au){return}if(au.id!=aw.selectedId){aw.selectRow(az)}var ax=aw.getEditor(U,au);aw.setEditor(A,ax);if(ax!=p){var av=$(ax);(function(){var aB=au.get(A),aD=Ext.get([aw.id,A,au.id].join(aq)),aC=aD.getXY(),aA;av.bind(C,A);av.render(au);if(Ext.isIE){av.processListener("un")}av.el.on(r,aw.onEditorKeyDown,aw);if(Ext.isIE){av.processListener("on")}Ext.fly(T).on(b,aw.onEditorBlur,aw);aA=aw.currentEditor={record:au,ov:aB,name:A,editor:av};aw.positionEditor();if(av instanceof x.CheckBox){if(ay){av.focus()}else{av.onClick()}}else{av.isEditor=O;av.isFireEvent=O;av.isHidden=al;av.focus();aw.editing=O;av.on(o,aw.onEditorSelect,aw);if(Ext.isFunction(ay)){ay(av)}aw.fireEvent(G,aw,av,az,A,au)}Ext.fly(window).on(ab,aw.positionEditor,aw)}).defer(10)}},showEditorByRecord:function(A){var C=this,U=C.dataset,au=A?U.indexOf(A):0;A=A||U.getAt(0);q(C.columns,function(av){if(av.hidden!=O&&C.getEditor(av,A)!=p){C.fireEvent(P,C,au,av.name,A,function(){});C.fireEvent(v,C,au,A);return al}})},onEditorSelect:function(){(function(){this.hideEditor()}).defer(1,this)},onEditorKeyDown:function(av,C){var U=this,au=av.keyCode;ced=U.currentEditor;if(au==27){if(ced){var A=ced.editor;if(A){A.clearInvalid();A.render(A.binder.ds.getCurrentRecord())}}U.hideEditor()}else{if(au==13){if(!(ced&&ced.editor&&ced.editor instanceof x.TextArea)){U.showEditorBy(39)}}else{if(au==9){av.stopEvent();U.showEditorBy(av.shiftKey?37:39)}else{if(av.ctrlKey&&(au==37||au==38||au==39||au==40)){U.showEditorBy(au);av.stopEvent()}}}}},findEditorBy:function(ax){var aA=this,C,az;if((C=aA.currentEditor)&&(az=C.editor)){var aD=aA.columns,aB=al,aw=aA.dataset,av=az.binder.name,A=az.record,aF=aw.data.indexOf(A),U=R,aC=al,ay=O,aE=al,au;if(aF!=-1){if(ax==37||ax==38){aD=[].concat(aD).reverse();ay=al}if(ax==38||ax==40){aE=O;au=aA.findColByName(av)}while(A){if(!aE){q(aD,function(aG){if(aB){if(aG.hidden!=O&&aA.getEditor(aG,A)!=p){U=aG.name;return al}}else{if(aG.name==av){aB=O}}})}if(U){return{row:aF,name:U,record:A}}A=aw.getAt(ay?++aF:--aF);if(ay&&!A&&!aC&&aA.autoappend!==al){aA.hideEditor();aw.create();A=aw.getAt(aF);aC=O}if(aE&&A&&aA.getEditor(au,A)!=p){U=av}}}}return R},showEditorBy:function(U){var au=this,aw=O,C=au.findEditorBy(U);if(C){au.hideEditor();var av=C.row,A=C.record;au.fireEvent(P,au,av,C.name,A,aw);au.fireEvent(v,au,av,A)}},positionEditor:function(){var C=this,A=C.currentEditor.editor,au=C.focusdiv,U=au.getXY();if(A instanceof x.CheckBox){A.move(U[0],U[1]-4)}else{A.setHeight(au.getHeight()-2);A.setWidth(au.getWidth()-5<22?22:(au.getWidth()-5));A.move(U[0],U[1])}if(A.isExpanded&&A.isExpanded()){if(Ext.isIE){if(C.t){clearTimeout(C.t)}C.t=(function(){A.syncPopup()}).defer(1)}else{A.syncPopup()}}},hideEditor:function(){var au=this,U=au.currentEditor;if(U){var C=U.editor;if(C){if(!C.canHide||C.canHide()){C.el.un(r,au.onEditorKeyDown,au);C.un(o,au.onEditorSelect,au);Ext.fly(T).un(b,au.onEditorBlur,au);Ext.fly(window).un(ab,au.positionEditor,au);C.move(-10000,-10000);var A=C.autocompleteview;if(A){A.hide()}C.blur();C.onBlur();C.isFireEvent=al;C.isHidden=O;au.editing=al;if(C.collapse){C.collapse()}}}}},selectRow:function(aw,C){var au=this,av=au.dataset,A=av.getAt(aw),U=(av.currentPage-1)*av.pagesize+aw+1;au.selectedId=A.id;if(au.selectTr){au.selectTr.removeClass(k)}au.selectTr=Ext.get(au.id+ar+A.id);if(au.selectTr){au.selectTr.addClass(k)}if(C!==al&&U!=R){av.locate.defer(5,av,[U,al])}},drawFootBar:function(C){var A=this;if(!A.fb){return}q([].concat((C)?C:A.columns),function(ax){var av=Ext.isString(ax)?A.findColByName(ax):ax;if(av&&av.footerrenderer){var aw=x.getRenderer(av.footerrenderer);if(aw==R){alert(aj+av.footerrenderer+L);return}var au=av.name,U=aw.call(window,A.dataset.data,au);if(!e(U)){A.fb.child(B+au+t).update(U)}}})},showColumn:function(C){var A=this.findColByName(C);if(A){if(A.hidden===O){delete A.hidden;this.wrap.select(B+C+t).setStyle(c,p)}}},hideColumn:function(C){var A=this.findColByName(C);if(A){if(A.hidden!==O){this.wrap.select(B+C+t).setStyle(c,Z);A.hidden=O}}},findColByName:function(A){var C;if(A){q(this.columns,function(U){if(U.name&&U.name.toLowerCase()===A.toLowerCase()){C=U;return al}})}return C},parseCss:function(U){var av=p,A=p;if(Ext.isArray(U)){for(var C=0;C<U.length;C++){var au=this.parseCss(U[C]);av+=";"+au.style;A+=j+au.cls}}else{if(Ext.isString(U)){var aw=!!U.match(/^([^,:;]+:[^:;]+;)*[^,:;]+:[^:;]+;*$/);A=aw?p:U;av=aw?U:p}}return{style:av,cls:A}},renderText:function(A,C,av){var au=C.renderer;if(au){var U=x.getRenderer(au);if(U==R){alert(aj+au+L);return av}av=U.call(window,av,A,C.name);return av==R?p:av}return av==R?p:av},renderRow:function(A,av){var au=this.rowrenderer,C=R;if(au){var U=x.getRenderer(au);if(U==R){alert(aj+au+L);return C}C=U.call(window,A,av);return !C?p:C}return C},renderEditor:function(au,A,U,C){this.createCell(au.dom,U,A)},onClick:function(ay,aB){var ax=this,A=(aB=Ext.fly(aB)).dom.tagName.toLowerCase()==ah,az=A?aB:aB.parent(ah);if(az){var au=az.getAttributeNS(p,"atype"),aA=az.getAttributeNS(p,s),U=ax.dataset;if(au==a){var aw=U.findById(aA),aC=U.indexOf(aw),C=az.getAttributeNS(p,"dataindex");ax.fireEvent(P,ax,aC,C,aw,!aB.hasClass("grid-ckb"));ax.fireEvent(v,ax,aC,aw)}else{if(au==z){var av=Ext.get(ax.id+at+aA);if(av.hasClass(ap)||av.hasClass(l)){return}if(ax.isSelectAll&&!av.parent(y)){av.replaceClass(H,W)}else{if(ax.isUnselectAll&&!av.parent(y)){av.replaceClass(W,H)}}av.hasClass(W)?U.unSelect(aA):U.select(aA)}else{if(au==I){var av=Ext.get(ax.id+at+aA);if(av.hasClass(M)||av.hasClass(aa)){return}U.select(aA)}}}}},onCellClick:function(U,au,C,A,av){this.showEditor(au,C,av)},onUpdate:function(aw,A,C,av){this.setSelectStatus(A);var au=this,ay=Ext.get([au.id,C,A.id].join(aq));if(ay){var ax=au.findColByName(C),U=au.getEditor(ax,A);if(U!=p&&($(U) instanceof x.CheckBox)){au.renderEditor(ay,A,ax,U)}else{ay.update(au.renderText(A,ax,av))}}q(au.columns,function(aA){if(aA.name!=C){var az=Ext.get([au.id,aA.name,A.id].join(aq));if(az){if(aA.editorfunction){au.renderEditor(az,A,aA,au.getEditor(aA,A))}if(aA.renderer){az.update(au.renderText(A,aA,A.get(aA.name)))}}}});au.drawFootBar(C)},onLoad:function(){var av=this,au=av.wrap,aw=av.dataset.data,A=au.removeClass(ad).child(ae);av.clearBody();if(A&&av.selectable&&av.selectionmodel==V){av.setCheckBoxStatus(A,al)}var C=aw.length;if(C==0){av.createEmptyRow()}else{for(var U=0;U<C;U++){av.createRow(aw[U],U)}}av.drawFootBar();x.Masker.unmask(au);av.fireEvent(ao,av)},onValid:function(au,A,C,U){var aw=this.findColByName(C);if(aw){var av=Ext.get([this.id,C,A.id].join(aq));if(av){if(U==al){av.addClass(ag)}else{av.removeClass([X,ag])}}}},onAdd:function(au,A,C){var U=this,au=U.dataset;U.removeEmptyRow();U.createRow(A,C,C!==au.data.length-1);U.selectRow(au.indexOf(A));U.setSelectStatus(A)},onRemove:function(au,A,C){var U=this,av=Ext.get(U.id+ar+A.id);if(av){av.remove()}U.selectTr=R;x.Masker.unmask(U.wrap);U.drawFootBar()},focus:function(){this.wrap.focus()},onFocus:function(){this.hasFocus=O},blur:function(){this.wrap.blur()},onBlur:function(){this.hasFocus=al},clearBody:function(){var A=this.tbody.dom;while(A.childNodes.length){A.removeChild(A.firstChild)}this.emptyRow=R},getDataIndex:function(U){for(var C=0,au=this.dataset.data,A=au.length;C<A;C++){if(au[C].id==U){return C}}return -1},onEditorBlur:function(au,C){var U=this,A=U.currentEditor;if(A&&!A.editor.isEventFromComponent(C)){U.hideEditor.defer(Ext.isIE9?10:0,U)}},onMouseWheel:function(C){C.stopEvent();if(this.editing==O){return}var U=C.getWheelDelta(),A=this.dataset;if(U>0){A.pre()}else{if(U<0){A.next()}}},onIndexChange:function(U,C){var A=this.getDataIndex(C.id);if(A==-1){return}this.selectRow(A,al)},onFieldChange:function(au,A,av,C,U){if(C==D){var aw=Ext.get([this.id,av.name,A.id].join(aq));if(aw){aw[U==O?"addClass":"removeClass"](X)}}},onBeforeRemove:function(){x.Masker.mask(this.wrap,_lang["grid.mask.remove"])},onBeforeLoad:function(){x.Masker.mask(this.wrap,_lang["grid.mask.loading"])},onAfterSuccess:function(){x.Masker.unmask(this.wrap)},onBeforSubmit:function(A){x.Masker.mask(this.wrap,_lang["grid.mask.submit"])},onAjaxFailed:function(C,A){x.Masker.unmask(this.wrap)},destroy:function(){x.Table.superclass.destroy.call(this);this.processDataSetLiestener("un")}})})($A);