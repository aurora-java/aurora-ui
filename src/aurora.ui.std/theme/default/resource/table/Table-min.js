(function(){var N=document.documentElement,aj="_",al="__",ak="-",l=".",i=" ",o="",r="]",u="-c",g="-u",ab="td",S="none",F="left",c="display",M="outline",ac="1px dotted blue",q="recordid",j="row-selected",y="required",Q="item-notBlank",aa="item-invalid",af="table-row-alt",z="table-rowbox",R=l+z,w="table.rowcheck",D="table.rowradio",A="table-ckb ",X="table-select-all",O="multiple",s="checkedvalue",m="-readonly",J="item-ckb",d=J+"-self",v=l+d,E=J+g,P=J+u,ai=J+m+g,k=J+m+u,L="item-radio-img",ae=L+u,W=L+g,T=L+m+u,I=L+m+g,f=v+i+l+P,a="table-cell",Z=a+"-editor",e="cellcheck",ag="rowcheck",h="click",K="cellclick",ah="render",t="rowclick",B="editorshow",G="nexteditorshow",p="keydown",n="select",b="mousedown",V="resize",ad="未找到",H="方法!",Y="div[atype=table.headcheck]",x="td[dataindex=";$A.Table=Ext.extend($A.Component,{initComponent:function(C){$A.Table.superclass.initComponent.call(this,C);var U=this.wrap;this.cb=U.child(Y);this.tbody=U.child("tbody");this.fb=U.child("tfoot");this.initTemplate()},processListener:function(C){$A.Table.superclass.processListener.call(this,C);this.tbody[C](h,this.onClick,this);if(this.canwheel){this.tbody[C]("mousewheel",this.onMouseWheel,this)}if(this.cb){this.cb[C](h,this.onHeadClick,this)}this[C](K,this.onCellClick,this)},processDataSetLiestener:function(C){var U=this.dataset;if(U){U[C]("ajaxfailed",this.onAjaxFailed,this);U[C]("metachange",this.onLoad,this);U[C]("update",this.onUpdate,this);U[C]("reject",this.onUpdate,this);U[C]("add",this.onAdd,this);U[C]("submit",this.onBeforSubmit,this);U[C]("submitfailed",this.onAfterSuccess,this);U[C]("submitsuccess",this.onAfterSuccess,this);U[C]("query",this.onBeforeLoad,this);U[C]("load",this.onLoad,this);U[C]("loadfailed",this.onAjaxFailed,this);U[C]("valid",this.onValid,this);U[C]("beforeremove",this.onBeforeRemove,this);U[C]("remove",this.onRemove,this);U[C]("clear",this.onLoad,this);U[C]("refresh",this.onLoad,this);U[C]("fieldchange",this.onFieldChange,this);U[C]("indexchange",this.onIndexChange,this);U[C]("select",this.onSelect,this);U[C]("unselect",this.onUnSelect,this);U[C]("selectall",this.onSelectAll,this);U[C]("unselectall",this.onUnSelectAll,this)}},initEvents:function(){$A.Table.superclass.initEvents.call(this);this.addEvents(ah,K,t,B,G)},bind:function(C){if(Ext.isString(C)){C=$(C);if(!C){return}}this.dataset=C;this.processDataSetLiestener("on");this.onLoad()},initTemplate:function(){this.cellTpl=new Ext.Template(['<div class="',a,' {cellcls}" id="',this.id,"_{name}_{",q,'}">{text}</div>']);this.cbTpl=new Ext.Template(['<center><div class="{cellcls}" id="',this.id,"_{name}_{",q,'}"></div></center>'])},createRow:function(am,an,aq){if(aq){var C=this.wrap.query("tbody tr");for(var ap=an,U=C.length;ap<U;ap++){Ext.fly(C[ap]).toggleClass(af).select(R).each(function(at){this.setSelectStatus(this.dataset.findById(at.getAttributeNS(o,q)))},this)}}var ar=this.tbody.dom.insertRow(an),ao=this.parseCss(this.renderRow(am,an));ar.id=this.id+ak+am.id;ar.style.cssText=ao.style;ar.className=(an%2==1?af+i:o)+ao.cls;Ext.each(this.columns,function(at){this.createCell(ar,at,am)},this)},createEmptyRow:function(){this.emptyRow=this.tbody.dom.insertRow(-1);Ext.each(this.columns,function(C){Ext.fly(this.emptyRow.insertCell(-1)).set({atype:a,dataindex:C.name}).setStyle({"text-align":C.align||F,display:C.hidden?S:o}).update("&#160;")},this)},removeEmptyRow:function(){if(this.emptyRow){this.tbody.dom.removeChild(this.emptyRow);this.emptyRow=null}},getCheckBoxStatus:function(C,an,am){var ap=this.dataset.getField(an),U=ap.getPropertity(s),ao=C.data[an];return J+(am?m:o)+((ao&&ao==U)?u:g)},createCell:function(at,C,ao){var ap=this.getEditor(C,ao),U=C.type,ar=C.name,an,av=o,am;if(at.tagName.toLowerCase()=="tr"){am=at.insertCell(-1)}else{am=Ext.fly(at).parent(ab).dom}if(ap!=o){var aq=$A.CmpManager.get(ap);if(aq&&(aq instanceof $A.CheckBox)){U=e}else{av=Z}}else{if(ar&&Ext.isDefined(ao.getField(ar).get(s))){U=e;an=true}}if(U==ag||U=="rowradio"){an=this.dataset.execSelectFunction(ao)?o:m;Ext.fly(am).set({atype:U==ag?w:D,recordid:ao.id}).addClass(z);am.innerHTML=this.cbTpl.applyTemplate({cellcls:U==ag?A+J+an+g:"table-radio "+L+an+g,name:ar,recordid:ao.id})}else{Ext.fly(am).set({atype:a,recordid:ao.id,dataindex:ar}).setStyle({"text-align":C.align||F,dLEFT:C.hidden?S:o});if(U==e){am.innerHTML=this.cbTpl.applyTemplate({cellcls:A+this.getCheckBoxStatus(ao,ar,an),name:ar,recordid:ao.id})}else{var au=ao.getMeta().getField(ar);if(au&&Ext.isEmpty(ao.data[ar])&&ao.isNew==true&&au.get(y)==true){av=av+i+Q}am.innerHTML=this.cellTpl.applyTemplate({text:this.renderText(ao,C,ao.data[ar]),cellcls:av,name:ar,recordid:ao.id})}}},onSelect:function(am,U,an){if(!U||an){return}var C=Ext.get(this.id+al+U.id);C.parent(R).addClass(d);if(C){if(this.selectionmodel==O){this.setCheckBoxStatus(C,true)}else{this.setRadioStatus(C,true);am.locate((am.currentPage-1)*am.pagesize+am.indexOf(U)+1)}this.setSelectStatus(U)}},onUnSelect:function(am,U,an){if(!U||an){return}var C=Ext.get(this.id+al+U.id);C.parent(R).addClass(d);if(C){if(this.selectionmodel==O){this.setCheckBoxStatus(C,false)}else{this.setRadioStatus(C,false)}this.setSelectStatus(U)}},onSelectAll:function(){this.clearChecked();this.isSelectAll=true;this.isUnSelectAll=false;this.wrap.addClass(X)},onUnSelectAll:function(){this.clearChecked();this.isSelectAll=false;this.isUnSelectAll=true;this.wrap.removeClass(X)},clearChecked:function(){var C=this.wrap;C.select(f).replaceClass(P,E);C.select(v).removeClass(d)},setRadioStatus:function(C,U){if(!U){C.removeClass(ae).addClass(W)}else{C.addClass(ae).removeClass(W)}},setCheckBoxStatus:function(C,U){if(!U){C.removeClass(P).addClass(E)}else{C.addClass(P).removeClass(E)}},setSelectDisable:function(am,U){var C=this.dataset.selected.indexOf(U)==-1;if(this.selectionmodel==O){am.removeClass([P,E]).addClass(C?ai:k)}else{am.removeClass([ae,W,T,I]).addClass(C?I:T)}},setSelectEnable:function(am,U){var C=this.dataset.selected.indexOf(U)==-1;if(this.selectionmodel==O){am.removeClass([ai,k]).addClass(C?E:P)}else{am.removeClass([W,ae,I,T]).addClass(C?W:ae)}},setSelectStatus:function(U){var am=this.dataset;if(am.selectfunction){var C=Ext.get(this.id+al+U.id);if(!am.execSelectFunction(U)){this.setSelectDisable(C,U)}else{this.setSelectEnable(C,U)}}},onHeadClick:function(an){var C=this.cb,am=this.dataset,U=C.hasClass(P);this.setCheckBoxStatus(C,!U);if(!U){am.selectAll()}else{am.unSelectAll()}},setEditor:function(U,am){var C=this.findColByName(U),an=Ext.get([this.id,U,this.selectedId].join(aj));C.editor=am;if(an){this.focusdiv=an;if(am==o){an.removeClass(Z)}else{if(!$(am) instanceof $A.CheckBox){an.addClass(Z)}}}},getEditor:function(an,U){var am=an.editor||o;if(an.editorfunction){var C=window[an.editorfunction];if(C==null){alert(ad+an.editorfunction+H);return null}am=C.call(window,U,an.name)||o}return am},showEditor:function(aq,an,ar){if(aq==-1){return}var am=this.findColByName(an);if(!am){return}var ap=this.dataset,C=ap.getAt(aq);if(!C){return}if(C.id!=this.selectedId){this.selectRow(aq)}var ao=this.getEditor(am,C);this.setEditor(an,ao);if(ao!=o){var U=$(ao);(function(){var au=C.get(an),aw=Ext.get([this.id,an,C.id].join(aj)),av=aw.getXY(),at;U.bind(ap,an);U.render(C);U.el.on(p,this.onEditorKeyDown,this);Ext.fly(N).on(b,this.onEditorBlur,this);at=this.currentEditor={record:C,ov:au,name:an,editor:U};if(U instanceof $A.CheckBox){U.move(-1000,av[1]+5);if(ar){U.focus()}else{U.onClick()}at.focusCheckBox=aw;aw.setStyle(M,ac)}else{this.positionEditor();U.isEditor=true;U.isFireEvent=true;U.isHidden=false;U.focus();this.editing=true;U.on(n,this.onEditorSelect,this);Ext.fly(window).on(V,this.positionEditor,this);if(ar){ar.call(window,U)}this.fireEvent(B,this,U,aq,an,C)}}).defer(10,this)}},onEditorSelect:function(){var C=this;setTimeout(function(){C.hideEditor()},1)},onEditorKeyDown:function(an,U){var am=an.keyCode;if(am==27){if(this.currentEditor){var C=this.currentEditor.editor;if(C){C.clearInvalid();C.render(C.binder.ds.getCurrentRecord())}}this.hideEditor()}else{if(am==13){if(!(this.currentEditor&&this.currentEditor.editor&&this.currentEditor.editor instanceof $A.TextArea)){this.showNextEditor()}}else{if(am==9){an.stopEvent();this.showNextEditor()}}}},showNextEditor:function(){this.hideEditor();var U=this.currentEditor;if(U){var ap=U.editor;if(ap){var au=function(ax){if(ax instanceof $A.Lov){ax.showLovWindow()}},ao=this.dataset,an=ap.binder.name,C=ap.record,aw=ao.data.indexOf(C),am=null;if(aw!=-1){var av=this.columns,ar=false,aq;Ext.each(av,function(ax,ay){if(ar){if(ax.hidden!=true){aq=this.getEditor(ax,C);if(aq!=o){am=ax.name;return false}}}else{if(ax.name==an){ar=true}}},this);if(am){this.fireEvent(K,this,aw,am,C,au)}else{var at=ao.getAt(aw+1);if(!at&&this.autoappend!==false){ao.create();at=ao.getAt(aw+1)}if(at){this.selectRow(aw+1);Ext.each(av,function(ax){if(this.getEditor(ax,at)!=o){this.fireEvent(K,this,aw+1,ax.name,at,au);return false}},this)}}}this.fireEvent(G,this,aw,am)}}},positionEditor:function(){var C=this.currentEditor.editor,am=this.focusdiv,U=am.getXY();C.setHeight(am.getHeight()-2);C.setWidth(am.getWidth()-5<22?22:(am.getWidth()-5));C.move(U[0],U[1]);if(C.isExpanded&&C.isExpanded()){if(Ext.isIE){if(this.t){clearTimeout(this.t)}this.t=setTimeout(function(){C.syncPopup()},1)}else{C.syncPopup()}}},hideEditor:function(){var U=this.currentEditor;if(U){var C=U.editor;if(C){if(!C.canHide||C.canHide()){var am=U.focusCheckBox;if(am){am.setStyle(M,S);U.focusCheckBox=null}C.el.un(p,this.onEditorKeyDown,this);C.un(n,this.onEditorSelect,this);Ext.fly(N).un(b,this.onEditorBlur,this);Ext.fly(window).un(V,this.positionEditor,this);C.move(-10000,-10000);C.onBlur();C.isFireEvent=false;C.isHidden=true;this.editing=false}}}},selectRow:function(ao,U){var an=this.dataset,C=an.getAt(ao),am=(an.currentPage-1)*an.pagesize+ao+1;this.selectedId=C.id;if(this.selectTr){this.selectTr.removeClass(j)}this.selectTr=Ext.get(this.id+ak+C.id);if(this.selectTr){this.selectTr.addClass(j)}this.selectRecord=C;if(U!==false&&am!=null){an.locate.defer(5,an,[am,false])}},drawFootBar:function(C){if(!this.fb){return}Ext.each([].concat((C)?C:this.columns),function(ap){var an=Ext.isString(ap)?this.findColByName(ap):ap;if(an&&an.footerrenderer){var ao=$A.getRenderer(an.footerrenderer);if(ao==null){alert(ad+an.footerrenderer+H);return}var am=an.name,U=ao.call(window,this.dataset.data,am);if(!Ext.isEmpty(U)){this.fb.child(x+am+r).update(U)}}},this)},showColumn:function(U){var C=this.findColByName(U);if(C){if(C.hidden===true){delete C.hidden;this.wrap.select(x+U+r).setStyle(c,o)}}},hideColumn:function(U){var C=this.findColByName(U);if(C){if(C.hidden!==true){this.wrap.select(x+U+r).setStyle(c,S);C.hidden=true}}},findColByName:function(U){if(U){var an=this.columns;for(var am=0,C=an.length;am<C;am++){var ao=an[am];if(ao.name&&ao.name.toLowerCase()===U.toLowerCase()){return ao}}}return},parseCss:function(am){var ao=o,C=o;if(Ext.isArray(am)){for(var U=0;U<am.length;U++){var an=this.parseCss(am[U]);ao+=";"+an.style;C+=i+an.cls}}else{if(Ext.isString(am)){var ap=!!am.match(/^([^,:;]+:[^:;]+;)*[^,:;]+:[^:;]+;*$/);C=ap?o:am;ao=ap?am:o}}return{style:ao,cls:C}},renderText:function(C,U,ao){var an=U.renderer;if(an){var am=$A.getRenderer(an);if(am==null){alert(ad+an+H);return ao}ao=am.call(window,ao,C,U.name);return ao==null?o:ao}return ao==null?o:ao},renderRow:function(C,ao){var an=this.rowrenderer,U=null;if(an){var am=$A.getRenderer(an);if(am==null){alert(ad+an+H);return U}U=am.call(window,C,ao);return !U?o:U}return U},renderEditor:function(an,C,am,U){this.createCell(an.dom,am,C)},onClick:function(aq,au){var C=au.tagName.toLowerCase()==ab,ar=C?Ext.fly(au):Ext.fly(au).parent(ab);if(ar){var an=ar.getAttributeNS(o,"atype"),at=ar.getAttributeNS(o,q),am=this.dataset;if(an==a){var ap=am.findById(at),av=am.indexOf(ap),U=ar.getAttributeNS(o,"dataindex");this.fireEvent(K,this,av,U,ap);this.fireEvent(t,this,av,ap)}else{if(an==w){var ao=Ext.get(this.id+al+at);if(ao.hasClass(ai)||ao.hasClass(k)){return}if(this.isSelectAll&&!ao.parent(v)){ao.replaceClass(E,P)}else{if(this.isUnselectAll&&!ao.parent(v)){ao.replaceClass(P,E)}}ao.hasClass(P)?am.unSelect(at):am.select(at)}else{if(an==D){var ao=Ext.get(this.id+al+at);if(ao.hasClass(I)||ao.hasClass(T)){return}am.select(at)}}}}},onCellClick:function(am,an,U,C,ao){this.showEditor(an,U,ao)},onUpdate:function(am,ap,U,au){this.setSelectStatus(ap);var C=Ext.get([this.id,U,ap.id].join(aj));if(C){var ar=this.findColByName(U);var aq=this.getEditor(ar,ap);if(aq!=o&&($(aq) instanceof $A.CheckBox)){this.renderEditor(C,ap,ar,aq)}else{var av=this.renderText(ap,ar,au);C.update(av)}}var aw=this.columns;for(var ao=0,an=aw.length;ao<an;ao++){var ar=aw[ao];if(ar.name!=U){var at=Ext.get([this.id,ar.name,ap.id].join(aj));if(at){if(ar.editorfunction){var aq=this.getEditor(ar,ap);this.renderEditor(at,ap,ar,aq)}if(ar.renderer){var av=this.renderText(ap,ar,ap.get(ar.name));at.update(av)}}}}this.drawFootBar(U)},onLoad:function(){var am=this.wrap,ao=this.dataset.data;this.clearBody();var C=am.removeClass(X).child(Y);if(C&&this.selectable&&this.selectionmodel==O){this.setCheckBoxStatus(C,false)}var U=ao.length;if(U==0){this.createEmptyRow()}else{for(var an=0;an<U;an++){this.createRow(ao[an],an)}}this.drawFootBar();$A.Masker.unmask(am);this.fireEvent(ah,this)},onValid:function(an,C,U,am){var ap=this.findColByName(U);if(ap){var ao=Ext.get([this.id,U,C.id].join(aj));if(ao){if(am==false){ao.addClass(aa)}else{ao.removeClass([Q,aa])}}}},onAdd:function(am,C,U){this.removeEmptyRow();this.createRow(C,U,U!==this.dataset.data.length-1);this.selectRow(this.dataset.indexOf(C));this.setSelectStatus(C)},onRemove:function(am,C,U){var an=Ext.get(this.id+ak+C.id);if(an){an.remove()}this.selectTr=null;$A.Masker.unmask(this.wrap);this.drawFootBar()},clearBody:function(){while(this.tbody.dom.childNodes.length){this.tbody.dom.removeChild(this.tbody.dom.firstChild)}this.emptyRow=null},getDataIndex:function(am){for(var U=0,an=this.dataset.data,C=an.length;U<C;U++){if(an[U].id==am){return U}}return -1},onEditorBlur:function(U,C){if(this.currentEditor&&!this.currentEditor.editor.isEventFromComponent(C)){this.hideEditor.defer(Ext.isIE9?10:0,this)}},onMouseWheel:function(U){U.stopEvent();if(this.editing==true){return}var am=U.getWheelDelta(),C=this.dataset;if(am>0){C.pre()}else{if(am<0){C.next()}}},onIndexChange:function(am,U){var C=this.getDataIndex(U.id);if(C==-1){return}this.selectRow(C,false)},onFieldChange:function(an,C,ao,U,am){if(U==y){var ap=Ext.get([this.id,ao.name,C.id].join(aj));if(ap){ap[am==true?"addClass":"removeClass"](Q)}}},onBeforeRemove:function(){$A.Masker.mask(this.wrap,_lang["grid.mask.remove"])},onBeforeLoad:function(){$A.Masker.mask(this.wrap,_lang["grid.mask.loading"])},onAfterSuccess:function(){$A.Masker.unmask(this.wrap)},onBeforSubmit:function(C){$A.Masker.mask(this.wrap,_lang["grid.mask.submit"])},onAjaxFailed:function(U,C){$A.Masker.unmask(this.wrap)}})})();