$A=Aurora={version:"1.0",revision:"$Rev$"};$A.fireWindowResize=function(){if($A.winWidth!=$A.getViewportWidth()||$A.winHeight!=$A.getViewportHeight()){$A.winHeight=$A.getViewportHeight();$A.winWidth=$A.getViewportWidth();$A.Cover.resizeCover()}};if(Ext.isIE6){Ext.EventManager.on(window,"resize",$A.fireWindowResize,this)}$A.cache={};$A.cmps={};$A.onReady=Ext.onReady;$A.get=Ext.get;$A.focusWindow;$A.focusTab;$A.defaultDateFormat="isoDate";$A.defaultDateTimeFormat="yyyy-mm-dd HH:MM:ss";$A.center=function(b){var e;if(typeof(b)=="string"){var c=$A.CmpManager.get(b);if(c){if(c.wrap){e=c.wrap}}else{e=Ext.get(b)}}else{e=Ext.get(b)}var d=$A.getViewportWidth();var g=$A.getViewportHeight();var a=Math.max(0,(d-e.getWidth())/2);var f=Math.max(0,(g-e.getHeight())/2);e.setStyle("position","absolute");e.moveTo(a,f)};$A.setTheme=function(a){if(a){var b=new Date();b.setTime(b.getTime()+24*3600*1000);document.cookie="app_theme="+escape(a)+";expires="+b.toGMTString();window.location.reload()}};$A.CmpManager=function(){return{put:function(b,a){if(!this.cache){this.cache={}}if(this.cache[b]!=null){alert("错误: ID为' "+b+" '的组件已经存在!");return}if($A.focusWindow){$A.focusWindow.cmps[b]=a}if($A.focusTab){$A.focusTab.cmps[b]=a}this.cache[b]=a;a.on("mouseover",$A.CmpManager.onCmpOver,$A.CmpManager);a.on("mouseout",$A.CmpManager.onCmpOut,$A.CmpManager)},onCmpOver:function(i,g){if($A.validInfoType!="tip"){return}if(($A.Grid&&i instanceof $A.Grid)||($A.Table&&i instanceof $A.Table)){var c=i.dataset;if(!c||c.isValid==true||!g.target){return}var h=Ext.fly(g.target).findParent("td");if(h){var d=Ext.fly(h).getAttributeNS("","atype");if(d=="grid-cell"||d=="table-cell"){var l=Ext.fly(h).getAttributeNS("","recordid");var f=c.findById(l);if(f){var a=Ext.fly(h).getAttributeNS("","dataindex");var b=f.valid[a];if(Ext.isEmpty(b)){return}$A.ToolTip.show(h,b)}}}}else{if(i.binder){var c=i.binder.ds;if(!c||c.isValid==true){return}var f=i.record;if(!f){return}var b=f.valid[i.binder.name];if(Ext.isEmpty(b)){return}$A.ToolTip.show(i.id,b)}}},onCmpOut:function(a,b){if($A.validInfoType!="tip"){return}$A.ToolTip.hide()},getAll:function(){return this.cache},remove:function(b){var a=this.cache[b];a.un("mouseover",$A.CmpManager.onCmpOver,$A.CmpManager);a.un("mouseout",$A.CmpManager.onCmpOut,$A.CmpManager);delete this.cache[b]},get:function(a){if(!this.cache){return null}return this.cache[a]}}}();Ext.Ajax.on("requestexception",function(f,c,e){if($A.slideBarEnable){$A.SideBar.enable=$A.slideBarEnable}$A.manager.fireEvent("ajaxerror",$A.manager,c.status,c);if($A.logWindow){var a=$("HTTPWATCH_DATASET").getCurrentRecord();var d=$A._startTime;var b=new Date();a.set("spend",b-d);a.set("status",c.status);a.set("result",c.statusText);a.set("response",c.statusText)}switch(c.status){case 404:$A.showErrorMessage(c.status+_lang["ajax.error"],_lang["ajax.error.404"]+'"'+c.statusText+'"',null,400,150);break;case 500:$A.showErrorMessage(c.status+_lang["ajax.error"],c.responseText,null,500,300);break;default:$A.showErrorMessage(_lang["ajax.error"],c.statusText);break}},this);$=$A.getCmp=function(b){var a=$A.CmpManager.get(b);if(a==null){alert("未找到组件:"+b)}return a};$A.setCookie=function(a,b){document.cookie=a+"="+escape(b)};$A.getCookie=function(b){var a=document.cookie.match(new RegExp("(^| )"+b+"=([^;]*)(;|$)"));if(a!=null){return unescape(a[2])}return null};$A.getViewportHeight=function(){if(Ext.isIE){return Ext.isStrict?document.documentElement.clientHeight:document.body.clientHeight}else{return self.innerHeight}};$A.getViewportWidth=function(){if(Ext.isIE){return Ext.isStrict?document.documentElement.clientWidth:document.body.clientWidth}else{return self.innerWidth}};$A.post=function(e,d){var c=Ext.getBody().createChild({style:"display:none",tag:"form",method:"post",action:e});for(var b in d){var a=d[b];if(a){if(a instanceof Date){a=a.format("isoDate")}c.createChild({tag:"input",type:"hidden",name:b,value:a})}}c.dom.submit()};$A.request=function(d){var c=d.url,i=d.para,f=d.success,g=d.error,h=d.scope,b=d.failure;var a=Ext.apply({},d.opts);$A.manager.fireEvent("ajaxstart",c,i);if($A.logWindow){$A._startTime=new Date();$("HTTPWATCH_DATASET").create({url:c,request:Ext.util.JSON.encode({parameter:i})})}var e=Ext.apply({parameter:i},d.ext);Ext.Ajax.request({url:c,method:"POST",params:{_request_data:Ext.util.JSON.encode(e)},opts:a,success:function(n,p){if($A.logWindow){var o=$A._startTime;var m=new Date();var l=$("HTTPWATCH_DATASET").getCurrentRecord();l.set("spend",m-o);l.set("result",n.statusText);l.set("status",n.status);l.set("response",n.responseText)}$A.manager.fireEvent("ajaxcomplete",c,i,n);if(n){var r=null;try{r=Ext.decode(n.responseText)}catch(t){$A.showErrorMessage(_lang["ajax.error"],_lang["ajax.error.format"]);return}if(r&&!r.success){$A.manager.fireEvent("ajaxfailed",$A.manager,c,i,r);if(r.error){var o=r.error.stackTrace;o=(o)?o.replaceAll("\r\n","</br>"):"";if(r.error.message){var s=(o=="")?150:250;$A.showErrorMessage(_lang["ajax.error"],r.error.message+"</br>"+o,null,400,s)}else{$A.showErrorMessage(_lang["ajax.error"],o,null,400,250)}if(g){g.call(h,r,p)}}}else{$A.manager.fireEvent("ajaxsuccess",$A.manager,c,i,r);if(f){f.call(h,r,p)}}}},failure:function(l,m){if(b){b.call(h,l,m)}},scope:h})};Aurora.dateFormat=function(){var a={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};var b=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,c=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,g=/[^-+\dA-Z]/g,d=function(i,h){i=String(i);h=h||2;while(i.length<h){i="0"+i}return i},f=function(h,i){return !!String(a[h]||h||a["default"]).match(i)},e=function(o,n,m){for(var p=0,h=n.match(b),l=o.match(/\d+/g),r;p<h.length;p++){if(l.length==h.length){r=l[p]}else{r=parseInt(o.slice(index=n.search(h[p]),index+h[p].length))}switch(h[p]){case"mm":case"m":r=r-1;break}m(h[p],r)}};return{pad:d,parseDate:function(n,C,x){if(typeof n!="string"||n==""){return null}C=String(a[C]||C||a["default"]);if(C.slice(0,4)=="UTC:"){C=C.slice(4);x=true}var i=new Date(1970,1,2,0,0,0),A=x?"setUTC":"set",t=i[A+"Date"],l=i[A+"Month"],r=i[A+"FullYear"],w=i[A+"Year"],z=i[A+"Hours"],p=i[A+"Minutes"],B=i[A+"Seconds"],u=i[A+"Milliseconds"],h={d:t,dd:t,m:l,mm:l,yy:w,yyyy:r,h:z,hh:z,H:z,HH:z,M:p,MM:p,s:B,ss:B,l:u,L:u};try{e(n,C,function(m,s){h[m].call(i,s)})}catch(o){throw new SyntaxError("invalid date")}if(isNaN(i)){throw new SyntaxError("invalid date")}return i},format:function(n,C,x){if(arguments.length==1&&(typeof n=="string"||n instanceof String)&&!/\d/.test(n)){C=n;n=undefined}n=n?new Date(n):new Date();if(isNaN(n)){throw new SyntaxError("invalid date")}C=String(a[C]||C||a["default"]);if(C.slice(0,4)=="UTC:"){C=C.slice(4);x=true}var A=x?"getUTC":"get",t=n[A+"Date"](),h=n[A+"Day"](),p=n[A+"Month"](),w=n[A+"FullYear"](),z=n[A+"Hours"](),r=n[A+"Minutes"](),B=n[A+"Seconds"](),u=n[A+"Milliseconds"](),i=x?0:n.getTimezoneOffset(),l={d:t,dd:d(t),m:p+1,mm:d(p+1),yy:String(w).slice(2),yyyy:w,h:z%12||12,hh:d(z%12||12),H:z,HH:d(z),M:r,MM:d(r),s:B,ss:d(B),l:d(u,3),L:d(u>99?Math.round(u/10):u),t:z<12?"a":"p",tt:z<12?"am":"pm",T:z<12?"A":"P",TT:z<12?"AM":"PM",Z:x?"UTC":(String(n).match(c)||[""]).pop().replace(g,""),o:(i>0?"-":"+")+d(Math.floor(Math.abs(i)/60)*100+Math.abs(i)%60,4),S:["th","st","nd","rd"][t%10>3?0:(t%100-t%10!=10)*t%10]};return C.replace(b,function(m){return m in l?l[m]:m.slice(1,m.length-1)})},isDateTime:function(h){return f(h,/([HhMs])\1?/)}}}();Ext.applyIf(String.prototype,{trim:function(){return this.replace(/(^\s*)|(\s*$)/g,"")}});Ext.applyIf(Date.prototype,{format:function(a,b){return Aurora.dateFormat.format(this,a,b)}});Ext.applyIf(Array.prototype,{add:function(a){if(this.indexOf(a)==-1){this[this.length]=a}}});Ext.applyIf(String.prototype,{replaceAll:function(b,a){return this.replace(new RegExp(b,"gm"),a)}});Ext.applyIf(String.prototype,{parseDate:function(a,b){return Aurora.dateFormat.parseDate(this.toString(),a,b)}});$A.TextMetrics=function(){var a;return{measure:function(b,c,d){if(!a){a=$A.TextMetrics.Instance(b,d)}a.bind(b);a.setFixedWidth(d||"auto");return a.getSize(c)}}}();$A.TextMetrics.Instance=function(b,e){var c='<div style="left:-1000px;top:-1000px;position:absolute;visibility:hidden"></div>';var d=Ext.get(Ext.DomHelper.append(Ext.get(b),c));if(e){d.setWidth(e)}var a={getSize:function(g){d.update(g);var f=new Object();f.width=d.getWidth();f.height=d.getHeight();d.update("");return f},bind:function(l){var g=new Array("font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing");var f=g.length,m={};for(var h=0;h<f;h++){m[g[h]]=Ext.fly(l).getStyle(g[h])}d.setStyle(m)},setFixedWidth:function(f){d.setWidth(f)}};a.bind(b);return a};$A.ToolTip=function(){q={init:function(){var a=this;Ext.onReady(function(){var b=Ext.DomHelper.insertFirst(Ext.getBody(),{tag:"div",cls:"tip-wrap",children:[{tag:"div",cls:"tip-body"}]});var c=Ext.DomHelper.insertFirst(Ext.getBody(),{tag:"div",cls:"item-shadow"});a.tip=Ext.get(b);a.shadow=Ext.get(c);a.body=a.tip.first("div.tip-body")})},show:function(a,d){if(this.tip==null){this.init()}this.tip.show();this.shadow.show();this.body.update(d);var c;if(typeof(a)=="string"){if(this.sid==a){return}this.sid=a;var b=$A.CmpManager.get(a);if(b){if(b.wrap){c=b.wrap}}}else{c=Ext.get(a)}this.shadow.setWidth(this.tip.getWidth());this.shadow.setHeight(this.tip.getHeight());this.correctPosition(c)},correctPosition:function(c){var b=$A.getViewportWidth();var a=c.getX()+c.getWidth()+5;var d=c.getX()+c.getWidth()+7;if(a+this.tip.getWidth()>b){a=c.getX()-this.tip.getWidth()-5;d=c.getX()-this.tip.getWidth()-3}this.tip.setX(a);this.tip.setY(c.getY());this.shadow.setX(d);this.shadow.setY(this.tip.getY()+2)},hide:function(){this.sid=null;if(this.tip!=null){this.tip.hide()}if(this.shadow!=null){this.shadow.hide()}}};return q}();$A.SideBar=function(){var a={enable:true,bar:null,show:function(d){if(!this.enable){return}var b=this;if(parent.showSideBar){parent.showSideBar(d)}else{this.hide();var c='<div class="item-slideBar">'+d+"</div>";this.bar=Ext.get(Ext.DomHelper.insertFirst(Ext.getBody(),c));this.bar.setStyle("z-index",999999);this.bar.animate({height:{to:50,from:0}},0.35,function(){setTimeout(function(){b.hide()},2000)},"easeOut","run")}},hide:function(){if(parent.hideSideBar){parent.hideSideBar()}else{if(this.bar){Ext.fly(this.bar).remove();this.bar=null}}}};return a}();$A.Status=function(){var a={bar:null,enable:true,show:function(c){if(!this.enable){return}this.hide();if(parent.showStatus){parent.showStatus(c)}else{var b='<div class="item-statusBar" unselectable="on">'+c+"</div>";this.bar=Ext.get(Ext.DomHelper.insertFirst(Ext.getBody(),b));this.bar.setStyle("z-index",999998)}},hide:function(){if(parent.hideStatus){parent.hideStatus()}else{if(this.bar){Ext.fly(this.bar).remove();this.bar=null}}}};return a}();$A.Cover=function(){var a={bodyOverflow:null,sw:null,sh:null,container:{},cover:function(d){var b=Ext.isStrict?document.documentElement.scrollWidth:document.body.scrollWidth;var c=Ext.isStrict?document.documentElement.scrollHeight:document.body.scrollHeight;var e=Math.max(b,$A.getViewportWidth());var h=Math.max(c,$A.getViewportHeight());var g='<DIV class="aurora-cover"'+(Ext.isIE6?' style="position:absolute;width:'+(e-1)+"px;height:"+(h-1)+"px;":"")+'" unselectable="on"></DIV>';var f=Ext.get(Ext.DomHelper.insertFirst(Ext.getBody(),g));f.setStyle("z-index",Ext.fly(d).getStyle("z-index")-1);$A.Cover.container[d.id]=f},uncover:function(b){var d=$A.Cover.container[b.id];if(d){Ext.fly(d).remove();$A.Cover.container[b.id]=null;delete $A.Cover.container[b.id]}var c=true;for(key in $A.Cover.container){if($A.Cover.container[key]){c=false;break}}},resizeCover:function(){for(key in $A.Cover.container){var b=$A.Cover.container[key];Ext.fly(b).setStyle("display","none")}setTimeout(function(){var c=Ext.isStrict?document.documentElement.scrollWidth:document.body.scrollWidth;var d=Ext.isStrict?document.documentElement.scrollHeight:document.body.scrollHeight;var e=Math.max(c,$A.getViewportWidth())-1;var g=Math.max(d,$A.getViewportHeight())-1;for(key in $A.Cover.container){var f=$A.Cover.container[key];Ext.fly(f).setWidth(e);Ext.fly(f).setHeight(g);Ext.fly(f).setStyle("display","")}},1)}};return a}();$A.Masker=function(){var a={container:{},mask:function(e,f){if($A.Masker.container[e.id]){return}f=f||_lang["mask.loading"];var e=Ext.get(e);var i=e.getWidth();var g=e.getHeight();var b='<div class="aurora-mask"  style="left:-1000px;top:-1000px;width:'+i+"px;height:"+g+'px;position: absolute;"><div unselectable="on"></div><span style="top:'+(g/2-11)+'px">'+f+"</span></div>";var d=Ext.get(Ext.DomHelper.append(e.parent(),b));var m=e.getStyle("z-index")=="auto"?0:e.getStyle("z-index");d.setStyle("z-index",m+1);d.setXY(e.getXY());var c=d.child("span");var l=$A.TextMetrics.measure(c,f);c.setLeft((i-l.width-45)/2);$A.Masker.container[e.id]=d},unmask:function(b){var c=$A.Masker.container[b.id];if(c){Ext.fly(c).remove();$A.Masker.container[b.id]=null;delete $A.Masker.container[b.id]}}};return a}();Ext.util.JSON.encodeDate=function(c){var b=function(d){return d<10?"0"+d:d};var a='"'+c.getFullYear()+"-"+b(c.getMonth()+1)+"-"+b(c.getDate());if(c.xtype=="timestamp"){a=a+" "+b(c.getHours())+":"+b(c.getMinutes())+":"+b(c.getSeconds())}a+='"';return a};Ext.Element.prototype.update=function(html,loadScripts,callback){if(typeof html=="undefined"){html=""}if(loadScripts!==true){this.dom.innerHTML=html;if(typeof callback=="function"){callback()}return this}var id=Ext.id();var dom=this.dom;html+='<span id="'+id+'"></span>';Ext.lib.Event.onAvailable(id,function(){var links=[];var scripts=[];var hd=document.getElementsByTagName("head")[0];for(var i=0;i<hd.childNodes.length;i++){var he=hd.childNodes[i];if(he.tagName=="LINK"){links.push(he.href)}else{if(he.tagName=="SCRIPT"){scripts.push(he.src)}}}var jsre=/(?:<script([^>]*)?>)((\n|\r|.)*?)(?:<\/script>)/ig;var jsSrcRe=/\ssrc=([\'\"])(.*?)\1/i;var cssre=/(?:<link([^>]*)?>)((\n|\r|.)*?)/ig;var cssHreRe=/\shref=([\'\"])(.*?)\1/i;var cssm;while(cssm=cssre.exec(html)){var attrs=cssm[1];var srcMatch=attrs?attrs.match(cssHreRe):false;if(srcMatch&&srcMatch[2]){var included=false;for(var i=0;i<links.length;i++){var link=links[i];if(link.indexOf(srcMatch[2])!=-1){included=true;break}}if(!included){var s=document.createElement("link");s.type="text/css";s.rel="stylesheet";s.href=srcMatch[2];hd.appendChild(s)}}}var match;var jslink=[];var jsscript=[];while(match=jsre.exec(html)){var attrs=match[1];var srcMatch=attrs?attrs.match(jsSrcRe):false;if(srcMatch&&srcMatch[2]){var included=false;for(var i=0;i<scripts.length;i++){var script=scripts[i];if(script.indexOf(srcMatch[2])!=-1){included=true;break}}if(!included){jslink[jslink.length]={src:srcMatch[2],type:"text/javascript"}}}else{if(match[2]&&match[2].length>0){jsscript[jsscript.length]=match[2]}}}var loaded=0;var onReadOnLoad=function(){var isready=Ext.isIE?(!this.readyState||this.readyState=="loaded"||this.readyState=="complete"):true;if(isready){loaded++;if(loaded==jslink.length){for(j=0,k=jsscript.length;j<k;j++){var jst=jsscript[j];if(window.execScript){window.execScript(jst)}else{window.eval(jst)}}if(typeof callback=="function"){callback()}}else{var js=jslink[loaded];var s=document.createElement("script");s.src=js.src;s.type=js.type;s[Ext.isIE?"onreadystatechange":"onload"]=onReadOnLoad;hd.appendChild(s)}}};if(jslink.length>0){var js=jslink[0];var s=document.createElement("script");s.src=js.src;s.type=js.type;s[Ext.isIE?"onreadystatechange":"onload"]=onReadOnLoad;hd.appendChild(s)}if(jslink.length==0){for(j=0,k=jsscript.length;j<k;j++){var jst=jsscript[j];if(window.execScript){window.execScript(jst)}else{window.eval(jst)}}if(typeof callback=="function"){callback()}}var el=document.getElementById(id);if(el){Ext.removeNode(el)}Ext.fly(dom).setStyle("display","block")});Ext.fly(dom).setStyle("display","none");dom.innerHTML=html.replace(/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/ig,"").replace(/(?:<link.*?>)((\n|\r|.)*?)/ig,"");return this};Ext.EventObjectImpl.prototype.isSpecialKey=function(){var a=this.keyCode;return(this.type=="keypress"&&this.ctrlKey)||a==8||a==46||a==9||a==13||a==40||a==27||a==44||(a==16)||(a==17)||(a>=18&&a<=20)||(a>=33&&a<=35)||(a>=36&&a<=39)};Ext.removeNode=Ext.isIE&&!Ext.isIE8?function(){var a;return function(b){if(b&&b.tagName!="BODY"){(Ext.enableNestedListenerRemoval)?Ext.EventManager.purgeElement(b,true):Ext.EventManager.removeAll(b);a=a||document.createElement('<div id="_removenode" style="position:absolute;display:none;left:-1000px;top:-1000px">');if(!a.parentNode){document.appendChild(a)}a.appendChild(b);a.innerHTML="";delete Ext.elCache[b.id]}}}():function(a){if(a&&a.parentNode&&a.tagName!="BODY"){(Ext.enableNestedListenerRemoval)?Ext.EventManager.purgeElement(a,true):Ext.EventManager.removeAll(a);a.parentNode.removeChild(a);delete Ext.elCache[a.id]}};$A.parseDate=function(b){if(typeof b=="string"){var a=b.match(/^ *(\d{4})-(\d{1,2})-(\d{1,2}) *$/);if(a&&a.length>3){return new Date(parseInt(a[1]),parseInt(a[2],10)-1,parseInt(a[3],10))}a=b.match(/^ *(\d{4})-(\d{1,2})-(\d{1,2}) +(\d{1,2}):(\d{1,2}):(\d{1,2}) *$/);if(a&&a.length>6){return new Date(parseInt(a[1]),parseInt(a[2],10)-1,parseInt(a[3],10),parseInt(a[4],10),parseInt(a[5],10),parseInt(a[6],10))}}return null};$A.getRenderer=function(b){if(!b){return null}var a;if(b.indexOf("Aurora.")!=-1){a=$A[b.substr(7,b.length)]}else{a=window[b]}return a};$A.formatDate=function(a){if(!a){return""}if(a.format){return a.format($A.defaultDateFormat)}return a};$A.formatDateTime=function(a){if(!a){return""}if(a.format){return a.format($A.defaultDateTimeFormat)}return a};$A.formatNumber=function(d,f){if(d!==0&&(!d||isNaN(d))){return""}if(f||f===0){d=Number(d).toFixed(f)}var e=String(d).split(".");var a=(e.length==2)?"."+e[1]:"";var c=e[0];var b=/(\d+)(\d{3})/;while(b.test(c)){c=c.replace(b,"$1,$2")}v=c+a;return v};$A.removeNumberFormat=function(a){a=String(a||"");while(a.indexOf(",")!=-1){a=a.replace(",","")}return isNaN(a)?parseFloat(a):a};$A.EventManager=Ext.extend(Ext.util.Observable,{constructor:function(){$A.EventManager.superclass.constructor.call(this);this.initEvents()},initEvents:function(){this.addEvents("ajaxerror","ajaxsuccess","ajaxfailed","ajaxstart","ajaxcomplete","valid","timeout")}});$A.manager=new $A.EventManager();$A.manager.on("ajaxstart",function(){$A.Status.show(_lang["eventmanager.start"])});$A.manager.on("timeout",function(){$A.Status.hide()});$A.manager.on("ajaxerror",function(){$A.Status.hide()});$A.manager.on("ajaxcomplete",function(){$A.Status.hide()});$A.manager.on("ajaxsuccess",function(){$A.SideBar.show(_lang["eventmanager.success"])});$A.regEvent=function(b,a){$A.manager.on(b,a)};$A.validInfoType="area";$A.validInfoTypeObj="";$A.setValidInfoType=function(a,b){$A.validInfoType=a;$A.validInfoTypeObj=b};$A.invalidRecords={};$A.addInValidReocrd=function(f,a){var b=$A.invalidRecords[f];if(!b){$A.invalidRecords[f]=b=[]}var c=false;for(var d=0;d<b.length;d++){var e=b[d];if(e.id==a.id){c=true;break}}if(!c){b.add(a)}};$A.removeInvalidReocrd=function(e,a){var b=$A.invalidRecords[e];if(!b){return}for(var c=0;c<b.length;c++){var d=b[c];if(d.id==a.id){b.remove(d);break}}};$A.getInvalidRecords=function(a){var c=[];for(var d in $A.invalidRecords){var e=$A.CmpManager.get(d);if(e.pageid==a){var b=$A.invalidRecords[d];c=c.concat(b)}}return c};$A.isInValidReocrdEmpty=function(a){var e=true;for(var c in $A.invalidRecords){var d=$A.CmpManager.get(c);if(d.pageid==a){var b=$A.invalidRecords[c];if(b.length!=0){e=false;break}}}return e};$A.manager.on("valid",function(a,c,b){switch($A.validInfoType){case"area":$A.showValidTopMsg(c);break;case"message":$A.showValidWindowMsg(c);break}});$A.showValidWindowMsg=function(g){var f=$A.isInValidReocrdEmpty(g.pageid);if(f==true){if($A.validWindow){$A.validWindow.close()}}if(!$A.validWindow&&f==false){$A.validWindow=$A.showWarningMessage(_lang["valid.fail"],"",400,200);$A.validWindow.on("close",function(){$A.validWindow=null})}var h=[];var b=$A.getInvalidRecords(g.pageid);for(var d=0;d<b.length;d++){var e=b[d];var c=e.ds.data.indexOf(e)+1;h[h.length]=_lang["valid.fail.note"]+'<a href="#" onclick="$(\''+e.ds.id+"').locate("+c+')">('+e.id+")</a>:";for(var a in e.valid){h[h.length]=e.valid[a]+";"}h[h.length]="<br/>"}if($A.validWindow){$A.validWindow.body.child("div").update(h.join(""))}};$A.pageids=[];$A.showValidTopMsg=function(b){var g=$A.isInValidReocrdEmpty(b.pageid);if(g==true){var l=Ext.get(b.pageid+"_msg");if(l){l.hide();l.setStyle("display","none");l.update("")}return}var e=$A.getInvalidRecords(b.pageid);var m=[];for(var f=0;f<e.length;f++){var a=e[f];var h=a.ds.data.indexOf(a)+1;m[m.length]=_lang["valid.fail.note"]+'<a href="#" onclick="$(\''+a.ds.id+"').locate("+h+')">('+a.id+")</a>:";for(var c in a.valid){m[m.length]=a.valid[c]+";"}m[m.length]="<br/>"}var l=Ext.get(b.pageid+"_msg");if(l){l.update(m.join(""));l.show(true)}};$A.setValidInfoType("tip");$A.AUTO_ID=1000;$A.DataSet=Ext.extend(Ext.util.Observable,{constructor:function(a){$A.DataSet.superclass.constructor.call(this);a=a||{};if(a.listeners){this.on(a.listeners)}this.pageid=a.pageid;this.spara={};this.selected=[];this.pagesize=a.pagesize||10;this.submiturl=a.submiturl||"";this.queryurl=a.queryurl||"";this.fetchall=a.fetchall||false;this.selectable=a.selectable||false;this.selectionmodel=a.selectionmodel||"multiple";this.selectfunction=a.selectfunction;this.autocount=a.autocount;this.bindtarget=a.bindtarget;this.bindname=a.bindname;this.loading=false;this.qpara={};this.fields={};this.resetConfig();this.id=a.id||Ext.id();$A.CmpManager.put(this.id,this);if(this.bindtarget&&this.bindname){this.bind($(this.bindtarget),this.bindname)}this.qds=Ext.isEmpty(a.querydataset)?null:$(a.querydataset);if(this.qds!=null&&this.qds.getCurrentRecord()==null){this.qds.create()}this.initEvents();if(a.fields){this.initFields(a.fields)}if(a.datas&&a.datas.length!=0){this.loadData(a.datas)}if(a.autoquery===true){var b=this;Ext.onReady(function(){b.query()})}if(a.autocreate==true){if(this.data.length==0){this.create()}}},destroy:function(){if(this.bindtarget&&this.bindname){var a=$A.CmpManager.get(this.bindtarget);if(a){a.clearBind()}}$A.CmpManager.remove(this.id);delete $A.invalidRecords[this.id]},reConfig:function(a){this.resetConfig();Ext.apply(this,a)},clearBind:function(){var a=this.bindname;var b=this.fields[a].pro.dataset;if(b){b.processBindDataSetListener(this,"un")}delete this.fields[a]},processBindDataSetListener:function(c,b){var a=this.onDataSetModify;this[b]("add",a,this);this[b]("remove",a,this);this[b]("update",a,this);this[b]("clear",a,this);this[b]("load",this.onDataSetLoad,this);this[b]("reject",a,this);c[b]("indexchange",this.onDataSetIndexChange,this)},bind:function(b,a){if(b.fields[a]){alert("重复绑定 "+a);return}this.processBindDataSetListener(b,"un");this.processBindDataSetListener(b,"on");var c=new $A.Record.Field({name:a,type:"dataset",dataset:this});b.fields[a]=c},onDataSetIndexChange:function(b,a){if(!a.get(this.bindname)&&a.isNew!=true){this.qpara={};Ext.apply(this.qpara,a.data);this.query(1,{record:a})}},onDataSetModify:function(){var a=$A.CmpManager.get(this.bindtarget);if(a){this.refreshBindDataSet(a.getCurrentRecord(),this.getConfig())}},onDataSetLoad:function(d,c){var a;if(c){a=c.opts.record}else{var b=$A.CmpManager.get(this.bindtarget);if(b){a=b.getCurrentRecord()}}if(a){this.refreshBindDataSet(a,d.getConfig())}},refreshBindDataSet:function(a,b){if(!a){return}a.set(this.bindname,b,true)},beforeCreate:function(c,a,b){if(this.data.length==0){this.create({},false)}},resetConfig:function(){this.data=[];this.selected=[];this.gotoPage=1;this.currentPage=1;this.currentIndex=1;this.totalCount=0;this.totalPage=0;this.isValid=true},getConfig:function(){var a={};a.xtype="dataset";a.data=this.data;a.selected=this.selected;a.isValid=this.isValid;a.gotoPage=this.gotoPage;a.currentPage=this.currentPage;a.currentIndex=this.currentIndex;a.totalCount=this.totalCount;a.totalPage=this.totalPage;return a},initEvents:function(){this.addEvents("ajaxfailed","beforecreate","metachange","fieldchange","add","remove","beforeremove","update","clear","query","beforeload","load","loadfailed","refresh","valid","indexchange","select","unselect","reject","beforesubmit","submit","submitsuccess","submitfailed")},initFields:function(b){for(var c=0,a=b.length;c<a;c++){var d=new $A.Record.Field(b[c]);this.fields[d.name]=d}},getField:function(a){return this.fields[a]},loadData:function(e,d,n){this.data=[];this.selected=[];if(d){this.totalCount=d}else{this.totalCount=e.length}this.totalPage=Math.ceil(this.totalCount/this.pagesize);for(var b=0,f=e.length;b<f;b++){var a=e[b].data||e[b];for(var m in this.fields){var h=this.fields[m];if(h){a[m]=this.processData(a,m,h)}}var c=new $A.Record(a,e[b].field);c.setDataSet(this);this.data.add(c)}if(this.sortInfo){this.sort()}this.fireEvent("beforeload",this,this.data);var l=true;if(this.bindtarget&&n){var g=$A.CmpManager.get(this.bindtarget).getCurrentRecord();if(n.opts.record&&g!=n.opts.record){this.refreshBindDataSet(n.opts.record,this.getConfig());l=false}}if(l){this.fireEvent("load",this,n)}},sort:function(a,b){},create:function(f,e){this.fireEvent("beforecreate",this);f=f||{};var a={};for(var c in this.fields){var g=this.fields[c];var d=g.getPropertity("defaultvalue");if(d&&!f[g.name]){a[g.name]=d}this.processValueListField(a,c,g)}var f=Ext.apply(f||{},a);var b=new $A.Record(f);this.add(b);return b},getNewRecrods:function(){var d=this.getAll();var e=[];for(var c=0,b=d.length;c<b;c++){var a=d[c];if(a.isNew==true){e.add(a)}}return e},add:function(a){a.isNew=true;a.setDataSet(this);var b=this.data.length;this.data.add(a);var b=(this.currentPage-1)*this.pagesize+this.data.length;this.currentIndex=b;this.fireEvent("add",this,a,b);this.locate(b,true)},getCurrentRecord:function(){if(this.data.length==0){return null}return this.data[this.currentIndex-(this.currentPage-1)*this.pagesize-1]},insert:function(c,b){b=[].concat(b);var e=this.data.splice(c,this.data.length);for(var d=0,a=b.length;d<a;d++){b[d].setDataSet(this);this.data.add(b[d])}this.data=this.data.concat(e);this.fireEvent("add",this,b,c)},remove:function(a){if(!a){a=this.getCurrentRecord()}if(!a){return}this.fireEvent("beforeremove",this);var b=[].concat(a);var e=[];for(var c=0;c<b.length;c++){var d=b[c];if(d.isNew){this.removeLocal(d)}else{e[e.length]=d}}this.removeRemote(e)},removeRemote:function(e){if(this.submiturl==""){return}var c=[];for(var g=0;g<e.length;g++){var a=e[g];for(var m in this.fields){var i=this.fields[m];if(i&&i.type=="dataset"){delete a.data[m]}}var l=Ext.apply({},a.data);l._id=a.id;l._status="delete";c[g]=l}if(c.length>0){var b;if(this.bindtarget){var h=$A.CmpManager.get(this.bindtarget);b={record:h.getCurrentRecord(),dataSet:this}}$A.request({url:this.submiturl,para:c,ext:this.spara,success:this.onRemoveSuccess,error:this.onSubmitError,scope:this,failure:this.onAjaxFailed,opts:b})}},onRemoveSuccess:function(e,c){if(e.result.record){var a=[].concat(e.result.record);if(this.bindtarget){var h=$A.CmpManager.get(this.bindtarget);if(h.getCurrentRecord()==c.opts.record){for(var d=0;d<a.length;d++){var g=a[d];this.removeLocal(this.findById(g._id),true)}}else{var b=c.opts.record.get(this.bindname);var f=new $A.DataSet({});f.reConfig(b);for(var d=0;d<a.length;d++){var g=a[d];f.removeLocal(f.findById(g._id),true)}this.refreshBindDataSet(c.opts.record,f.getConfig());delete f}}else{for(var d=0;d<a.length;d++){var g=a[d];this.removeLocal(this.findById(g._id),true)}}}},removeLocal:function(a,c){$A.removeInvalidReocrd(this.id,a);var b=this.data.indexOf(a);if(b==-1){return}this.data.remove(a);if(c){this.totalCount--}this.selected.remove(a);if(this.data.length==0){this.removeAll();return}var d=this.currentIndex-(this.currentPage-1)*this.pagesize;if(d<0){return}if(d<=this.data.length){this.locate(this.currentIndex,true)}else{this.pre()}this.fireEvent("remove",this,a,b)},getAll:function(){return this.data},find:function(c,b){var a=null;this.each(function(d){var e=d.get(c);if(e==b){a=d;return false}},this);return a},findById:function(d){var c=null;for(var b=0,a=this.data.length;b<a;b++){if(this.data[b].id==d){c=this.data[b];break}}return c},removeAll:function(){this.currentIndex=1;this.data=[];this.selected=[];this.fireEvent("clear",this)},indexOf:function(a){return this.data.indexOf(a)},getAt:function(a){return this.data[a]},each:function(e,d){var b=[].concat(this.data);for(var c=0,a=b.length;c<a;c++){if(e.call(d||b[c],b[c],c,a)===false){break}}},processCurrentRow:function(){var b=this.getCurrentRecord();for(var a in this.fields){var d=this.fields[a];if(d.type=="dataset"){var c=d.pro.dataset;if(b&&b.data[d.name]){c.reConfig(b.data[d.name])}else{c.resetConfig()}c.fireEvent("refresh",c);c.processCurrentRow()}}if(b){this.fireEvent("indexchange",this,b)}},getSelected:function(){return this.selected},selectAll:function(){for(var b=0,a=this.data.length;b<a;b++){this.select(this.data[b])}},unSelectAll:function(){for(var b=0,a=this.data.length;b<a;b++){this.unSelect(this.data[b])}},select:function(a){if(!this.selectable){return}if(typeof(a)=="string"){a=this.findById(a)}if(this.selected.indexOf(a)!=-1){return}if(!this.execSelectFunction(a)){return}if(this.selectionmodel=="multiple"){this.selected.add(a);this.fireEvent("select",this,a)}else{var b=this.selected[0];this.unSelect(b);this.selected=[];this.selected.add(a);this.fireEvent("select",this,a)}},unSelect:function(a){if(!this.selectable){return}if(typeof(a)=="string"){a=this.findById(a)}if(this.selected.indexOf(a)==-1){return}this.selected.remove(a);this.fireEvent("unselect",this,a)},execSelectFunction:function(d){if(this.selectfunction){var c=$A.getRenderer(this.selectfunction);if(c==null){alert("未找到"+this.selectfunction+"方法!")}else{var a=c.call(window,d);if(Ext.isDefined(a)){return a}}}return true},locate:function(a,c){if(this.currentIndex==a&&c!==true){return}if(a<=0||(a>this.totalCount+this.getNewRecrods().length)){return}var b=a-(this.currentPage-1)*this.pagesize;if(this.data[b-1]){this.currentIndex=a}else{if(this.isModified()){$A.showInfoMessage(_lang["dataset.info"],_lang["dataset.info.locate"])}else{this.currentIndex=a;this.currentPage=Math.ceil(a/this.pagesize);this.query(this.currentPage);return}}this.processCurrentRow()},goPage:function(b){if(b>0){this.gotoPage=b;var a=(b-1)*this.pagesize+this.getNewRecrods().length+1;this.locate(a)}},first:function(){this.locate(1)},pre:function(){this.locate(this.currentIndex-1)},next:function(){this.locate(this.currentIndex+1)},firstPage:function(){this.goPage(1)},prePage:function(){this.goPage(this.currentPage-1)},nextPage:function(){this.goPage(this.currentPage+1)},lastPage:function(){this.goPage(this.totalPage)},validate:function(b){this.isValid=true;var m=this.getCurrentRecord();if(!m){return true}var e=this.getAll();var s={};var i=false;var p=null;for(var g in this.fields){var o=this.fields[g];if(o.type=="dataset"){i=true;var n=o.pro.dataset;s[o.name]=n}}for(var g=0,f=e.length;g<f;g++){var h=e[g];if(!h.validateRecord()){this.isValid=false;p=h;$A.addInValidReocrd(this.id,h)}else{$A.removeInvalidReocrd(this.id,h)}if(this.isValid==false){if(i){break}}else{for(key in s){var c=s[key];if(h.data[key]){c.reConfig(h.data[key]);if(!c.validate(false)){this.isValid=false;p=h}c.reConfig(m.data[key])}}if(this.isValid==false){break}}}if(p!=null){var a=this.indexOf(p);if(a!=-1){this.locate(a+1)}}if(b!==false){$A.manager.fireEvent("valid",$A.manager,this,this.isValid)}if(!this.isValid){$A.showInfoMessage(_lang["dataset.info"],_lang["dataset.info.validate"])}return this.isValid},setQueryUrl:function(a){this.queryurl=a},setQueryParameter:function(a,b){this.qpara[a]=b},setQueryDataSet:function(a){this.qds=a;if(this.qds.getCurrentRecord()==null){this.qds.create()}},setSubmitUrl:function(a){this.submiturl=a},setSubmitParameter:function(a,b){this.spara[a]=b},query:function(d,c){$A.slideBarEnable=$A.SideBar.enable;$A.SideBar.enable=false;if(!this.queryurl){return}if(this.qds){if(this.qds.getCurrentRecord()==null){this.qds.create()}var b=this,a=setInterval(function(){if(!b.qds.getCurrentRecord().isReady){return}clearInterval(a);if(!b.qds.validate()){return}b.doQuery(d,c)},10)}else{this.doQuery(d,c)}},doQuery:function(h,f){var e;if(this.qds){e=this.qds.getCurrentRecord()}if(!h){this.currentIndex=1}this.currentPage=h||1;var g={};if(e!=null){Ext.apply(g,e.data)}Ext.apply(g,this.qpara);for(var c in g){var b=g[c];if(Ext.isEmpty(b,false)){delete g[c]}}var a="pagesize="+this.pagesize+"&pagenum="+this.currentPage+"&_fetchall="+this.fetchall+"&_autocount="+this.autocount;var d=this.queryurl+(this.queryurl.indexOf("?")==-1?"?":"&")+a;this.loading=true;this.fireEvent("query",this);$A.request({url:d,para:g,success:this.onLoadSuccess,error:this.onLoadError,scope:this,failure:this.onAjaxFailed,opts:f})},isModified:function(){var e=false;var d=this.getAll();for(var c=0,b=d.length;c<b;c++){var a=d[c];if(a.dirty==true||a.isNew==true){e=true;break}else{for(var f in this.fields){var h=this.fields[f];if(h.type=="dataset"){var g=h.pro.dataset;g.reConfig(a.data[h.name]);if(g.isModified()){e=true;break}}}}}return e},getJsonData:function(f){var h=[];var n=this.data;if(f){n=this.getSelected()}for(var g=0,c=n.length;g<c;g++){var a=n[g];var o=a.dirty||a.isNew;var m=Ext.apply({},a.data);m._id=a.id;m._status=a.isNew?"insert":"update";for(var e in a.data){var p=m[e];if(p&&p.xtype=="dataset"){var b=new $A.DataSet({});b.reConfig(p);o=o==false?b.isModified():o;m[e]=b.getJsonData()}}if(o||f){h.push(m)}}return h},doSubmit:function(b,a){if(!this.validate()){return}this.fireBindDataSetEvent("submit",b,a);this.submiturl=b||this.submiturl;if(this.submiturl==""){return}var h=a;for(var d=0;d<h.length;d++){var g=h[d];for(var c in g){var e=this.fields[c];if(e&&e.type!="dataset"&&g[c]===""){g[c]=null}}}$A.request({url:this.submiturl,para:h,ext:this.spara,success:this.onSubmitSuccess,error:this.onSubmitError,scope:this,failure:this.onAjaxFailed})},isAllReady:function(a){for(var b=0;b<a.length;b++){if(!a[b].isReady){return false}}return true},submitSelected:function(a){var c=this,b=setInterval(function(){if(!c.isAllReady(c.getSelected())){return}clearInterval(b);c.fireEvent("beforesubmit",c);var e=c.getJsonData(true);c.doSubmit(a,e)},10)},submit:function(a){var c=this,b=setInterval(function(){if(!c.isAllReady(c.getAll())){return}clearInterval(b);c.fireEvent("beforesubmit",c);var e=c.getJsonData();c.doSubmit(a,e)},10)},post:function(a){var d=this.getCurrentRecord();if(!d){return}var c=this,b=setInterval(function(){if(!d.isReady){return}clearInterval(b);if(c.validate()){Aurora.post(a,d.data)}},10)},reset:function(){var a=this.getCurrentRecord();if(!a&&!a.fields){return}for(var d in a.fields){var b=a.fields[d].get("defaultvalue");if(b!=a.get(d)){a.set(d,b==undefined||b==null?"":b)}}},fireBindDataSetEvent:function(){var b=Ext.toArray(arguments);var d=b[0];b[0]=this;this.fireEvent.apply(this,[d].concat(b));for(var c in this.fields){var f=this.fields[c];if(f.type=="dataset"){var e=f.pro.dataset;if(e){e.fireBindDataSetEvent(d)}}}},afterEdit:function(a,b,c,d){this.fireEvent("update",this,a,b,c,d)},afterReject:function(a,b,c){this.fireEvent("reject",this,a,b,c)},onSubmitSuccess:function(b){var a=[];if(b.result.record){a=[].concat(b.result.record);this.commitRecords(a,true)}this.fireBindDataSetEvent("submitsuccess",b)},commitRecords:function(n,b){for(var m=0,e=n.length;m<e;m++){var h=n[m];var a=this.findById(h._id);if(a.isNew){this.totalCount++}if(!a){return}a.commit();for(var g in h){var s=g;var o=this.fields[s];if(o&&o.type=="dataset"){var c=o.pro.dataset;c.reConfig(a.data[o.name]);if(h[g].record){c.commitRecords([].concat(h[g].record),this.getCurrentRecord()==a)}}else{var d=a.get(s);var p=h[g];if(s=="_id"||s=="_status"||s=="__parameter_parsed__"){continue}if(o){p=this.processData(h,g,o)}if(d!=p){if(b){a.set(s,p,true)}else{a.data[s]=p}}}}}},processData:function(d,b,e){var a=d[b];if(a){var c=e.getPropertity("datatype");c=c?c.toLowerCase():"";switch(c){case"date":a=$A.parseDate(a);break;case"java.util.date":a=$A.parseDate(a);break;case"java.sql.date":a=$A.parseDate(a);break;case"java.sql.timestamp":a=$A.parseDate(a);a.xtype="timestamp";break;case"int":a=parseInt(a);break;case"float":a=parseFloat(a);break;case"boolean":a=a=="true";break}}return this.processValueListField(d,a,e)},processValueListField:function(f,n,m){var g=m.getPropertity("options");var l=m.getPropertity("displayfield");var h=m.getPropertity("valuefield");var d=m.getPropertity("mapping");if(l&&h&&g&&d&&!n){var o;for(var e=0;e<d.length;e++){var b=d[e];if(h==b.from){o=b.to;break}}var c=f[o];var p=$(g);if(p&&c){var a=p.find(h,c);if(a){n=a.get(l)}}}return n},onSubmitError:function(a){this.fireBindDataSetEvent("submitfailed",a)},onLoadSuccess:function(f,d){if(f==null){return}if(!f.result.record){f.result.record=[]}var c=[].concat(f.result.record);var h=f.result.totalCount;var a=[];if(c.length>0){for(var e=0,b=c.length;e<b;e++){var g={data:c[e]};a.push(g)}}else{if(c.length==0){this.currentIndex=1}}this.loading=false;this.loadData(a,h,d);this.locate(this.currentIndex,true);$A.SideBar.enable=$A.slideBarEnable},onAjaxFailed:function(b,a){this.fireBindDataSetEvent("ajaxfailed",b,a)},onLoadError:function(b,a){this.fireBindDataSetEvent("loadfailed",b,a);this.loading=false;$A.SideBar.enable=$A.slideBarEnable},onFieldChange:function(a,d,b,c){this.fireEvent("fieldchange",this,a,d,b,c)},onMetaChange:function(a,d,b,c){this.fireEvent("metachange",this,a,d,b,c)},onRecordValid:function(a,b,c){if(c==false&&this.isValid!==false){this.isValid=false}this.fireEvent("valid",this,a,b,c)}});$A.Record=function(b,a){this.id=++$A.AUTO_ID;this.data=b;this.fields={};this.valid={};this.isValid=true;this.isNew=false;this.dirty=false;this.editing=false;this.modified=null;this.isReady=true;this.meta=new $A.Record.Meta(this);if(a){this.initFields(a)}};$A.Record.prototype={commit:function(){this.editing=false;this.valid={};this.isValid=true;this.isNew=false;this.dirty=false;this.modified=null},initFields:function(a){for(var c=0,b=a.length;c<b;c++){var d=new $A.Record.Field(a[c]);d.record=this;this.fields[d.name]=d}},validateRecord:function(){this.isValid=true;this.valid={};var f=this.ds.fields;var d=this.fields;var e=[];for(var b in f){if(f[b].type!="dataset"){e.add(b)}}for(var b in d){if(e.indexOf(b)==-1){if(d[b].type!="dataset"){e.add(b)}}}for(var c=0,a=e.length;c<a;c++){if(this.isValid==true){this.isValid=this.validate(e[c])}else{this.validate(e[c])}}return this.isValid},validate:function(c){var e=true;var b=this.get(c);var f=this.getMeta().getField(c);var d=f.get("validator");if(Ext.isEmpty(b)&&f.get("required")==true){this.valid[c]=_lang["dataset.validate.required"];e=false}else{var a=true;if(d){d=window[d];a=d.call(window,this,c,b);if(a!==true){e=false;this.valid[c]=a}}}if(e==true){delete this.valid[c]}this.ds.onRecordValid(this,c,e);return e},setDataSet:function(a){this.ds=a},getField:function(a){return this.getMeta().getField(a)},getMeta:function(){return this.meta},copy:function(a){if(a==this){alert("不能copy自身!");return}if(a.dirty){for(var b in a.modified){this.set(b,a.get(b))}}},set:function(b,d,c){if(!(this.data[b]==d||(Ext.isDate(this.data[b])&&Ext.isDate(d)&&this.data[b].getTime()==d.getTime()))){if(!c){this.dirty=true;if(!this.modified){this.modified={}}if(typeof this.modified[b]=="undefined"){this.modified[b]=this.data[b]}}var a=this.data[b];this.data[b]=d;if(!this.editing&&this.ds){this.ds.afterEdit(this,b,d,a)}}this.validate(b)},get:function(a){return this.data[a]},reject:function(b){var a=this.modified;for(var c in a){if(typeof a[c]!="function"){this.data[c]=a[c];this.ds.afterReject(this,c,a[c])}}delete this.modified;this.editing=false;this.dirty=false},onFieldChange:function(a,b,c){var d=this.getMeta().getField(a);this.ds.onFieldChange(this,d,b,c)},onFieldClear:function(a){var b=this.getMeta().getField(a);this.ds.onFieldChange(this,b)},onMetaChange:function(c,a,b){this.ds.onMetaChange(this,c,a,b)},onMetaClear:function(a){this.ds.onMetaChange(this,a)}};$A.Record.Meta=function(a){this.record=a;this.pro={}};$A.Record.Meta.prototype={clear:function(){this.pro={};this.record.onMetaClear(this)},getField:function(a){if(!a){return null}var c=this.record.fields[a];var e=this.record.ds.fields[a];var b;if(!c){if(e){c=new $A.Record.Field({name:e.name,type:e.type||"string"})}else{c=new $A.Record.Field({name:a,type:"string"})}c.record=this.record;this.record.fields[c.name]=c}var d={};if(e){d=Ext.apply(d,e.pro)}d=Ext.apply(d,this.pro);d=Ext.apply(d,c.pro);delete d.name;delete d.type;c.snap=d;return c},setRequired:function(a){var b=this.pro.required;if(b!==a){this.pro.required=a;this.record.onMetaChange(this,"required",a)}},setReadOnly:function(a){var b=this.pro.readonly;if(b!==a){this.pro.readonly=a;this.record.onMetaChange(this,"readonly",a)}}};$A.Record.Field=function(a){this.name=a.name;this.type=a.type;this.pro=a||{};this.record};$A.Record.Field.prototype={clear:function(){this.pro={};this.record.onFieldClear(this.name)},setPropertity:function(a,b){var c=this.pro[a];if(c!==b){this.pro[a]=b;this.record.onFieldChange(this.name,a,b)}},get:function(b){var a=null;if(this.snap){a=this.snap[b]}return a},getPropertity:function(a){return this.pro[a]},setRequired:function(a){this.setPropertity("required",a)},isRequired:function(){return this.getPropertity("required")},setReadOnly:function(a){if(a){delete this.record.valid[this.name]}this.setPropertity("readonly",a)},isReadOnly:function(){return this.getPropertity("readonly")},setOptions:function(a){this.setPropertity("options",a)},getOptions:function(){return this.getPropertity("options")},setMapping:function(a){this.setPropertity("mapping",a)},getMapping:function(){return this.getPropertity("mapping")},setTitle:function(a){this.setPropertity("title",a)},setLovWidth:function(a){this.setPropertity("lovwidth",a)},setLovHeight:function(a){this.setPropertity("lovheight",a)},setLovGridHeight:function(a){this.setPropertity("lovgridheight",a)},setLovModel:function(a){this.setPropertity("lovmodel",a)},setLovService:function(a){this.setPropertity("lovservice",a)},setLovUrl:function(a){this.setPropertity("lovurl",a)},setLovPara:function(a,b){var c=this.getPropertity("lovpara");if(!c){c={};this.setPropertity("lovpara",c)}if(b==null){delete c[a]}else{c[a]=b}}};$A.Component=Ext.extend(Ext.util.Observable,{constructor:function(a){$A.Component.superclass.constructor.call(this);this.id=a.id||Ext.id();$A.CmpManager.put(this.id,this);this.initConfig=a;this.isHidden=false;this.isFireEvent=false;this.initComponent(a);this.initEvents()},initComponent:function(a){a=a||{};Ext.apply(this,a);this.wrap=Ext.get(this.id);if(this.listeners){this.on(this.listeners)}},processListener:function(a){this.processMouseOverOut(a);if(this.marginwidth||this.marginheight){Ext.EventManager[a](window,"resize",this.windowResizeListener,this)}},processMouseOverOut:function(a){this.wrap[a]("mouseover",this.onMouseOver,this);this.wrap[a]("mouseout",this.onMouseOut,this)},initEvents:function(){this.addEvents("focus","blur","change","valid","mouseover","mouseout");this.processListener("on")},windowResizeListener:function(){var a,b;if(this.marginheight){a=Aurora.getViewportHeight();this.setHeight(a-this.marginheight)}if(this.marginwidth){b=Aurora.getViewportWidth();this.setWidth(b-this.marginwidth)}},isEventFromComponent:function(a){return this.wrap.contains(a)},move:function(a,b){this.wrap.setX(a);this.wrap.setY(b)},getBindName:function(){return this.binder?this.binder.name:null},getBindDataSet:function(){return this.binder?this.binder.ds:null},bind:function(c,b){this.clearBind();if(typeof(c)=="string"){c=$(c)}if(!c){return}this.binder={ds:c,name:b};this.record=c.getCurrentRecord();var d=c.fields[this.binder.name];if(d){var a={};Ext.apply(a,this.initConfig);Ext.apply(a,d.pro);delete a.name;delete a.type;this.initComponent(a)}c.on("metachange",this.onRefresh,this);c.on("valid",this.onValid,this);c.on("remove",this.onRemove,this);c.on("clear",this.onClear,this);c.on("update",this.onUpdate,this);c.on("reject",this.onUpdate,this);c.on("fieldchange",this.onFieldChange,this);c.on("indexchange",this.onRefresh,this);this.onRefresh(c)},clearBind:function(){if(this.binder){var a=this.binder.ds;a.un("metachange",this.onRefresh,this);a.un("valid",this.onValid,this);a.un("remove",this.onRemove,this);a.un("clear",this.onClear,this);a.un("update",this.onUpdate,this);a.un("reject",this.onUpdate,this);a.un("fieldchange",this.onFieldChange,this);a.un("indexchange",this.onRefresh,this)}this.binder=null;this.record=null},destroy:function(){this.processListener("un");$A.CmpManager.remove(this.id);this.clearBind();delete this.wrap},onMouseOver:function(a){this.fireEvent("mouseover",this,a)},onMouseOut:function(a){this.fireEvent("mouseout",this,a)},onRemove:function(b,a){if(this.binder.ds==b&&this.record==a){this.clearValue()}},onCreate:function(b,a){this.clearInvalid();this.record=b.getCurrentRecord();this.setValue("",true)},onRefresh:function(a){if(this.isFireEvent==true||this.isHidden==true){return}this.clearInvalid();this.render(a.getCurrentRecord())},render:function(a){this.record=a;if(this.record){var c=this.record.get(this.binder.name);var d=this.record.getMeta().getField(this.binder.name);var b={};Ext.apply(b,this.initConfig);Ext.apply(b,d.snap);this.initComponent(b);if(this.record.valid[this.binder.name]){this.markInvalid()}if(!Ext.isEmpty(c,true)){this.setValue(c,true)}else{this.clearValue()}}else{this.setValue("",true)}},onValid:function(d,a,b,c){if(this.binder.ds==d&&this.binder.name==b&&this.record==a){if(c){this.fireEvent("valid",this,this.record,this.binder.name,true);this.clearInvalid()}else{this.fireEvent("valid",this,this.record,this.binder.name,false);this.markInvalid()}}},onUpdate:function(d,a,b,c){if(this.binder.ds==d&&this.record==a&&this.binder.name==b&&this.getValue()!=c){this.setValue(c,true)}},onFieldChange:function(b,a,c){if(this.binder.ds==b&&this.record==a&&this.binder.name==c.name){this.onRefresh(b)}},onClear:function(a){this.clearValue()},setValue:function(b,a){var c=this.value;this.value=b;if(a===true){return}if(this.binder){this.record=this.binder.ds.getCurrentRecord();if(this.record==null){this.record=this.binder.ds.create({},false)}this.record.set(this.binder.name,b);if(Ext.isEmpty(b,true)){delete this.record.data[this.binder.name]}}if(c!=b){this.fireEvent("change",this,b,c)}},getValue:function(){var a=this.value;a=(a===null||a===undefined?"":a);return a},setWidth:function(a){if(this.width==a){return}this.width=a;this.wrap.setWidth(a)},setHeight:function(a){if(this.height==a){return}this.height=a;this.wrap.setHeight(a)},clearInvalid:function(){},markInvalid:function(){},clearValue:function(){},initMeta:function(){},setDefault:function(){},setRequired:function(){},onDataChange:function(){},setWidth:function(a){this.wrap.setStyle("width",a+"px")},setHeight:function(a){this.wrap.setStyle("height",a+"px")}});$A.Field=Ext.extend($A.Component,{validators:[],requiredCss:"item-notBlank",focusCss:"item-focus",readOnlyCss:"item-readOnly",emptyTextCss:"item-emptyText",invalidCss:"item-invalid",constructor:function(a){a.required=a.required||false;a.readonly=a.readonly||false;$A.Field.superclass.constructor.call(this,a)},initElements:function(){this.el=this.wrap.child("input[atype=field.input]")},initComponent:function(a){$A.Field.superclass.initComponent.call(this,a);this.initElements();this.originalValue=this.getValue();this.applyEmptyText();this.initStatus();if(this.hidden==true){this.setVisible(false)}},processListener:function(a){$A.Field.superclass.processListener.call(this,a);this.el[a]("focus",this.onFocus,this);this.el[a]("blur",this.onBlur,this);this.el[a]("change",this.onChange,this);this.el[a]("keyup",this.onKeyUp,this);this.el[a]("keydown",this.onKeyDown,this);this.el[a]("keypress",this.onKeyPress,this)},processMouseOverOut:function(a){this.el[a]("mouseover",this.onMouseOver,this);this.el[a]("mouseout",this.onMouseOut,this)},initEvents:function(){$A.Field.superclass.initEvents.call(this);this.addEvents("keydown","keyup","keypress","enterdown")},destroy:function(){$A.Field.superclass.destroy.call(this);delete this.el},setWidth:function(a){this.wrap.setStyle("width",(a+3)+"px");this.el.setStyle("width",a+"px")},setHeight:function(a){this.wrap.setStyle("height",a+"px");this.el.setStyle("height",(a-2)+"px")},setVisible:function(a){if(a==true){this.wrap.show()}else{this.wrap.hide()}},initStatus:function(){this.clearInvalid();this.initRequired(this.required);this.initReadOnly(this.readonly)},onChange:function(a){},onKeyUp:function(a){this.fireEvent("keyup",this,a)},onKeyDown:function(c){this.fireEvent("keydown",this,c);var b=c.keyCode;if(b==13||b==27){this.blur();if(b==13){var a=this;setTimeout(function(){a.fireEvent("enterdown",a,c)},5)}}},onKeyPress:function(a){this.fireEvent("keypress",this,a)},onFocus:function(a){(Ext.isGecko||Ext.isGecko2||Ext.isGecko3)?this.select():this.select.defer(10,this);if(this.readonly){return}if(!this.hasFocus){this.hasFocus=true;this.startValue=this.getValue();if(this.emptytext){if(this.el.dom.value==this.emptytext){this.setRawValue("")}this.wrap.removeClass(this.emptyTextCss)}this.wrap.addClass(this.focusCss);this.fireEvent("focus",this)}},processValue:function(a){return a},onBlur:function(a){if(this.readonly){return}if(this.hasFocus){this.hasFocus=false;var b=this.getRawValue();b=this.processValue(b);this.setValue(b);this.wrap.removeClass(this.focusCss);this.fireEvent("blur",this)}},setValue:function(b,a){$A.Field.superclass.setValue.call(this,b,a);if(this.emptytext&&this.el&&b!==undefined&&b!==null&&b!==""){this.wrap.removeClass(this.emptyTextCss)}this.setRawValue(this.formatValue((b===null||b===undefined?"":b)));this.applyEmptyText()},formatValue:function(a){var b=null;if(this.renderer){b=$A.getRenderer(this.renderer)}return(b!=null)?b.call(window,a):a},getRawValue:function(){var a=this.el.getValue();if(a===this.emptytext||a===undefined){a=""}return a},initRequired:function(a){if(this.crrentRequired==a){return}this.clearInvalid();this.crrentRequired=a;if(a){this.wrap.addClass(this.requiredCss)}else{this.wrap.removeClass(this.requiredCss)}},initReadOnly:function(a){if(this.currentReadOnly==a){return}this.currentReadOnly=a;this.el.dom.readOnly=a;if(a){this.wrap.addClass(this.readOnlyCss)}else{this.wrap.removeClass(this.readOnlyCss)}},applyEmptyText:function(){if(this.emptytext&&this.getRawValue().length<1){this.setRawValue(this.emptytext);this.wrap.addClass(this.emptyTextCss)}},clearInvalid:function(){this.invalidMsg=null;this.wrap.removeClass(this.invalidCss)},markInvalid:function(a){this.invalidMsg=a;this.wrap.addClass(this.invalidCss)},select:function(f,a){var c=this.getRawValue();if(c.length>0){f=f===undefined?0:f;a=a===undefined?c.length:a;var e=this.el.dom;if(e.setSelectionRange){e.setSelectionRange(f,a)}else{if(e.createTextRange){var b=e.createTextRange();b.moveStart("character",f);b.moveEnd("character",a-c.length);b.select()}}}},setRawValue:function(a){return this.el.dom.value=(a===null||a===undefined?"":a)},reset:function(){this.setValue(this.originalValue);this.clearInvalid();this.applyEmptyText()},focus:function(){if(this.readonly){return}this.el.dom.focus();this.fireEvent("focus",this)},blur:function(){if(this.readonly){return}this.el.blur();this.fireEvent("blur",this)},clearValue:function(){this.setValue("",true);this.clearInvalid();this.applyEmptyText()}});$A.Box=Ext.extend($A.Component,{constructor:function(a){this.errors=[];$A.Box.superclass.constructor.call(this,a)},initEvents:function(){},onValid:function(e,a,d,b){if(b){this.clearError(e.id)}else{var c=a.errors[d];if(c){this.showError(e.id,c.message)}}},showError:function(b,a){Ext.fly(b+"_vmsg").update(a)},clearError:function(a){Ext.fly(a+"_vmsg").update("")},clearAllError:function(){for(var a=0;a<this.errors.length;a++){this.clearError(this.errors[a])}}});$A.ImageCode=Ext.extend($A.Component,{processListener:function(a){$A.ImageCode.superclass.processListener.call(this,a);this.wrap[a]("click",this.onClick,this)},onClick:function(){this.refresh()},refresh:function(){this.wrap.dom.src="imagecode?r="+Math.random()}});$A.Label=Ext.extend($A.Component,{onUpdate:function(d,a,b,c){if(this.binder.ds==d&&this.binder.name==b){this.updateLabel(a,b,c)}},render:function(a){this.record=a;if(this.record){var b=this.record.get(this.binder.name);this.updateLabel(this.record,this.binder.name,b)}},updateLabel:function(a,b,d){var c=$A.getRenderer(this.renderer);if(c!=null){d=c.call(window,d,a,b)}this.wrap.update(d)}});$A.Button=Ext.extend($A.Component,{disableCss:"item-btn-disabled",overCss:"item-btn-over",pressCss:"item-btn-pressed",disabled:false,constructor:function(a){$A.Button.superclass.constructor.call(this,a)},initComponent:function(a){$A.Button.superclass.initComponent.call(this,a);this.el=this.wrap.child("button[atype=btn]");if(this.hidden==true){this.setVisible(false)}if(this.disabled==true){this.disable()}},processListener:function(a){$A.Button.superclass.processListener.call(this,a);this.wrap[a]("click",this.onClick,this);this.wrap[a]("mousedown",this.onMouseDown,this)},initEvents:function(){$A.Button.superclass.initEvents.call(this);this.addEvents("click")},destroy:function(){$A.Button.superclass.destroy.call(this);delete this.el},setVisible:function(a){if(a==true){this.wrap.show()}else{this.wrap.hide()}},focus:function(){if(this.disabled){return}this.el.dom.focus()},blur:function(){if(this.disabled){return}this.el.dom.blur()},disable:function(){this.disabled=true;this.wrap.addClass(this.disableCss);this.el.dom.disabled=true},enable:function(){this.disabled=false;this.wrap.removeClass(this.disableCss);this.el.dom.disabled=false},onMouseDown:function(a){if(!this.disabled){this.wrap.addClass(this.pressCss);Ext.get(document.documentElement).on("mouseup",this.onMouseUp,this)}},onMouseUp:function(a){if(!this.disabled){Ext.get(document.documentElement).un("mouseup",this.onMouseUp,this);this.wrap.removeClass(this.pressCss)}},onClick:function(a){if(!this.disabled){a.stopEvent();this.fireEvent("click",this,a)}},onMouseOver:function(a){if(!this.disabled){this.wrap.addClass(this.overCss)}},onMouseOut:function(a){if(!this.disabled){this.wrap.removeClass(this.overCss)}}});$A.Button.getTemplate=function(c,b,a){return'<TABLE class="item-btn " id="'+c+'" style="WIDTH: '+(a||60)+'px" cellSpacing="0"><TBODY><TR><TD class="item-btn-tl"><I></I></TD><TD class="item-btn-tc"></TD><TD class="item-btn-tr"><I></I></TD></TR><TR><TD class="item-btn-ml"><I></I></TD><TD class="item-btn-mc"><BUTTON hideFocus style="HEIGHT: 17px" atype="btn">'+b+'</BUTTON></TD><TD class="item-btn-mr"><I></I></TD></TR><TR><TD class="item-btn-bl"><I></I></TD><TD class="item-btn-bc"></TD><TD class="item-btn-br"><I></I></TD></TR></TBODY></TABLE><script>new Aurora.Button({"id":"'+c+'"});<\/script>'};$A.CheckBox=Ext.extend($A.Component,{checkedCss:"item-ckb-c",uncheckedCss:"item-ckb-u",readonyCheckedCss:"item-ckb-readonly-c",readonlyUncheckedCss:"item-ckb-readonly-u",constructor:function(a){a.checked=a.checked||false;a.readonly=a.readonly||false;$A.CheckBox.superclass.constructor.call(this,a)},initComponent:function(a){this.checkedvalue="Y";this.uncheckedvalue="N";$A.CheckBox.superclass.initComponent.call(this,a);this.wrap=Ext.get(this.id);this.el=this.wrap.child("div[atype=checkbox]")},processListener:function(a){this.wrap[a]("click",this.onClick,this)},initEvents:function(){$A.CheckBox.superclass.initEvents.call(this);this.addEvents("click")},destroy:function(){$A.CheckBox.superclass.destroy.call(this);delete this.el},onClick:function(a){if(!this.readonly){this.checked=this.checked?false:true;this.setValue(this.checked);this.fireEvent("click",this,this.checked)}},setValue:function(b,a){if(typeof(b)==="boolean"){this.checked=b?true:false}else{this.checked=(""+b==""+this.checkedvalue)}this.initStatus();var c=this.checked==true?this.checkedvalue:this.uncheckedvalue;$A.CheckBox.superclass.setValue.call(this,c,a)},getValue:function(){var a=this.value;a=(a===null||a===undefined?"":a);return a},initStatus:function(){this.el.removeClass(this.checkedCss);this.el.removeClass(this.uncheckedCss);this.el.removeClass(this.readonyCheckedCss);this.el.removeClass(this.readonlyUncheckedCss);if(this.readonly){this.el.addClass(this.checked?this.readonyCheckedCss:this.readonlyUncheckedCss)}else{this.el.addClass(this.checked?this.checkedCss:this.uncheckedCss)}}});$A.Radio=Ext.extend($A.Component,{ccs:"item-radio-img-c",ucs:"item-radio-img-u",rcc:"item-radio-img-readonly-c",ruc:"item-radio-img-readonly-u",imgCss:"item-radio-img",valueField:"value",constructor:function(a){a.checked=a.checked||false;a.readonly=a.readonly||false;$A.Radio.superclass.constructor.call(this,a)},initComponent:function(a){$A.Radio.superclass.initComponent.call(this,a);this.wrap=Ext.get(this.id);this.nodes=Ext.DomQuery.select(".item-radio-option",this.wrap.dom);this.initStatus()},processListener:function(a){this.wrap[a]("click",this.onClick,this);this.wrap[a]("keydown",this.onKeyDown,this)},focus:function(){this.wrap.focus()},onKeyDown:function(f){this.fireEvent("keydown",this,f);var d=f.keyCode;if(d==13){var c=this;setTimeout(function(){c.fireEvent("enterdown",c,f)},5)}else{if(d==40){var g=this.getValueItem();var b=this.options.indexOf(g);if(b+1<this.options.length){var a=this.options[b+1][this.valueField];this.setValue(a)}}else{if(d==38){var g=this.getValueItem();var b=this.options.indexOf(g);if(b-1>=0){var a=this.options[b-1][this.valueField];this.setValue(a)}}}}},initEvents:function(){$A.Radio.superclass.initEvents.call(this);this.addEvents("click","keydown","enterdown")},setValue:function(b,a){if(b==""){return}$A.Radio.superclass.setValue.call(this,b,a);this.initStatus();this.focus()},getItem:function(){var a=this.getValueItem();if(a!=null){a=new $A.Record(a)}return a},getValueItem:function(){var b=this.getValue();var a=this.options.length;var d=null;for(var c=0;c<a;c++){var e=this.options[c];if(e[this.valueField]==b){d=e;break}}return d},select:function(b){var a=this.getItemValue(b);if(a){this.setValue(a)}},getValue:function(){var a=this.value;a=(a===null||a===undefined?"":a);return a},initStatus:function(){var a=this.nodes.length;for(var b=0;b<a;b++){var c=Ext.fly(this.nodes[b]).child("."+this.imgCss);c.removeClass(this.ccs);c.removeClass(this.ucs);c.removeClass(this.rcc);c.removeClass(this.ruc);var d=Ext.fly(this.nodes[b]).getAttributeNS("","itemvalue");if(d===this.value){this.readonly?c.addClass(this.rcc):c.addClass(this.ccs)}else{this.readonly?c.addClass(this.ruc):c.addClass(this.ucs)}}},getItemValue:function(b){var c=Ext.fly(this.nodes[b]);if(!c){return null}var a=c.getAttributeNS("","itemvalue");return a},onClick:function(f){if(!this.readonly){var a=this.nodes.length;for(var c=0;c<a;c++){var d=Ext.fly(this.nodes[c]);if(d.contains(f.target)){var b=d.getAttributeNS("","itemvalue");this.setValue(b);this.fireEvent("click",this,b);break}}}}});$A.TextField=Ext.extend($A.Field,{constructor:function(a){$A.TextField.superclass.constructor.call(this,a)},initComponent:function(a){$A.TextField.superclass.initComponent.call(this,a)},initEvents:function(){$A.TextField.superclass.initEvents.call(this)},processListener:function(a){$A.TextField.superclass.processListener.call(this,a);if(this.typecase){if(!window.clipboardData){this.el[a]("change",this.onChange,this)}else{if(this.typecase){this.el[a]("paste",this.onPaste,this)}}}},onPaste:function(b){if(window.clipboardData){var a=window.clipboardData.getData("text");if(this.typecase=="upper"){window.clipboardData.setData("text",a.toUpperCase())}else{if(this.typecase=="lower"){window.clipboardData.setData("text",a.toLowerCase())}}setTimeout(function(){window.clipboardData.setData("text",a)},1)}},onChange:function(a){var b=this.getRawValue();if(this.isDbc(b)){b=this.dbc2sbc(b);this.setRawValue(b)}if(this.typecase=="upper"){this.setValue(this.getRawValue().toUpperCase())}else{if(this.typecase=="lower"){this.setValue(this.getRawValue().toLowerCase())}}},destroy:function(){$A.TextField.superclass.destroy.call(this)},isCapsLock:function(c){var b=c.getKey();var a=c.shiftKey;if(((b>=65&&b<=90)&&!a)||((b>=97&&b<=122)&&a)){if(this.dcl!=true){$A.showWarningMessage(_lang["textfield.warn"],_lang["textfield.warn.capslock"])}this.dcl=true}else{this.dcl=false}},onKeyPress:function(g){$A.TextField.superclass.onKeyPress.call(this,g);if(this.detectCapsLock){this.isCapsLock(g)}var f=g.getKey();var c=f;if(this.typecase&&!g.ctrlKey){if(this.typecase=="upper"){if(f>=97&&f<=122){c=f-32}}else{if(this.typecase=="lower"){if(f>=65&&f<=90){c=f+32}}}if(Ext.isIE){g.browserEvent.keyCode=c}else{if((f>=97&&f<=122)||(f>=65&&f<=90)){var a=String.fromCharCode(c);g.stopEvent();var h=this.el.dom;var i=this.getRawValue();var b=h.selectionStart;var g=h.selectionEnd;i=i.substring(0,b)+a+i.substring(g,i.length);this.setRawValue(i);h.selectionStart=b+1;h.selectionEnd=h.selectionStart}}}},isDbc:function(d){var b=false;for(var a=0;a<d.length;a++){var e=d.charCodeAt(a);if((e>65248)||(e==12288)){b=true;break}}return b},dbc2sbc:function(c){var a="";for(var b=0;b<c.length;b++){code=c.charCodeAt(b);if(code>=65281&&code<=65373){a+=String.fromCharCode(c.charCodeAt(b)-65248)}else{if(code==12288){a+=String.fromCharCode(c.charCodeAt(b)-12288+32)}else{a+=c.charAt(b)}}}return a}});$A.NumberField=Ext.extend($A.TextField,{allowdecimals:true,allownegative:true,allowformat:true,baseChars:"0123456789",decimalSeparator:".",decimalprecision:2,constructor:function(a){$A.NumberField.superclass.constructor.call(this,a)},initComponent:function(a){$A.NumberField.superclass.initComponent.call(this,a);this.allowed=this.baseChars+"";if(this.allowdecimals){this.allowed+=this.decimalSeparator}if(this.allownegative){this.allowed+="-"}},initEvents:function(){$A.NumberField.superclass.initEvents.call(this)},onKeyPress:function(b){var a=b.getKey();if(b.isSpecialKey()){return}var d=b.getCharCode();if(this.allowed.indexOf(String.fromCharCode(d))===-1){b.stopEvent();return}$A.NumberField.superclass.onKeyPress.call(this,b)},formatValue:function(a){var b=this.fixPrecision(this.parseValue(a));if(this.allowformat){b=$A.formatNumber(b)}return b},processValue:function(a){return this.fixPrecision(this.parseValue(a))},onFocus:function(a){if(this.readonly){return}if(this.allowformat){this.setRawValue($A.removeNumberFormat(this.getRawValue()))}$A.NumberField.superclass.onFocus.call(this,a)},parseValue:function(a){a=String(a);if(a.indexOf(",")!=-1){a=a.replace(/,/g,"")}if(!this.allownegative){a=a.replace("-","")}if(!this.allowdecimals){a=a.indexOf(".")==-1?a:a.substring(0,a.indexOf("."))}a=parseFloat(a.replace(this.decimalSeparator,"."));return isNaN(a)?"":a},fixPrecision:function(b){var a=isNaN(b);if(!this.allowdecimals||this.decimalprecision==-1||a||!b){return a?"":b}return parseFloat(b).toFixed(this.decimalprecision)}});$A.TriggerField=Ext.extend($A.TextField,{constructor:function(a){$A.TriggerField.superclass.constructor.call(this,a)},initComponent:function(a){$A.TriggerField.superclass.initComponent.call(this,a);this.trigger=this.wrap.child("div[atype=triggerfield.trigger]");this.initPopup()},initPopup:function(){if(this.initpopuped==true){return}this.popup=this.wrap.child("div[atype=triggerfield.popup]");this.shadow=this.wrap.child("div[atype=triggerfield.shadow]");Ext.getBody().insertFirst(this.popup);Ext.getBody().insertFirst(this.shadow);this.initpopuped=true},processListener:function(a){$A.TriggerField.superclass.processListener.call(this,a);this.trigger[a]("click",this.onTriggerClick,this,{preventDefault:true})},isExpanded:function(){var a=this.popup.getXY();return !(a[0]<-500||a[1]<-500)},setWidth:function(a){this.wrap.setStyle("width",(a+3)+"px");this.el.setStyle("width",(a-20)+"px")},onFocus:function(){if(this.readonly){return}$A.TriggerField.superclass.onFocus.call(this);if(!this.isExpanded()){this.expand()}},onBlur:function(a){this.hasFocus=false;this.wrap.removeClass(this.focusCss);this.fireEvent("blur",this)},onKeyDown:function(a){if(a.keyCode==9||a.keyCode==27||a.keyCode==13){if(this.isExpanded()){this.collapse()}}$A.TriggerField.superclass.onKeyDown.call(this,a)},isEventFromComponent:function(b){var a=$A.TriggerField.superclass.isEventFromComponent.call(this,b);return a||this.popup.contains(b)},destroy:function(){if(this.isExpanded()){this.collapse()}this.shadow.remove();this.popup.remove();delete this.popup;delete this.shadow;$A.TriggerField.superclass.destroy.call(this)},triggerBlur:function(a){if(!this.popup.contains(a.target)&&!this.wrap.contains(a.target)){if(this.isExpanded()){this.collapse()}}},setVisible:function(a){$A.TriggerField.superclass.setVisible.call(this,a);if(a==false&&this.isExpanded()){this.collapse()}},collapse:function(){Ext.get(document.documentElement).un("mousedown",this.triggerBlur,this);this.popup.moveTo(-1000,-1000);this.shadow.moveTo(-1000,-1000)},expand:function(){Ext.get(document.documentElement).on("mousedown",this.triggerBlur,this);this.syncPopup()},syncPopup:function(){var c=this.wrap.getXY(),b=this.popup.getHeight(),e=this.wrap.getHeight(),a=$A.getViewportHeight()-3,d=(c[1]+e+b)>a?((c[1]-b)<0?(c[1]+e):(c[1]-b)):(c[1]+e);this.popup.moveTo(c[0],d);this.shadow.moveTo(c[0]+3,d+3)},onTriggerClick:function(){if(this.readonly){return}if(this.isExpanded()){this.collapse()}else{this.expand();this.el.focus()}}});$A.ComboBox=Ext.extend($A.TriggerField,{maxHeight:200,blankOption:true,rendered:false,selectedClass:"item-comboBox-selected",currentNodeClass:"item-comboBox-current",constructor:function(a){$A.ComboBox.superclass.constructor.call(this,a)},initComponent:function(a){$A.ComboBox.superclass.initComponent.call(this,a);if(a.options){this.setOptions(a.options)}else{this.clearOptions()}},initEvents:function(){$A.ComboBox.superclass.initEvents.call(this);this.addEvents("select")},onTriggerClick:function(){this.doQuery("",true);$A.ComboBox.superclass.onTriggerClick.call(this)},onBlur:function(c){$A.ComboBox.superclass.onBlur.call(this,c);if(!this.isExpanded()){var b=this.getRawValue();var a=this.getRecordByDisplay(b);if(a!=null){this.setValue(a.get(this.displayfield))}else{this.setValue("")}}},getRecordByDisplay:function(e){if(!this.optionDataSet){return null}var a=this.optionDataSet.getAll();var c=a.length;var b=null;for(var f=0;f<c;f++){var g=a[f];var h=g.get(this.displayfield);if(h==e){b=g;break}}return b},expand:function(){if(!this.optionDataSet){return}if(this.rendered===false){this.initQuery()}this.correctViewSize();$A.ComboBox.superclass.expand.call(this);var a=this.getValue();this.currentIndex=this.getIndex(a);if(!this.currentIndex){return}if(!Ext.isEmpty(a)){if(this.selectedIndex){Ext.fly(this.getNode(this.selectedIndex)).removeClass(this.selectedClass)}var b=this.getNode(this.currentIndex);if(b){Ext.fly(b).addClass(this.currentNodeClass)}this.selectedIndex=this.currentIndex}},collapse:function(){$A.ComboBox.superclass.collapse.call(this);if(this.currentIndex!==undefined){Ext.fly(this.getNode(this.currentIndex)).removeClass(this.currentNodeClass)}},clearOptions:function(){this.processDataSet("un");this.optionDataSet=null},setOptions:function(a){var b=a;if(typeof(a)==="string"){b=$(a)}if(this.optionDataSet!=b){this.optionDataSet=b;this.processDataSet("un");this.processDataSet("on");this.rendered=false;if(!Ext.isEmpty(this.value)){this.setValue(this.value,true)}}},processDataSet:function(a){if(this.optionDataSet){this.optionDataSet[a]("load",this.onDataSetLoad,this);this.optionDataSet[a]("add",this.onDataSetLoad,this);this.optionDataSet[a]("update",this.onDataSetLoad,this);this.optionDataSet[a]("remove",this.onDataSetLoad,this);this.optionDataSet[a]("clear",this.onDataSetLoad,this);this.optionDataSet[a]("reject",this.onDataSetLoad,this)}},onDataSetLoad:function(){this.rendered=false;if(this.isExpanded()){this.expand()}},onRender:function(){if(!this.view){this.popup.update("<ul></ul>");this.view=this.popup.child("ul");this.view.on("click",this.onViewClick,this);this.view.on("mousemove",this.onViewMove,this)}if(this.optionDataSet){this.initList();this.rendered=true}},correctViewSize:function(){var f=[];var e=this.wrap.getWidth();for(var c=0;c<this.view.dom.childNodes.length;c++){var a=this.view.dom.childNodes[c];var d=$A.TextMetrics.measure(a,a.innerHTML).width;e=Math.max(e,d)||e}this.popup.setWidth(e);var b=Math.min(this.popup.child("ul").getHeight()+2,this.maxHeight);this.popup.setHeight(b<20?20:b);this.shadow.setWidth(e);this.shadow.setHeight(b<20?20:b)},onViewClick:function(b,a){if(a.tagName!="LI"){return}this.onSelect(a);this.collapse()},onViewOver:function(b,a){this.inKeyMode=false},onViewMove:function(c,b){if(this.inKeyMode){return}var a=b.tabIndex;this.selectItem(a)},onSelect:function(e){var b=e.tabIndex;if(b==-1){return}var a=this.optionDataSet.getAt(b);var c=a.get(this.valuefield);var d=this.getRenderText(a);this.setValue(d);this.fireEvent("select",this,c,d,a)},initQuery:function(){this.doQuery(this.getText())},doQuery:function(b,a){if(b===undefined||b===null){b=""}this.onRender()},initList:function(){this.refresh();if(this.optionDataSet.loading==true){this.view.update('<li tabIndex="-1">'+_lang["combobox.loading"]+"</li>")}else{var a=this.optionDataSet.getAll();var b=a.length;var f=[];for(var c=0;c<b;c++){var d=$A.getRenderer(this.renderer);var e=this.getRenderText(a[c]);f.add('<li tabIndex="'+c+'">'+e+"</li>")}if(b!=0){this.view.update(f.join(""))}}},getRenderText:function(a){var b=$A.getRenderer(this.renderer);var c="&#160;";if(b){c=b.call(window,this,a)}else{c=a.get(this.displayfield)}return c},refresh:function(){this.view.update("");this.selectedIndex=null},selectItem:function(a){if(Ext.isEmpty(a)){return}var b=this.getNode(a);if(b&&b.tabIndex!=this.selectedIndex){if(!Ext.isEmpty(this.selectedIndex)){Ext.fly(this.getNode(this.selectedIndex)).removeClass(this.selectedClass)}this.selectedIndex=b.tabIndex;Ext.fly(b).addClass(this.selectedClass)}},getNode:function(a){return this.view.dom.childNodes[a]},destroy:function(){if(this.view){this.view.un("click",this.onViewClick,this);this.view.un("mousemove",this.onViewMove,this)}delete this.view;$A.ComboBox.superclass.destroy.call(this)},getText:function(){return this.text},setValue:function(l,f){$A.ComboBox.superclass.setValue.call(this,l,f);if(this.record){var g=this.record.getMeta().getField(this.binder.name);if(g){var a=g.get("mapping");var h=this.getRawValue();var e=this.getRecordByDisplay(h);if(a){for(var d=0;d<a.length;d++){var b=a[d];var c=e?e.get(b.from):"";if(!Ext.isEmpty(c,true)){if(f){this.record.data[b.to]=c}else{this.record.set(b.to,c)}}else{delete this.record.data[b.to]}}}}}},getIndex:function(c){var a=this.optionDataSet.getAll();var b=a.length;for(var d=0;d<b;d++){if(a[d].data[this.displayfield]==c){return d}}}});$A.DateField=Ext.extend($A.Component,{bodyTpl:['<TABLE cellspacing="0">','<CAPTION class="item-dateField-caption"></CAPTION>','<THEAD class="item-dateField-head">',"<TR>","<TD>{sun}</TD>","<TD>{mon}</TD>","<TD>{tues}</TD>","<TD>{wed}</TD>","<TD>{thur}</TD>","<TD>{fri}</TD>","<TD>{sat}</TD>","</TR>","</THEAD>","<TBODY>","</TBODY>","</TABLE>"],preMonthTpl:['<DIV class="item-dateField-pre" title="{pre}"></DIV>'],nextMonthTpl:['<DIV class="item-dateField-next" title="{next}"></DIV>'],initComponent:function(a){$A.DateField.superclass.initComponent.call(this,a);if(this.height){this.rowHeight=(this.height-18*(Ext.isIE?3:2))/6}this.body=new Ext.Template(this.bodyTpl).append(this.wrap.dom,{sun:_lang["datefield.sun"],mon:_lang["datefield.mon"],tues:_lang["datefield.tues"],wed:_lang["datefield.wed"],thur:_lang["datefield.thur"],fri:_lang["datefield.fri"],sat:_lang["datefield.sat"]},true);this.head=this.body.child(".item-dateField-caption").dom;if(this.enablemonthbtn=="both"||this.enablemonthbtn=="pre"){this.preMonthBtn=new Ext.Template(this.preMonthTpl).append(this.head,{pre:_lang["datefield.preMonth"]},true)}if(this.enablemonthbtn=="both"||this.enablemonthbtn=="next"){this.nextMonthBtn=new Ext.Template(this.nextMonthTpl).append(this.head,{next:_lang["datefield.nextMonth"]},true)}this.head.text=document.createElement("span");this.head.appendChild(this.head.text)},processListener:function(a){$A.DateField.superclass.processListener.call(this,a);if(this.enablemonthbtn=="both"||this.enablemonthbtn=="pre"){this.preMonthBtn[a]("click",this.preMonth,this)}if(this.enablemonthbtn=="both"||this.enablemonthbtn=="next"){this.nextMonthBtn[a]("click",this.nextMonth,this)}this.body[a]("mousewheel",this.onMouseWheel,this);this.body[a]("mouseover",this.onMouseOver,this);this.body[a]("mouseout",this.onMouseOut,this);this.body[a]("mouseup",this.onSelect,this)},initEvents:function(){$A.DateField.superclass.initEvents.call(this);this.addEvents("select","draw")},destroy:function(){$A.DateField.superclass.destroy.call(this);delete this.preMonthBtn;delete this.nextMonthBtn;delete this.body;delete this.head},onMouseWheel:function(a){var b=a.getWheelDelta();if(b>0){this.preMonth();a.stopEvent()}if(b<0){this.nextMonth();a.stopEvent()}},onMouseOver:function(a){if(this.overTd){Ext.fly(this.overTd).removeClass("dateover")}if((Ext.fly(a.target).hasClass("item-day")||Ext.fly(a.target).hasClass("onToday"))&&Ext.fly(a.target).getAttributeNS("","_date")!="0"){this.overTd=a.target;Ext.fly(this.overTd).addClass("dateover")}},onMouseOut:function(a){if(this.overTd){Ext.fly(this.overTd).removeClass("dateover")}},onSelect:function(a){this.fireEvent("select",a)},onSelectDay:function(a){if(!Ext.fly(a).hasClass("onSelect")){Ext.fly(a).addClass("onSelect")}},nowMonth:function(){this.predraw(new Date())},preMonth:function(){this.predraw(new Date(this.year,this.month-2,1,this.hours,this.minutes,this.seconds))},nextMonth:function(){this.predraw(new Date(this.year,this.month,1,this.hours,this.minutes,this.seconds))},preYear:function(){this.predraw(new Date(this.year-1,this.month-1,1,this.hours,this.minutes,this.seconds))},nextYear:function(){this.predraw(new Date(this.year+1,this.month-1,1,this.hours,this.minutes,this.seconds))},predraw:function(a,b){if(!a||!a instanceof Date){a=new Date()}this.date=a;this.hours=a.getHours();this.minutes=a.getMinutes();this.seconds=a.getSeconds();this.year=a.getFullYear();this.month=a.getMonth()+1;this.draw(new Date(this.year,this.month-1,1,this.hours,this.minutes,this.seconds));if(!b){this.fireEvent("draw",this)}},draw:function(c){var l=[],p=c.getFullYear(),n=c.getMonth()+1,g=c.getHours(),e=c.getMinutes(),b=c.getSeconds();this.head.text.innerHTML=p+_lang["datefield.year"]+n+_lang["datefield.month"];for(var h=1,a=new Date(p,n-1,1).getDay(),r=new Date(p,n-1,0).getDate();h<=a;h++){l.push((this.enablebesidedays=="both"||this.enablebesidedays=="pre")?new Date(p,n-2,r-a+h,g,e,b):null)}for(var h=1,t=new Date(p,n,0).getDate();h<=t;h++){l.push(new Date(p,n-1,h,g,e,b))}for(var h=1,t=new Date(p,n,0).getDay(),m=7+(l.length>5*7?0:7);h<m-t;h++){l.push((this.enablebesidedays=="both"||this.enablebesidedays=="next")?new Date(p,n,h,g,e,b):null)}Ext.fly(this.body.dom.tBodies[0]).remove();this.body.dom.appendChild(document.createElement("tbody"));var f=0;while(l.length){var u=this.body.dom.tBodies[0].insertRow(-1);if(this.rowHeight){u.style.height=this.rowHeight+"px"}if(f%2==0){u.className="week-alt"}f++;for(var h=1;h<=7;h++){var o=l.shift();if(Ext.isDefined(o)){var s=u.insertCell(-1);if(o){s.className=c.getMonth()==o.getMonth()?"item-day":"item-day item-day-besides";s.innerHTML=this.renderCell(s,o)||o.getDate();if(s.disabled){Ext.fly(s).set({_date:"0"});Ext.fly(s).addClass("item-day-disabled")}else{Ext.fly(s).set({_date:(""+o.getTime())});if(this.format){Ext.fly(s).set({title:o.format(this.format)})}}if(this.isSame(o,new Date())){s.className="onToday"}if(this.selectDay&&this.isSame(o,this.selectDay)){this.onSelectDay(s)}}}}}},renderCell:function(a,b,c){if(this.dayrenderer){$A.getRenderer(this.dayrenderer).call(this,a,b,c)}},isSame:function(b,a){if(!a.getFullYear||!b.getFullYear){return false}return(b.getFullYear()==a.getFullYear()&&b.getMonth()==a.getMonth()&&b.getDate()==a.getDate())}});$A.DatePicker=Ext.extend($A.TriggerField,{nowTpl:['<DIV class="item-day" style="cursor:pointer" title="{title}">{now}</DIV>'],constructor:function(a){this.dateFields=[];$A.DatePicker.superclass.constructor.call(this,a)},initComponent:function(a){$A.DatePicker.superclass.initComponent.call(this,a);this.initFormat()},initFormat:function(){this.format=this.format||$A.defaultDateFormat},initDatePicker:function(){if(!this.inited){this.initDateField();this.initFooter();this.inited=true}},initDateField:function(){this.popup.setStyle({width:150*this.viewsize+"px"});if(this.dateFields.length==0){for(var b=0;b<this.viewsize;b++){var a={id:this.id+"_df"+b,height:130,enablemonthbtn:"none",enablebesidedays:"none",dayrenderer:this.dayrenderer,listeners:{select:this.onSelect.createDelegate(this),draw:this.onDraw.createDelegate(this)}};if(b==0){if(this.enablebesidedays=="both"||this.enablebesidedays=="pre"){a.enablebesidedays="pre"}if(this.enablemonthbtn=="both"||this.enablemonthbtn=="pre"){a.enablemonthbtn="pre"}}if(b==this.viewsize-1){if(this.enablebesidedays=="both"||this.enablebesidedays=="next"){a.enablebesidedays=a.enablebesidedays=="pre"?"both":"next"}if(this.enablemonthbtn=="both"||this.enablemonthbtn=="next"){a.enablemonthbtn=a.enablemonthbtn=="pre"?"both":"next"}}else{Ext.fly(this.id+"_df"+b).dom.style.cssText="border-right:1px solid #BABABA"}this.dateFields.add(new $A.DateField(a))}}},initFooter:function(){if(!this.now){this.now=new Ext.Template(this.nowTpl).append(this.popup.child("div.item-dateField-foot").dom,{now:_lang["datepicker.today"],title:new Date().format(this.format)},true)}this.now.set({_date:new Date().getTime()})},initEvents:function(){$A.DatePicker.superclass.initEvents.call(this);this.addEvents("select")},processListener:function(a){$A.DatePicker.superclass.processListener.call(this,a);if(this.now){this.now[a]("click",this.onSelect,this)}},onKeyUp:function(a){$A.DatePicker.superclass.onKeyUp.call(this,a);try{this.selectDay=this.getRawValue().parseDate(this.format);$A.Component.prototype.setValue.call(this,this.selectDay);this.predraw(this.selectDay)}catch(a){}},onDraw:function(a){if(this.dateFields.length>1){this.sysnDateField(a)}this.shadow.setWidth(this.popup.getWidth());this.shadow.setHeight(this.popup.getHeight())},onSelect:function(b){if((Ext.fly(b.target).hasClass("item-day")||Ext.fly(b.target).hasClass("onToday"))&&Ext.fly(b.target).getAttributeNS("","_date")!="0"){var a=new Date(parseInt(Ext.fly(b.target).getAttributeNS("","_date")));this.collapse();this.processDate(a);this.setValue(a);this.fireEvent("select",this,a)}},processDate:function(a){},onBlur:function(a){$A.DatePicker.superclass.onBlur.call(this,a);if(!this.isExpanded()){try{this.setValue(this.getRawValue().parseDate(this.format))}catch(a){alert(a.message);this.setValue(null)}}},formatValue:function(a){if(a instanceof Date){return a.format(this.format)}return a},expand:function(){this.initDatePicker();$A.DatePicker.superclass.expand.call(this);this.selectDay=this.getValue();this.predraw(this.selectDay);var g=this.wrap.getXY(),c=this.popup.getWidth(),e=this.popup.getHeight(),h=this.wrap.getHeight(),f=this.wrap.getWidth(),d=$A.getViewportHeight()-3,b=$A.getViewportWidth()-3,a=(g[0]+c)>b?((b-c)<0?g[0]:(b-c)):g[0];y=(g[1]+h+e)>d?((g[1]-e)<0?(g[1]+h):(g[1]-e)):(g[1]+h);this.popup.moveTo(a,y);this.shadow.moveTo(a+3,y+3)},destroy:function(){$A.DatePicker.superclass.destroy.call(this);delete this.format;delete this.viewsize},predraw:function(a){if(a&&a instanceof Date){this.selectDay=new Date(a)}else{a=new Date();a.setHours(0);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0)}this.draw(a)},draw:function(a){this.dateFields[0].selectDay=this.selectDay;this.dateFields[0].format=this.format;this.dateFields[0].predraw(a)},sysnDateField:function(c){var a=new Date(c.date);for(var b=0;b<this.viewsize;b++){if(c==this.dateFields[b]){a.setMonth(a.getMonth()-b)}}for(var b=0;b<this.viewsize;b++){this.dateFields[b].selectDay=this.selectDay;if(b!=0){a.setMonth(a.getMonth()+1)}this.dateFields[b].format=this.format;if(c!=this.dateFields[b]){this.dateFields[b].predraw(a,true)}}},preMonth:function(){this.dateFields[0].preMonth()},nextMonth:function(){this.dateFields[0].nextMonth()},onMouseWheel:function(a){var b=a.getWheelDelta();if(b>0&&(this.enablemonthbtn=="both"||this.enablemonthbtn=="pre")){this.preMonth();a.stopEvent()}if(b<0&&(this.enablemonthbtn=="both"||this.enablemonthbtn=="next")){this.nextMonth();a.stopEvent()}}});$A.DateTimePicker=Ext.extend($A.DatePicker,{initFormat:function(){this.format=this.format||$A.defaultDateTimeFormat},initFooter:function(){this.hourSpan=this.popup.child("input[atype=field.hour]");this.minuteSpan=this.popup.child("input[atype=field.minute]");this.secondSpan=this.popup.child("input[atype=field.second]")},processListener:function(a){$A.DateTimePicker.superclass.processListener.call(this,a);this.hourSpan[a]("focus",this.onDateFocus,this);this.hourSpan[a]("blur",this.onDateBlur,this);this.hourSpan[a]("keydown",this.onDateKeyDown,this);this.hourSpan[a]("keyup",this.onDateKeyUp,this);this.minuteSpan[a]("focus",this.onDateFocus,this);this.minuteSpan[a]("blur",this.onDateBlur,this);this.minuteSpan[a]("keydown",this.onDateKeyDown,this);this.minuteSpan[a]("keyup",this.onDateKeyUp,this);this.secondSpan[a]("focus",this.onDateFocus,this);this.secondSpan[a]("blur",this.onDateBlur,this);this.secondSpan[a]("keydown",this.onDateKeyDown,this);this.secondSpan[a]("keyup",this.onDateKeyUp,this)},onDateKeyDown:function(b){var d=b.keyCode,a=b.target;if(d==13){a.blur()}else{if(d==27){a.value=a.oldValue||"";a.blur()}else{if(d!=8&&d!=9&&d!=37&&d!=39&&d!=46&&(d<48||d>57||b.shiftKey)){b.stopEvent();return}}}},onDateKeyUp:function(d){var f=d.keyCode,b=d.target;if(f!=8&&f!=9&&f!=37&&f!=39&&f!=46&&(f<48||f>57||d.shiftKey)){d.stopEvent();return}else{if(this.value&&this.value instanceof Date){var a=new Date(this.value.getTime());this.processDate(a);this.setValue(a);this.fireEvent("select",this,a)}}},onDateFocus:function(a){Ext.fly(a.target.parentNode).addClass("item-dateField-input-focus");a.target.select()},onDateBlur:function(b){var a=b.target;Ext.fly(a.parentNode).removeClass("item-dateField-input-focus");if(!a.value.match(/^[0-9]*$/)){a.value=a.oldValue||""}else{this.draw(new Date(this.dateFields[0].year,this.dateFields[0].month-1,1,this.hourSpan.dom.value,this.minuteSpan.dom.value,this.secondSpan.dom.value))}},predraw:function(a,b){$A.DateTimePicker.superclass.predraw.call(this,a,b);this.hourSpan.dom.oldValue=this.hourSpan.dom.value=$A.dateFormat.pad(this.dateFields[0].hours);this.minuteSpan.dom.oldValue=this.minuteSpan.dom.value=$A.dateFormat.pad(this.dateFields[0].minutes);this.secondSpan.dom.oldValue=this.secondSpan.dom.value=$A.dateFormat.pad(this.dateFields[0].seconds)},processDate:function(a){if(a){a.setHours((el=this.hourSpan.dom).value.match(/^[0-9]*$/)?el.value:el.oldValue);a.setMinutes((el=this.minuteSpan.dom).value.match(/^[0-9]*$/)?el.value:el.oldValue);a.setSeconds((el=this.secondSpan.dom).value.match(/^[0-9]*$/)?el.value:el.oldValue)}a.xtype="timestamp"}});$A.ToolBar=Ext.extend($A.Component,{constructor:function(a){$A.ToolBar.superclass.constructor.call(this,a)},initComponent:function(a){$A.ToolBar.superclass.initComponent.call(this,a)},initEvents:function(){$A.ToolBar.superclass.initEvents.call(this)}});$A.NavBar=Ext.extend($A.ToolBar,{constructor:function(a){$A.NavBar.superclass.constructor.call(this,a)},initComponent:function(c){$A.NavBar.superclass.initComponent.call(this,c);this.dataSet=$(this.dataSet);this.pageInput=$(this.inputId);this.currentPage=this.wrap.child("div[atype=currentPage]");this.pageInfo=this.wrap.child("div[atype=pageInfo]");this.navInfo=this.wrap.child("div[atype=displayInfo]");this.pageInput.setValue(1);if(this.comboBoxId){var b=[10,20,50,100];if(b.indexOf(this.dataSet.pagesize)==-1){b.unshift(this.dataSet.pagesize);b.sort(function(g,f){return g-f})}var a=[];while(Ext.isDefined(b[0])){var e=b.shift();a.push({code:e,name:e})}var d=new $A.DataSet({datas:a});this.pageSizeInput=$(this.comboBoxId);this.pageSizeInput.setOptions(d);this.pageSizeInput.setValue(this.dataSet.pagesize);this.pageSizeInfo=this.wrap.child("div[atype=pageSizeInfo]");this.pageSizeInfo2=this.wrap.child("div[atype=pageSizeInfo2]");this.pageSizeInfo.update(_lang["toolbar.pageSize"]);this.pageSizeInfo2.update(_lang["toolbar.pageSize2"])}this.currentPage.update(_lang["toolbar.ctPage"])},processListener:function(a){$A.NavBar.superclass.processListener.call(this,a);this.dataSet[a]("load",this.onLoad,this);this.pageInput[a]("keydown",this.onInputKeyPress,this);if(this.pageSizeInput){this.pageSizeInput[a]("select",this.onInputSelect,this)}},initEvents:function(){$A.NavBar.superclass.initEvents.call(this)},onLoad:function(){this.pageInput.setValue(this.dataSet.currentPage);this.pageInfo.update(_lang["toolbar.total"]+this.dataSet.totalPage+_lang["toolbar.page"]);this.navInfo.update(this.creatNavInfo())},creatNavInfo:function(){var b=((this.dataSet.currentPage-1)*this.dataSet.pagesize+1);var a=this.dataSet.currentPage*this.dataSet.pagesize;if(a>this.dataSet.totalCount){a=this.dataSet.totalCount}if(a==0){b=0}return _lang["toolbar.visible"]+b+" - "+a+" "+_lang["toolbar.total"]+this.dataSet.totalCount+_lang["toolbar.item"]},onInputKeyPress:function(a,c){if(c.keyCode==13){var b=parseInt(a.getRawValue());if(isNaN(b)){a.setValue(this.dataSet.currentPage)}else{if(b>0&&b<=this.dataSet.totalPage){this.dataSet.goPage(b)}else{a.setValue(this.dataSet.currentPage)}}}},onInputSelect:function(b,a){this.dataSet.pagesize=a;this.dataSet.query()}});$A.WindowManager=function(){return{put:function(a){if(!this.cache){this.cache=[]}this.cache.add(a)},getAll:function(){return this.cache},remove:function(a){this.cache.remove(a)},get:function(c){if(!this.cache){return null}var b=null;for(var a=0;a<this.cache.length;a++){if(this.cache[a].id==c){b=this.cache[a];break}}return b},getZindex:function(){var c=40;var d=this.getAll();for(var b=0;b<d.length;b++){var e=d[b];var a=e.wrap.getStyle("z-index");if(a=="auto"){a=0}if(a>c){c=a}}return c}}}();$A.Window=Ext.extend($A.Component,{constructor:function(a){if($A.WindowManager.get(a.id)){return}this.draggable=true;this.closeable=true;this.fullScreen=false;this.modal=a.modal||true;this.cmps={};$A.focusWindow=null;$A.Window.superclass.constructor.call(this,a)},initComponent:function(b){$A.Window.superclass.initComponent.call(this,b);var d=this;$A.WindowManager.put(d);var a=new Ext.Template(d.getTemplate());var c=new Ext.Template(d.getShadowTemplate());d.width=1*(d.width||350);d.height=1*(d.height||400);if(d.fullScreen){d.width=$A.getViewportWidth()-(Ext.isIE||!d.hasVScrollBar()?0:17)-(Ext.isIE8?1:0);d.height=$A.getViewportHeight()-(Ext.isIE||!d.hasHScrollBar()?26:43);d.draggable=false;d.marginheight=1;d.marginwidth=1}d.wrap=a.insertFirst(document.body,{title:d.title,width:d.width,bodywidth:d.width-2,height:d.height},true);d.shadow=c.insertFirst(document.body,{},true);d.focusEl=d.wrap.child("a[atype=win.focus]");d.title=d.wrap.child("div[atype=window.title]");d.head=d.wrap.child("td[atype=window.head]");d.body=d.wrap.child("div[atype=window.body]");d.closeBtn=d.wrap.child("div[atype=window.close]");if(d.draggable){d.initDraggable()}if(!d.closeable){d.closeBtn.hide()}d.center();if(d.url){d.showLoading();d.load(d.url,d.params)}},processListener:function(a){$A.Window.superclass.processListener.call(this,a);if(this.closeable){this.closeBtn[a]("click",this.onCloseClick,this);this.closeBtn[a]("mouseover",this.onCloseOver,this);this.closeBtn[a]("mouseout",this.onCloseOut,this);this.closeBtn[a]("mousedown",this.onCloseDown,this)}this.wrap[a]("click",this.toFront,this);this.focusEl[a]("keydown",this.handleKeyDown,this);if(this.draggable){this.head[a]("mousedown",this.onMouseDown,this)}},initEvents:function(){$A.Window.superclass.initEvents.call(this);this.addEvents("close","load")},handleKeyDown:function(b){b.stopEvent();var a=b.getKey();if(a==27){this.close()}},initDraggable:function(){this.head.addClass("item-draggable")},focus:function(){this.focusEl.focus()},center:function(){var d=$A.getViewportWidth();var f=$A.getViewportHeight();var b=document[Ext.isStrict?"documentElement":"body"].scrollLeft;var c=document[Ext.isStrict?"documentElement":"body"].scrollTop;var a=b+Math.max((d-this.width)/2,0);var e=c+Math.max((f-this.height-(Ext.isIE?26:23))/2,0);this.shadow.setWidth(this.wrap.getWidth());this.shadow.setHeight(this.wrap.getHeight());if(this.fullScreen){a=b;e=c;this.shadow.moveTo(a,e)}else{this.shadow.moveTo(a+3,e+3)}this.wrap.moveTo(a,e);this.toFront();this.focus.defer(10,this)},hasVScrollBar:function(){var a=document[Ext.isStrict?"documentElement":"body"];return a.scrollTop>0||a.scrollHeight>a.clientHeight},hasHScrollBar:function(){var a=document[Ext.isStrict?"documentElement":"body"];return a.scrollLeft>0||a.scrollWidth>a.clientWidth},getShadowTemplate:function(){return['<DIV class="item-shadow"></DIV>']},getTemplate:function(){return['<TABLE class="win-wrap" style="width:{width}px;" cellSpacing="0" cellPadding="0" border="0">',"<TBODY>",'<TR style="height:23px;" >','<TD class="win-caption">','<TABLE cellSpacing="0" unselectable="on"  onselectstart="return false;" style="height:23px;-moz-user-select:none;"  cellPadding="0" width="100%" border="0" unselectable="on">',"<TBODY>","<TR>",'<TD unselectable="on" class="win-caption-label" atype="window.head" width="99%">','<A atype="win.focus" href="#" class="win-fs" tabIndex="-1"></A><DIV unselectable="on" atype="window.title" unselectable="on">{title}</DIV>',"</TD>",'<TD unselectable="on" class="win-caption-button" noWrap>','<DIV class="win-close" atype="window.close" unselectable="on"></DIV>',"</TD>",'<TD><DIV style="width:5px;"/></TD>',"</TR>","</TBODY>","</TABLE>","</TD>","</TR>",'<TR style="height:{height}px">','<TD class="win-body" vAlign="top" unselectable="on">','<DIV class="win-content" atype="window.body" style="position:relatvie;width:{bodywidth}px;height:{height}px;" unselectable="on"></DIV>',"</TD>","</TR>","</TBODY>","</TABLE>"]},toFront:function(){var b=this.wrap.getStyle("z-index");var a=$A.WindowManager.getZindex();if(b=="auto"){b=0}if(b<a){this.wrap.setStyle("z-index",a+5);this.shadow.setStyle("z-index",a+4);if(this.modal){$A.Cover.cover(this.wrap)}}$A.focusWindow=this},onMouseDown:function(c){var a=this;a.toFront();a.focus();var b=a.wrap.getXY();a.relativeX=b[0]-c.getPageX();a.relativeY=b[1]-c.getPageY();a.screenWidth=$A.getViewportWidth();a.screenHeight=$A.getViewportHeight();if(!this.proxy){this.initProxy()}this.proxy.show();Ext.get(document.documentElement).on("mousemove",a.onMouseMove,a);Ext.get(document.documentElement).on("mouseup",a.onMouseUp,a)},onMouseUp:function(b){var a=this;Ext.get(document.documentElement).un("mousemove",a.onMouseMove,a);Ext.get(document.documentElement).un("mouseup",a.onMouseUp,a);if(a.proxy){a.wrap.moveTo(a.proxy.getX(),a.proxy.getY());a.shadow.moveTo(a.proxy.getX()+3,a.proxy.getY()+3);a.proxy.hide()}},onMouseMove:function(h){h.stopEvent();var c=document[Ext.isStrict?"documentElement":"body"].scrollLeft;var f=document[Ext.isStrict?"documentElement":"body"].scrollTop;var b=c+this.screenWidth;var g=f+this.screenHeight;var d=h.getPageX()+this.relativeX;var a=h.getPageY()+this.relativeY;if(d<=c){d=c}if((d+this.width)>=(b-3)){d=b-this.width-3}if(a<=f){a=f}if((a+this.height)>=(g-30)){a=Math.max(g-this.height-30,0)}this.proxy.moveTo(d,a)},showLoading:function(){this.body.update(_lang["window.loading"]);this.body.setStyle("text-align","center");this.body.setStyle("line-height",5)},clearLoading:function(){this.body.update("");this.body.setStyle("text-align","");this.body.setStyle("line-height","")},initProxy:function(){var a=this;var c='<DIV style="border:1px dashed black;Z-INDEX: 10000; LEFT: 0px; WIDTH: 100%; CURSOR: default; POSITION: absolute; TOP: 0px; HEIGHT: 621px;" unselectable="on"></DIV>';a.proxy=Ext.get(Ext.DomHelper.insertFirst(Ext.getBody(),c));var b=a.wrap.getXY();a.proxy.setWidth(a.wrap.getWidth());a.proxy.setHeight(a.wrap.getHeight());a.proxy.setLocation(b[0],b[1])},onCloseClick:function(a){a.stopEvent();this.close()},onCloseOver:function(a){this.closeBtn.addClass("win-btn-over")},onCloseOut:function(a){this.closeBtn.removeClass("win-btn-over")},onCloseDown:function(a){this.closeBtn.removeClass("win-btn-over");this.closeBtn.addClass("win-btn-down");Ext.get(document.documentElement).on("mouseup",this.onCloseUp,this)},onCloseUp:function(a){this.closeBtn.removeClass("win-btn-down");Ext.get(document.documentElement).un("mouseup",this.onCloseUp,this)},close:function(){$A.WindowManager.remove(this);this.destroy();this.fireEvent("close",this)},destroy:function(){$A.focusWindow=null;var a=this.wrap;if(!a){return}if(this.proxy){this.proxy.remove()}if(this.modal){$A.Cover.uncover(this.wrap)}$A.Window.superclass.destroy.call(this);delete this.title;delete this.head;delete this.body;delete this.closeBtn;delete this.proxy;a.remove();this.shadow.remove();var b=this;setTimeout(function(){for(var c in b.cmps){var d=b.cmps[c];if(d.destroy){try{d.destroy()}catch(f){alert("销毁window出错: "+f)}}}},10)},load:function(a,b){Ext.Ajax.request({url:a,params:b||{},success:this.onLoad.createDelegate(this)})},setChildzindex:function(b){for(var a in this.cmps){var d=this.cmps[a];d.setZindex(b)}},setWidth:function(a){a=$A.getViewportWidth()-(Ext.isIE||!this.hasVScrollBar()?0:17)-(Ext.isIE8?1:0);$A.Window.superclass.setWidth.call(this,a);this.body.setWidth(a-2);this.shadow.setWidth(this.wrap.getWidth())},setHeight:function(c){c=$A.getViewportHeight()-(Ext.isIE||!this.hasHScrollBar()?26:43);Ext.fly(this.body.dom.parentNode.parentNode).setHeight(c);this.body.setHeight(c);this.shadow.setHeight(this.wrap.getHeight());var a=document[Ext.isStrict?"documentElement":"body"].scrollLeft;var b=document[Ext.isStrict?"documentElement":"body"].scrollTop;this.shadow.moveTo(a,b);this.wrap.moveTo(a,b)},onLoad:function(a,c){if(!this.body){return}this.clearLoading();var f=a.responseText;var d;try{d=Ext.decode(a.responseText)}catch(l){}if(d&&d.success==false){if(d.error){$A.manager.fireEvent("ajaxfailed",$A.manager,c.url,c.para,d);var b=d.error.stackTrace;b=(b)?b.replaceAll("\r\n","</br>"):"";if(d.error.message){var g=(b=="")?150:250;$A.showErrorMessage(_lang["window.error"],d.error.message+"</br>"+b,null,400,g)}else{$A.showErrorMessage(_lang["window.error"],b,null,400,250)}}return}var i=this;this.body.update(f,true,function(){i.fireEvent("load",i)})}});$A.showMessage=function(d,c,e,b,a){return $A.showTypeMessage(d,c,b||300,a||100,"win-info",e)};$A.showWarningMessage=function(d,c,e,b,a){return $A.showTypeMessage(d,c,b||300,a||100,"win-warning",e)};$A.showInfoMessage=function(d,c,e,b,a){return $A.showTypeMessage(d,c,b||300,a||100,"win-info",e)};$A.showErrorMessage=function(d,c,e,b,a){return $A.showTypeMessage(d,c,b||300,a||100,"win-error",e)};$A.showTypeMessage=function(e,d,c,a,b,f){var d='<div class="win-icon '+b+'"><div class="win-type" style="width:'+(c-60)+"px;height:"+(a-58)+'px;">'+d+"</div></div>";return $A.showOkWindow(e,d,c,a,f)};$A.showConfirm=function(f,e,c,d,b,a){b=b||300;a=a||100;var e='<div class="win-icon win-question"><div class="win-type" style="width:'+(b-60)+"px;height:"+(a-58)+'px;">'+e+"</div></div>";return $A.showOkCancelWindow(f,e,c,d,b,a)};$A.showOkCancelWindow=function(h,c,a,d,b,i){var g=$A.CmpManager.get("aurora-msg-ok-cancel");if(g==null){var f=$A.Button.getTemplate("aurora-msg-ok",_lang["window.button.ok"]);var e=$A.Button.getTemplate("aurora-msg-cancel",_lang["window.button.cancel"]);g=new $A.Window({id:"aurora-msg-ok-cancel",title:h,height:i||100,width:b||300});if(c){g.body.update(c+'<center><table cellspacing="5"><tr><td>'+f+"</td><td>"+e+"</td><tr></table></center>",true,function(){var m=$("aurora-msg-ok");var l=$("aurora-msg-cancel");g.cmps["aurora-msg-ok"]=m;g.cmps["aurora-msg-cancel"]=l;m.on("click",function(){if(a){a.call(this,g)}});l.on("click",function(){g.close();if(d){d.call(this,g)}})})}}return g};$A.showOkWindow=function(f,e,c,a,g){var d=$A.CmpManager.get("aurora-msg-ok");if(d==null){var b=$A.Button.getTemplate("aurora-msg-yes",_lang["window.button.ok"]);d=new $A.Window({id:"aurora-msg-ok",title:f,height:a,width:c});if(e){d.body.update(e+"<center>"+b+"</center>",true,function(){var h=$("aurora-msg-yes");d.cmps["aurora-msg-yes"]=h;h.on("click",function(){if(g){g.call(this,d)}d.close()});h.focus.defer(10,h)})}}return d};$A.showUploadWindow=function(d,f,b,e,c,a,g){new Aurora.Window({id:"upload_window",url:d+"/upload.screen?callback="+g+"&pkvalue="+e+"&source_type="+b+"&max_size="+(c||0)+"&file_type="+(a||"*.*"),title:f||_lang["window.upload.title"],height:330,width:595})};$A.Lov=Ext.extend($A.TextField,{constructor:function(a){this.isWinOpen=false;this.fetching=false;this.fetchremote=true;this.context=a.context||"";$A.Lov.superclass.constructor.call(this,a)},initComponent:function(a){$A.Lov.superclass.initComponent.call(this,a);this.para={};if(!Ext.isEmpty(this.lovurl)){this.lovurl=this.processParmater(this.lovurl)}else{if(!Ext.isEmpty(this.lovservice)){this.lovservice=this.processParmater(this.lovservice)}else{if(!Ext.isEmpty(this.lovmodel)){this.lovmodel=this.processParmater(this.lovmodel)}}}this.trigger=this.wrap.child("div[atype=triggerfield.trigger]")},processParmater:function(b){var a=b.indexOf("?");if(a!=-1){this.para=Ext.urlDecode(b.substring(a+1,b.length));return b.substring(0,a)}return b},processListener:function(a){$A.Lov.superclass.processListener.call(this,a);this.trigger[a]("click",this.onTriggerClick,this,{preventDefault:true})},initEvents:function(){$A.Lov.superclass.initEvents.call(this);this.addEvents("commit")},onTriggerClick:function(a){a.stopEvent();this.showLovWindow()},destroy:function(){$A.Lov.superclass.destroy.call(this)},setWidth:function(a){this.wrap.setStyle("width",(a+3)+"px");this.el.setStyle("width",(a-20)+"px")},onChange:function(a){if(this.fetchremote==true){this.fetchRecord()}},canHide:function(){return this.isWinOpen==false},commit:function(e,b){if(this.win){this.win.close()}var a=b?b:this.record;if(a){var c=this.getMapping();for(var d=0;d<c.length;d++){var f=c[d];a.set(f.to,e.get(f.from)||"")}}this.fireEvent("commit",this,a,e)},getMapping:function(){var a;if(this.record){var b=this.record.getMeta().getField(this.binder.name);if(b){a=b.get("mapping")}}return a?a:[{from:this.binder.name,to:this.binder.name}]},onWinClose:function(){this.isWinOpen=false;this.win=null;if(!Ext.isIE6&&!Ext.isIE7){this.focus()}},getLovPara:function(){var a=Ext.apply({},this.para);var c;if(this.record){c=this.record.getMeta().getField(this.binder.name)}if(c){var b=c.get("lovpara");if(b){Ext.apply(a,b)}}return a},fetchRecord:function(){if(this.readonly==true){return}if(!Ext.isEmpty(this.lovurl)){return}this.fetching=true;var b=this.getRawValue();if(!Ext.isEmpty(this.lovservice)){url=this.context+"sys_lov.svc?svc="+this.lovservice+"&pagesize=1&pagenum=1&_fetchall=false&_autocount=false&"+Ext.urlEncode(this.getLovPara())}else{if(!Ext.isEmpty(this.lovmodel)){url=this.context+"autocrud/"+this.lovmodel+"/query?pagesize=1&pagenum=1&_fetchall=false&_autocount=false&"+Ext.urlEncode(this.getLovPara())}}var a=this.record;a.isReady=false;var f={};var c=this.getMapping();for(var d=0;d<c.length;d++){var e=c[d];if(this.binder.name==e.to){f[e.from]=b}a.set(e.to,"")}$A.slideBarEnable=$A.SideBar.enable;$A.SideBar.enable=false;this.setRawValue(_lang["lov.query"]);$A.request({url:url,para:f,success:function(h){var i=new $A.Record({});if(h.result.record){var g=[].concat(h.result.record);if(g.length>0){var l=g[0];i=new $A.Record(l)}}this.fetching=false;this.commit(i,a);a.isReady=true;$A.SideBar.enable=$A.slideBarEnable},error:this.onFetchFailed,scope:this})},onFetchFailed:function(a){this.fetching=false;$A.SideBar.enable=$A.slideBarEnable},showLovWindow:function(){if(this.fetching||this.isWinOpen||this.readonly){return}var a=this.getRawValue();this.blur();var b;if(!Ext.isEmpty(this.lovurl)){b=this.lovurl+"?"+Ext.urlEncode(this.getLovPara())+"&"}else{if(!Ext.isEmpty(this.lovservice)){b=this.context+"sys_lov.screen?url="+encodeURIComponent(this.context+"sys_lov.svc?svc="+this.lovservice+"&"+Ext.urlEncode(this.getLovPara()))+"&service="+this.lovservice+"&"}else{if(!Ext.isEmpty(this.lovmodel)){b=this.context+"sys_lov.screen?url="+encodeURIComponent(this.context+"autocrud/"+this.lovmodel+"/query?"+Ext.urlEncode(this.getLovPara()))+"&service="+this.lovmodel+"&"}}}if(b){this.isWinOpen=true;this.win=new $A.Window({title:this.title||"Lov",url:b+"lovid="+this.id+"&key="+encodeURIComponent(a)+"&gridheight="+(this.lovgridheight||350)+"&innerwidth="+((this.lovwidth||400)-30),height:this.lovheight||400,width:this.lovwidth||400});this.win.on("close",this.onWinClose,this)}}});$A.MultiLov=Ext.extend($A.Lov,{constructor:function(a){this.quote="'";this.localvalues=[];$A.MultiLov.superclass.constructor.call(this,a)},processListener:function(a){$A.MultiLov.superclass.processListener.call(this,a);this.el[a]("click",this.onClick,this)},initEvents:function(){$A.MultiLov.superclass.initEvents.call(this)},onChange:function(a){},onClick:function(f){var h=this.getCursortPosition();var d=this.getRawValue();var c=d.split(";");var g=0;for(var b=0;b<c.length;b++){var a=g+c[b].length+1;if(h>g&&h<a){if(this.start!=g||this.end!=a){this.select(g,a);if(Ext.isGecko||Ext.isOpera){this.start=g;this.end=a}}else{this.start=this.end=0}break}else{g+=c[b].length+1}}},commit:function(f,d){if(this.win){this.win.close()}var a=d?d:this.record;if(a){this.optionDataSet=f;var c=f.getAll(),g="";for(var e=0;e<c.length;e++){if(c[e].get(this.valuefield)){var b=c[e].get(this.valuefield);g+=this.quote+b+this.quote;if(e!=c.length-1){g+=","}}}a.set(this.binder.name,g)}this.fireEvent("commit",this,a,c)},getCursortPosition:function(){var b=0;if(document.selection){this.el.focus();var a=document.selection.createRange();a.moveStart("character",-this.el.dom.value.length);b=a.text.length}else{if(this.el.dom.selectionStart||this.el.dom.selectionStart=="0"){b=this.el.dom.selectionStart}}return b},processValue:function(d){this.localvalues=[];if(this.optionDataSet){this.optionDataSet.removeAll()}if(!d){return""}var c=d.split(";"),g="",b=[];for(var e=0;e<c.length;e++){var f=c[e].trim();if(f||f=="0"){var a=this.getRecordByDisplay(f);if(a){f=a.get(this.valuefield);b.add(a)}else{this.localvalues.add(f)}g+=this.quote+f+this.quote+","}}for(var e=0;e<b.length;e++){this.optionDataSet.add(b[e])}return g.match(/,$/)?g.slice(0,g.length-1):g},getRecordByDisplay:function(b){if(!this.optionDataSet){return null}var a=this.optionDataSet.getAll();for(var c=0;c<a.length;c++){var e=a[c].get(this.displayfield);if(e==b){return a[c]}}return null},formatValue:function(b){var d="";if(this.optionDataSet){var a=this.optionDataSet.getAll();for(var c=0;c<a.length;c++){d+=a[c].get(this.displayfield)+";"}}for(var c=0;c<this.localvalues.length;c++){d+=this.localvalues[c]+";"}return d},showLovWindow:function(){if(this.fetching||this.isWinOpen||this.readonly){return}var a=this.getRawValue();this.blur();var b;if(!Ext.isEmpty(this.lovurl)){b=this.lovurl+"?"+Ext.urlEncode(this.getLovPara())+"&"}else{if(!Ext.isEmpty(this.lovservice)){b=this.context+"sys_multiLov.screen?url="+encodeURIComponent(this.context+"sys_lov.svc?svc="+this.lovservice+"&"+Ext.urlEncode(this.getLovPara()))+"&service="+this.lovservice+"&"}else{if(!Ext.isEmpty(this.lovmodel)){b=this.context+"sys_multiLov.screen?url="+encodeURIComponent(this.context+"autocrud/"+this.lovmodel+"/query?"+Ext.urlEncode(this.getLovPara()))+"&service="+this.lovmodel+"&"}}}if(b){this.isWinOpen=true;this.win=new $A.Window({title:this.title||"Lov",url:b+"lovid="+this.id+"&key="+encodeURIComponent(a)+"&gridheight="+(this.lovgridheight||350)+"&innerwidth="+((this.lovwidth||400)-30)+"&innergridwidth="+Math.round(((this.lovwidth||400)-90)/2),height:this.lovheight||400,width:this.lovwidth||400});this.win.on("close",this.onWinClose,this)}}});$A.TextArea=Ext.extend($A.Field,{constructor:function(a){$A.TextArea.superclass.constructor.call(this,a)},initComponent:function(a){$A.TextArea.superclass.initComponent.call(this,a)},initEvents:function(){$A.TextArea.superclass.initEvents.call(this)},initElements:function(){this.el=this.wrap},onKeyDown:function(a){}});