$A=Aurora={version:"1.0"};$A.fireWindowResize=function(){$A.Mask.resizeMask()};Ext.fly(window).on("resize",$A.fireWindowResize,this);$A.cache={};$A.cmps={};$A.setTheme=function(a){if(a){var b=new Date();b.setTime(b.getTime()+24*3600*1000);document.cookie="app_theme="+escape(a)+";expires="+b.toGMTString();window.location.reload()}};$A.CmpManager=function(){return{put:function(b,a){if(!this.cache){this.cache={}}if(this.cache[b]!=null){alert("错误: ID为' "+b+" '的组件已经存在!");return}this.cache[b]=a;a.on("mouseover",$A.CmpManager.onCmpOver,$A.CmpManager);a.on("mouseout",$A.CmpManager.onCmpOut,$A.CmpManager)},onCmpOver:function(d,g){if($A.validInfoType!="tip"){return}if(d instanceof $A.Grid){var f=d.dataset;if(!f||f.isValid==true){return}if(Ext.fly(g.target).hasClass("grid-cell")){var c=Ext.fly(g.target).getAttributeNS("","recordid");var a=f.findById(c);var b=Ext.fly(g.target).getAttributeNS("","dataindex");var h=a.valid[b];if(h===true){return}$A.ToolTip.show(g.target,h)}}else{if(d.binder){var f=d.binder.ds;if(!f||f.isValid==true){return}var a=d.record;if(!a){return}var h=a.valid[d.binder.name];if(h===true){return}$A.ToolTip.show(d.id,h)}}},onCmpOut:function(a,b){if($A.validInfoType!="tip"){return}$A.ToolTip.hide()},getAll:function(){return this.cache},remove:function(b){var a=this.cache[b];a.un("mouseover",$A.CmpManager.onCmpOver,$A.CmpManager);a.un("mouseout",$A.CmpManager.onCmpOut,$A.CmpManager);delete this.cache[b]},get:function(a){if(!this.cache){return null}return this.cache[a]}}}();Ext.Ajax.on("requestexception",function(f,c,e){$A.manager.fireEvent("ajaxerror",$A.manager,c.status,c);if($A.logWindow){var a=$("HTTPWATCH_DATASET").getCurrentRecord();var d=$A._startTime;var b=new Date();a.set("spend",b-d);a.set("status",c.status);a.set("result",c.statusText);a.set("response",c.statusText)}switch(c.status){case 404:$A.showMessage("错误",'状态 404: 未找到"'+c.statusText+'"');break;default:$A.showMessage("错误","状态 "+c.status+" 服务器端错误!");break}},this);$=$A.getCmp=function(b){var a=$A.CmpManager.get(b);if(a==null){alert("未找到组件:"+b)}return a};$A.getViewportHeight=function(){if(Ext.isIE){return Ext.isStrict?document.documentElement.clientHeight:document.body.clientHeight}else{return self.innerHeight}};$A.getViewportWidth=function(){if(Ext.isIE){return Ext.isStrict?document.documentElement.clientWidth:document.body.clientWidth}else{return self.innerWidth}};$A.request=function(c,a,e,b,d){$A.manager.fireEvent("ajaxstart",c,a);if($A.logWindow){$A._startTime=new Date();$("HTTPWATCH_DATASET").create({url:c,request:Ext.util.JSON.encode({parameter:a})})}Ext.Ajax.request({url:c,method:"POST",params:{_request_data:Ext.util.JSON.encode({parameter:a})},success:function(h){if($A.logWindow){var i=$A._startTime;var g=new Date();var f=$("HTTPWATCH_DATASET").getCurrentRecord();f.set("spend",g-i);f.set("result",h.statusText);f.set("status",h.status);f.set("response",h.responseText)}$A.manager.fireEvent("ajaxcomplete",c,a,h);if(h&&h.responseText){var l=null;try{l=Ext.decode(h.responseText)}catch(m){$A.showMessage("错误","返回格式不正确!")}if(l&&!l.success){$A.manager.fireEvent("ajaxfailed",$A.manager,c,a,l);if(l.error){if(b){b.call(d,l)}}}else{$A.manager.fireEvent("ajaxsuccess",$A.manager,c,a,l);if(e){e.call(d,l)}}}},scope:d})};Ext.applyIf(String.prototype,{trim:function(){return this.replace(/(^\s*)|(\s*$)/g,"")}});Ext.applyIf(Array.prototype,{add:function(a){if(this.indexOf(a)==-1){this[this.length]=a}}});$A.TextMetrics=function(){var a;return{measure:function(b,c,d){if(!a){a=$A.TextMetrics.Instance(b,d)}a.bind(b);a.setFixedWidth(d||"auto");return a.getSize(c)}}}();$A.TextMetrics.Instance=function(b,d){var c=new Ext.Element(document.createElement("div"));document.body.appendChild(c.dom);c.position("absolute");c.setLeft(-1000);c.setTop(-1000);c.hide();if(d){c.setWidth(d)}var a={getSize:function(f){c.update(f);var e=new Object();e.width=c.getWidth();e.height=c.getHeight();c.update("");return e},bind:function(h){var f=new Array("font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing");var e=f.length,l={};for(var g=0;g<e;g++){l[f[g]]=Ext.fly(h).getStyle(f[g])}c.setStyle(l)},setFixedWidth:function(e){c.setWidth(e)}};a.bind(b);return a};$A.ToolTip=function(){q={init:function(){var a=this;Ext.onReady(function(){var b=Ext.DomHelper.append(Ext.getBody(),{tag:"div",cls:"tip-wrap",children:[{tag:"div",cls:"tip-body"}]});var c=Ext.DomHelper.append(Ext.getBody(),{tag:"div",cls:"item-shadow"});a.tip=Ext.get(b);a.shadow=Ext.get(c);a.body=a.tip.first("div.tip-body")})},show:function(a,d){if(this.tip==null){this.init();return}this.tip.show();this.shadow.show();this.body.update(d);var c;if(typeof(a)=="string"){var b=$A.CmpManager.get(a);if(b){if(b.wrap){c=b.wrap}}}else{c=Ext.get(a)}this.shadow.setWidth(this.tip.getWidth());this.shadow.setHeight(this.tip.getHeight());this.correctPosition(c)},correctPosition:function(c){var b=$A.getViewportWidth();var a=c.getX()+c.getWidth()+5;var d=c.getX()+c.getWidth()+7;if(a+this.tip.getWidth()>b){a=c.getX()-this.tip.getWidth()-5;d=c.getX()-this.tip.getWidth()-3}this.tip.setX(a);this.tip.setY(c.getY());this.shadow.setX(d);this.shadow.setY(this.tip.getY()+2)},hide:function(){if(this.tip!=null){this.tip.hide()}if(this.shadow!=null){this.shadow.hide()}}};return q}();$A.Mask=function(){var a={container:{},mask:function(e){var c=Ext.isStrict?document.documentElement.scrollWidth:document.body.scrollWidth;var d=Ext.isStrict?document.documentElement.scrollHeight:document.body.scrollHeight;var f=Math.max(c,$A.getViewportWidth());var h=Math.max(d,$A.getViewportHeight());var g='<DIV class="aurora-mask" style="left:0px;top:0px;width:'+f+"px;height:"+h+'px;POSITION: absolute;FILTER: alpha(opacity=30);BACKGROUND-COLOR: #000000; opacity: 0.3; MozOpacity: 0.3" unselectable="on"></DIV>';var b=Ext.get(Ext.DomHelper.append(Ext.getBody(),g));b.setStyle("z-index",Ext.fly(e).getStyle("z-index")-1);$A.Mask.container[e.id]=b},unmask:function(c){var b=$A.Mask.container[c.id];if(b){Ext.fly(b).remove();$A.Mask.container[c.id]=null;delete $A.Mask.container[c.id]}},resizeMask:function(){var c=Ext.isStrict?document.documentElement.scrollWidth:document.body.scrollWidth;var d=Ext.isStrict?document.documentElement.scrollHeight:document.body.scrollHeight;var e=Math.max(c,$A.getViewportWidth());var f=Math.max(d,$A.getViewportHeight());for(key in $A.Mask.container){var b=$A.Mask.container[key];Ext.fly(b).setWidth(e);Ext.fly(b).setHeight(f)}}};return a}();Ext.Element.prototype.update=function(html,loadScripts,callback){if(typeof html=="undefined"){html=""}if(loadScripts!==true){this.dom.innerHTML=html;if(typeof callback=="function"){callback()}return this}var id=Ext.id();var dom=this.dom;html+='<span id="'+id+'"></span>';Ext.lib.Event.onAvailable(id,function(){var links=[];var scripts=[];var hd=document.getElementsByTagName("head")[0];for(var i=0;i<hd.childNodes.length;i++){var he=hd.childNodes[i];if(he.tagName=="LINK"){links.push(he.href)}else{if(he.tagName=="SCRIPT"){scripts.push(he.src)}}}var jsre=/(?:<script([^>]*)?>)((\n|\r|.)*?)(?:<\/script>)/ig;var jsSrcRe=/\ssrc=([\'\"])(.*?)\1/i;var cssre=/(?:<link([^>]*)?>)((\n|\r|.)*?)/ig;var cssHreRe=/\shref=([\'\"])(.*?)\1/i;var cssm;while(cssm=cssre.exec(html)){var attrs=cssm[1];var srcMatch=attrs?attrs.match(cssHreRe):false;if(srcMatch&&srcMatch[2]){var included=false;for(var i=0;i<links.length;i++){var link=links[i];if(link.indexOf(srcMatch[2])!=-1){included=true;break}}if(!included){var s=document.createElement("link");s.type="text/css";s.rel="stylesheet";s.href=srcMatch[2];hd.appendChild(s)}}}var match;var jslink=[];var jsscript=[];while(match=jsre.exec(html)){var attrs=match[1];var srcMatch=attrs?attrs.match(jsSrcRe):false;if(srcMatch&&srcMatch[2]){var included=false;for(var i=0;i<scripts.length;i++){var script=scripts[i];if(script.indexOf(srcMatch[2])!=-1){included=true;break}}if(!included){jslink[jslink.length]={src:srcMatch[2],type:"text/javascript"}}}else{if(match[2]&&match[2].length>0){jsscript[jsscript.length]=match[2]}}}var loaded=0;for(var i=0,l=jslink.length;i<l;i++){var js=jslink[i];var s=document.createElement("script");s.src=js.src;s.type=js.type;s[Ext.isIE?"onreadystatechange":"onload"]=function(){var isready=Ext.isIE?(!this.readyState||this.readyState=="loaded"||this.readyState=="complete"):true;if(isready){loaded++;if(loaded==jslink.length){for(j=0,k=jsscript.length;j<k;j++){var jst=jsscript[j];if(window.execScript){window.execScript(jst)}else{window.eval(jst)}}if(typeof callback=="function"){callback()}}}};hd.appendChild(s)}if(jslink.length==0){for(j=0,k=jsscript.length;j<k;j++){var jst=jsscript[j];if(window.execScript){window.execScript(jst)}else{window.eval(jst)}}if(typeof callback=="function"){callback()}}var el=document.getElementById(id);if(el){Ext.removeNode(el)}Ext.fly(dom).setStyle("display","block")});Ext.fly(dom).setStyle("display","none");dom.innerHTML=html.replace(/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/ig,"").replace(/(?:<link.*?>)((\n|\r|.)*?)/ig,"");return this};$A.parseDate=function(b){if(typeof b=="string"){if(b.indexOf(".0")!=-1){b=b.substr(0,b.length-2)}var a=b.match(/^ *(\d{4})-(\d{1,2})-(\d{1,2}) *$/);if(a&&a.length>3){return new Date(parseInt(a[1]),parseInt(a[2])-1,parseInt(a[3]))}a=b.match(/^ *(\d{4})-(\d{1,2})-(\d{1,2}) +(\d{1,2}):(\d{1,2}):(\d{1,2}) *$/);if(a&&a.length>6){return new Date(parseInt(a[1]),parseInt(a[2])-1,parseInt(a[3]),parseInt(a[4]),parseInt(a[5]),parseInt(a[6]))}}return null};Aurora.formateDate=function(a){if(!a){return""}if(a.getFullYear){return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()}else{return a}};Aurora.formateDateTime=function(a){if(!a){return""}if(a.getFullYear){return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()}else{return a}};$A.EventManager=Ext.extend(Ext.util.Observable,{constructor:function(){$A.EventManager.superclass.constructor.call(this);this.initEvents()},initEvents:function(){this.addEvents("ajaxerror","ajaxsuccess","ajaxfailed","ajaxstart","ajaxcomplete","valid","timeout")}});$A.manager=new $A.EventManager();$A.regEvent=function(b,a){$A.manager.on(b,a)};$A.validInfoType="area";$A.validInfoTypeObj="";$A.setValidInfoType=function(a,b){$A.validInfoType=a;$A.validInfoTypeObj=b};$A.invalidRecords={};$A.addInValidReocrd=function(f,a){var b=$A.invalidRecords[f];if(!b){$A.invalidRecords[f]=b=[]}var c=false;for(var d=0;d<b.length;d++){var e=b[d];if(e.id==a.id){c=true;break}}if(!c){b.add(a)}};$A.removeInvalidReocrd=function(e,a){var b=$A.invalidRecords[e];if(!b){return}for(var c=0;c<b.length;c++){var d=b[c];if(d.id==a.id){b.remove(d);break}}};$A.getInvalidRecords=function(a){var c=[];for(var d in $A.invalidRecords){var e=$A.CmpManager.get(d);if(e.pageid==a){var b=$A.invalidRecords[d];c=c.concat(b)}}return c};$A.isInValidReocrdEmpty=function(a){var e=true;for(var c in $A.invalidRecords){var d=$A.CmpManager.get(c);if(d.pageid==a){var b=$A.invalidRecords[c];if(b.length!=0){e=false;break}}}return e};$A.manager.on("valid",function(a,c,b){switch($A.validInfoType){case"area":$A.showValidTopMsg(c);break;case"message":$A.showValidWindowMsg(c);break}});$A.showValidWindowMsg=function(g){var f=$A.isInValidReocrdEmpty(g.pageid);if(f==true){if($A.validWindow){$A.validWindow.close()}}if(!$A.validWindow&&f==false){$A.validWindow=$A.showWindow("校验失败","",400,200);$A.validWindow.on("close",function(){$A.validWindow=null})}var h=[];var b=$A.getInvalidRecords(g.pageid);for(var d=0;d<b.length;d++){var e=b[d];var c=e.ds.data.indexOf(e)+1;h[h.length]='记录<a href="#" onclick="$(\''+e.ds.id+"').locate("+c+')">('+e.id+")</a>:";for(var a in e.valid){h[h.length]=e.valid[a]+";"}h[h.length]="<br/>"}if($A.validWindow){$A.validWindow.body.child("div").update(h.join(""))}};$A.pageids=[];$A.showValidTopMsg=function(b){var g=$A.isInValidReocrdEmpty(b.pageid);if(g==true){var l=Ext.get(b.pageid+"_msg");if(l){l.hide();l.setStyle("display","none");l.update("")}return}var e=$A.getInvalidRecords(b.pageid);var m=[];for(var f=0;f<e.length;f++){var a=e[f];var h=a.ds.data.indexOf(a)+1;m[m.length]='记录<a href="#" onclick="$(\''+a.ds.id+"').locate("+h+')">('+a.id+")</a>:";for(var c in a.valid){m[m.length]=a.valid[c]+";"}m[m.length]="<br/>"}var l=Ext.get(b.pageid+"_msg");if(l){l.update(m.join(""));l.show(true)}};Ext.get(document.documentElement).on("keydown",function(a){if(a.shiftKey&&a.keyCode==76){if(!$A.logWindow){$A.logWindow=new $A.Window({modal:false,url:"log.screen",title:"AjaxWatch",height:550,width:530});$A.logWindow.on("close",function(){delete $A.logWindow})}}});$A.AUTO_ID=1000;$A.DataSet=Ext.extend(Ext.util.Observable,{constructor:function(a){$A.DataSet.superclass.constructor.call(this);a=a||{};this.pageid=a.pageid;this.spara={};this.selected=[];this.pageSize=a.pageSize||10;this.submitUrl=a.submitUrl||"";this.queryUrl=a.queryUrl||"";this.fetchAll=a.fetchAll;this.selectable=a.selectable;this.selectionmodel=a.selectionmodel;this.autoCount=a.autoCount;this.loading=false;this.qpara={};this.fields={};this.resetConfig();this.id=a.id||Ext.id();$A.CmpManager.put(this.id,this);this.qds=a.queryDataSet==""?null:$(a.queryDataSet);if(this.qds!=null&&this.qds.getCurrentRecord()==null){this.qds.create()}this.initEvents();if(a.fields){this.initFields(a.fields)}if(a.datas&&a.datas.length!=0){this.loadData(a.datas)}if(a.autoQuery===true){this.query()}},destroy:function(){$A.CmpManager.remove(this.id);delete $A.invalidRecords[this.id]},reConfig:function(a){this.resetConfig();Ext.apply(this,a)},bind:function(a,b){if(this.fields[a]){alert("重复绑定 "+a);return}b.un("beforecreate",this.beforeCreate,this);b.un("add",this.bindDataSetPrototype,this);b.un("remove",this.bindDataSetPrototype,this);b.un("update",this.bindDataSetPrototype,this);b.un("clear",this.bindDataSetPrototype,this);b.un("load",this.bindDataSetPrototype,this);b.un("reject",this.bindDataSetPrototype,this);b.on("beforecreate",this.beforeCreate,this);b.on("add",this.bindDataSetPrototype,this);b.on("remove",this.bindDataSetPrototype,this);b.on("update",this.bindDataSetPrototype,this);b.on("clear",this.bindDataSetPrototype,this);b.on("load",this.bindDataSetPrototype,this);b.on("reject",this.bindDataSetPrototype,this);var c=new $A.Record.Field({name:a,type:"dataset",dataset:b});this.fields[c.name]=c},bindDataSetPrototype:function(a){var b=this.getCurrentRecord();if(!b){return}for(var c in this.fields){var e=this.fields[c];if(e.type=="dataset"){var d=e.pro.dataset;if(a===true){d.resetConfig()}b.data[e.name]=d.getConfig()}}},beforeCreate:function(c,a,b){if(this.data.length==0){this.create({},false);this.bindDataSetPrototype(true)}},resetConfig:function(){this.data=[];this.selected=[];this.gotoPage=1;this.currentPage=1;this.currentIndex=1;this.totalCount=0;this.totalPage=0;this.isValid=true},getConfig:function(){var a={};a.id=this.id;a.xtype="dataset";a.data=this.data;a.selected=this.selected;a.isValid=this.isValid;a.gotoPage=this.gotoPage;a.currentPage=this.currentPage;a.currentIndex=this.currentIndex;a.totalCount=this.totalCount;a.totalPage=this.totalPage;return a},initEvents:function(){this.addEvents("beforecreate","metachange","fieldchange","add","remove","update","clear","load","refresh","valid","indexchange","select","unselect","reject","submitsuccess","submitfailed")},initFields:function(b){for(var c=0,a=b.length;c<a;c++){var d=new $A.Record.Field(b[c]);this.fields[d.name]=d}},getField:function(a){return this.fields[a]},loadData:function(f,e){this.data=[];this.selected=[];if(e){this.totalCount=e}else{this.totalCount=f.length}this.totalPage=Math.ceil(this.totalCount/this.pageSize);for(var c=0,g=f.length;c<g;c++){var a=f[c].data||f[c];for(var l in this.fields){var h=this.fields[l];var b=h.getPropertity("datatype");switch(b){case"date":a[l]=$A.parseDate(a[l]);break;case"int":a[l]=parseInt(a[l]);break}}var d=new $A.Record(a,f[c].field);d.setDataSet(this);this.data.add(d)}if(this.sortInfo){this.sort()}this.fireEvent("load",this)},sort:function(a,b){},create:function(g,f){this.fireEvent("beforecreate",this);g=g||{};var a={};for(var c in this.fields){var h=this.fields[c];var e=h.getPropertity("defaultvalue");if(e&&!g[h.name]){a[h.name]=e}}var g=Ext.apply(g||{},a);var b=new $A.Record(g);this.add(b);var d=(this.currentPage-1)*this.pageSize+this.data.length;this.locate(d,true);return b},getNewRecrods:function(){var d=this.getAll();var e=[];for(var c=0,b=d.length;c<b;c++){var a=d[c];if(a.isNewRecord==true){e.add(a)}}return e},add:function(a){a.isNew=true;a.isNewRecord=true;a.setDataSet(this);var b=this.data.length;this.data.add(a);this.fireEvent("add",this,a,b)},getCurrentRecord:function(){if(this.data.length==0){return null}return this.data[this.currentIndex-(this.currentPage-1)*this.pageSize-1]},insert:function(c,b){b=[].concat(b);var e=this.data.splice(c,this.data.length);for(var d=0,a=b.length;d<a;d++){b[d].setDataSet(this);this.data.add(b[d])}this.data=this.data.concat(e);this.fireEvent("add",this,b,c)},remove:function(a){if(!a){a=this.getCurrentRecord()}if(!a){return}if(a.isNew){this.removeLocal(a)}else{this.removeRemote(a)}},removeRemote:function(b){if(this.submitUrl==""){return}var e=Ext.apply({},b.data);e._id=b.id;e._status="delete";var c=[e];for(var a=0;a<c.length;a++){c[a]=Ext.apply(c[a],this.spara)}if(c.length>0){$A.request(this.submitUrl,c,this.onRemoveSuccess,this.onSubmitFailed,this)}},onRemoveSuccess:function(c){if(c.result.record){var a=[].concat(c.result.record);for(var b=0;b<a.length;b++){var e=a[b];var d=this.findById(e._id);this.removeLocal(d)}}},removeLocal:function(a){$A.removeInvalidReocrd(this.id,a);var b=this.data.indexOf(a);if(b==-1){return}this.data.remove(a);this.selected.remove(a);if(this.data.length==0){this.removeAll();return}var c=this.currentIndex-(this.currentPage-1)*this.pageSize;if(c<0){return}if(c<=this.data.length){this.locate(this.currentIndex,true)}else{this.pre()}this.fireEvent("remove",this,a,b)},getAll:function(){return this.data},find:function(c,b){var a=null;this.each(function(d){var e=d.get(c);if(e==b){a=d;return false}},this);return a},findById:function(d){var c=null;for(var b=0,a=this.data.length;b<a;b++){if(this.data[b].id==d){c=this.data[b];break}}return c},removeAll:function(){this.currentIndex=1;this.data=[];this.selected=[];this.fireEvent("clear",this)},indexOf:function(a){return this.data.indexOf(a)},getAt:function(a){return this.data[a]},each:function(e,d){var b=[].concat(this.data);for(var c=0,a=b.length;c<a;c++){if(e.call(d||b[c],b[c],c,a)===false){break}}},processCurrentRow:function(){var b=this.getCurrentRecord();for(var a in this.fields){var d=this.fields[a];if(d.type=="dataset"){var c=d.pro.dataset;if(b&&b.data[d.name]){c.reConfig(b.data[d.name])}else{c.resetConfig()}c.fireEvent("refresh",c);c.processCurrentRow()}}if(b){this.fireEvent("indexchange",this,b)}},getSelected:function(){return this.selected},selectAll:function(){for(var b=0,a=this.data.length;b<a;b++){this.select(this.data[b])}},unSelectAll:function(){for(var b=0,a=this.data.length;b<a;b++){this.unSelect(this.data[b])}},select:function(a){if(typeof(a)=="string"){a=this.findById(a)}if(this.selectable&&this.selectionmodel=="multiple"){if(this.selected.indexOf(a)==-1){this.selected.add(a);this.fireEvent("select",this,a)}}else{if(this.selected.indexOf(a)==-1){var b=this.selected[0];this.unSelect(b);this.selected=[];this.selected.add(a);this.fireEvent("select",this,a)}}},unSelect:function(a){if(typeof(a)=="string"){a=this.findById(a)}if(this.selectable){if(this.selected.indexOf(a)!=-1){this.selected.remove(a);this.fireEvent("unselect",this,a)}}},locate:function(a,c){if(this.currentIndex==a&&c!==true){return}if(a<=0||(a>this.totalCount+this.getNewRecrods().length)){return}var b=a-(this.currentPage-1)*this.pageSize;if(this.data[b-1]){this.currentIndex=a}else{if(this.isModified()){$A.showMessage("提示","有未保存数据!")}else{this.currentIndex=a;this.currentPage=Math.ceil(a/this.pageSize);this.query(this.currentPage);return}}this.processCurrentRow()},goPage:function(b){if(b>0){this.gotoPage=b;var a=(b-1)*this.pageSize+this.getNewRecrods().length+1;this.locate(a)}},first:function(){this.locate(1)},pre:function(){this.locate(this.currentIndex-1)},next:function(){this.locate(this.currentIndex+1)},firstPage:function(){this.goPage(1)},prePage:function(){this.goPage(this.currentPage-1)},nextPage:function(){this.goPage(this.currentPage+1)},lastPage:function(){this.goPage(this.totalPage)},validate:function(b){this.isValid=true;var m=this.getCurrentRecord();var e=this.getAll();var s={};var i=false;var p=null;for(var g in this.fields){var o=this.fields[g];if(o.type=="dataset"){i=true;var n=o.pro.dataset;s[o.name]=n}}for(var g=0,f=e.length;g<f;g++){var h=e[g];if(h.dirty==true||h.isNew==true){if(!h.validateRecord()){this.isValid=false;p=h;$A.addInValidReocrd(this.id,h)}else{$A.removeInvalidReocrd(this.id,h)}if(this.isValid==false){if(i){break}}else{for(key in s){var c=s[key];c.reConfig(h.data[key]);if(!c.validate(false)){this.isValid=false;p=h}}if(this.isValid==false){break}}}}if(p!=null){var a=this.indexOf(p);if(a!=-1){this.locate(a+1)}}if(b!==false){$A.manager.fireEvent("valid",$A.manager,this,this.isValid)}return this.isValid},setQueryUrl:function(a){this.queryUrl=a},setQueryParameter:function(a,b){this.qpara[a]=b},setQueryDataSet:function(a){this.qds=a;if(this.qds.getCurrentRecord()==null){this.qds.create()}},setSubmitUrl:function(a){this.submitUrl=a},setSubmitParameter:function(a,b){this.spara[a]=b},query:function(e){var c;if(this.qds){if(this.qds.getCurrentRecord()==null){this.qds.create()}if(!this.qds.validate()){return}c=this.qds.getCurrentRecord()}if(!this.queryUrl){return}if(!e){this.currentIndex=1}this.currentPage=e||1;var d={};if(c!=null){Ext.apply(d,c.data)}Ext.apply(d,this.qpara);var a="pagesize="+this.pageSize+"&pagenum="+this.currentPage+"&_fecthall="+this.fetchAll+"&_autocount="+this.autoCount+"&_rootpath=list";var b="";if(this.queryUrl.indexOf("?")==-1){b=this.queryUrl+"?"+a}else{b=this.queryUrl+"&"+a}this.loading=true;$A.request(b,d,this.onLoadSuccess,this.onLoadFailed,this)},isModified:function(){var e=false;var d=this.getAll();for(var c=0,b=d.length;c<b;c++){var a=d[c];if(a.dirty==true||a.isNew==true){e=true;break}}return e},isDataModified:function(){var b=false;for(var c=0,a=this.data.length;c<a;c++){var d=this.data[c];if(d.dirty||d.isNew){b=true;break}}return b},getJsonData:function(){var g=[];for(var f=0,c=this.data.length;f<c;f++){var a=this.data[f];var m=a.dirty||a.isNew;var h=Ext.apply({},a.data);h._id=a.id;h._status=a.isNew?"new":"update";for(var e in a.data){var n=h[e];if(n&&n.xtype=="dataset"){var b=$(n.id);b.reConfig(n);m=m==false?b.isDataModified():m;h[e]=b.getJsonData()}}if(m){g.push(h)}}return g},submit:function(a){if(!this.validate()){return}this.submitUrl=a||this.submitUrl;if(this.submitUrl==""){return}var c=this.getJsonData();for(var b=0;b<c.length;b++){c[b]=Ext.apply(c[b],this.spara)}if(c.length>0){$A.request(this.submitUrl,c,this.onSubmitSuccess,this.onSubmitFailed,this)}},afterEdit:function(a,b,c){this.fireEvent("update",this,a,b,c)},afterReject:function(a){this.fireEvent("reject",this,a)},onSubmitSuccess:function(b){if(b.result.record){var a=[].concat(b.result.record);this.refreshRecord(a)}this.fireEvent("submitsuccess",this,b)},refreshRecord:function(n){for(var m=0,d=n.length;m<d;m++){var h=n[m];var a=this.findById(h._id);if(!a){return}for(var e in h){var s=e;if(!this.fields[e]){for(var g in this.fields){if(e.toLowerCase()==g.toLowerCase()){s=g}}}var o=this.fields[s];if(o&&o.type=="dataset"){var b=o.pro.dataset;if(a){b.reConfig(a.data[o.name])}if(h[e].record){b.refreshRecord([].concat(h[e].record))}}else{var c=a.get(s);var p=h[e];if(s=="_id"||s=="_status"||s=="__parameter_parsed__"){continue}if(o&&o.getPropertity("datatype")=="date"){p=$A.parseDate(p)}if(c!=p){a.set(s,p)}}}a.clear()}},onSubmitFailed:function(a){$A.showMessage("错误",a.error.message);this.fireEvent("submitfailed",this,a)},onLoadSuccess:function(e){if(e==null){return}if(!e.result.list.record){e.result.list.record=[]}var c=[].concat(e.result.list.record);var g=e.result.list.totalCount;var a=[];if(c.length>0){for(var d=0,b=c.length;d<b;d++){var f={data:c[d]};a.push(f)}}else{if(c.length==0){this.currentIndex=1}}this.loading=false;this.loadData(a,g);this.locate(this.currentIndex,true)},onLoadFailed:function(a){$A.showMessage("错误",a.error.message);this.loading=false},onFieldChange:function(a,d,b,c){this.fireEvent("fieldchange",this,a,d,b,c)},onMetaChange:function(a,d,b,c){this.fireEvent("metachange",this,a,d,b,c)},onRecordValid:function(a,b,c){this.fireEvent("valid",this,a,b,c)}});$A.Record=function(b,a){this.id=++$A.AUTO_ID;this.data=b;this.fields={};this.valid={};this.isValid=true;this.isNew=false;this.dirty=false;this.editing=false;this.modified=null;this.meta=new $A.Record.Meta(this);if(a){this.initFields(a)}};$A.Record.prototype={clear:function(){this.editing=false;this.valid={};this.isValid=true;this.isNew=false;this.dirty=false;this.modified=null},initFields:function(a){for(var c=0,b=a.length;c<b;c++){var d=new $A.Record.Field(a[c]);d.record=this;this.fields[d.name]=d}},validateRecord:function(){this.isValid=true;this.valid={};var f=this.ds.fields;var d=this.fields;var e=[];for(var b in f){e.add(b.toLowerCase())}for(var b in d){if(e.indexOf(b.toLowerCase())==-1){e.add(b.toLowerCase())}}for(var c=0,a=e.length;c<a;c++){if(this.isValid==true){this.isValid=this.validate(e[c])}else{this.validate(e[c])}}return this.isValid},validate:function(c){var e=true;var b=this.get(c);var f=this.getMeta().getField(c);if(!b&&f.get("required")==true){this.valid[c]=c+"不能为空";e=false}else{var d=f.snap.validator;var a=true;if(d){d=window[d];a=d.call(window,this,c,b);if(a!==true){e=false;this.valid[c]=a}}}if(e==true){delete this.valid[c]}this.ds.onRecordValid(this,c,e);return e},setDataSet:function(a){this.ds=a},getMeta:function(){return this.meta},set:function(a,b){if(this.data[a]==b){return}this.dirty=true;if(!this.modified){this.modified={}}if(typeof this.modified[a]=="undefined"){this.modified[a]=this.data[a]}this.data[a]=b;if(!this.editing&&this.ds){this.ds.afterEdit(this,a,b)}this.validate(a)},get:function(a){return this.data[a]},reject:function(b){var a=this.modified;for(var c in a){if(typeof a[c]!="function"){this.data[c]=a[c]}}delete this.modified;this.editing=false;if(this.dirty&&this.ds){this.ds.afterReject(this)}this.dirty=false},onFieldChange:function(a,b,c){var d=this.getMeta().getField(a);this.ds.onFieldChange(this,d,b,c)},onFieldClear:function(a){var b=this.getMeta().getField(a);this.ds.onFieldChange(this,b)},onMetaChange:function(c,a,b){this.ds.onMetaChange(this,c,a,b)},onMetaClear:function(a){this.ds.onMetaChange(this,a)}};$A.Record.Meta=function(a){this.record=a;this.pro={}};$A.Record.Meta.prototype={clear:function(){this.pro={};this.record.onMetaClear(this)},getField:function(a){var c=this.record.fields[a];var e=this.record.ds.fields[a];var b;if(!c){if(e){c=new $A.Record.Field({name:e.name,type:e.type})}else{c=new $A.Record.Field({name:a,type:"string"})}c.record=this.record;this.record.fields[c.name]=c}var d={};if(e){d=Ext.apply(d,e.pro)}d=Ext.apply(d,this.pro);d=Ext.apply(d,c.pro);delete d.name;delete d.type;c.snap=d;return c},setRequired:function(a){var b=this.pro.required;if(b!==a){this.pro.required=a;this.record.onMetaChange(this,"required",a)}},setReadOnly:function(a){var b=this.pro.readonly;if(b!==a){this.pro.readonly=a;this.record.onMetaChange(this,"readonly",a)}}};$A.Record.Field=function(a){this.name=a.name;this.type=a.type;this.pro=a||{};this.record};$A.Record.Field.prototype={clear:function(){this.pro={};this.record.onFieldClear(this.name)},setPropertity:function(b,a){var c=this.pro[a];if(c!==b){this.pro[a]=b;this.record.onFieldChange(this.name,a,b)}},get:function(b){var a=null;if(this.snap){a=this.snap[b]}return a},getPropertity:function(a){return this.pro[a]},setRequired:function(a){this.setPropertity(a,"required")},setReadOnly:function(a){this.setPropertity(a,"readonly")},setOptions:function(a){this.setPropertity(a,"options")},getOptions:function(){return this.getPropertity("options")}};$A.Component=Ext.extend(Ext.util.Observable,{constructor:function(a){$A.Component.superclass.constructor.call(this);this.id=a.id||Ext.id();$A.CmpManager.put(this.id,this);this.initConfig=a;this.isHidden=false;this.isFireEvent=false;this.initComponent(a);this.initEvents()},initComponent:function(a){a=a||{};Ext.apply(this,a);this.wrap=Ext.get(this.id)},processListener:function(a){this.wrap[a]("mouseover",this.onMouseOver,this);this.wrap[a]("mouseout",this.onMouseOut,this)},initEvents:function(){this.addEvents("focus","blur","change","invalid","valid","mouseover","mouseout");this.processListener("on")},isEventFromComponent:function(a){return this.wrap.contains(a)},move:function(a,b){this.wrap.setX(a);this.wrap.setY(b)},getBindName:function(){return this.binder?this.binder.name:null},getBindDataSet:function(){return this.binder?this.binder.ds:null},bind:function(c,b){this.clearBind();if(typeof(c)=="string"){c=$(c)}if(!c){return}this.binder={ds:c,name:b};this.record=c.getCurrentRecord();var d=c.fields[this.binder.name];if(d){var a={};Ext.apply(a,this.initConfig);Ext.apply(a,d.pro);delete a.name;delete a.type;this.initComponent(a)}c.on("metachange",this.onRefresh,this);c.on("valid",this.onValid,this);c.on("remove",this.onRemove,this);c.on("clear",this.onClear,this);c.on("update",this.onUpdate,this);c.on("fieldchange",this.onFieldChange,this);c.on("indexchange",this.onRefresh,this);this.onRefresh(c)},clearBind:function(){if(this.binder){var a=this.binder.ds;a.un("metachange",this.onRefresh,this);a.un("valid",this.onValid,this);a.un("remove",this.onRemove,this);a.un("clear",this.onClear,this);a.un("update",this.onUpdate,this);a.un("fieldchange",this.onFieldChange,this);a.un("indexchange",this.onRefresh,this)}this.binder=null;this.record=null},destroy:function(){this.processListener("un");$A.CmpManager.remove(this.id);this.clearBind();delete this.wrap},onMouseOver:function(a){this.fireEvent("mouseover",this,a)},onMouseOut:function(a){this.fireEvent("mouseout",this,a)},onRemove:function(b,a){if(this.binder.ds==b&&this.record==a){this.clearValue()}},onCreate:function(b,a){this.clearInvalid();this.record=b.getCurrentRecord();this.setValue("",true)},onRefresh:function(a){if(this.isFireEvent==true||this.isHidden==true){return}this.clearInvalid();this.rerender(a.getCurrentRecord())},rerender:function(a){this.record=a;if(this.record){var c=this.record.get(this.binder.name);var d=this.record.getMeta().getField(this.binder.name);var b={};Ext.apply(b,this.initConfig);Ext.apply(b,d.snap);this.initComponent(b);if(this.record.valid[this.binder.name]){this.markInvalid()}if(this.value==c){return}this.setValue(c,true)}else{this.setValue("",true)}},onValid:function(d,a,b,c){if(this.binder.ds==d&&this.binder.name.toLowerCase()==b.toLowerCase()&&this.record==a){if(c){this.fireEvent("valid",this,this.record,this.binder.name);this.clearInvalid()}else{this.fireEvent("invalid",this,this.record,this.binder.name);this.markInvalid()}}},onUpdate:function(d,a,b,c){if(this.binder.ds==d&&this.binder.name.toLowerCase()==b.toLowerCase()&&this.getValue()!=c){this.setValue(c,true)}},onFieldChange:function(b,a,c){if(this.binder.ds==b&&this.binder.name==c.name){this.onRefresh(b)}},onClear:function(a){this.clearValue()},setValue:function(b,a){this.value=b;if(a===true){return}if(this.binder){this.record=this.binder.ds.getCurrentRecord();if(this.record==null){var c={};c[this.binder.name]=b;this.record=this.binder.ds.create(c,false);this.record.validate(this.binder.name)}else{this.record.set(this.binder.name,b);if(b==""){delete this.record.data[this.binder.name]}}}},setWidth:function(a){this.width=a;this.wrap.setWidth(a)},setHeight:function(a){this.height=a;this.wrap.setHeight(a)},clearInvalid:function(){},markInvalid:function(){},clearValue:function(){},initMeta:function(){},setDefault:function(){},setRequired:function(){},onDataChange:function(){},setWidth:function(a){this.wrap.setStyle("width",a+"px")},setHeight:function(a){this.wrap.setStyle("height",a+"px")}});$A.Field=Ext.extend($A.Component,{validators:[],requiredCss:"item-notBlank",focusCss:"item-focus",readOnlyCss:"item-readOnly",emptyTextCss:"item-emptyText",invalidCss:"item-invalid",constructor:function(a){a.required=a.required||false;a.readonly=a.readonly||false;$A.Field.superclass.constructor.call(this,a)},initElements:function(){this.el=this.wrap.child("input[atype=field.input]")},initComponent:function(a){$A.Field.superclass.initComponent.call(this,a);this.initElements();this.originalValue=this.getValue();this.applyEmptyText();this.initStatus();if(this.hidden==true){this.setVisible(false)}},processListener:function(a){this.el[a]("focus",this.onFocus,this);this.el[a]("blur",this.onBlur,this);this.el[a]("change",this.onChange,this);this.el[a]("keyup",this.onKeyUp,this);this.el[a]("keydown",this.onKeyDown,this);this.el[a]("keypress",this.onKeyPress,this)},initEvents:function(){$A.Field.superclass.initEvents.call(this);this.addEvents("keydown","keyup","keypress")},destroy:function(){$A.Field.superclass.destroy.call(this);delete this.el},setWidth:function(a){this.wrap.setStyle("width",(a+3)+"px");this.el.setStyle("width",a+"px")},setHeight:function(a){this.wrap.setStyle("height",a+"px");this.el.setStyle("height",(a-1)+"px")},setVisible:function(a){if(a==true){this.wrap.show()}else{this.wrap.hide()}},initStatus:function(){this.clearInvalid();this.setRequired(this.required);this.setReadOnly(this.readonly)},onChange:function(a){},onKeyUp:function(a){this.fireEvent("keyup",this,a)},onKeyDown:function(a){this.fireEvent("keydown",this,a);if(a.keyCode==13||a.keyCode==27){this.blur()}},onKeyPress:function(a){this.fireEvent("keypress",this,a)},onFocus:function(a){(Ext.isGecko||Ext.isGecko2||Ext.isGecko3)?this.select():this.select.defer(10,this);if(this.readonly){return}if(!this.hasFocus){this.hasFocus=true;this.startValue=this.getValue();if(this.emptytext){if(this.el.dom.value==this.emptytext){this.setRawValue("")}this.wrap.removeClass(this.emptyTextCss)}this.wrap.addClass(this.focusCss);this.fireEvent("focus",this)}},processValue:function(a){return a},onBlur:function(a){if(this.readonly){return}if(this.hasFocus){this.hasFocus=false;var b=this.getRawValue();b=this.processValue(b);if(String(b)!==String(this.startValue)){this.fireEvent("change",this,b,this.startValue)}this.setValue(b);this.wrap.removeClass(this.focusCss);this.fireEvent("blur",this)}},setValue:function(b,a){$A.Field.superclass.setValue.call(this,b,a);if(this.emptytext&&this.el&&b!==undefined&&b!==null&&b!==""){this.wrap.removeClass(this.emptyTextCss)}this.setRawValue(this.formatValue((b===null||b===undefined?"":b)));this.applyEmptyText()},formatValue:function(a){return a},getRawValue:function(){var a=this.el.getValue();if(a===this.emptytext||a===undefined){a=""}return a},getValue:function(){var a=this.value;a=(a===null||a===undefined?"":a);return a},setRequired:function(a){if(this.crrentRequired==a){return}this.clearInvalid();this.crrentRequired=a;if(a){this.wrap.addClass(this.requiredCss)}else{this.wrap.removeClass(this.requiredCss)}},setReadOnly:function(a){if(this.currentReadOnly==a){return}this.currentReadOnly=a;this.el.dom.readOnly=a;if(a){this.wrap.addClass(this.readOnlyCss)}else{this.wrap.removeClass(this.readOnlyCss)}},applyEmptyText:function(){if(this.emptytext&&this.getRawValue().length<1){this.setRawValue(this.emptytext);this.wrap.addClass(this.emptyTextCss)}},clearInvalid:function(){this.invalidMsg=null;this.wrap.removeClass(this.invalidCss)},markInvalid:function(a){this.invalidMsg=a;this.wrap.addClass(this.invalidCss)},select:function(f,a){var c=this.getRawValue();if(c.length>0){f=f===undefined?0:f;a=a===undefined?c.length:a;var e=this.el.dom;if(e.setSelectionRange){e.setSelectionRange(f,a)}else{if(e.createTextRange){var b=e.createTextRange();b.moveStart("character",f);b.moveEnd("character",a-c.length);b.select()}}}},setRawValue:function(a){return this.el.dom.value=(a===null||a===undefined?"":a)},reset:function(){this.setValue(this.originalValue);this.clearInvalid();this.applyEmptyText()},focus:function(){if(this.readonly){return}this.el.dom.focus()},blur:function(){if(this.readonly){return}this.el.blur()},clearValue:function(){this.setValue("",true);this.clearInvalid();this.applyEmptyText()}});$A.Box=Ext.extend($A.Component,{constructor:function(a){this.errors=[];$A.Box.superclass.constructor.call(this,a)},initEvents:function(){},onValid:function(c,a,b){this.clearError(c.id)},onInvalid:function(d,a,c){var b=a.errors[c];if(b){this.showError(d.id,b.message)}},showError:function(b,a){Ext.fly(b+"_vmsg").update(a)},clearError:function(a){Ext.fly(a+"_vmsg").update("")},clearAllError:function(){for(var a=0;a<this.errors.length;a++){this.clearError(this.errors[a])}}});$A.Label=Ext.extend($A.Component,{onUpdate:function(d,a,b,c){if(this.binder.ds==d&&this.binder.name.toLowerCase()==b.toLowerCase()){this.update(a,b,c)}},rerender:function(a){this.record=a;if(this.record){var b=this.record.get(this.binder.name);this.update(this.record,this.binder.name,b)}},update:function(a,b,d){if(d){if(this.renderer){var c=window[this.renderer];d=c.call(window,d,a,b)}this.wrap.update(d)}}});$A.Button=Ext.extend($A.Component,{disableCss:"item-btn-disabled",overCss:"item-btn-over",pressCss:"item-btn-pressed",constructor:function(a){$A.Button.superclass.constructor.call(this,a)},initComponent:function(a){$A.Button.superclass.initComponent.call(this,a);this.el=this.wrap.child("button[atype=btn]");if(this.hidden==true){this.setVisible(false)}},processListener:function(a){$A.Button.superclass.processListener.call(this,a);this.wrap[a]("click",this.onClick,this);this.wrap[a]("mousedown",this.onMouseDown,this)},initEvents:function(){$A.Button.superclass.initEvents.call(this);this.addEvents("click")},destroy:function(){$A.Button.superclass.destroy.call(this);delete this.el},setVisible:function(a){if(a==true){this.wrap.show()}else{this.wrap.hide()}},disable:function(){this.wrap.addClass(this.disableCss);this.el.dom.disabled=true},enable:function(){this.wrap.removeClass(this.disableCss);this.el.dom.disabled=false},onMouseDown:function(a){this.wrap.addClass(this.pressCss);Ext.get(document.documentElement).on("mouseup",this.onMouseUp,this)},onMouseUp:function(a){Ext.get(document.documentElement).un("mouseup",this.onMouseUp,this);this.wrap.removeClass(this.pressCss)},onClick:function(a){this.fireEvent("click",this)},onMouseOver:function(a){this.wrap.addClass(this.overCss)},onMouseOut:function(a){this.wrap.removeClass(this.overCss)}});$A.CheckBox=Ext.extend($A.Component,{checkedCss:"item-ckb-c",uncheckedCss:"item-ckb-u",readonyCheckedCss:"item-ckb-readonly-c",readonlyUncheckedCss:"item-ckb-readonly-u",constructor:function(a){a.checked=a.checked||false;a.readonly=a.readonly||false;$A.CheckBox.superclass.constructor.call(this,a)},initComponent:function(a){this.checkedvalue="Y";this.uncheckedvalue="N";$A.CheckBox.superclass.initComponent.call(this,a);this.wrap=Ext.get(this.id);this.el=this.wrap.child("div[atype=checkbox]")},processListener:function(a){this.wrap[a]("click",this.onClick,this)},initEvents:function(){$A.CheckBox.superclass.initEvents.call(this);this.addEvents("click")},destroy:function(){$A.CheckBox.superclass.destroy.call(this);delete this.el},onClick:function(a){if(!this.readonly){this.checked=this.checked?false:true;this.setValue(this.checked);this.fireEvent("click",this,this.checked)}},setValue:function(b,a){if(typeof(b)==="boolean"){this.checked=b?true:false}else{this.checked=b===this.checkedvalue?true:false}this.initStatus();var c=this.checked==true?this.checkedvalue:this.uncheckedvalue;$A.CheckBox.superclass.setValue.call(this,c,a)},getValue:function(){var a=this.value;a=(a===null||a===undefined?"":a);return a},setReadOnly:function(a){if(typeof(a)==="boolean"){this.readonly=a?true:false;this.initStatus()}},initStatus:function(){this.el.removeClass(this.checkedCss);this.el.removeClass(this.uncheckedCss);this.el.removeClass(this.readonyCheckedCss);this.el.removeClass(this.readonlyUncheckedCss);if(this.readonly){this.el.addClass(this.checked?this.readonyCheckedCss:this.readonlyUncheckedCss)}else{this.el.addClass(this.checked?this.checkedCss:this.uncheckedCss)}}});$A.Radio=Ext.extend($A.Component,{checkedCss:"item-radio-img-c",uncheckedCss:"item-radio-img-u",readonyCheckedCss:"item-radio-img-readonly-c",readonlyUncheckedCss:"item-radio-img-readonly-u",imgCss:"item-radio-img",constructor:function(a){a.checked=a.checked||false;a.readonly=a.readonly||false;$A.Radio.superclass.constructor.call(this,a)},initComponent:function(a){$A.Radio.superclass.initComponent.call(this,a);this.wrap=Ext.get(this.id);this.nodes=Ext.DomQuery.select(".item-radio-option",this.wrap.dom)},processListener:function(a){this.wrap[a]("click",this.onClick,this)},focus:function(){},initEvents:function(){$A.Radio.superclass.initEvents.call(this);this.addEvents("click")},setValue:function(b,a){this.value=b;this.initStatus();$A.Radio.superclass.setValue.call(this,b,a)},getValue:function(){var a=this.value;a=(a===null||a===undefined?"":a);return a},setReadOnly:function(a){if(typeof(a)==="boolean"){this.readonly=a?true:false;this.initStatus()}},initStatus:function(){var a=this.nodes.length;for(var b=0;b<a;b++){var c=Ext.fly(this.nodes[b]).child("."+this.imgCss);c.removeClass(this.checkedCss);c.removeClass(this.uncheckedCss);c.removeClass(this.readonyCheckedCss);c.removeClass(this.readonlyUncheckedCss);var d=Ext.fly(this.nodes[b]).getAttributeNS("","itemvalue");if((b==0&&this.value=="")||d===this.value){this.readonly?c.addClass(this.readonyCheckedCss):c.addClass(this.checkedCss)}else{this.readonly?c.addClass(this.readonlyUncheckedCss):c.addClass(this.uncheckedCss)}}},onClick:function(f){if(!this.readonly){var a=this.nodes.length;for(var c=0;c<a;c++){var d=Ext.fly(this.nodes[c]);if(d.contains(f.target)){var b=d.getAttributeNS("","itemvalue");this.setValue(b);this.fireEvent("click",this,b);break}}}}});$A.TextField=Ext.extend($A.Field,{constructor:function(a){$A.TextField.superclass.constructor.call(this,a)},initComponent:function(a){$A.TextField.superclass.initComponent.call(this,a)},initEvents:function(){$A.TextField.superclass.initEvents.call(this)}});$A.TriggerField=Ext.extend($A.TextField,{constructor:function(a){$A.TriggerField.superclass.constructor.call(this,a)},initComponent:function(a){$A.TriggerField.superclass.initComponent.call(this,a);this.trigger=this.wrap.child("div[atype=triggerfield.trigger]");this.initPopup()},initPopup:function(){if(this.initpopuped==true){return}this.popup=this.wrap.child("div[atype=triggerfield.popup]");this.shadow=this.wrap.child("div[atype=triggerfield.shadow]");Ext.getBody().insertFirst(this.popup);Ext.getBody().insertFirst(this.shadow);this.initpopuped=true},initEvents:function(){$A.TriggerField.superclass.initEvents.call(this);this.trigger.on("click",this.onTriggerClick,this,{preventDefault:true})},isExpanded:function(){var a=this.popup.getXY();return !(a[0]==-1000||a[1]==-1000)},setWidth:function(a){this.wrap.setStyle("width",(a+3)+"px");this.el.setStyle("width",(a-20)+"px")},onFocus:function(){if(this.readonly){return}$A.TriggerField.superclass.onFocus.call(this);if(!this.isExpanded()){this.expand()}},onBlur:function(){this.hasFocus=false;this.wrap.removeClass(this.focusCss);this.fireEvent("blur",this)},onKeyDown:function(a){$A.TriggerField.superclass.onKeyDown.call(this,a);if(a.browserEvent.keyCode==9||a.keyCode==27){if(this.isExpanded()){this.collapse()}}},isEventFromComponent:function(b){var a=$A.TriggerField.superclass.isEventFromComponent.call(this,b);return a||this.popup.contains(b)},destroy:function(){if(this.isExpanded()){this.collapse()}this.trigger.un("click",this.onTriggerClick,this);delete this.trigger;delete this.popup;$A.TriggerField.superclass.destroy.call(this)},triggerBlur:function(a){if(!this.popup.contains(a.target)&&!this.wrap.contains(a.target)){if(this.isExpanded()){this.collapse()}}},setVisible:function(a){$A.TriggerField.superclass.setVisible.call(this,a);if(a==false&&this.isExpanded()){this.collapse()}},collapse:function(){Ext.get(document.documentElement).un("mousedown",this.triggerBlur,this);this.popup.moveTo(-1000,-1000);this.shadow.moveTo(-1000,-1000)},expand:function(){Ext.get(document.documentElement).on("mousedown",this.triggerBlur,this);var a=this.wrap.getXY();this.popup.moveTo(a[0],a[1]+23);this.shadow.moveTo(a[0]+3,a[1]+26)},onTriggerClick:function(){if(this.readonly){return}if(this.isExpanded()){this.collapse()}else{this.el.focus();this.expand()}}});$A.ComboBox=Ext.extend($A.TriggerField,{maxHeight:200,blankOption:true,rendered:false,selectedClass:"item-comboBox-selected",currentNodeClass:"item-comboBox-current",constructor:function(a){$A.ComboBox.superclass.constructor.call(this,a)},initComponent:function(a){$A.ComboBox.superclass.initComponent.call(this,a);if(a.options){this.setOptions(a.options)}},initEvents:function(){$A.ComboBox.superclass.initEvents.call(this);this.addEvents("select")},onTriggerClick:function(){this.doQuery("",true);$A.ComboBox.superclass.onTriggerClick.call(this)},onBlur:function(){$A.ComboBox.superclass.onBlur.call(this);if(!this.isExpanded()){var b=this.getRawValue();var a=this.getRecordByDisplay(b);if(a!=null){this.setValue(a.get(this.displayfield))}else{this.setValue("")}}},getRecordByDisplay:function(e){if(!this.optionDataSet){return null}var a=this.optionDataSet.getAll();var c=a.length;var b=null;for(var f=0;f<c;f++){var g=a[f];var h=g.get(this.displayfield);if(h==e){b=g;break}}return b},expand:function(){if(!this.optionDataSet){return}if(this.rendered===false){this.initQuery()}this.correctViewSize();$A.ComboBox.superclass.expand.call(this);var a=this.getValue();this.currentIndex=this.getIndex(a);if(!this.currentIndex){return}if(!Ext.isEmpty(a)){if(this.selectedIndex){Ext.fly(this.getNode(this.selectedIndex)).removeClass(this.selectedClass)}var b=this.getNode(this.currentIndex);if(b){Ext.fly(b).addClass(this.currentNodeClass)}this.selectedIndex=this.currentIndex}},collapse:function(){$A.ComboBox.superclass.collapse.call(this);if(this.currentIndex!==undefined){Ext.fly(this.getNode(this.currentIndex)).removeClass(this.currentNodeClass)}},setOptions:function(a){var b=a;if(typeof(a)==="string"){b=$(a)}if(this.currentOptions!=b){this.optionDataSet=b;this.optionDataSet.un("load",this.onDataSetLoad,this);this.optionDataSet.on("load",this.onDataSetLoad,this);this.rendered=false;this.currentOptions=b;if(!Ext.isEmpty(this.value)){this.setValue(this.value,true)}}},onDataSetLoad:function(){this.rendered=false;this.expand()},onRender:function(){if(!this.view){this.popup.update("<ul></ul>");this.view=this.popup.child("ul");this.view.on("click",this.onViewClick,this);this.view.on("mousemove",this.onViewMove,this)}if(this.optionDataSet){this.initList();this.rendered=true}},correctViewSize:function(){var f=[];var e=this.wrap.getWidth();for(var c=0;c<this.view.dom.childNodes.length;c++){var a=this.view.dom.childNodes[c];var d=$A.TextMetrics.measure(a,a.innerHTML).width;e=Math.max(e,d)||e}this.popup.setWidth(e);var b=Math.min(this.popup.child("ul").getHeight()+2,this.maxHeight);this.popup.setHeight(b<20?20:b);this.shadow.setWidth(e);this.shadow.setHeight(b<20?20:b)},onViewClick:function(b,a){if(a.tagName!="LI"){return}this.onSelect(a);this.collapse()},onViewOver:function(b,a){this.inKeyMode=false},onViewMove:function(c,b){if(this.inKeyMode){return}var a=b.tabIndex;this.selectItem(a)},onSelect:function(e){var b=e.tabIndex;if(b==-1){return}var a=this.optionDataSet.getAt(b);var c=a.get(this.valuefield);var d=a.get(this.displayfield);this.setValue(d);this.fireEvent("select",this,c,d,a)},initQuery:function(){this.doQuery(this.getText())},doQuery:function(b,a){if(b===undefined||b===null){b=""}this.onRender()},initList:function(){this.refresh();this.litp=new Ext.Template('<li tabIndex="{index}">{'+this.displayfield+"}&#160;</li>");if(this.optionDataSet.loading==true){this.view.update('<li tabIndex="-1">正在加载...</li>')}else{var a=this.optionDataSet.getAll();var b=a.length;var f=[];for(var c=0;c<b;c++){var e=Ext.apply(a[c].data,{index:c});f.add(this.litp.applyTemplate(e))}if(b!=0){this.view.update(f.join(""))}}},refresh:function(){this.view.update("");this.selectedIndex=null},selectItem:function(a){if(Ext.isEmpty(a)){return}var b=this.getNode(a);if(b&&b.tabIndex!=this.selectedIndex){if(!Ext.isEmpty(this.selectedIndex)){Ext.fly(this.getNode(this.selectedIndex)).removeClass(this.selectedClass)}this.selectedIndex=b.tabIndex;Ext.fly(b).addClass(this.selectedClass)}},getNode:function(a){return this.view.dom.childNodes[a]},destroy:function(){if(this.view){this.view.un("click",this.onViewClick,this);this.view.un("mousemove",this.onViewMove,this)}delete this.view;$A.ComboBox.superclass.destroy.call(this)},getText:function(){return this.text},setValue:function(c,b){$A.ComboBox.superclass.setValue.call(this,c,b);if(this.record){var h=this.record.getMeta().getField(this.binder.name);if(h){var e=h.get("mapping");var d=this.getRawValue();var a=this.getRecordByDisplay(d);if(e&&a){for(var f=0;f<e.length;f++){var g=e[f];this.record.set(g.to,a.get(g.from))}}}}},getIndex:function(c){var a=this.optionDataSet.getAll();var b=a.length;for(var d=0;d<b;d++){if(a[d].data[this.displayfield]==c){return d}}}});$A.DateField=Ext.extend($A.Component,{constructor:function(a){$A.DateField.superclass.constructor.call(this,a);this.draw()},initComponent:function(a){$A.DateField.superclass.initComponent.call(this,a);this.wrap=typeof(a.container)=="string"?Ext.get(a.container):a.container;this.table=this.wrap.child("table");this.tbody=this.wrap.child("tbody").dom;this.days=[];this.selectDays=this.selectDays||[];this.date=this.date||new Date();this.year=this.date.getFullYear();this.month=this.date.getMonth()+1;this.preMonthBtn=this.wrap.child("div.item-dateField-pre");this.nextMonthBtn=this.wrap.child("div.item-dateField-next");this.yearSpan=this.wrap.child("span.item-dateField-year");this.monthSpan=this.wrap.child("span.item-dateField-month")},processListener:function(a){$A.DateField.superclass.processListener.call(this,a);this.preMonthBtn[a]("click",this.preMonth,this);this.nextMonthBtn[a]("click",this.nextMonth,this);this.table[a]("click",this.onSelect,this);this.table[a]("mouseover",this.mouseOver,this);this.table[a]("mouseout",this.mouseOut,this)},initEvents:function(){$A.DateField.superclass.initEvents.call(this);this.addEvents("select","draw")},destroy:function(){$A.DateField.superclass.destroy.call(this);delete this.preMonthBtn;delete this.nextMonthBtn;delete this.yearSpan;delete this.monthSpan;delete this.table;delete this.tbody},mouseOut:function(a){if(this.overTd){Ext.fly(this.overTd).removeClass("dateover")}},mouseOver:function(a){if(this.overTd){Ext.fly(this.overTd).removeClass("dateover")}if(Ext.fly(a.target).hasClass("item-day")&&a.target.date!=0){this.overTd=a.target;Ext.fly(this.overTd).addClass("dateover")}},onSelect:function(a){if(this.singleSelect===false){}else{if(this.selectedDay){Ext.fly(this.selectedDay).removeClass("onSelect")}if(Ext.fly(a.target).hasClass("item-day")&&a.target.date!=0){this.selectedDay=a.target;this.onSelectDay(this.selectedDay);this.fireEvent("select",this,this.selectedDay.date)}}},onSelectDay:function(a){if(!Ext.fly(a).hasClass("onSelect")){Ext.fly(a).addClass("onSelect")}},onToday:function(a){a.className="onToday"},afterFinish:function(){for(var a=0;a<this.selectDays.length;a++){var b=this.selectDays[a];if(b.getFullYear()==this.year&&b.getMonth()+1==this.month){this.onSelectDay(this.days[b.getDate()])}}},nowMonth:function(){this.predraw(new Date())},preMonth:function(){this.predraw(new Date(this.year,this.month-2,1))},nextMonth:function(){this.predraw(new Date(this.year,this.month,1))},preYear:function(){this.predraw(new Date(this.year-1,this.month-1,1))},nextYear:function(){this.predraw(new Date(this.year+1,this.month-1,1))},predraw:function(a){if(a==""){a=new Date()}this.year=a.getFullYear();this.month=a.getMonth()+1;this.draw();this.fireEvent("draw",this)},draw:function(){var e=[];for(var c=1,a=new Date(this.year,this.month-1,1).getDay();c<=a;c++){e.push(0)}for(var c=1,h=new Date(this.year,this.month,0).getDate();c<=h;c++){e.push(c)}this.days=[];while(this.tbody.hasChildNodes()){this.tbody.removeChild(this.tbody.firstChild)}var b=0;while(e.length){var m=document.createElement("tr");if(b%2!=0){m.className="week-alt"}b++;for(var c=1;c<=7;c++){var l=document.createElement("td");l.className="item-day";l.innerHTML="&nbsp;";l.date=0;if(e.length){var g=e.shift();if(g){l.innerHTML=g;this.days[g]=l;var f=new Date(this.year,this.month-1,g);l.date=f;this.isSame(f,new Date())&&this.onToday(l);this.selectDay&&this.isSame(f,this.selectDay)&&this.onSelectDay(l)}}m.appendChild(l)}this.tbody.appendChild(m)}this.yearSpan.dom.innerHTML=this.year;this.monthSpan.dom.innerHTML=this.month;this.afterFinish()},isSame:function(b,a){return(b.getFullYear()==a.getFullYear()&&b.getMonth()==a.getMonth()&&b.getDate()==a.getDate())}});$A.DatePicker=Ext.extend($A.TriggerField,{constructor:function(a){$A.DatePicker.superclass.constructor.call(this,a)},initComponent:function(b){$A.DatePicker.superclass.initComponent.call(this,b);if(!this.dateField){var a={id:this.id+"_df",container:this.popup};this.dateField=new $A.DateField(a);this.dateField.on("select",this.onSelect,this);this.dateField.on("draw",this.onDraw,this)}},initEvents:function(){$A.DatePicker.superclass.initEvents.call(this);this.addEvents("select")},onDraw:function(){this.shadow.setWidth(this.popup.getWidth());this.shadow.setHeight(this.popup.getHeight())},onSelect:function(b,a){this.collapse();this.setValue(a);this.fireEvent("select",this,a)},onBlur:function(){$A.DatePicker.superclass.onBlur.call(this);if(!this.isExpanded()){var a=this.getRawValue();if(!isNaN(new Date(a.replace(/-/g,"/")))){this.setValue(new Date(a.replace(/-/g,"/")))}else{this.setValue("")}}},formatValue:function(a){if(a instanceof Date){return Aurora.formateDate(a)}else{return a}},expand:function(){$A.DatePicker.superclass.expand.call(this);if(this.dateField.selectDay!=this.getValue()){this.dateField.selectDay=this.getValue();this.dateField.predraw(this.dateField.selectDay);var a=this.popup.getWidth();var b=this.popup.getHeight();this.shadow.setWidth(a);this.shadow.setHeight(b)}var e=$A.getViewportHeight();var b=this.popup.getHeight();var d=this.popup.getY();if(d+b>e){var c=this.wrap.getXY();this.popup.moveTo(c[0],c[1]-b);this.shadow.moveTo(c[0]+3,c[1]-b+3)}},destroy:function(){$A.DatePicker.superclass.destroy.call(this)}});$A.ToolBar=Ext.extend($A.Component,{constructor:function(a){$A.ToolBar.superclass.constructor.call(this,a)},initComponent:function(a){$A.ToolBar.superclass.initComponent.call(this,a)},initEvents:function(){$A.ToolBar.superclass.initEvents.call(this)}});$A.NavBar=Ext.extend($A.ToolBar,{constructor:function(a){$A.NavBar.superclass.constructor.call(this,a)},initComponent:function(a){$A.NavBar.superclass.initComponent.call(this,a);this.dataSet=$(this.dataSet);this.pageInput=$(this.inputId);this.pageInfo=Ext.get(this.pageId);this.navInfo=Ext.get(this.infoId);this.pageInput.setValue(1)},processListener:function(a){$A.NavBar.superclass.processListener.call(this,a);this.dataSet[a]("load",this.onLoad,this);this.pageInput[a]("keydown",this.onInputKeyPress,this)},initEvents:function(){$A.NavBar.superclass.initEvents.call(this)},onLoad:function(){this.pageInput.setValue(this.dataSet.currentPage);this.pageInfo.update("共"+this.dataSet.totalPage+"页");this.navInfo.update(this.creatNavInfo())},creatNavInfo:function(){var b=((this.dataSet.currentPage-1)*this.dataSet.pageSize+1);var a=this.dataSet.currentPage*this.dataSet.pageSize;if(a>this.dataSet.totalCount){a=this.dataSet.totalCount}if(a==0){b=0}return"显示 "+b+" - "+a+",共 "+this.dataSet.totalCount+" 条"},onInputKeyPress:function(a,c){if(c.keyCode==13){var b=parseInt(a.getRawValue());if(isNaN(b)){a.setValue(this.dataSet.currentPage)}else{if(b>0&&b<=this.dataSet.totalPage){this.dataSet.goPage(b)}else{a.setValue(this.dataSet.currentPage)}}}}});$A.WindowManager=function(){return{put:function(a){if(!this.cache){this.cache=[]}this.cache.add(a)},getAll:function(){return this.cache},remove:function(a){this.cache.remove(a)},get:function(c){if(!this.cache){return null}var b=null;for(var a=0;a<this.cache.length;a++){if(this.cache[a].id==c){b=this.cache[a];break}}return b},getZindex:function(){var c=40;var d=this.getAll();for(var b=0;b<d.length;b++){var e=d[b];var a=e.wrap.getStyle("z-index");if(a=="auto"){a=0}if(a>c){c=a}break}return c}}}();$A.Window=Ext.extend($A.Component,{constructor:function(a){if($A.WindowManager.get(a.id)){return}this.draggable=true;this.closeable=true;this.modal=a.modal||true;this.oldcmps={};this.cmps={};$A.Window.superclass.constructor.call(this,a)},initComponent:function(b){$A.Window.superclass.initComponent.call(this,b);var d=this;$A.WindowManager.put(d);var a=new Ext.Template(d.getTemplate());var c=new Ext.Template(d.getShadowTemplate());d.width=d.width||350;d.height=d.height||400;d.wrap=a.append(document.body,{title:d.title,width:d.width,bodywidth:d.width-2,height:d.height},true);d.shadow=c.append(document.body,{},true);d.focusEl=d.wrap.child("a[atype=win.focus]");d.title=d.wrap.child("div[atype=window.title]");d.head=d.wrap.child("td[atype=window.head]");d.body=d.wrap.child("div[atype=window.body]");d.closeBtn=d.wrap.child("div[atype=window.close]");if(d.draggable){d.initDraggable()}if(!d.closeable){d.closeBtn.hide()}if(d.url){d.showLoading();d.load(d.url)}d.center()},processListener:function(a){$A.Window.superclass.processListener.call(this,a);if(this.closeable){this.closeBtn[a]("click",this.onClose,this)}this.wrap[a]("click",this.toFront,this);this.focusEl[a]("keydown",this.handleKeyDown,this);if(this.draggable){this.head.on("mousedown",this.onMouseDown,this)}},initEvents:function(){$A.Window.superclass.initEvents.call(this);this.addEvents("close","load")},handleKeyDown:function(b){b.stopEvent();var a=b.getKey();if(a==27){this.close()}},initDraggable:function(){this.head.addClass("item-draggable")},focus:function(){this.focusEl.focus()},center:function(){var c=$A.getViewportWidth();var e=$A.getViewportHeight();var a=(c-this.width)/2;var d=(e-this.height)/2;this.wrap.moveTo(a,d);this.shadow.setWidth(this.wrap.getWidth());this.shadow.setHeight(this.wrap.getHeight());this.shadow.moveTo(a+3,d+3);this.toFront();var b=this;setTimeout(function(){b.focusEl.focus()},10)},getShadowTemplate:function(){return['<DIV class="item-shadow""></DIV>']},getTemplate:function(){return['<TABLE class="window-wrap" style="width:{width}px;height:{height}px;" cellSpacing="0" cellPadding="0" border="0">',"<TBODY>",'<TR style="height:25px;" >','<TD class="window-caption">','<TABLE cellSpacing="0" unselectable="on"  onselectstart="return false;" style="-moz-user-select:none;"  cellPadding="1" width="100%" height="100%" border="0" unselectable="on">',"<TBODY>","<TR>",'<TD unselectable="on" class="window-caption-label" atype="window.head" width="99%">','<A atype="win.focus" href="#" class="win-fs" tabIndex="-1">&#160;</A><DIV unselectable="on" atype="window.title" unselectable="on">{title}</DIV>',"</TD>",'<TD unselectable="on" class="window-caption-button" noWrap>','<DIV class="window-close" atype="window.close" unselectable="on"></DIV>',"</TD>","</TR>","</TBODY>","</TABLE>","</TD>","</TR>",'<TR style="height:99%">','<TD class="window-body" vAlign="top" unselectable="on">','<DIV class="window-content" atype="window.body" style="position:relatvie;width:{bodywidth}px;height:{height}px;" unselectable="on"></DIV>',"</TD>","</TR>","</TBODY>","</TABLE>"]},toFront:function(){var b=this.wrap.getStyle("z-index");var a=$A.WindowManager.getZindex();if(b=="auto"){b=0}if(b<a){this.wrap.setStyle("z-index",a+5);this.shadow.setStyle("z-index",a+4);if(this.modal){$A.Mask.mask(this.wrap)}}},onMouseDown:function(c){var a=this;var b=a.wrap.getXY();a.relativeX=b[0]-c.getPageX();a.relativeY=b[1]-c.getPageY();Ext.get(document.documentElement).on("mousemove",a.onMouseMove,a);Ext.get(document.documentElement).on("mouseup",a.onMouseUp,a)},onMouseUp:function(b){var a=this;Ext.get(document.documentElement).un("mousemove",a.onMouseMove,a);Ext.get(document.documentElement).un("mouseup",a.onMouseUp,a);if(a.proxy){a.wrap.moveTo(a.proxy.getX(),a.proxy.getY());a.shadow.moveTo(a.proxy.getX()+3,a.proxy.getY()+3);a.proxy.hide()}},onMouseMove:function(a){a.stopEvent();if(!this.proxy){this.initProxy()}this.proxy.show();this.proxy.moveTo(a.getPageX()+this.relativeX,a.getPageY()+this.relativeY)},showLoading:function(){this.body.update("正在加载...");this.body.setStyle("text-align","center");this.body.setStyle("line-height",5)},clearLoading:function(){this.body.update("");this.body.setStyle("text-align","");this.body.setStyle("line-height","")},initProxy:function(){var a=this;var c='<DIV style="border:1px dashed black;Z-INDEX: 10000; LEFT: 0px; WIDTH: 100%; CURSOR: default; POSITION: absolute; TOP: 0px; HEIGHT: 621px;" unselectable="on"></DIV>';a.proxy=Ext.get(Ext.DomHelper.append(Ext.getBody(),c));var b=a.wrap.getXY();a.proxy.setWidth(a.wrap.getWidth());a.proxy.setHeight(a.wrap.getHeight());a.proxy.setLocation(b[0],b[1])},onClose:function(a){this.close()},close:function(){$A.WindowManager.remove(this);this.destroy();this.fireEvent("close",this)},destroy:function(){for(var a in this.cmps){var c=this.cmps[a];if(c.destroy){try{c.destroy()}catch(d){alert("销毁window出错: "+d)}}}var b=this.wrap;if(!b){return}if(this.proxy){this.proxy.remove()}if(this.modal){$A.Mask.unmask(this.wrap)}$A.Window.superclass.destroy.call(this);delete this.title;delete this.head;delete this.body;delete this.closeBtn;delete this.proxy;b.remove();this.shadow.remove()},load:function(b){var a=$A.CmpManager.getAll();for(var c in a){this.oldcmps[c]=a[c]}Ext.Ajax.request({url:b,success:this.onLoad.createDelegate(this)})},setChildzindex:function(b){for(var a in this.cmps){var d=this.cmps[a];d.setZindex(b)}},onLoad:function(a,b){this.clearLoading();var c=a.responseText;var d=this;this.body.update(c,true,function(){var e=$A.CmpManager.getAll();for(var f in e){if(d.oldcmps[f]==null){d.cmps[f]=e[f]}}d.fireEvent("load",d)})}});$A.showMessage=function(b,a){return $A.showWindow(b,a,300,100,"win-alert")};$A.hideWindow=function(){var a=$A.CmpManager.get("aurora-msg");if(a){a.close()}};$A.showWindow=function(f,e,c,a,b){b=b||"";var d=$A.CmpManager.get("aurora-msg");if(d==null){d=new $A.Window({id:"aurora-msg",title:f,height:a,width:c});d.body.update('<div class="'+b+'">'+e+"</div>")}return d};$A.Lov=Ext.extend($A.TextField,{constructor:function(a){this.isWinOpen=false;$A.Lov.superclass.constructor.call(this,a)},initComponent:function(a){$A.Lov.superclass.initComponent.call(this,a);this.trigger=this.wrap.child("div[atype=triggerfield.trigger]")},processListener:function(a){$A.Lov.superclass.processListener.call(this,a);this.trigger[a]("click",this.showLovWindow,this,{preventDefault:true})},initEvents:function(){$A.Lov.superclass.initEvents.call(this);this.addEvents("commit")},destroy:function(){$A.Lov.superclass.destroy.call(this)},setWidth:function(a){this.wrap.setStyle("width",(a+3)+"px");this.el.setStyle("width",(a-20)+"px")},onBlur:function(f){if(this.readonly){return}var a=this.record?this.record.get(this.binder.name):null;var c=this.getRawValue();var b=this.getValue();var d=true;if(c==""){d=false}else{if(c==b){d=false}}if(d){this.showLovWindow()}else{$A.Lov.superclass.onBlur.call(this,f)}},onKeyDown:function(a){if(a.getKey()==13){this.showLovWindow()}else{$A.TriggerField.superclass.onKeyDown.call(this,a)}},canHide:function(){return this.isWinOpen==false},commit:function(c){this.win.close();this.dataRecord=c;var a=this.getMapping();for(var b=0;b<a.length;b++){var d=a[b];if(this.binder.name==d.to){this.setValue(c.get(d.from));break}}this.dataRecord=null},getMapping:function(){var a;if(this.record){var b=this.record.getMeta().getField(this.binder.name);if(b){a=b.get("mapping")}}return a?a:[{from:this.binder.name,to:this.binder.name}]},setValue:function(b,a){$A.Lov.superclass.setValue.call(this,b,a);if(this.record&&this.dataRecord&&a!==true){var c=this.getMapping();for(var d=0;d<c.length;d++){var e=c[d];this.record.set(e.to,this.dataRecord.get(e.from))}}},onWinClose:function(){this.isWinOpen=false;this.win=null;this.focus()},showLovWindow:function(){if(this.isWinOpen==true){return}if(this.readonly==true){return}if(this.ref==""||Ext.isEmpty(this.ref)){return}this.isWinOpen=true;var a="";var c=this.getRawValue();var b=this.getValue();if(c!=b){a=c}this.blur();this.win=new $A.Window({title:this.title||"Lov",url:(this.ref)+"?lovid="+this.id+"&key="+encodeURIComponent(a),height:this.winheight||400,width:this.winwidth||400});this.win.on("close",this.onWinClose,this)}});$A.TextArea=Ext.extend($A.Field,{constructor:function(a){$A.TextArea.superclass.constructor.call(this,a)},initComponent:function(a){$A.TextArea.superclass.initComponent.call(this,a)},initEvents:function(){$A.TextArea.superclass.initEvents.call(this)},initElements:function(){this.el=this.wrap},setRawValue:function(a){this.el.update(a===null||a===undefined?"":a)},getRawValue:function(){var a=this.el.dom.innerHTML;if(a===this.emptytext||a===undefined){a=""}return a}});