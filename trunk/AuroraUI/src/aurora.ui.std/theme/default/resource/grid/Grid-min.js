(function(aA){var aB=document,a1=aB.documentElement,ag=Ext.each,ai=Ext.isEmpty,J=false,ae=true,ax=null,af="_",k="__",v=".",r=" ",w="",D="]",ay="-c",an="-u",aJ="$l-",aD="$u-",aK="on",am="px",aY="tr",a="td",a3="th",b="_tb",ap="div",n="top",c="left",ak="none",R="width",M="center",at="hidden",aN="cursor",ao="visible",az="default",Y="w-resize",g="outline",aO="1px dotted blue",aP="atype",e="append",aI="insertBefore",aU="insertAfter",f="before",l="_navbar",aW="text-overflow",B="recordid",P="dataindex",ab="row-selected",O="required",aF="item-notBlank",ar="item-invalid",d="row-alt",E="grid-rowbox",aS=v+E,t="grid.rowcheck",z="grid.rowradio",F="grid.head",aZ="grid-ckb ",ad="grid-select-all",aj="multiple",av="checkedvalue",x="-readonly",H="item-ckb",V=H+"-self",a0=v+V,aC=H+an,aL=H+ay,L=H+x+an,T=H+x+ay,W="item-radio-img",aT=W+ay,aH=W+an,Q=W+x+ay,G=W+x+an,aX=a0+r+v+aL,q="grid-cell",h="cell-editor",K="cellcheck",X="rowcheck",Z="rowradio",aq="rownumber",j="grid-",a5=j+aq,aM="desc",o="asc",i=j+aM,aE=j+o,p="click",a2="dblclick",I="cellclick",u="render",aV="rowclick",au="editorshow",S="nexteditorshow",aQ="keydown",al="select",y="mousedown",aw="mousemove",ah="mouseup",aa="未找到",aG="方法!",N="tr[class!=grid-hl]",s="div[atype=grid.headcheck]",aR="["+P+"=",a4=a3+aR,ac=a+aR,m={autoadjust:ae,forexport:ae,hidden:J,lock:J,resizable:ae,rowspan:1,sortable:ae,width:100};aA.Grid=Ext.extend(aA.Component,{constructor:function(A){var C=this;C.selectedId=ax;C.lockWidth=0;C.autofocus=A.autofocus||ae;aA.Grid.superclass.constructor.call(C,A)},initComponent:function(A){aA.Grid.superclass.initComponent.call(this,A);var U=this,C=U.wrap,a6=U.wb=Ext.get(U.id+"_wrap");U.fb=a6.child("div[atype=grid.fb]");if(U.fb){U.uf=U.fb.child("div[atype=grid.uf]")}U.uc=C.child("div[atype=grid.uc]");U.uh=C.child("div[atype=grid.uh]");U.ub=C.child("div[atype=grid.ub]");U.uht=C.child("table[atype=grid.uht]");U.lc=C.child("div[atype=grid.lc]");U.lh=C.child("div[atype=grid.lh]");U.lb=C.child("div[atype=grid.lb]");U.lht=C.child("table[atype=grid.lht]");U.sp=C.child("div[atype=grid.spliter]");Ext.getBody().insertFirst(U.sp);U.classfiyColumns();U.initTemplate()},processListener:function(A){var C=this;aA.Grid.superclass.processListener.call(C,A);C.wrap[A]("mouseover",C.onMouseOver,C)[A]("mouseout",C.onMouseOut,C)[A](p,C.focus,C)[A]("focus",C.onFocus,C)[A]("blur",C.onBlur,C);if(C.canwheel!==J){C.wb[A]("mousewheel",C.onMouseWheel,C)}C.wb[A](Ext.isOpera?"keypress":aQ,C.handleKeyDown,C)[A]("keyup",C.handleKeyUp,C);C.ub[A]("scroll",C.syncScroll,C)[A](p,C.onClick,C)[A](a2,C.onDblclick,C);C.uht[A](aw,C.onUnLockHeadMove,C);C.uh[A](y,C.onHeadMouseDown,C)[A](p,C.onHeadClick,C);if(C.lb){C.lb[A](p,C.onClick,C)[A](a2,C.onDblclick,C)}if(C.lht){C.lht[A](aw,C.onLockHeadMove,C)}if(C.lh){C.lh[A](y,C.onHeadMouseDown,C)[A](p,C.onHeadClick,C)}C[A](I,C.onCellClick,C)},initEvents:function(){aA.Grid.superclass.initEvents.call(this);this.addEvents(u,aQ,a2,I,aV,au,S)},syncScroll:function(){var A=this;A.hideEditor();A.uh.dom.scrollLeft=A.ub.dom.scrollLeft;if(A.lb){A.lb.dom.scrollTop=A.ub.dom.scrollTop}if(A.uf){A.uf.dom.scrollLeft=A.ub.dom.scrollLeft}},handleKeyUp:function(A){if(A.getKey()==9){this.showFirstEditor()}},handleKeyDown:function(a6){var C=this,A=a6.getKey(),U=C.dataset;if(a6.ctrlKey&&a6.keyCode==86&&C.canpaste){var a7=window.clipboardData.getData("text");if(a7){ag(a7.split("\n"),function(bb){var a9=bb.split("\t");if(a9==w){return}var ba={},a8=0;ag(C.columns,function(bc){if(C.isFunctionCol(bc.type)){return}if(bc.hidden!==ae){ba[bc.name]=a9[a8];a8++}});U.create(ba)})}}else{if(A==9){C.showFirstEditor()}else{if(A==38||A==40||A==33||A==34){if(U.loading==ae){return}switch(a6.getKey()){case 33:U.prePage();break;case 34:U.nextPage();break;case 38:if(!a6.ctrlKey){U.pre()}break;case 40:if(!a6.ctrlKey){U.next()}break}a6.stopEvent()}}}C.fireEvent(aQ,C,a6)},processDataSetLiestener:function(A){var C=this,U=C.dataset;if(U){U[A]("ajaxfailed",C.onAjaxFailed,C);U[A]("metachange",C.onRefresh,C);U[A]("update",C.onUpdate,C);U[A]("reject",C.onUpdate,C);U[A]("add",C.onAdd,C);U[A]("submit",C.onBeforSubmit,C);U[A]("submitfailed",C.onAfterSuccess,C);U[A]("submitsuccess",C.onAfterSuccess,C);U[A]("query",C.onBeforeLoad,C);U[A]("load",C.onLoad,C);U[A]("loadfailed",C.onAjaxFailed,C);U[A]("valid",C.onValid,C);U[A]("beforeremove",C.onBeforeRemove,C);U[A]("remove",C.onRemove,C);U[A]("clear",C.onLoad,C);U[A]("refresh",C.onRefresh,C);U[A]("fieldchange",C.onFieldChange,C);U[A]("indexchange",C.onIndexChange,C);U[A]("select",C.onSelect,C);U[A]("unselect",C.onUnSelect,C);U[A]("selectall",C.onSelectAll,C);U[A]("unselectall",C.onUnSelectAll,C)}},bind:function(C){if(Ext.isString(C)){C=$(C);if(!C){return}}var A=this;A.dataset=C;if(C.autopagesize===ae){C.pagesize=Math.round(((A.ub.getHeight()||parseFloat(A.ub.dom.style.height))-16)/25)}A.processDataSetLiestener(aK);A.onLoad()},initTemplate:function(){var A=this;A.rowTdTpl=new Ext.Template(["<td ",aP,'="{',aP,'}" class="',E,'" ',B,'="{',B,'}">']);A.rowNumTdTpl=new Ext.Template(['<td style="text-align:{align}" class="',a5,'" ',aP,'="',a5,'" ',B,'="{',B,'}">']);A.rowNumCellTpl=new Ext.Template(['<div style="',R,":{",R,'}px">{text}</div>']);A.tdTpl=new Ext.Template(['<td style="visibility:{visibility};text-align:{align}" ',P,'="{name}" ',aP,'="',q,'" ',B,'="{',B,'}">']);A.cellTpl=new Ext.Template(['<div class="',q,' {cellcls}" style="',R,":{",R,'}px" id="',A.id,'_{name}_{recordid}" title="{title}"><span>{text}</span></div>']);A.cbTpl=new Ext.Template(['<center><div class="{cellcls}" id="',A.id,"_{name}_{",B,'}"></div></center>'])},getCheckBoxStatus:function(A,a6,U){var a8=this.dataset.getField(a6),C=a8.getPropertity(av),a7=A.data[a6];return H+(U?x:w)+((a7&&a7==C)?ay:an)},createTemplateData:function(C,A){return{width:C.width-2,recordid:A.id,visibility:C.hidden===ae?at:ao,name:C.name}},createCell:function(C,a9,bb){var bc=this,a7=bc.createTemplateData(C,a9),bg,a6=bc.tdTpl,bi=w,U=C.type,a8,ba=bc.getEditor(C,a9),be=[];if(ba!=w){var bd=aA.CmpManager.get(ba);if(bd&&(bd instanceof aA.CheckBox)){U=K}else{bi=h}}else{if(C.name&&!ai(a9.getField(C.name).get(av))){U=K;a8=ae}}if(U==X||U==Z){a8=bc.dataset.execSelectFunction(a9)?w:x;a6=bc.rowTdTpl;a7=Ext.apply(a7,{align:M,atype:U==X?t:z,cellcls:U==X?aZ+H+a8+an:"grid-radio "+W+a8+an});bg=bc.cbTpl}else{if(U==K){a7=Ext.apply(a7,{align:M,cellcls:aZ+bc.getCheckBoxStatus(a9,C.name,a8)});bg=bc.cbTpl}else{var bf=a9.getMeta().getField(C.name);if(bf&&ai(a9.data[C.name])&&a9.isNew==ae&&bf.get(O)==ae){bi=bi+r+aF}var A=(bi.indexOf(h)!=-1)?5:2,bh=bc.renderText(a9,C,a9.data[C.name]);a7=Ext.apply(a7,{align:C.align||c,cellcls:bi,width:a7.width-A,text:bh,title:String(bh).replace(/<[^<>]*>/mg,w)});bg=bc.cellTpl;if(U==aq){a6=bc.rowNumTdTpl;bg=bc.rowNumCellTpl}}}if(bb){be.push(a6.applyTemplate(a7))}be.push(bg.applyTemplate(a7));if(bb){be.push("</td>")}return be.join(w)},createRow:function(a7,bb,a9,ba){var a6=this,U=a6.parseCss(a6.renderRow(ba,bb)),a8=['<tr id="',a6.id,a7,ba.id,'" class="',(bb%2==0?w:d),U.cls,'"','style="',U.style,'">'];for(var C=0,A=a9.length;C<A;C++){if(a9[C].hidden){continue}a8.push(a6.createCell(a9[C],ba,ae))}a8.push("</tr>");return a8.join(w)},parseCss:function(U){var a7=w,A=w;if(Ext.isArray(U)){for(var C=0;C<U.length;C++){var a6=this.parseCss(U[C]);a7+=";"+a6.style;A+=r+a6.cls}}else{if(Ext.isString(U)){var a8=!!U.match(/^([^,:;]+:[^:;]+;)*[^,:;]+:[^:;]+;*$/);A=a8?w:U;a7=a8?U:w}}return{style:a7,cls:A}},renderText:function(A,C,a7){var a6=C.renderer;if(a6){var U=aA.getRenderer(a6);if(U==ax){alert(aa+a6+aG);return a7}a7=U(a7,A,C.name);return a7==ax?w:a7}return a7==ax?w:a7},renderRow:function(A,a7){var a6=this.rowrenderer,C=ax;if(a6){var U=aA.getRenderer(a6);if(U==ax){alert(aa+a6+aG);return C}C=U(A,a7);return !C?w:C}return C},createTH:function(U){var a7=['<tr class="grid-hl">'];for(var C=0,A=U.length;C<A;C++){var a6=U[C];if(a6.hidden){continue}a7.push("<th ",P,'="',a6.name,'" style="height:0px;width:',a6.hidden===ae?0:a6.width,am,'"></th>')}a7.push("</tr>");return a7.join(w)},onBeforeRemove:function(){aA.Masker.mask(this.wb,_lang["grid.mask.remove"])},onBeforeLoad:function(){this.ub.scrollTo(c,0);this.uh.scrollTo(c,0);if(!Ext.isIE6){aA.Masker.mask(this.wb,_lang["grid.mask.loading"])}},onBeforSubmit:function(A){aA.Masker.mask(this.wb,_lang["grid.mask.submit"])},onAfterSuccess:function(){aA.Masker.unmask(this.wb)},preLoad:function(){},onLoad:function(){var C=this;C.isSelectAll=J;C.clearDomRef();C.preLoad();var A=C.wrap.removeClass(ad).child(s);if(A&&C.selectable&&C.selectionmodel==aj){C.setCheckBoxStatus(A,J)}if(C.lb){C.renderLockArea()}C.renderUnLockAread();C.drawFootBar();aA.Masker.unmask(C.wb);C.fireEvent(u,C)},clearDomRef:function(){this.selectlockTr=ax;this.selectUnlockTr=ax},customize:function(){var a9=location.pathname,ba=a9.indexOf("modules"),a6=a9.substring(ba,a9.length),U=a6.substring(a6.lastIndexOf("/")+1,a6.length),C=a9.substring(0,ba),a8=this.wrap.parent("[url]");if(a8){var a7=a8.getAttributeNS("","url");if(a7){a7=a7.split("?")[0];if(a7.indexOf(C)==-1){var A=a7.lastIndexOf("/");if(A!=-1){a7=a7.substring(A+1,a7.length)}a6=a6.replaceAll(U,a7)}else{a6=a7.substring(a7.indexOf(C)+new String(C).length,a7.length)}}}new Aurora.Window({id:"sys_customization_grid",url:C+"modules/sys/sys_customization_grid.screen?source_file="+a6+"&id="+this.id+"&did="+this.dataset.id,title:"个性化设置",height:530,width:560})},onAjaxFailed:function(C,A){aA.Masker.unmask(this.wb)},onMouseWheel:function(C){C.stopEvent();if(this.editing==ae){return}var U=C.getWheelDelta(),A=this.dataset;if(U>0){A.pre()}else{if(U<0){A.next()}}},focus:function(){this.wb.focus()},onFocus:function(){this.hasFocus=true},blur:function(){this.wb.blur()},onBlur:function(){this.hasFocus=false},renderLockArea:function(){var A=this,C=A.lockColumns,U=['<TABLE cellSpacing="0" atype="grid.lbt" cellPadding="0" border="0"  ',R,'="',A.lockWidth,'"><TBODY>',A.createTH(C)];ag(A.dataset.data,function(a7,a6){U.push(A.createRow(aJ,a6,C,a7))},A);U.push('</TBODY></TABLE><DIV style="height:17px"></DIV>');A.lbt=A.lb.update(U.join(w)).child("table[atype=grid.lbt]")},renderUnLockAread:function(){var A=this,C=A.unlockColumns,U=['<TABLE cellSpacing="0" atype="grid.ubt" cellPadding="0" border="0" ',R,'="',A.unlockWidth,'"><TBODY>',A.createTH(C)];ag(A.dataset.data,function(a7,a6){U.push(A.createRow(aD,a6,C,a7))},A);U.push("</TBODY></TABLE>");A.ubt=A.ub.update(U.join(w)).child("table[atype=grid.ubt]")},isOverSplitLine:function(A){var U=this,C=0,a6=J;U.overColIndex=-1;ag(U.columns,function(a8,a7){if(a8.hidden!==ae){C+=a8.width}if(A<C+3&&A>C-3&&a8.resizable!=J){a6=ae;U.overColIndex=a7;return J}});return a6},onRefresh:function(){var A=this;A.onLoad();if(A.selectable){var C=A.dataset;ag(C.selected,function(U){A.onSelect(C,U)})}},onIndexChange:function(U,C){var A=this.getDataIndex(C.id);if(A==-1){return}this.selectRow(A,J)},isFunctionCol:function(A){return A==X||A==Z||A==aq},onAdd:function(U,a9,bi){var bc=this,a7=bc.columns,bg=bi===U.data.length-1,ba=bc.parseCss(bc.renderRow(a9,bi)),bh=(bi%2==0?w:d+r)+ba.cls;if(bc.lbt){var C=aB.createElement(aY),bf=bc.lbt.dom.tBodies[0];C.id=bc.id+aJ+a9.id;C.className=bh;Ext.fly(C).set({style:ba.style});ag(a7,function(bj){if(bj.lock===ae){var bl=aB.createElement(a);if(bj.type==X){Ext.fly(bl).set({recordid:a9.id,atype:t});bl.className=E;if(bc.isSelectAll){bl.className+=r+V}}else{if(bj.type==Z){Ext.fly(bl).set({recordid:a9.id,atype:z});bl.className=E}else{if(bj.hidden){bl.style.visibility=at}bl.style.textAlign=bj.align||c;if(!bc.isFunctionCol(bj.type)){bl.dataindex=bj.name}var bk={recordid:a9.id,atype:q};if(bj.type==aq){bl.className=a5;bk.atype=a5}Ext.fly(bl).set(bk)}}bl.innerHTML=bc.createCell(bj,a9,J);C.appendChild(bl)}});if(bg){bf.appendChild(C)}else{var bb=Ext.fly(bf).query(N);for(var a8=bi,a6=bb.length;a8<a6;a8++){var bd=Ext.fly(bb[a8]).toggleClass(d);bd.select(".grid-rownumber div").each(function(bj){bj.update(Number(bj.dom.innerHTML)+1)});bd.select(aS).each(function(bj){bc.setSelectStatus(U.findById(bj.getAttributeNS(w,B)))})}bf.insertBefore(C,bb[bi])}}var A=aB.createElement(aY),be=bc.ubt.dom.tBodies[0];A.id=bc.id+aD+a9.id;A.className=bh;Ext.fly(A).set({style:ba.style});ag(a7,function(bj){if(bj.lock!==ae){var bk=aB.createElement(a);bk.style.visibility=bj.hidden===ae?at:ao;bk.style.textAlign=bj.align||c;Ext.fly(bk).set({dataindex:bj.name,recordid:a9.id,atype:q});bk.innerHTML=bc.createCell(bj,a9,J);A.appendChild(bk)}});if(bg){be.appendChild(A)}else{var bb=Ext.fly(be).query(N);for(var a8=bi,a6=bb.length;a8<a6;a8++){Ext.fly(bb[a8]).toggleClass(d)}be.insertBefore(A,bb[bi])}bc.setSelectStatus(a9);bc.drawFootBar()},renderEditor:function(a6,A,U,C){a6.parent(a).update(this.createCell(U,A,J))},onUpdate:function(a8,A,C,a7){this.setSelectStatus(A);var a6=this,ba=Ext.get([a6.id,C,A.id].join(af));if(ba){var a9=a6.findColByName(C),U=a6.getEditor(a9,A);if(U!=w&&($(U) instanceof aA.CheckBox)){a6.renderEditor(ba,A,a9,U)}else{ba.update(a6.renderText(A,a9,a7))}}ag(a6.columns,function(bc){if(bc.name!=C){var bb=Ext.get([a6.id,bc.name,A.id].join(af));if(bb){if(bc.editorfunction){a6.renderEditor(bb,A,bc,a6.getEditor(bc,A))}if(bc.renderer){bb.update(a6.renderText(A,bc,A.get(bc.name)))}}}});a6.drawFootBar(C)},onValid:function(a6,A,C,U){var a8=this.findColByName(C);if(a8){var a7=Ext.get([this.id,C,A.id].join(af));if(a7){if(U==J){a7.addClass(ar)}else{a7.removeClass([aF,ar])}}}},onRemove:function(a7,A,C){var a6=this,U=Ext.get(a6.id+aJ+A.id),a8=Ext.get(a6.id+aD+A.id);if(U){U.remove()}if(a8){a8.remove()}if(Ext.isIE||Ext.isIE9){a6.syncScroll()}a6.clearDomRef();aA.Masker.unmask(a6.wb);a6.drawFootBar()},onClear:function(){},onFieldChange:function(a6,A,a7,C,U){if(C==O){var a8=Ext.get([this.id,a7.name,A.id].join(af));if(a8){a8[U==ae?"addClass":"removeClass"](aF)}}},getDataIndex:function(U){for(var C=0,a6=this.dataset.data,A=a6.length;C<A;C++){if(a6[C].id==U){return C}}return -1},onSelect:function(a6,C,a7){if(!C||a7){return}var U=this,A=Ext.get(U.id+k+C.id);A.parent(aS).addClass(V);if(A){if(U.selectionmodel==aj){U.setCheckBoxStatus(A,ae)}else{U.setRadioStatus(A,ae);a6.locate((a6.currentPage-1)*a6.pagesize+a6.indexOf(C)+1)}U.setSelectStatus(C)}},onUnSelect:function(a6,C,a7){if(!C||a7){return}var U=this,A=Ext.get(U.id+k+C.id);A.parent(aS).addClass(V);if(A){if(U.selectionmodel==aj){U.setCheckBoxStatus(A,J)}else{U.setRadioStatus(A,J)}U.setSelectStatus(C)}},onSelectAll:function(){var A=this;A.clearChecked();A.isSelectAll=ae;A.isUnSelectAll=J;A.wrap.addClass(ad)},onUnSelectAll:function(){var A=this;A.clearChecked();A.isSelectAll=J;A.isUnSelectAll=ae;A.wrap.removeClass(ad)},clearChecked:function(){var A=this.wrap;A.select(aX).replaceClass(aL,aC);A.select(a0).removeClass(V)},onDblclick:function(a9,U){var a8=Ext.fly(U).parent("td[atype=grid-cell]");if(a8){var a7=this.dataset,a6=a8.getAttributeNS(w,B),A=a7.findById(a6),ba=a7.indexOf(A),C=a8.getAttributeNS(w,P);this.fireEvent(a2,this,A,ba,C)}},onClick:function(a9,bc){var ba=Ext.fly(bc).parent(a);if(ba){var a8=this,U=ba.getAttributeNS(w,aP),bb=ba.getAttributeNS(w,B),C=a8.dataset;if(U==q){var a7=C.findById(bb),bd=C.indexOf(a7),A=ba.getAttributeNS(w,P);a8.fireEvent(I,a8,bd,A,a7);a8.fireEvent(aV,a8,bd,a7)}else{if(U==a5){var a7=C.findById(bb),bd=C.indexOf(a7);if(a7.id!=a8.selectedId){a8.selectRow(bd)}}else{if(U==t){var a6=Ext.get(a8.id+k+bb);if(a6.hasClass(L)||a6.hasClass(T)){return}if(a8.isSelectAll&&!a6.parent(a0)){a6.replaceClass(aC,aL)}else{if(a8.isUnselectAll&&!a6.parent(a0)){a6.replaceClass(aL,aC)}}a6.hasClass(aL)?C.unSelect(bb):C.select(bb)}else{if(U==z){var a6=Ext.get(a8.id+k+bb);if(a6.hasClass(G)||a6.hasClass(Q)){return}C.select(bb)}}}}}},onCellClick:function(U,a6,C,A,a7){this.adjustColumn(C);this.showEditor(a6,C,a7)},adjustColumn:function(a6){var a9=this,U=a9.findColByName(a6);if(!U||!U.autoadjust||U.hidden){return}var a8=a9.wrap.select("tr.grid-hl "+a4+a6+D),C=parseInt(a8.elements[0].style.width),A=C,ba=12,a7=Math.min(a9.width-(a9.selectable?23:0)-20,U.maxadjustwidth||Number.MAX_VALUE);a9.wrap.select(ac+a6+"] span").each(function(bb){if(Ext.isIE||Ext.isIE9){bb.parent().setStyle(aW,"clip")}A=Math.max(bb.getWidth()+ba,A);if(Ext.isIE||Ext.isIE9){bb.parent().setStyle(aW,w)}if(A>a7){A=a7;return J}});A>C&&a9.setColumnSize(a6,A)},setColumnPrompt:function(C,A){this.wrap.select("td.grid-hc"+aR+C+"] div").update(A)},setEditor:function(C,U){var A=this.findColByName(C),a6=Ext.get([this.id,C,this.selectedId].join(af));A.editor=U;if(a6){if(U==w){a6.removeClass(h)}else{if(!$(U) instanceof aA.CheckBox){a6.addClass(h)}}}},getEditor:function(a6,C){var U=a6.editor||w;if(a6.editorfunction){var A=window[a6.editorfunction];if(A==ax){alert(aa+a6.editorfunction+aG);return ax}U=A(C,a6.name)||w}return U},showEditor:function(bb,A,ba){if(bb==-1){return}var a8=this,U=a8.findColByName(A);if(!U){return}var C=a8.dataset,a6=C.getAt(bb);if(!a6){return}if(a6.id!=a8.selectedId){a8.selectRow(bb)}else{a8.focusRow(bb)}a8.focusColumn(A);var a9=a8.getEditor(U,a6);a8.setEditor(A,a9);if(a9!=w){var a7=$(a9);(function(){var bd=a6.get(A),bg=Ext.get([a8.id,A,a6.id].join(af)),bf=bg.getXY(),bc;a7.bind(C,A);a7.render(a6);a7.el.on(aQ,a8.onEditorKeyDown,a8);Ext.fly(a1).on(y,a8.onEditorBlur,a8);bc=a8.currentEditor={record:a6,ov:bd,name:A,editor:a7};if(a7 instanceof aA.CheckBox){a7.move(-1000,bf[1]+5);if(ba){a7.focus()}else{a7.onClick()}bc.focusCheckBox=bg;bg.setStyle(g,aO)}else{var be=bg.parent();a7.move(bf[0],bf[1]);a7.setHeight(bg.getHeight()-2);a7.setWidth(bg.getWidth()-5);a7.isEditor=ae;a7.isFireEvent=ae;a7.isHidden=J;a7.focus();a8.editing=ae;a7.on(al,a8.onEditorSelect,a8);if(ba){ba(a7)}a8.fireEvent(au,a8,a7,bb,A,a6)}}).defer(10)}},showFirstEditor:function(){var C=this,A=C.dataset.data[0];ag(C.columns,function(U){if(U.hidden!=ae&&C.getEditor(U,A)!=w){C.fireEvent(I,C,0,U.name,A,function(){});C.fireEvent(aV,C,0,A);name=U.name;return J}})},onEditorSelect:function(){(function(){this.hideEditor()}).defer(1,this)},onEditorKeyDown:function(a7){var U=this,a6=a7.keyCode,C=U.currentEditor;if(a6==27){if(C){var A=C.editor;if(A){A.clearInvalid();A.render(A.binder.ds.getCurrentRecord())}}U.hideEditor()}else{if(a6==13){if(!(C&&C.editor&&C.editor instanceof aA.TextArea)){U.showEditorBy(39)}}else{if(a6==9){a7.stopEvent();U.showEditorBy(a7.shiftKey?37:39)}else{if(a7.ctrlKey&&(a6==37||a6==38||a6==39||a6==40)){U.showEditorBy(a6);a7.stopEvent()}}}}},findEditorBy:function(a9){var bc=this,C,bb;if((C=bc.currentEditor)&&(bb=C.editor)){var bf=bc.columns,bd=J,a8=bc.dataset,a7=bb.binder.name,A=bb.record,bh=a8.data.indexOf(A),U=ax,be=J,ba=ae,bg=J,a6;if(bh!=-1){if(a9==37||a9==38){bf=[].concat(bf).reverse();ba=J}if(a9==38||a9==40){bg=ae;a6=bc.findColByName(a7)}while(A){if(!bg){ag(bf,function(bi){if(bd){if(bi.hidden!=ae&&bc.getEditor(bi,A)!=w){U=bi.name;return J}}else{if(bi.name==a7){bd=ae}}})}if(U){return{row:bh,name:U,record:A}}A=a8.getAt(ba?++bh:--bh);if(ba&&!A&&!be&&bc.autoappend!==J){bc.hideEditor();a8.create();A=a8.getAt(bh);be=ae}if(bg&&A&&bc.getEditor(a6,A)!=w){U=a7}}}}return ax},showEditorBy:function(U){var a6=this,a8=function(a9){},C=a6.findEditorBy(U);if(C){a6.hideEditor();var a7=C.row,A=C.record;a6.fireEvent(I,a6,a7,C.name,A,a8);a6.fireEvent(aV,a6,a7,A)}},focusRow:function(a8){var a7=25,A=this.ub,U=A.getScroll().top,a6=A.getHeight(),C=A.dom.scrollWidth>A.dom.clientWidth?16:0;if(a8*a7<U){A.scrollTo(n,a8*a7-1)}else{if((a8+1)*a7>(U+a6-C)){A.scrollTo(n,(a8+1)*a7-a6+C)}}if(this.autofocus){this.focus()}},focusColumn:function(U){var ba=this,A=25,C=ba.ub,a7=C.getScroll().left,bb=0,a9=0,a6=0,a8;ag(ba.columns,function(bc){if(bc.name==U){a9=bc.width}if(bc.hidden!==ae){if(bc.lock===ae){a6+=bc.width}else{if(a9==0){bb+=bc.width}}}});a8=bb+a9;if(bb<a7){C.scrollTo(c,bb)}else{if((a8-a7)>(ba.width-a6)){C.scrollTo(c,a8-ba.width+a6+(C.dom.scrollHeight>C.dom.clientHeight?16:0))}}if(ba.autofocus){ba.focus()}},hideEditor:function(){var U=this,C=U.currentEditor;if(C){var A=C.editor;if(A){if(!A.canHide||A.canHide()){var a6=C.focusCheckBox;if(a6){a6.setStyle(g,ak);C.focusCheckBox=ax}A.el.un(aQ,U.onEditorKeyDown,U);A.un(al,U.onEditorSelect,U);Ext.fly(a1).un(y,U.onEditorBlur,U);A.move(-10000,-10000);A.onBlur();A.isFireEvent=J;A.isHidden=ae;U.editing=J;if(A.collapse){A.collapse()}}}}},onEditorBlur:function(a6,C){var U=this,A=U.currentEditor;if(A&&!A.editor.isEventFromComponent(C)){U.hideEditor.defer(Ext.isIE9?10:0,U)}},onLockHeadMove:function(C){var A=this;A.hmx=C.xy[0]-A.lht.getXY()[0];A.lh.setStyle(aN,A.isOverSplitLine(A.hmx)?Y:az)},onUnLockHeadMove:function(U){var A=this;var C=A.uht;A.hmx=U.xy[0]-(C?C.getXY()[0]+C.getScroll().left:0)+A.lockWidth;A.uh.setStyle(aN,A.isOverSplitLine(A.hmx)?Y:az)},onHeadMouseDown:function(C){var A=this;A.dragWidth=-1;if(A.overColIndex==undefined||A.overColIndex==-1){return}A.dragIndex=A.overColIndex;A.dragStart=C.getXY()[0];A.sp.setHeight(A.wrap.getHeight()).show().setStyle({top:A.wrap.getXY()[1]+am,left:C.xy[0]+am});Ext.get(a1).on(aw,A.onHeadMouseMove,A).on(ah,A.onHeadMouseUp,A)},onHeadClick:function(ba,bf){var a8=this,bb=Ext.fly(bf).parent(a),A=a8.dataset,U;if(bb){U=bb.getAttributeNS(w,aP)}if(U==F){var a9=bb.getAttributeNS(w,P),C=a8.findColByName(a9);if(C&&C.sortable===ae){if(A.isModified()){aA.showInfoMessage("提示","有未保存数据!");return}var bc=bb.child(ap),be=a9,a7=w;if(a8.currentSortTarget){a8.currentSortTarget.removeClass([aE,i])}a8.currentSortTarget=bc;if(ai(C.sorttype)){C.sorttype=aM;bc.removeClass(aE).addClass(i);a7=aM}else{if(C.sorttype==aM){C.sorttype=o;bc.removeClass(i).addClass(aE);a7=o}else{C.sorttype=w;bc.removeClass([i,aE])}}A.sort(be,a7)}}else{if(U==t){var a6=bb.child(s);if(a6){var bd=a6.hasClass(aL);a8.setCheckBoxStatus(a6,!bd);if(!bd){A.selectAll()}else{A.unSelectAll()}}}}},setRadioStatus:function(A,C){if(!C){A.removeClass(aT).addClass(aH)}else{A.addClass(aT).removeClass(aH)}},setCheckBoxStatus:function(A,C){if(!C){A.removeClass(aL).addClass(aC)}else{A.addClass(aL).removeClass(aC)}},setSelectDisable:function(U,C){var A=this.dataset.selected.indexOf(C)==-1;if(this.selectionmodel==aj){U.removeClass([aL,aC]).addClass(A?L:T)}else{U.removeClass([aT,aH,Q,G]).addClass(A?G:Q)}},setSelectEnable:function(U,C){var A=this.dataset.selected.indexOf(C)==-1;if(this.selectionmodel==aj){U.removeClass([L,T]).addClass(A?aC:aL)}else{U.removeClass([aH,aT,G,Q]).addClass(A?aH:aT)}},setSelectStatus:function(C){var U=this,a6=U.dataset;if(a6.selectfunction){var A=Ext.get(U.id+k+C.id);if(!a6.execSelectFunction(C)){U.setSelectDisable(A,C)}else{U.setSelectEnable(A,C)}}},onHeadMouseMove:function(a6){var U=this;a6.stopEvent();U.dragEnd=a6.getXY()[0];var C=U.dragEnd-U.dragStart,a7=U.columns[U.dragIndex],A=a7.width+C;if(A>30&&A<U.width){U.dragWidth=A;U.sp.setStyle(c,a6.xy[0]+am)}},onHeadMouseUp:function(C){var A=this;Ext.get(a1).un(aw,A.onHeadMouseMove,A).un(ah,A.onHeadMouseUp,A);A.sp.hide();if(A.dragWidth!=-1){A.setColumnSize(A.columns[A.dragIndex].name,A.dragWidth)}A.syncScroll()},findColByName:function(A){var C;if(A){ag(this.columns,function(U){if(U.name&&U.name.toLowerCase()===A.toLowerCase()){C=U;return J}})}return C},selectRow:function(a8,C){var a6=this,a7=a6.dataset,A=a7.getAt(a8),U=(a7.currentPage-1)*a7.pagesize+a8+1;a6.selectedId=A.id;if(a6.selectlockTr){a6.selectlockTr.removeClass(ab)}if(a6.selectUnlockTr){a6.selectUnlockTr.removeClass(ab)}a6.selectUnlockTr=Ext.get(a6.id+aD+A.id);if(a6.selectUnlockTr){a6.selectUnlockTr.addClass(ab)}a6.selectlockTr=Ext.get(a6.id+aJ+A.id);if(a6.selectlockTr){a6.selectlockTr.addClass(ab)}a6.focusRow(a8);a6.selectRecord=A;if(C!==J&&U!=ax){a7.locate.defer(5,a7,[U,J])}},setColumnSize:function(A,bc){var a7=this,a8,a6,U=0,C=0;ag(a7.columns,function(bd){if(bd.name&&bd.name===A){if(bd.hidden===ae){return}bd.width=bc;if(bd.lock!==ae){a8=a7.uh.child(a4+A+D);a6=a7.ub.child(a4+A+D)}else{if(a7.lh){a8=a7.lh.child(a4+A+D)}if(a7.lb){a6=a7.lb.child(a4+A+D)}}}if(bd.hidden!==ae){bd.lock!==ae?(C+=bd.width):(U+=bd.width)}});a7.wrap.select(ac+A+"] DIV.grid-cell").each(function(bd){bd.setStyle(R,Math.max(bc-(bd.hasClass(h)?7:4),0)+am)});a7.unlockWidth=C;a7.lockWidth=U;if(a8){a8.setStyle(R,bc+am)}if(a6){a6.setStyle(R,bc+am)}var bb=Math.max(a7.width-U,0);if(a7.fb){a7.fb.child(a4+A+D).setStyle(R,bc+am);a7.uf.setStyle(R,bb+am);a7.fb.child("table[atype=fb.ubt]").setStyle(R,C+am);var ba=a7.fb.child("table[atype=fb.lbt]");if(ba){a7.fb.child("div[atype=grid.lf]").setStyle(R,(U-1)+am);ba.setStyle(R,U+am)}}if(a7.lc){var a9=Math.max(U-1,0);a7.lc.setStyle({width:a9+am,display:a9==0?ak:w})}if(a7.lht){a7.lht.setStyle(R,U+am)}if(a7.lbt){a7.lbt.setStyle(R,U+am)}a7.uc.setStyle(R,bb+am);a7.uh.setStyle(R,bb+am);a7.ub.setStyle(R,bb+am);a7.uht.setStyle(R,C+am);if(a7.ubt){a7.ubt.setStyle(R,C+am)}a7.syncSize()},drawFootBar:function(C){var A=this;if(!A.fb){return}ag([].concat(C?C:A.columns),function(a9){var a7=Ext.isString(a9)?A.findColByName(a9):a9;if(a7&&a7.footerrenderer){var a8=aA.getRenderer(a7.footerrenderer);if(a8==ax){alert(aa+a7.footerrenderer+aG);return}var a6=a7.name,U=a8(A.dataset.data,a6);if(!ai(U)){A.fb.child(ac+a6+D).update(U)}}})},syncSize:function(){var A=this,U=0;ag(A.columns,function(a6){if(a6.hidden!==ae){if(a6.lock===ae){U+=a6.width}}});if(U!=0){var C=A.width-U;A.uc.setWidth(C);A.uh.setWidth(C);A.ub.setWidth(C)}},classfiyColumns:function(){var A=this;A.lockColumns=[],A.unlockColumns=[];A.lockWidth=0,A.unlockWidth=0;ag(A.columns,function(C){if(C.lock===ae){A.lockColumns.add(C);if(C.hidden!==ae){A.lockWidth+=C.width}}else{A.unlockColumns.add(C);if(C.hidden!==ae){A.unlockWidth+=C.width}}});A.columns=A.lockColumns.concat(A.unlockColumns)},showColumn:function(C){var A=this.findColByName(C);if(A){if(A.hidden===ae){delete A.hidden;A.forexport=ae;this.setColumnSize(C,A.hiddenwidth||A.width);delete A.hiddenwidth;this.wrap.select(ac+C+D).show()}}},hideColumn:function(C){var A=this.findColByName(C);if(A){if(A.hidden!==ae){A.hiddenwidth=A.width;this.setColumnSize(C,0,J);this.wrap.select(ac+C+D).hide();A.hidden=ae;A.forexport=J}}},removeColumn:function(A){var ba=this,bc=ba.columns,bd=[],a9=[];ag(A,function(bf){col=ba.findColByName(bf);if(!col){return}if(col.lock){bd.push(bf)}else{a9.push(bf)}bc.splice(bc.indexOf(col),1)});var a8=bd.length,a7=a9.length,U=[];if(a8||a7){ba.classfiyColumns();if(a8){var C=ba.lockWidth,be=ba.wrap.getWidth()-C;for(var a6=0;a6<a8;a6++){U.push(aR+bd[a6]+D)}if(C){ba.lht.setWidth(C);ba.lc.setWidth(C);ba.lbt.dom.width=C}else{ba.lc.remove()}ba.uc.setWidth(be);ba.uh.setWidth(be);ba.ub.setWidth(be)}for(var a6=0;a6<a7;a6++){U.push(aR+a9[a6]+D)}ba.wrap.select(U.join(",")).remove();var bb=ba.unlockWidth;ba.uht.setWidth(bb);ba.ubt.setWidth(bb)}},createHead:Ext.isIE||Ext.isIE9?function(a9,ba,U,a8,C){var A=a8.query(aY),a6=Ext.fly(A[0]).child("th[width=20]"),a7;if(U){a7=a8.query(aR+U+D)[0]}if(ba==aU){a7=a7.nextSibling||ax;C++}else{if(ba==e){if(a6){a7=a6.dom}C=-1}}ag(a9,function(bf){var bc=Ext.get(aB.createElement(a3)),be=Ext.get(A[1].insertCell(C)),bb=bf.width,bd=bf.name;if(C>-1){C++}be.addClass("grid-hc").set({dataindex:bd,atype:F}).update("<div>"+bf.prompt+"</div>");if(a7){A[0].insertBefore(bc.dom,a7)}else{A[0].appendChild(bc.dom)}bc.setStyle(R,bb+am).set({dataindex:bd})})}:function(a9,ba,A,a7){var C=[],a6=[],U=a7.query(ba!=e?aR+A+D:aY);ag(a9,function(bb){C.push('<th style="width:',bb.width,am,';" ',P,'="',bb.name,'"></th>');a6.push('<td class="grid-hc" atype="grid.head" ',P,'="',bb.name,'"><div>',bb.prompt,"</div></td>")});new Ext.Template(C.join(w))[ba](U[0],{});new Ext.Template(a6.join(w))[ba](U[1],{});var a8=Ext.fly(U[0]).child("th[width=20]");if(a8){a8.appendTo(Ext.fly(U[0]))}},addColumn:function(bi,C,a8){var a9=this;if(a9.dataset.isModified()){aA.showInfoMessage(_lang["grid.info"],_lang["grid.info.continue"])}else{var be=a9.columns,ba=be.length,bh,bf;if(C&&a8){var a6=a9.findColByName(C);if(a6){bh=a6.lock;bf=a9[bh?"lockColumns":"unlockColumns"].indexOf(a6);ba=(a8==f?0:1)+be.indexOf(a6)}else{alert("未找到列"+C);return}}var bg=[],a7=[];ag(bi,function(bl){var bk=Ext.apply(Ext.apply({},m),bl),bj=a9.findColByName(bk.name);if(bj){return}if(bk.lock){bg.push(bk)}else{a7.push(bk)}});var U=bg.concat(a7);if(U.length){var A=a8?(a8==f?aI:aU):e,bd=umethod=A,bb=uname=C,bc=a9.wrap;if(bh){umethod=aI;uname=a9.unlockColumns[0].name}else{bd=e;bb=ax}a9.columns=be.slice(0,ba).concat(U).concat(be.slice(ba));a9.classfiyColumns();if(bg.length){if(!a9.lht){a9.lc=new Ext.Template("<DIV class='grid-la' atype='grid.lc' style='width:24px;'><DIV class='grid-lh' atype='grid.lh' unselectable='on' onselectstart='return false;' style='height:25px;'><TABLE cellSpacing='0' atype='grid.lht' cellPadding='0' border='0' style='width:25px'><TBODY><TR class='grid-hl'></TR><TR height=25></TR></TBODY></TABLE></DIV><DIV class='grid-lb' atype='grid.lb' style='width:100%;height:255px'></DIV></DIV>").insertFirst(a9.wrap.dom,{},ae);a9.lh=bc.child("div[atype=grid.lh]");a9.lb=bc.child("div[atype=grid.lb]");a9.lht=bc.child("table[atype=grid.lht]");a9.lb[aK](p,a9.onClick,a9)[aK](a2,a9.onDblclick,a9);a9.lht[aK](aw,a9.onLockHeadMove,a9);a9.lh[aK](y,a9.onHeadMouseDown,a9)[aK](p,a9.onHeadClick,a9)}a9.createHead(bg,bd,bb,a9.lht,bf)}if(a7.length){a9.createHead(a7,umethod,uname,a9.uht,bf)}if(a9.lb){a9.lb.update(w)}a9.ub.update(w);ag(U,function(bj){a9.setColumnSize(bj.name,bj.width)});a9.dataset.query()}}},insertColumnBefore:function(C,A){this.addColumn(A,C,f)},insertColumnAfter:function(C,A){this.addColumn(A,C,1)},setWidth:function(U){var a6=this;if(a6.width==U){return}a6.width=U;a6.wrap.setWidth(U);var C=aA.CmpManager.get(a6.id+b);if(C){C.setWidth(U)}var A=aA.CmpManager.get(a6.id+l);if(A){A.setWidth(U)}if(a6.fb){a6.fb.setWidth(U)}var a7=U-a6.lockWidth;a6.uc.setWidth(a7);a6.uh.setWidth(a7);a6.ub.setWidth(a7);if(a6.uf){a6.uf.setWidth(a7)}},setHeight:function(a6){var a7=this;if(a7.height==a6){return}a7.height=a6;var C=aA.CmpManager.get(a7.id+b);if(C){a6-=25}var A=aA.CmpManager.get(a7.id+l);if(A){a6-=25}if(a7.fb){a6-=25}a7.wrap.setHeight(a6);var U=a6-25;if(a7.lb){a7.lb.setHeight(U)}a7.ub.setHeight(U)},deleteSelectRows:function(U){var C=this.dataset,A=[].concat(C.getSelected());if(A.length>0){C.remove(A)}},remove:function(){var A=this.dataset.getSelected();if(A.length>0){aA.showConfirm(_lang["grid.remove.confirm"],_lang["grid.remove.confirmMsg"],this.deleteSelectRows.createDelegate(this))}},clear:function(){var C=this.dataset,A=C.getSelected();while(A[0]){C.removeLocal(A[0])}},_export:function(C,A,U){this.exportOptions={type:C,filename:A,separator:U};this.showExportConfirm()},showExportConfirm:function(){this.initColumnPrompt();var C=this,a7=0,a6=C.id+"_export",U=['<div class="item-export-wrap" style="margin:15px;width:270px" id="',a6,'">','<div class="grid-uh" atype="grid.uh" style="width: 270px; -moz-user-select: none; text-align: left; height: 25px; cursor: default;" onselectstart="return false;" unselectable="on">','<table cellSpacing="0" cellPadding="0" border="0"><tbody><tr height="25px">','<td class="export-hc" style="width:22px;" atype="export.rowcheck"><center><div atype="export.headcheck" class="',aZ,aC,'"></div></center></td>','<td class="export-hc" style="width:222px;" atype="grid-type">',_lang["grid.export.column"],"</td>","</tr></tbody></table></div>",'<div style="overflow:auto;height:200px;"><table cellSpacing="0" cellPadding="0" border="0"><tbody>'],A=ae;ag(C.columns,function(a9,a8){if(!C.isFunctionCol(a9.type)){if(A){A=a9.forexport!==J}U.push("<tr",(a7+a8)%2==0?w:' class="',d,'"','><td class="',E,'" style="width:22px;" ',B,'="',a8,'" atype="export.rowcheck"><center><div id="',C.id,k,a8,'" class="',aZ,a9.forexport===J?aC:aL,'"></div></center></td><td><div class="',q,'" style="width:220px">',a9.prompt,a9.hidden?'<div style="float:right;color:red">&lt;隐藏列&gt;</div>':w,"</div></td></tr>")}else{a7++}});if(A){U[7]=aL}U.push("</tbody></table></div></div>");C.exportwindow=aA.showOkCancelWindow(_lang["grid.export.config"],U.join(w),function(a8){aA.showConfirm(_lang["grid.export.confirm"],_lang["grid.export.confirmMsg"],function(a9){C.doExport();a9.close();a8.body.un(p,C.onExportClick,C);a8.close()});return J},ax,ax,300);C.exportwindow.body.on(p,C.onExportClick,C)},initColumnPrompt:function(){var A=this;if(!A.isPromptInit){ag(A.columns,function(C){if(!A.isFunctionCol(C.type)){C.prompt=C.name?A.wrap.child("td.grid-hc"+aR+C.name+"] div").dom.innerHTML:(C.prompt||A.dataset.getField(C.name).pro.prompt)}});A.isPromptInit=ae}},onExportClick:function(a7,bd){var a6=this,a8=Ext.fly(bd).parent(a);if(a8){var A=a8.getAttributeNS(w,aP);if(A=="export.rowcheck"){var bb=a8.getAttributeNS(w,B),C=a8.child(ap),ba=C.hasClass(aL),U=C.getAttributeNS(w,aP),a9=a6.columns;a6.setCheckBoxStatus(C,!ba);if(U=="export.headcheck"){var bc=(a6.isFunctionCol(a9[0].type)?1:0)+(a6.isFunctionCol(a9[1].type)?1:0);a6.exportwindow.body.select("td[atype=export.rowcheck] div[atype!=export.headcheck]").each(function(be,bg,bf){a6.setCheckBoxStatus(be,!ba);a9[bf+bc].forexport=!ba})}else{a9[bb].forexport=!ba}}}},doExport:function(){var C=this,A=C.exportOptions;C.initColumnPrompt();aA.doExport(C.dataset,C.columns,null,A.type,A.separator,A.filename);delete C.exportOptions},destroy:function(){aA.Grid.superclass.destroy.call(this);this.processDataSetLiestener("un");this.sp.remove();delete this.sp}});aA.Grid.revision="$Rev$"})($A);