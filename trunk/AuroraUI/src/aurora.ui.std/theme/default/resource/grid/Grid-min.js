$A.Grid=Ext.extend($A.Component,{bgc:"background-color",scor:"#dfeaf5",ocor:"#ffe3a8",cecls:"cell-editor",nbcls:"item-notBlank",constructor:function(a){this.overId=null;this.selectedId=null;this.lockWidth=0;this.autofocus=a.autofocus||true;$A.Grid.superclass.constructor.call(this,a)},initComponent:function(b){$A.Grid.superclass.initComponent.call(this,b);var e=this.wrap;this.wb=Ext.get(this.id+"_wrap");this.fb=this.wb.child("div[atype=grid.fb]");if(this.fb){this.uf=this.fb.child("div[atype=grid.uf]")}this.uc=e.child("div[atype=grid.uc]");this.uh=e.child("div[atype=grid.uh]");this.ub=e.child("div[atype=grid.ub]");this.uht=e.child("table[atype=grid.uht]");this.lc=e.child("div[atype=grid.lc]");this.lh=e.child("div[atype=grid.lh]");this.lb=e.child("div[atype=grid.lb]");this.lht=e.child("table[atype=grid.lht]");this.sp=e.child("div[atype=grid.spliter]");Ext.getBody().insertFirst(this.sp);this.fs=e.child("a[atype=grid.focus]");this.lockColumns=[],this.unlockColumns=[];this.lockWidth=0,this.unlockWidth=0;for(var d=0,a=this.columns.length;d<a;d++){var f=this.columns[d];if(f.lock===true){this.lockColumns.add(f);if(f.hidden!==true){this.lockWidth+=f.width}}else{this.unlockColumns.add(f);if(f.hidden!==true){this.unlockWidth+=f.width}}}this.columns=this.lockColumns.concat(this.unlockColumns);this.initTemplate()},processListener:function(a){$A.Grid.superclass.processListener.call(this,a);this.wrap[a]("mouseover",this.onMouseOver,this);this.wrap[a]("mouseout",this.onMouseOut,this);this.wrap[a]("click",this.focus,this);this.wb[a]("mousewheel",this.onMouseWheel,this);this.fs[a](Ext.isOpera?"keypress":"keydown",this.handleKeyDown,this);this.ub[a]("scroll",this.syncScroll,this);this.ub[a]("click",this.onClick,this);this.ub[a]("dblclick",this.onDblclick,this);this.uht[a]("mousemove",this.onUnLockHeadMove,this);this.uh[a]("mousedown",this.onHeadMouseDown,this);this.uh[a]("click",this.onHeadClick,this);if(this.lb){this.lb[a]("click",this.onClick,this);this.lb[a]("dblclick",this.onDblclick,this)}if(this.lht){this.lht[a]("mousemove",this.onLockHeadMove,this)}if(this.lh){this.lh[a]("mousedown",this.onHeadMouseDown,this)}if(this.lh){this.lh[a]("click",this.onHeadClick,this)}},initEvents:function(){$A.Grid.superclass.initEvents.call(this);this.addEvents("render","keydown","dblclick","cellclick","rowclick","editorshow")},syncScroll:function(){this.hideEditor();this.uh.dom.scrollLeft=this.ub.dom.scrollLeft;if(this.lb){this.lb.dom.scrollTop=this.ub.dom.scrollTop}if(this.uf){this.uf.dom.scrollLeft=this.ub.dom.scrollLeft}},handleKeyDown:function(m){var q=m.getKey();if(m.ctrlKey&&m.keyCode==86&&this.canpaste){var s=window.clipboardData.getData("text");if(s){var a=this.columns;var u=s.split("\n");for(var h=0,b=u.length;h<b;h++){var t=u[h];var p=t.split("\t");if(p==""){continue}var g={};for(var f=0,o=0,d=this.columns.length;f<d;f++){var n=this.columns[f];if(this.isFunctionCol(n)){continue}if(n.hidden!==true){g[n.name]=p[o];o++}}this.dataset.create(g)}}}else{if(q==38||q==40||q==33||q==34){if(this.dataset.loading==true){return}var t;switch(m.getKey()){case 33:this.dataset.prePage();break;case 34:this.dataset.nextPage();break;case 38:this.dataset.pre();break;case 40:this.dataset.next();break}}}this.fireEvent("keydown",this,m)},processDataSetLiestener:function(a){var b=this.dataset;if(b){b[a]("ajaxfailed",this.onAjaxFailed,this);b[a]("metachange",this.onRefresh,this);b[a]("update",this.onUpdate,this);b[a]("reject",this.onUpdate,this);b[a]("add",this.onAdd,this);b[a]("submit",this.onBeforSubmit,this);b[a]("submitfailed",this.onAfterSuccess,this);b[a]("submitsuccess",this.onAfterSuccess,this);b[a]("query",this.onBeforeLoad,this);b[a]("load",this.onLoad,this);b[a]("loadfailed",this.onAjaxFailed,this);b[a]("valid",this.onValid,this);b[a]("beforeremove",this.onBeforeRemove,this);b[a]("remove",this.onRemove,this);b[a]("clear",this.onLoad,this);b[a]("refresh",this.onRefresh,this);b[a]("fieldchange",this.onFieldChange,this);b[a]("indexchange",this.onIndexChange,this);b[a]("select",this.onSelect,this);b[a]("unselect",this.onUnSelect,this)}},bind:function(b){if(typeof(b)==="string"){b=$(b);if(!b){return}}var a=this;a.dataset=b;if(b.autopagesize===true){b.pagesize=Math.round(((this.ub.getHeight()||parseFloat(this.ub.dom.style.height))-16)/25)}a.processDataSetLiestener("on");this.onLoad()},initTemplate:function(){this.rowTdTpl=new Ext.Template('<td atype="{atype}" class="grid-rowbox" recordid="{recordid}">');this.tdTpl=new Ext.Template('<td style="visibility:{visibility};text-align:{align}" dataindex="{name}" atype="grid-cell" recordid="{recordid}">');this.cellTpl=new Ext.Template('<div class="grid-cell {cellcls}" style="width:{width}px" id="'+this.id+'_{name}_{recordid}">{text}</div>');this.cbTpl=new Ext.Template('<center><div class="{cellcls}" id="'+this.id+'_{name}_{recordid}"></div></center>')},getCheckBoxStatus:function(a,c){var f=this.dataset.getField(c);var b=f.getPropertity("checkedvalue");var d=f.getPropertity("uncheckedvalue");var e=a.data[c];return(e&&e==b)?"item-ckb-c":"item-ckb-u"},createTemplateData:function(b,a){return{width:b.width-2,recordid:a.id,visibility:b.hidden===true?"hidden":"visible",name:b.name}},createCell:function(b,g,i){var e=this.createTemplateData(b,g);var m;var d=this.tdTpl;var n="";var c=b.type;var h=this.getEditor(b,g);if(h!=""){var j=$A.CmpManager.get(h);if(j&&(j instanceof $A.CheckBox)){c="cellcheck";n=""}else{n=this.cecls}}if(c=="rowcheck"||c=="rowradio"){var f="";if(!this.dataset.execSelectFunction(g)){f="-readonly"}d=this.rowTdTpl;e=Ext.apply(e,{align:"center",atype:c=="rowcheck"?"grid.rowcheck":"grid.rowradio",cellcls:c=="rowcheck"?"grid-ckb item-ckb"+f+"-u":"grid-radio item-radio-img"+f+"-u"});m=this.cbTpl}else{if(c=="cellcheck"){e=Ext.apply(e,{align:"center",cellcls:"grid-ckb "+this.getCheckBoxStatus(g,b.name)});m=this.cbTpl}else{var l=g.getMeta().getField(b.name);if(l&&Ext.isEmpty(g.data[b.name])&&g.isNew==true&&l.get("required")==true){n=n+" "+this.nbcls}var a=(n.indexOf(this.cecls)!=-1)?5:2;e=Ext.apply(e,{align:b.align||"left",cellcls:n,width:e.width-a,text:this.renderText(g,b,g.data[b.name])});m=this.cellTpl}}var k=[];if(i){k.add(d.applyTemplate(e))}k.add(m.applyTemplate(e));if(i){k.add("</td>")}return k.join("")},createRow:function(f,k,h,j){var g=[];var d=this.parseCss(this.renderRow(j,k));g.add('<tr id="'+this.id+"$"+f+"-"+j.id+'" class="'+(k%2==0?"":"row-alt")+d.cls+'"style="'+d.style+'">');for(var b=0,a=h.length;b<a;b++){var e=h[b];g.add(this.createCell(e,j,true))}g.add("</tr>");return g.join("")},parseCss:function(c){var e="",a="";if(Ext.isArray(c)){for(var b=0;b<c.length;b++){var d=this.parseCss(c[b]);e+=";"+d.style;a+=" "+d.cls}}else{if(typeof c=="string"){isStyle=!!c.match(/^([^,:;]+:[^:;]+;)*[^,:;]+:[^:;]+;*$/);a=isStyle?"":c;e=isStyle?c:""}}return{style:e,cls:a}},renderText:function(a,b,e){var d=b.renderer;if(d){var c=$A.getRenderer(d);if(c==null){alert("未找到"+d+"方法!");return e}e=c.call(window,e,a,b.name);return e==null?"":e}return e==null?"":e},renderRow:function(a,e){var d=this.rowrenderer,b=null;if(d){var c=$A.getRenderer(d);if(c==null){alert("未找到"+d+"方法!");return b}b=c.call(window,a,e);return !b?"":b}return b},createTH:function(d){var e=[];e.add('<tr class="grid-hl">');for(var c=0,b=d.length;c<b;c++){var a=d[c].width;if(d[c].hidden===true){a=0}e.add('<th dataindex="'+d[c].name+'" style="height:0px;width:'+a+'px"></th>')}e.add("</tr>");return e.join("")},onBeforeRemove:function(){$A.Masker.mask(this.wb,_lang["grid.mask.remove"])},onBeforeLoad:function(){$A.Masker.mask(this.wb,_lang["grid.mask.loading"])},onBeforSubmit:function(a){$A.Masker.mask(this.wb,_lang["grid.mask.submit"])},onAfterSuccess:function(){$A.Masker.unmask(this.wb)},preLoad:function(){},onLoad:function(){this.clearDomRef();this.preLoad();var a=Ext.fly(this.wrap).child("div[atype=grid.headcheck]");if(this.selectable&&this.selectionmodel=="multiple"){this.setCheckBoxStatus(a,false)}if(this.lb){this.renderLockArea()}this.renderUnLockAread();this.drawFootBar();$A.Masker.unmask(this.wb);this.fireEvent("render",this)},clearDomRef:function(){this.selectlockTr=null;this.selectUnlockTr=null},onAjaxFailed:function(b,a){$A.Masker.unmask(this.wb)},onMouseWheel:function(b){if(this.editing==true){return}var c=b.getWheelDelta(),a=this;if(c>0){a.dataset.pre();b.stopEvent()}else{if(c<0){a.dataset.next();b.stopEvent()}}},focus:function(){this.fs.focus()},renderLockArea:function(){var d=[];var c=this.lockColumns;d.add('<TABLE cellSpacing="0" atype="grid.lbt" cellPadding="0" border="0"  width="'+this.lockWidth+'"><TBODY>');d.add(this.createTH(c));for(var b=0,a=this.dataset.data.length;b<a;b++){d.add(this.createRow("l",b,c,this.dataset.getAt(b)))}d.add("</TBODY></TABLE>");d.add('<DIV style="height:17px"></DIV>');this.lb.update(d.join(""));this.lbt=this.lb.child("table[atype=grid.lbt]")},renderUnLockAread:function(){var d=[];var c=this.unlockColumns;d.add('<TABLE cellSpacing="0" atype="grid.ubt" cellPadding="0" border="0" width="'+this.unlockWidth+'"><TBODY>');d.add(this.createTH(c));for(var b=0,a=this.dataset.data.length;b<a;b++){d.add(this.createRow("u",b,c,this.dataset.getAt(b)))}d.add("</TBODY></TABLE>");this.ub.update(d.join(""));this.ubt=this.ub.child("table[atype=grid.ubt]")},isOverSplitLine:function(a){var d=0;var g=false;this.overColIndex=-1;var f=this.columns;for(var e=0,b=f.length;e<b;e++){var h=f[e];if(h.hidden!==true){d+=h.width}if(a<d+3&&a>d-3&&h.resizable!=false){g=true;this.overColIndex=e;break}}return g},onRefresh:function(){this.onLoad(false)},onIndexChange:function(c,b){var a=this.getDataIndex(b.id);if(a==-1){return}if(b!=this.selectRecord){this.selectRow(a,false)}},isFunctionCol:function(a){return a.type=="rowcheck"||a.type=="rowradio"},onAdd:function(d,j,m){if(this.lb){var n=[]}var o=[];var q=0;var g=this.columns;var s=this.dataset.data.length-1;var k=this.parseCss(this.renderRow(j,s));if(this.lbt){var b=document.createElement("tr");b.id=this.id+"$l-"+j.id;b.className=(s%2==0?"":"row-alt")+" "+k.cls;Ext.fly(b).set({style:k.style});for(var h=0,f=g.length;h<f;h++){var c=g[h];if(c.lock===true){var e=document.createElement("td");if(c.type=="rowcheck"){Ext.fly(e).set({recordid:j.id,atype:"grid.rowcheck"});e.className="grid-rowbox"}else{e.style.visibility=c.hidden===true?"hidden":"visible";e.style.textAlign=c.align||"left";if(!this.isFunctionCol(c)){e.dataindex=c.name}Ext.fly(e).set({dataindex:c.name,recordid:j.id,atype:"grid-cell"})}var p=this.createCell(c,j,false);e.innerHTML=p;b.appendChild(e)}}this.lbt.dom.tBodies[0].appendChild(b)}var a=document.createElement("tr");a.id=this.id+"$u-"+j.id;a.className=(s%2==0?"":"row-alt")+" "+k.cls;Ext.fly(a).set({style:k.style});for(var h=0,f=g.length;h<f;h++){var c=g[h];if(c.lock!==true){var e=document.createElement("td");e.style.visibility=c.hidden===true?"hidden":"visible";e.style.textAlign=c.align||"left";Ext.fly(e).set({dataindex:c.name,recordid:j.id,atype:"grid-cell"});var p=this.createCell(c,j,false);e.innerHTML=p;a.appendChild(e)}}this.ubt.dom.tBodies[0].appendChild(a);this.setSelectStatus(j)},renderEditor:function(f,b,e,d){var a=this.createCell(e,b,false);f.parent().update(a)},onUpdate:function(d,g,b,m){this.setSelectStatus(g);var a=Ext.get(this.id+"_"+b+"_"+g.id);if(a){var j=this.findColByName(b);var h=this.getEditor(j,g);if(h!=""&&($(h) instanceof $A.CheckBox)){this.renderEditor(a,g,j,h)}else{var n=this.renderText(g,j,m);a.update(n)}}var o=this.columns;for(var f=0,e=o.length;f<e;f++){var j=o[f];if(j.name!=b){var k=Ext.get(this.id+"_"+j.name+"_"+g.id);if(k){if(j.editorfunction){var h=this.getEditor(j,g);this.renderEditor(k,g,j,h)}if(j.renderer){var n=this.renderText(g,j,g.get(j.name));k.update(n)}}}}this.drawFootBar(b)},onValid:function(e,a,b,d){var g=this.findColByName(b);if(g){var f=Ext.get(this.id+"_"+b+"_"+a.id);if(f){if(d==false){f.addClass("item-invalid")}else{f.removeClass([this.nbcls,"item-invalid"])}}}},onRemove:function(d,a,b){var c=Ext.get(this.id+"$l-"+a.id);if(c){c.remove()}var e=Ext.get(this.id+"$u-"+a.id);if(e){e.remove()}this.clearDomRef();$A.Masker.unmask(this.wb);this.drawFootBar()},onClear:function(){},onFieldChange:function(d,a,e,b,c){switch(b){case"required":var f=Ext.get(this.id+"_"+e.name+"_"+a.id);if(f){(c==true)?f.addClass(this.nbcls):f.removeClass(this.nbcls)}break}},getDataIndex:function(d){var b=-1;for(var c=0,a=this.dataset.data.length;c<a;c++){var e=this.dataset.getAt(c);if(e.id==d){b=c;break}}return b},onSelect:function(c,b){var a=Ext.get(this.id+"__"+b.id);if(a&&this.selectable&&this.selectionmodel=="multiple"){this.setCheckBoxStatus(a,true)}else{this.setRadioStatus(a,true)}},onUnSelect:function(c,b){var a=Ext.get(this.id+"__"+b.id);if(a&&this.selectable&&this.selectionmodel=="multiple"){this.setCheckBoxStatus(a,false)}else{this.setRadioStatus(a,false)}},onDblclick:function(f){var d=Ext.fly(f.target).findParent("td[atype=grid-cell]");if(d){var c=Ext.fly(d).getAttributeNS("","recordid");var a=this.dataset.findById(c);var g=this.dataset.indexOf(a);var b=Ext.fly(d).getAttributeNS("","dataindex");this.fireEvent("dblclick",this,a,g,b)}},onClick:function(f){var g=Ext.fly(f.target).findParent("td");if(g){var b=Ext.fly(g).getAttributeNS("","atype");var i=Ext.fly(g).getAttributeNS("","recordid");if(b=="grid-cell"){var d=this.dataset.findById(i);var j=this.dataset.indexOf(d);var a=Ext.fly(g).getAttributeNS("","dataindex");this.showEditor(j,a);this.fireEvent("cellclick",this,j,a,d);this.fireEvent("rowclick",this,j,d)}else{if(b=="grid.rowcheck"){var c=Ext.get(this.id+"__"+i);if(c.hasClass("item-ckb-readonly-u")){return}var h=c.hasClass("item-ckb-c");(h)?this.dataset.unSelect(i):this.dataset.select(i)}else{if(b=="grid.rowradio"){var c=Ext.get(this.id+"__"+i);if(c.hasClass("item-radio-img-readonly-u")){return}this.dataset.select(i)}}}}},setColumnPrompt:function(c,a){var e=Ext.DomQuery.select("td.grid-hc",this.wrap.dom);for(var d=0,b=e.length;d<b;d++){var h=e[d];var f=Ext.fly(h).getAttributeNS("","dataindex");if(f==c){var g=Ext.fly(h).child("div");g.update(a);break}}},setEditor:function(b,c){var a=this.findColByName(b);a.editor=c;var d=Ext.get(this.id+"_"+b+"_"+this.selectRecord.id);if(d){(c=="")?d.removeClass(this.cecls):d.addClass(this.cecls)}},getEditor:function(d,b){var c=d.editor||"";if(d.editorfunction){var a=window[d.editorfunction];if(a==null){alert("未找到"+d.editorfunction+"方法!");return null}c=a.call(window,b,d.name)}return c},showEditor:function(l,a){if(l==-1){return}var c=this.findColByName(a);if(!c){return}var f=this.dataset.getAt(l);if(!f){return}if(f.id!=this.selectedId){this.selectRow(l)}this.focusColumn(a);var h=this.getEditor(c,f);this.setEditor(a,h);if(h!=""&&($(h) instanceof $A.CheckBox)){var i=this.dataset.getField(a);var e=i.getPropertity("checkedvalue");var b=i.getPropertity("uncheckedvalue");var j=f.get(a);f.set(a,j==e?b:e)}else{if(h){var d=document.getElementById(this.id+"_"+a+"_"+f.id);var k=Ext.fly(d).getXY();var g=this;setTimeout(function(){var n=f.get(a);g.currentEditor={record:f,ov:n,name:a,editor:$(h)};var m=g.currentEditor.editor;if(m){m.setHeight(Ext.fly(d.parentNode).getHeight()-5);m.setWidth(Ext.fly(d.parentNode).getWidth()-7);m.isFireEvent=true;m.isHidden=false;m.move(k[0],k[1]);m.bind(g.dataset,a);m.render(f);m.focus();g.editing=true;m.on("keydown",g.onEidtorKeyDown,g);Ext.get(document.documentElement).on("mousedown",g.onEditorBlur,g)}g.fireEvent("editorshow",g,m,l,a,f)},1)}}},onEidtorKeyDown:function(a,c){var b=c.keyCode;if(b==27){a.clearInvalid();a.render(a.binder.ds.getCurrentRecord());this.hideEditor()}if(b==13){this.showNextEditor()}if(b==9){c.stopEvent();this.showNextEditor()}},showNextEditor:function(){this.hideEditor();if(this.currentEditor&&this.currentEditor.editor){var j=this.currentEditor.editor,f=j.binder.ds,e=j.binder.name,a=j.record,o=f.data.indexOf(a),b=null;if(o!=-1){var n=this.columns;var c=0;for(var h=0,g=n.length;h<g;h++){if(n[h].name==e){c=h+1}}for(var h=c,g=n.length;h<g;h++){var d=n[h];var k=this.getEditor(d,a);if(k!=""){b=d.name;break}}if(b){this.showEditor(o,b)}else{var m=f.getAt(o+1);if(m){for(var h=0,g=n.length;h<g;h++){var d=n[h];var k=this.getEditor(d,a);if(k!=""){this.showEditor(o+1,d.name);break}}}}}}},focusRow:function(d){var c=25;var b=this.ub.getScroll().top;if(d*c<b){this.ub.scrollTo("top",d*c-1)}if((d+1)*c>(b+this.ub.getHeight())){var a=this.ub.dom.scrollWidth>this.ub.dom.clientWidth?(d+1)*c-this.ub.getHeight()+16:(d+1)*c-this.ub.getHeight();this.ub.scrollTo("top",a)}if(this.autofocus){this.focus()}},focusColumn:function(b){var f=25;var e=this.ub.getScroll().left;var g=lr=lw=tw=0;for(var d=0,a=this.columns.length;d<a;d++){var h=this.columns[d];if(h.name&&h.name==b){tw=h.width}if(h.hidden!==true){if(h.lock===true){lw+=h.width}else{if(tw==0){g+=h.width}}}}lr=g+tw;if(g<e){this.ub.scrollTo("left",g)}if((lr-e)>(this.width-lw)){this.ub.scrollTo("left",lr-this.width+lw)}if(this.autofocus){this.focus()}},hideEditor:function(){if(this.currentEditor&&this.currentEditor.editor){var a=this.currentEditor.editor;var b=true;if(a.canHide){b=a.canHide()}if(b){a.un("keydown",this.onEidtorKeyDown,this);Ext.get(document.documentElement).un("mousedown",this.onEditorBlur,this);var a=this.currentEditor.editor;a.move(-10000,-10000);a.isFireEvent=false;a.isHidden=true}a.blur();this.editing=false}},onEditorBlur:function(a){if(this.currentEditor&&!this.currentEditor.editor.isEventFromComponent(a.target)){this.hideEditor()}},onLockHeadMove:function(a){this.hmx=a.xy[0]-this.lht.getXY()[0];if(this.isOverSplitLine(this.hmx)){this.lh.setStyle("cursor","w-resize")}else{this.lh.setStyle("cursor","default")}},onUnLockHeadMove:function(b){var a=0;if(this.uht){a=this.uht.getXY()[0]+this.uht.getScroll().left}this.hmx=b.xy[0]-a+this.lockWidth;if(this.isOverSplitLine(this.hmx)){this.uh.setStyle("cursor","w-resize")}else{this.uh.setStyle("cursor","default")}},onHeadMouseDown:function(a){this.dragWidth=-1;if(this.overColIndex==undefined||this.overColIndex==-1){return}this.dragIndex=this.overColIndex;this.dragStart=a.getXY()[0];this.sp.setHeight(this.wrap.getHeight());this.sp.setVisible(true);this.sp.setStyle("top",this.wrap.getXY()[1]+"px");this.sp.setStyle("left",a.xy[0]+"px");Ext.get(document.documentElement).on("mousemove",this.onHeadMouseMove,this);Ext.get(document.documentElement).on("mouseup",this.onHeadMouseUp,this)},onHeadClick:function(h){var i=Ext.fly(h.target).findParent("td");var b;if(i){i=Ext.fly(i);b=i.getAttributeNS("","atype")}if(b=="grid.head"){var g=i.getAttributeNS("","dataindex");var a=this.findColByName(g);if(a&&a.sortable===true){if(this.dataset.isModified()){$A.showInfoMessage("提示","有未保存数据!");return}var j=i.child("div");this.dataset.setQueryParameter("ORDER_FIELD",g);if(this.currentSortTarget){var f=Ext.fly(this.currentSortTarget);f.removeClass(["grid-asc","grid-desc"])}this.currentSortTarget=j;if(Ext.isEmpty(a.sorttype)){a.sorttype="desc";j.removeClass("grid-asc");j.addClass("grid-desc");this.dataset.setQueryParameter("ORDER_TYPE","desc")}else{if(a.sorttype=="desc"){a.sorttype="asc";j.removeClass("grid-desc");j.addClass("grid-asc");this.dataset.setQueryParameter("ORDER_TYPE","asc")}else{a.sorttype="";j.removeClass(["grid-desc","grid-asc"]);delete this.dataset.qpara.ORDER_TYPE}}if(this.dataset.getAll().length!=0){this.dataset.query()}}}else{if(b=="grid.rowcheck"){var c=i.child("div[atype=grid.headcheck]");var k=c.hasClass("item-ckb-c");this.setCheckBoxStatus(c,!k);if(!k){this.dataset.selectAll()}else{this.dataset.unSelectAll()}}}},setRadioStatus:function(a,b){if(!b){a.removeClass("item-radio-img-c");a.addClass("item-radio-img-u")}else{a.addClass("item-radio-img-c");a.removeClass("item-radio-img-u")}},setCheckBoxStatus:function(a,b){if(!b){a.removeClass("item-ckb-c");a.addClass("item-ckb-u")}else{a.addClass("item-ckb-c");a.removeClass("item-ckb-u")}},setSelectDisable:function(a){if(this.selectable&&this.selectionmodel=="multiple"){a.removeClass("item-ckb-c");a.removeClass("item-ckb-u");a.addClass("item-ckb-readonly-u")}else{a.removeClass("item-radio-img-c");a.removeClass("item-radio-img-u");a.addClass("item-radio-img-readonly-u")}},setSelectEnable:function(a){if(this.selectable&&this.selectionmodel=="multiple"){a.removeClass("item-ckb-readonly-u");a.addClass("item-ckb-u")}else{a.removeClass("item-radio-img-readonly-u");a.addClass("item-radio-img-u")}},setSelectStatus:function(b){if(this.dataset.selectfunction){var a=Ext.get(this.id+"__"+b.id);if(!this.dataset.execSelectFunction(b)){this.dataset.unSelect(b);this.setSelectDisable(a)}else{this.setSelectEnable(a)}}},onHeadMouseMove:function(d){d.stopEvent();this.dragEnd=d.getXY()[0];var b=this.dragEnd-this.dragStart;var f=this.columns[this.dragIndex];var a=f.width+b;if(a>30&&a<this.width){this.dragWidth=a;this.sp.setStyle("left",d.xy[0]+"px")}},onHeadMouseUp:function(a){Ext.get(document.documentElement).un("mousemove",this.onHeadMouseMove,this);Ext.get(document.documentElement).un("mouseup",this.onHeadMouseUp,this);this.sp.setVisible(false);if(this.dragWidth!=-1){this.setColumnSize(this.columns[this.dragIndex].name,this.dragWidth)}this.syncScroll()},findColByName:function(d){var b;for(var e=0,a=this.columns.length;e<a;e++){var f=this.columns[e];if(f.name&&f.name.toLowerCase()===d.toLowerCase()){b=f;break}}return b},selectRow:function(d,b){var a=this.dataset.getAt(d);this.selectedId=a.id;if(this.selectlockTr){this.selectlockTr.setStyle(this.bgc,"")}if(this.selectUnlockTr){this.selectUnlockTr.removeClass("row-selected")}this.selectUnlockTr=Ext.get(this.id+"$u-"+a.id);if(this.selectUnlockTr){this.selectUnlockTr.addClass("row-selected")}this.selectlockTr=Ext.get(this.id+"$l-"+a.id);if(this.selectlockTr){this.selectlockTr.setStyle(this.bgc,this.scor)}this.focusRow(d);var c=(this.dataset.currentPage-1)*this.dataset.pagesize+d+1;this.selectRecord=a;if(b!==false&&c!=null){this.dataset.locate.defer(5,this.dataset,[c,false])}},setColumnSize:function(y,m){var a=this.columns;var t,g,b=0,d=0;var f="width",j="px";for(var o=0,n=a.length;o<n;o++){var u=a[o];if(u.name&&u.name===y){if(u.hidden===true){return}u.width=m;if(u.lock!==true){t=this.uh.child("th[dataindex="+y+"]");g=this.ub.child("th[dataindex="+y+"]")}else{if(this.lh){t=this.lh.child("th[dataindex="+y+"]")}if(this.lb){g=this.lb.child("th[dataindex="+y+"]")}}}u.lock!==true?(d+=u.width):(b+=u.width)}var p=Ext.DomQuery.select("td[dataindex="+y+"]",this.wrap.dom);for(var o=0,n=p.length;o<n;o++){var e=p[o];var h=Ext.fly(e).child("DIV.grid-cell");if(h){var q=h.hasClass(this.cecls)?7:4;Ext.fly(h).setStyle(f,Math.max(m-q,0)+j)}}this.unlockWidth=d;this.lockWidth=b;if(t){t.setStyle(f,m+j)}if(g){g.setStyle(f,m+j)}if(this.fb){var s=this.fb.child("th[dataindex="+y+"]");s.setStyle(f,m+j);var w=this.fb.child("table[atype=fb.ubt]");this.uf.setStyle(f,Math.max(this.width-b,0)+j);w.setStyle(f,d+j);var x=this.fb.child("table[atype=fb.lbt]");if(x){var k=this.fb.child("div[atype=grid.lf]");k.setStyle(f,(b-1)+j);x.setStyle(f,b+j)}}if(this.lc){var v=Math.max(b-1,0);this.lc.setStyle(f,v+j);this.lc.setStyle("display",v==0?"none":"")}if(this.lht){this.lht.setStyle(f,b+j)}if(this.lbt){this.lbt.setStyle(f,b+j)}this.uc.setStyle(f,Math.max(this.width-b,0)+j);this.uh.setStyle(f,Math.max(this.width-b,0)+j);this.ub.setStyle(f,Math.max(this.width-b,0)+j);this.uht.setStyle(f,d+j);if(this.ubt){this.ubt.setStyle(f,d+j)}this.syncSize()},drawFootBar:function(b){if(!this.fb){return}b=[].concat((b)?b:this.columns);var a=this;Ext.each(b,function(h){var e=typeof(h)==="string"?a.findColByName(h):h;if(e&&e.footerrenderer){var d=e.name;var g=$A.getRenderer(e.footerrenderer);if(g==null){alert("未找到"+e.footerrenderer+"方法!");return}var c=g.call(window,a.dataset.data,d);var f=a.fb.child("td[dataindex="+d+"]");f.update(c)}})},syncSize:function(){var e=0;for(var b=0,a=this.columns.length;b<a;b++){var f=this.columns[b];if(f.hidden!==true){if(f.lock===true){e+=f.width}}}if(e!=0){var d=this.width-e;this.uc.setWidth(d);this.uh.setWidth(d);this.ub.setWidth(d)}},showColumn:function(c){var b=this.findColByName(c);if(b){if(b.hidden===true){delete b.hidden;this.setColumnSize(c,b.hiddenWidth);delete b.hiddenWidth;var e=Ext.DomQuery.select("td[dataindex="+c+"]",this.wrap.dom);for(var d=0,a=e.length;d<a;d++){var f=e[d];Ext.fly(f).show()}}}},hideColumn:function(c){var b=this.findColByName(c);if(b){if(b.hidden!==true){b.hiddenWidth=b.width;this.setColumnSize(c,0,false);var e=Ext.DomQuery.select("td[dataindex="+c+"]",this.wrap.dom);for(var d=0,a=e.length;d<a;d++){var f=e[d];Ext.fly(f).hide()}b.hidden=true}}},setWidth:function(c){if(this.width==c){return}this.width=c;this.wrap.setWidth(c);var b=$A.CmpManager.get(this.id+"_tb");if(b){b.setWidth(c)}var a=$A.CmpManager.get(this.id+"_navbar");if(a){a.setWidth(c)}if(this.fb){this.fb.setWidth(c)}var d=c-this.lockWidth;this.uc.setWidth(d);this.uh.setWidth(d);this.ub.setWidth(d);if(this.uf){this.uf.setWidth(d)}},setHeight:function(d){if(this.height==d){return}this.height=d;var b=$A.CmpManager.get(this.id+"_tb");if(b){d-=25}var a=$A.CmpManager.get(this.id+"_navbar");if(a){d-=25}if(this.fb){d-=25}this.wrap.setHeight(d);var c=d-25;if(this.lb){this.lb.setHeight(c)}this.ub.setHeight(c)},deleteSelectRows:function(b){var a=[].concat(this.dataset.getSelected());if(a.length>0){this.dataset.remove(a)}b.close()},remove:function(){var a=this.dataset.getSelected();if(a.length>0){$A.showConfirm("确认","确认删除选择记录?",this.deleteSelectRows.createDelegate(this))}},clear:function(){var a=this.dataset.getSelected();while(a[0]){this.dataset.removeLocal(a[0])}},_export:function(){var e={parameter:{_column_config_:{}}},h=[],a={},u=function(o,i){if(!(Ext.isDefined(o.forexport)?o.forexport:true)){return null}var k=Ext.encode(o);var p=a[k];if(!p){p={prompt:o.prompt}}a[k]=p;(p.column=p.column||[]).add(i);if(o._parent){return u(o._parent,p)}return p};for(var l=0;l<this.columns.length;l++){var g=this.columns[l],w=Ext.isDefined(g.forexport)?g.forexport:true;if(!g.type&&w){var m={prompt:g.prompt||this.dataset.getField(g.name).pro.prompt};if(g.width){m.width=g.width}if(g.name){m.name=g.exportfield||g.name}m.align=g.align||"left";var f=g._parent?u(g._parent,m):m;if(f){h.add(f)}}}e.parameter["_column_config_"]["column"]=h;e._generate_state=true;e._format="xls";if(this.dataset.qds){r=this.dataset.qds.getCurrentRecord()}var b={};if(r!=null){Ext.apply(b,r.data)}Ext.apply(b,this.dataset.qpara);for(var j in b){var n=b[j];if(Ext.isEmpty(n,false)){delete b[j]}}Ext.apply(e.parameter,b);var d=document.createElement("form");d.target="_blank";d.method="post";d.action=this.dataset.queryurl;var t=document.createElement("input");t.id="_request_data";t.type="hidden";t.name="_request_data";t.value=Ext.encode(e);d.appendChild(t);document.body.appendChild(d);d.submit();d.parentNode.removeChild(d)},destroy:function(){$A.Grid.superclass.destroy.call(this);this.processDataSetLiestener("un");this.sp.remove();delete this.sp}});$A.Grid.revision="$Rev$";