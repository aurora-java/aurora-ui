(function(){var f=Math.sin,h=Math.cos,b=Math.min,l=Math.sqrt,e=Math.PI,i=e/180,c=function(n,m,o){if(/\%/.test(n)){return parseFloat(n)*m/100+(o||0)}return n},a=function(m){return/\%/.test(m)},d=function(p,n){var m=new Ext.Template('<span style="font-size:{fontSize}">{text}</span>').append(document.body,{fontSize:n,text:p},true),o=m.getWidth();m.remove();return o},g=function(m){switch(m){case"left":case"top":return -1;case"right":case"bottom":return 1;default:return 0}},k=function(n,m){switch(m){case -1:return 0;case 0:return n/2;case 1:return n}},j=$A.merge;$A.Dashboard=Ext.extend($A.Graphics,{options:{chart:{align:"center",verticalAlign:"middle",padding:10,max:100,min:0,borderWidth:4,borderColor:"#4572A7",borderRadius:5,backgroundColor:"gradient(linear,0 0,100% 100%,color-stop(0,rgba(255,255,255,1)),color-stop(100%,rgba(240,240,255,1)))",style:{fontFamily:'"Lucida Grande", "Lucida Sans Unicode", Verdana, Arial, Helvetica, sans-serif',fontSize:"11px",color:"#000"}},board:{allowDecimals:true,width:"40%",fillColor:"gradient(linear,0 0,100% 0,color-stop(0,rgba(0,255,255,1)),color-stop(50%,rgba(255,255,0,1)),color-stop(100%,rgba(255,0,0,1)))",fillOpacity:null,borderColor:"#000",borderWidth:1,startAngle:0,endAngle:180,tickColor:"#000",tickLength:"25%",tickPosition:"inside",tickInterval:null,tickAngleInterval:30,tickWidth:1,tickStartAngle:10,tickEndAngle:-10,minorTickColor:"#A0A0A0",minorTickLength:2,minorTickPosition:"inside",minorTickWidth:0,marginalTickLength:"50%",marginalTickWidth:1,marginalTickColor:"#000",startOntick:true,endOntick:true,showFirstLabel:true,showLastLabel:true,labels:{enabled:true,x:5,y:5,rotation:0,style:{color:"rgb(0,0,214)",fontSize:"11px",lineHeight:"14px"}}},pointer:{fillColor:"rgba(135,135,135,0.5)",fillOpacity:null,borderColor:"#000",borderWidth:1,width:8,dist:10,labels:{enabled:true,x:15,y:-15,rotation:-90,style:{color:"rgb(145,45,0)",fontSize:"11px",lineHeight:"14px"}}},title:{text:"Dashboard title",align:"center",verticalAlign:"top",margin:15,x:0,y:0,style:{color:"#3E576F",fontSize:"16px"}}},constructor:function(m){$A.Dashboard.superclass.constructor.call(this,m);this.setOptions(m)},processDataListener:function(m){var n=this.binder&&this.binder.ds;if(n){n[m]("update",this.redraw,this)}},bind:function(n,m){if(typeof(n)=="string"){n=$(n)}if(!n){return}this.binder={ds:n,name:m};this.record=n.getCurrentRecord();this.processDataListener("on");this.onLoad()},setOptions:function(m,n){this.options=j(this.options,m);if(n){this.redraw()}},onLoad:function(){var m=this;if(!this.hasSVG){$A.onReady(function(){m.redraw()})}else{m.redraw()}},redraw:function(){if(!this.record){return}var m=this.options,o=m.chart,p=m.title,n=m.board;pointer=m.pointer;this.clear();this.renderBoard(n,p,pointer,o);this.renderPointer(pointer,o);this.renderTitle(p,o)},setTitle:function(m){this.options.title=j(this.options.title,m);this.redraw()},clear:function(){var m=this.top.cmps;while(m.length){m.pop().destroy()}this.pointerEl=null},renderTitle:function(t,o){var s=t.text;if(!s){return}var m=o.borderWidth,q=t.margin,n=t.style,p=n.fontSize,r=parseInt(p);this.createGElement("text",{text:s,color:n.color,size:r,dx:t.x+q+k(o.width-q*2-m*2-d(s,p),g(t.align)),dy:t.y+q+k(o.height-q*2-m*2-r,g(t.verticalAlign))})},renderBoard:function(v,R,E,ai){var s=R.verticalAlign,ae=ai.padding,r=ai.borderWidth,o=ai.borderRadius,z=parseInt(R.style.fontSize),u=(Ext.isEmpty(ai.marginLeft)?0:ai.marginLeft)+r,al=(Ext.isEmpty(ai.marginRight)?0:ai.marginRight)+r,Y=(Ext.isEmpty(ai.marginTop)?(R.text&&s=="top"?z+R.margin*2:0):ai.marginTop)+r,S=(Ext.isEmpty(ai.marginBottom)?(R.text&&s=="bottom"?z+R.margin*2:0):ai.marginBottom)+r,B=ai.width,ag=ai.height,n=(B||300)-ae*2-u-al,p=(ag||300)-ae*2-Y-S,ad=g(ai.align),M=g(ai.verticalAlign),U=(v.startAngle%360+360)%360,F=(v.endAngle%360+360)%360,F=F>U?F:F+360,L=i*U,A=i*(F%360),G=ai.max,ak=ai.min,ah=v.width,ah=c(ah,b(p,n)),Z=v.tickAngleInterval*i,V=v.startOntick?L:v.tickStartAngle*i+L,ac=v.endOntick?A:v.tickEndAngle*i+A,q=this.normalizeTickInterval(v.tickInterval?v.tickInterval:(G-ak)*Z/(ac-V),v),Z=(ac-V)*q/(G-ak),T=Math.ceil((G-ak)/q),J=f(L),H=f(A),P=h(L),N=h(A),aa,X,W,t=function(aq,y,an,am){aa=b(aq,y);var x={xR:an*aa,yR:am*aa},ar,ao,at,ap;if(y<=aq){ap=n*(1-aa/aq);ar="x";ao="y";at=ad}else{ap=p*(1-aa/y);ar="y";ao="x",at=M}x[ar]=ae+x[ar+"R"]+k(ap,at);x[ao]=ae+x[ao+"R"];X=x.x+u;W=x.y+Y};if(J>=0){if(P>=0){if(H>=0){if(N>P){t(n/2,p/2,1,1)}else{if(N>=0){t(n/P,p/H,0,H)}else{t(n/(P-N),p,-N,1)}}}else{if(N>P){t(n/(1+N),p/2,1,1)}else{if(N>=0){t(n/(1+P),p/2,1,1)}else{t(n/(1+P),p/(1-H),1,1)}}}}else{if(N<=0){if(H>J){t(n/2,p/2,1,1)}else{if(H>=0){t(n/-N,p/J,-N,J)}else{t(n,p/(J-H),1,J)}}}else{if(H>J){t(n/2,p/(1+H),1,H)}else{if(H>=0){t(n/2,p/(1+J),1,J)}else{t(n,p/(J-H),1,J)}}}}}else{if(P<=0){if(H<=0){if(N<P){t(n/2,p/2,1,1)}else{if(N<=0){t(n/-P,p/-H,-P,0)}else{t(n/(N-P),p,-P,0)}}}else{if(N<P){t(n/(1-N),p/2,1,1)}else{if(N<=0){t(n/(1+P),p/2,1,1)}else{t(n/(1-P),p/(1+H),1,H)}}}}else{if(N>=0){if(H<J){t(n/2,p/2,1,1)}else{if(H<=0){t(n/N,p/-J,0,0)}else{t(n,p/(H-J),0,H)}}}else{if(H<J){t(n/2,p/(1-H),1,1)}else{if(H<=0){t(n/2,p/(1-J),1,1)}else{t(n/(1-N),p/(1-J),-N,1)}}}}}this.createGElement("rect",{x:r,y:r,width:B-r*2,height:ag-r*2,rx:o,ry:o,strokecolor:ai.borderColor,strokewidth:r,fillcolor:ai.backgroundColor,cursor:"default"}).createGElement("arc",{x:X,y:W,r:aa,innerR:aa-ah,start:L,end:A,cursor:"default",fillcolor:v.fillColor,fillopacity:v.fillOpacity,strokecolor:v.borderColor,strokewidth:v.borderWidth});var D=V,ab=ak,w=v.labels,m=w.style,K;for(var af=0;af<=T;af++){var C=this.getTickOptions(v,(af==0||af==T)?"marginal":"",ah),Q=C.length,O=h(D),I=f(D),aj=[X+aa*O,W-aa*I,X+(aa-Q)*O,W-(aa-Q)*I];K=!w.enabled||(!v.showFirstLabel&&af==0)||(!v.showLastLabel&&af==T);this.createGElement("line",{points:aj.join(" "),strokewidth:(D==L||D==A)?0:C.width,strokecolor:C.color,title:K?"":(ab+""),titlesize:parseInt(m.fontSize||ai.style.fontSize),titlecolor:m.color||ai.style.color,titlex:w.x,titley:w.y,titlerotation:90-D/i-w.rotation,titlefontfamily:m.fontFamily||ai.style.fontFamily,cursor:"default"});if(af==T-1){ab=G;D=ac}else{ab+=q;D+=Z}}Ext.apply(E,{center:[X,W],start:L,end:A,minAngle:V,maxAngle:ac,radius:aa-E.dist})},getTickOptions:function(m,n,o){n=n?n+"T":"t";return{length:c(m[n+"ickLength"],o),width:m[n+"ickWidth"],color:m[n+"ickColor"]}},renderPointer:function(F,B){var G=B.max,E=B.min,z=c(this.record.get(this.binder.name),G-E,E),K=F.labels,H=B.style,n=K.style,D=F.width,q=F.radius,L=F.center,r=F.minAngle,p=F.maxAngle<r?F.maxAngle+e*2:F.maxAngle,I=(p-r)/(G-E)*(z-E)+r,s=i*135,A=I+s,u=I-s,m=f(I),o=h(I),C=D*q*l(2)/(2*q-D),w=L[0]+q*o,t=L[1]-q*m,J=["M",L[0]-w,L[1]-t,"L",L[0]+C*h(A)-w,L[1]-C*f(A)-t,0,0,L[0]+C*h(u)-w,L[1]-C*f(u)-t,"Z"];this.pointerEl=this.createGElement("path",{d:J.join(" "),x:w,y:t,strokecolor:F.borderColor,strokewidth:F.borderWidth,fillcolor:F.fillColor,fillopacity:F.fillOpacity,title:K.enabled?z:"",titlesize:parseInt(n.fontSize||H.fontSize),titlecolor:n.color||H.color,titlex:K.x,titley:K.y,titlerotation:90-I/i-K.rotation,titlefontfamily:n.fontFamily||H.fontFamily}).createGElement("arc",{x:L[0],y:L[1],r:D,innerR:D-2,start:F.start,end:F.end,cursor:"default",strokecolor:F.borderColor,strokewidth:F.borderWidth})},normalizeTickInterval:function(m,n){var p=Math.pow(10,Math.floor(Math.log(m)/Math.LN10)),q=m/p,r=[1,2,2.5,5,10];if(n&&n.allowDecimals===false){if(p===1){r=[1,2,5,10]}else{if(p<=0.1){r=[1/p]}}}for(var o=0;o<r.length;o++){m=r[o];if(q<=(r[o]+(r[o+1]||r[o]))/2){break}}m*=p;return m}})})();