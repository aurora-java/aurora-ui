(function(a){var c=true,j=false,d=null,m=Ext.each,p="item-menu-current",k="mousedown",i="mouseup",e="submit",g="td.item-menu-icon div",l='<div class="item-ie-shadow"></div>',h='<LI id="{id}" class="item-menu"></LI>',o='<TR id="{id}" class="item-menu"></TR>',b='<SPAN class="item-menu-text">{text}</SPAN>',n='<DIV class="item-shadow item-menu-container" style="z-index:{zIndex};visibility:hidden;">{shadow}<TABLE cellspacing="0"><TBODY></TBODY></TABLE></DIV>';function f(r,q){r.options&&r.options.sort(f);q.options&&q.options.sort(f);return parseFloat(r.index)-parseFloat(q.index)}a.MenuBar=Ext.extend(a.Component,{constructor:function(q){var r=this;r.isActive=j;r.needHide=j;r.children=[];r.selectIndex=d;a.MenuBar.superclass.constructor.call(r,q);r.handlerfield=r.handlerfield||"handler";r.menutype=r.menutype||"type";r.checked=r.checked||"checked"},processListener:function(q){var r=this;a.MenuBar.superclass.processListener.call(r,q);Ext.fly(document)[q](k,r.onMouseDown,r)[q](i,r.onMouseUp,r);Ext.getBody()[q]("selectstart",r.preventMenuAndSelect,r)[q]("contextmenu",r.preventMenuAndSelect,r);if(q=="on"){a.onReady(function(){r.processIframeListener(q)})}else{r.processIframeListener(q)}},processIframeListener:function(q){var r=this;function s(t){Ext.fly(t)[q](k,r.onMouseDown,r)[q](i,r.onMouseUp,r)}m(Ext.getBody().query("iframe"),function(u,t){(t=u.contentWindow)&&s(t.document);Ext.fly(u)[q]("load",function(){s(u.contentWindow.document)});if(r.urltarget&&r.urltarget==u.name){r.targetFrame=u}})},processDataSetLiestener:function(q){var r=this,s=r.dataset;if(s){s[q]("update",r.onUpdate,r);s[q]("load",r.onLoad,r)}},bind:function(r){if(Ext.isString(r)){r=$(r);if(!r){return}}var q=this;q.dataset=r;q.processDataSetLiestener("on");q.onLoad()},renderText:function(s){var q=this,t=s.get(q.displayfield),r=q.renderer&&a.getRenderer(q.renderer);return r?r(t,s,q.context):t},onUpdate:function(u,q,r,t){var s=this;if(r==s.displayfield){q.menu.setText(s.value)}else{if(r==s.checked){q.menu.check(t)}}},onLoad:function(){var x=this,t=x.idfield,A=x.parentfield,C=x.displayfield,s=x.sequence,v=x.iconfield,r=x.handlerfield,z=x.urlfield,u=x.menutype,B=x.checked,y=x.rootid,D=x.handler,E=[],q={},w=x.dataset.data;m(w,function(I){var J=I.get(t),H=q[J]={record:I,text:I.get(C),renderText:x.renderText(I),index:I.get(s)||Number.MAX_VALUE,icon:I.get(v),dataId:J},G=I.get(u);if(G){var F=G.match(/^([^\[\]]+)\[?([^\[\]]+)?\]?$/);Ext.apply(H,{type:F[1],checked:I.get(B)=="true"||j});F[2]&&Ext.apply(H,{groupName:F[2]})}I.get(r)&&Ext.apply(H,{listeners:{mouseup:function(){window[I.get(r)].apply(window,Ext.toArray(arguments).concat(I))}}});I.get(z)&&Ext.apply(H,{listeners:{submit:function(){x.directURL(I.get(z),I.get(C))}}})});m(w,function(I){var G=I.get(A),F=q[I.get(t)];if(!G||G==y||G<0){E.push(F)}else{var H=q[G];(H.options=H.options||[]).push(F)}});x.addMenus(E.sort(f))},directURL:function(q,s){var r=this;if(r.targetFrame){r.targetFrame.setAttribute("src",Ext.urlAppend(q,"r="+Math.floor(Math.random()*100000)))}else{if(r.urltarget){window.open(q,r.urltarget)}else{new a.Window({title:s,url:q,fullScreen:c})}}},preventMenuAndSelect:function(r,q){if(this.isAncestor(q)){r.stopEvent();return j}},onMouseDown:function(v,s){var u=this,q=u.selectIndex,r=u.children;if(q==d||!r.length){return}if(v.button==0){if(u.wrap.contains(s)){u.needHide=u.isActive}var w=r[q];if(u.isAncestor(s)){u.isActive=c;w.show()}else{w.inactive();w.hide();u.isActive=j}}},onMouseUp:function(v,s){var u=this,q=u.selectIndex,r=u.children;if(q==d||!r.length){return}if(v.button==0){if(u.needHide||!u.isAncestor(s)){u.isActive=j}if(!u.isActive){r[q].hide()}}},addMenus:function(r){var u=this,t=u.children,q=t.length,s=u.wrap.child("ul");m(r,function(w){var v=u.id+"-node"+q;new Ext.Template(h).append(s,{id:v});t.push(w.record.menu=new Aurora[w.options?"Menu":"MenuItem"](Ext.apply(w,{id:v,parent:u,bar:u,index:q++})));delete w.record})},destroy:function(){var q=this;delete q.children;delete q.isActive;delete q.needHide;a.Menu.superclass.destroy.call(q)},isAncestor:function(s){var t=this,r=t.wrap,q=j;if(r.dom!=s&&r.contains(s)){q=c}else{m(t.children,function(u){if(u.isAncestor&&u.isAncestor(s)){return !(q=c)}})}return q}});a.MenuItem=Ext.extend(a.Component,{constructor:function(q){this.hasIcon=j;a.MenuItem.superclass.constructor.call(this,q)},initComponent:function(q){var s=this;a.MenuItem.superclass.initComponent.call(s,q);var r=s.parent!==s.bar;s.el=new Ext.Template(r?s.menuTpl:b).append(s.wrap,{text:s.renderText,width:"16px"},c);if(r){s.setIcon();s.type&&!s.children&&s.initMenuType()}},processListener:function(q){var r=this;a.MenuItem.superclass.processListener.call(r,q);r.wrap[q](i,r.onMouseUp,r)},processMouseOverOut:function(q){var r=this;r.wrap[q]("mouseover",r.onMouseOver,r)[q]("mouseout",r.onMouseOut,r)},initEvents:function(){a.MenuItem.superclass.initEvents.call(this);this.addEvents(e,i)},getWidth:function(){var q=this;return q.wrap.child("td.item-menu-text").getWidth()+(q.parent==q.bar?0:72)},initMenuType:function(){var r=this,q=r.type;(q=="radio"||q=="checkbox")&&r.wrap.child(g).addClass("type-"+q);r.check()},check:function(q){this.wrap.child(g)[(this.checked=q)?"addClass":"removeClass"]("check")},getBindingRecord:function(){return this.record},setText:function(r){var q=this;q.text=r;q.el.update(q.renderText=q.bar.renderText(q.record))},setIcon:function(r){var s=this;if(!(r||(r=s.icon))||s.type){return}var q=r.match(/^([^\?]*)\??([^?]*)?$/);s.wrap.child(g).setStyle({"background-image":"url("+(q[1].match(/^[\/]{1}/)?s.bar.context:"")+q[1]+")","background-position":q[2]||"0 0"});s.hasIcon=c},submit:function(){var u=this,t=u.bar;if(!u.children){var s=u.checked,w=t.checked,r=u.parent,v=t.children[t.selectIndex],q=u.record;if(r!=t){v.inactive();v.hide();t.isActive=j}if(u.type=="checkbox"){q.set(t.checked,!s)}else{if(u.type=="radio"){if(s){return}q.set(w,c);u.groupName&&m(r.groups[u.groupName],function(x){x!=u&&x.record.set(w,j)})}}}u.fireEvent(i,t,u);u.fireEvent(e,t)},onMouseUp:function(q){q.button==0&&this.submit()},onMouseOver:function(q){this.active()},onMouseOut:function(r){var q=this;!q.isActive&&q.inactive();q.showIntervalId&&clearTimeout(q.showIntervalId)},active:function(){var t=this,s=t.parent,q=s.selectIndex,r=t.index;t.wrap.addClass(p);if(q===r){return}if(q!=d){var u=s.children[q];u.inactive();if(s==t.bar){u.hide()}else{(function(){u.hide()}).defer(299)}}s.selectIndex=r},inactive:function(){this.wrap.removeClass(p)},show:function(){},hide:function(){},destroy:function(){delete this.el;delete this.bar;a.MenuItem.superclass.destroy.call(this)},menuTpl:['<TD class="item-menu-icon" align="center"><DIV></DIV></TD>','<TD class="item-menu-text">{text}</TD>',"<TD></TD>"]});a.Menu=Ext.extend(a.MenuItem,{constructor:function(q){var r=this;r.children=[];r.selectIndex=d;r.groups={};r.isActive=j;r.initMenus=j;a.Menu.superclass.constructor.call(r,q)},initComponent:function(q){var r=this;a.Menu.superclass.initComponent.call(r,q);r.container=new Ext.Template(n).append(r.bar.wrap,{zIndex:10000+r.index,shadow:Ext.isIE?l:""},c)},addMenus:function(s){if(!this.options){return}var v=this,u=0,t=v.children,r=t.length,q=v.container;m(s,function(x){var y,z,w=v.id+"-node"+r;new Ext.Template(o).append(q.child("tbody"),{id:w});x.record.menu=y=new Aurora[x.options?"Menu":"MenuItem"](Ext.apply(x,{id:w,parent:v,bar:v.bar,index:r++}));(z=y.groupName)&&(v.groups[z]=v.groups[z]||[]).push(y);t.push(y);delete x.record;u=Math.max(y.getWidth(),u)});q.setWidth(u).child("table").setStyle({width:"100%"})},onMouseOver:function(r){var q=this;a.Menu.superclass.onMouseOver.call(q,r);if(q.parent===q.bar){q.show()}else{q.showIntervalId=(function(){q.show()}).defer(300)}},show:function(){a.Menu.superclass.show.call(this);var w=this,B=w.parent,s=w.wrap,r=w.container;if(!B.isActive||w.isActive){return}if(!w.initMenus){w.addMenus(w.options);w.initMenus=c}var E=s.getXY(),A,z,t=r.getWidth(),C=r.getHeight(),q=s.getHeight(),v=s.getWidth(),D=a.getViewportHeight()-3,u=a.getViewportWidth()-3;if(B===w.bar){A=(E[0]+t)>u?((u-t)<0?E[0]:(u-t)):E[0];z=(E[1]+q+C)>D?((E[1]-C)<0?(E[1]+q):(E[1]-C)):(E[1]+q)}else{A=(E[0]+v+t)>u?((E[0]-t)<0?(E[0]+v):(E[0]-t)):(E[0]+v);z=(E[1]+q+C)>D?((D-C)<0?E[1]:(D-C)):E[1]}r.moveTo(A,z).stopFx().fadeIn();w.isActive=c},hide:function(){a.Menu.superclass.hide.call(this);var r=this,q=r.selectIndex;r.container.stopFx().hide();if(q!=d){var s=r.children[q];s.inactive();s.hide()}r.isActive=j;r.selectIndex=d},destroy:function(){var q=this;q.container.remove();delete q.children;delete q.groups;a.Menu.superclass.destroy.call(q)},isAncestor:function(s){var t=this,q=t.container,r=j;if(q.dom!=s&&q.contains(s)){r=c}else{m(t.children,function(u){if(u.isAncestor&&u.isAncestor(s)){return !(r=c)}})}return r},menuTpl:['<TD class="item-menu-icon" align="center"><DIV></DIV></TD>','<TD class="item-menu-text">{text}</TD>','<TD class="item-menu-arrow" align="center"><DIV></DIV></TD>']})})($A);