(function(){var a="scroll-disabled",f="tab-scroll-left-over",h="tab-scroll-right-over",b="tab-scroll-left",q="tab-scroll-right",j="tab-close",d="tab-btn-over",k="tab-btn-down",c="tab-scroll",m="right",n="left",g="active",e="unactive",l="none",r="block",o="select",i="beforeopen",p="padding-left";$A.Tab=Ext.extend($A.Component,{constructor:function(s){$A.Tab.superclass.constructor.call(this,s)},initComponent:function(u){$A.Tab.superclass.initComponent.call(this,u);this.scriptwidth=u.scriptwidth||60;var t=this.wrap,x=this.head=t.child("div[atype=tab.strips]"),v=this.script=x.parent();this.body=t.child("div.item-tab-body");this.scrollLeft=t.child("div[atype=scroll-left]");this.scrollRight=t.child("div[atype=scroll-right]");this.sp=v.parent();this.selectTab(u.selected||0)},processListener:function(s){$A.Tab.superclass.processListener.call(this,s);this.sp[s]("mousedown",this.onMouseDown,this)[s]("mouseup",this.onMouseUp,this)[s]("mouseover",this.onMouseOver,this)[s]("mouseout",this.onMouseOut,this);this.script[s]("click",this.onClick,this)[s]("mousewheel",this.onMouseWheel,this)},initEvents:function(){$A.Tab.superclass.initEvents.call(this);this.addEvents(o,i)},selectTab:function(z,E){var s=this.getTab(z);if(!s){return}var z=s.index,y=s.strip,F=s.body;if(y.hasClass(a)){this.selectTab(z+1);return}this.selectedIndex=z;if(this.activeTab){this.activeTab.replaceClass(g,e)}this.activeTab=y;y.replaceClass(e,g);var B=this.script,x=this.scrollLeft,t=this.scrollRight,v=y.dom.offsetLeft,D=y.getWidth(),u=B.getScroll().left,C=B.getWidth(),A=this.head.getWidth();tr=v+D-u-C,tl=u-v;if(tr>0){t.removeClass(a);x.removeClass(a);B.scrollTo(n,u+tr)}else{if(tl>0){x.removeClass(a);B.scrollTo(n,u-tl);t.removeClass(a)}}if(C+B.getScroll().left>=A){B.scrollTo(n,A-C);t.addClass(a)}else{if(z==0){B.scrollTo(n,0);x.addClass(a)}}if(F){if(this.activeBody){this.activeBody.setStyle({left:"-1000px",top:"-1000px"})}this.activeBody=F;F.setStyle({left:0,top:0})}if(this.items[z].ref&&(F.loaded!=true||E)){this.load(this.items[z].ref,F,z);F.loaded=true}else{this.fireEvent(o,this,z)}},stripTpl:['<div class="strip unactive"  unselectable="on" onselectstart="return false;"><div style="height:26px;width:{stripwidth2}px">','<div class="strip-left"></div>','<div style="width:{stripwidth}px;" class="strip-center"><div class="tab-close"></div>{prompt}</div>','<div class="strip-right"></div>',"</div></div>"],bodyTpl:'<div style="width:{bodywidth}px;height:{bodyheight}px;left:-10000px;top:-10000px;" class="tab"></div>',openTab:function(u,t){var w=0,z=this.items,v=z.length;for(;w<v;w++){var C=z[w];if(C.ref&&C.ref==u){this.selectTab(w);return}}if(this.fireEvent(i,this,v)!==false){z.push({ref:u});var x=Math.max($A.TextMetrics.measure(document.body,t).width+20,this.scriptwidth),B=this.head,y=this.body,A=this.script,s=B.getWidth()+x+6;B.setWidth(s);if(s>A.getWidth()){this.scrollLeft.setStyle({display:r});this.scrollRight.setStyle({display:r});A.setStyle(p,"1px")}new Ext.Template(this.stripTpl).append(B.dom,{prompt:t,stripwidth:x,stripwidth2:x+6});new Ext.Template(this.bodyTpl).append(y.dom,{bodywidth:y.getWidth(),bodyheight:y.getHeight()});this.selectTab(v)}},closeTab:function(z){var y=this.getTab(z);if(!y){return}var x=y.strip,s=y.body,u=y.index;if(!x.child("div."+j)){$A.showWarningMessage("警告","该Tab页无法被关闭!");return}if(this.activeBody==y.body){this.activeBody=null;this.activeTab=null}this.items.splice(u,1);var v=this.head,t=this.script,w=v.getWidth()-x.getWidth();v.setWidth(w);if(w<=t.getWidth()){this.scrollLeft.setStyle({display:l});this.scrollRight.setStyle({display:l});t.setStyle(p,"0")}x.remove();s.remove();delete s.loaded;setTimeout(function(){Ext.iterate(s.cmps,function(A,B){if(B.destroy){try{B.destroy()}catch(C){alert("销毁Tab出错: "+C)}}})},10);this.selectTab(u)},destroy:function(){Ext.each(this.body.dom.children,function(s){Ext.iterate(Ext.fly(s).cmps,function(t,u){if(u.destroy){try{u.destroy()}catch(v){alert("销毁Tab出错: "+v)}}})});$A.Tab.superclass.destroy.call(this)},setDisabled:function(s){var u=this.getTab(s);if(!u){return}if(this.items.length>1){var t=u.strip,s=u.index;if(this.activeTab==t){this.selectTab(s+(this.getTab(s+1)?1:-1))}t.addClass(a)}},setEnabled:function(s){var t=this.getTab(s);if(!t){return}t.strip.removeClass(a)},getTab:function(w){var t=this.body.dom.children,v=this.head.dom.children,u,s;if(Ext.isNumber(w)){if(w<0){w+=v.length}w=Math.round(w);if(v[w]){u=Ext.get(v[w]);s=Ext.get(t[w])}}else{w=Ext.get(w);w=Ext.each(v,function(y,x){if(y==w.dom){u=w;s=Ext.get(t[x]);return false}})}return u?{strip:u,body:s,index:w}:null},scrollTo:function(w){var v=this.script,u=this.scrollRight,x=this.scrollLeft,t=v.getScroll().left,s=this.scriptwidth;if(w==n){v.scrollTo(n,t-s);u.removeClass(a);if(v.getScroll().left<=0){x.addClass(a).replaceClass(f,b);this.stopScroll()}}else{if(w==m){v.scrollTo(n,t+s);x.removeClass(a);if(v.getScroll().left+v.getWidth()>=this.head.getWidth()){u.addClass(a).replaceClass(h,q);this.stopScroll()}}}},stopScroll:function(){if(this.scrollInterval){clearInterval(this.scrollInterval);delete this.scrollInterval}},onClick:function(v,s){var u=Ext.fly(s);if(u.hasClass(j)){this.closeTab(u.parent(".strip"))}},onMouseWheel:function(s){var t=s.getWheelDelta();if(t>0){this.scrollTo(n);s.stopEvent()}else{this.scrollTo(m);s.stopEvent()}},onMouseDown:function(x,s){var v=Ext.fly(s),u=v.parent(".strip"),w=this;if(v.hasClass(j)){v.removeClass(d).addClass(k)}else{if(v.hasClass(c)&&!v.hasClass(a)){if(v.hasClass(f)){w.scrollTo(n)}else{w.scrollTo(m)}w.scrollInterval=setInterval(function(){if(v.hasClass(c)&&!v.hasClass(a)){if(v.hasClass(f)){w.scrollTo(n)}else{w.scrollTo(m)}if(v.hasClass(a)){clearInterval(w.scrollInterval)}}},100)}else{if(u&&u.hasClass("strip")&&!u.hasClass(g)&&!u.hasClass(a)){w.selectTab(u)}}}},onMouseUp:function(s){this.stopScroll()},onMouseOver:function(x,u){var w=Ext.fly(u),v=w.parent(".strip");if(w.hasClass(c)&&!w.hasClass(a)){if(w.hasClass(b)){w.replaceClass(b,f)}else{if(w.hasClass(q)){w.replaceClass(q,h)}}}else{if(w.hasClass(j)){w.addClass(d)}}if(v){w=v.child("div."+j);if(w){var s=this.currentBtn;if(s){s.hide()}this.currentBtn=w;w.show()}}},onMouseOut:function(w,s){var v=Ext.fly(s),u=v.parent(".strip");if(v.hasClass(c)&&!v.hasClass(a)){this.stopScroll();if(v.hasClass(f)){v.replaceClass(f,b)}else{if((v.hasClass(h))){v.replaceClass(h,q)}}}else{if(v.hasClass(j)){v.removeClass([d,k])}}if(u){v=u.child("div."+j);if(v){v.hide()}}},showLoading:function(s){s.setStyle({"text-align":"center","line-height":5}).update(_lang["tab.loading"])},clearLoading:function(s){s.setStyle({"text-align":"","line-height":""}).update("")},reloadTab:function(t,s){t=Ext.isEmpty(t)?this.selectedIndex:t;var u=this.getTab(t);if(!u){return}if(s){this.items[t].ref=s}Ext.iterate(u.body.cmps,function(v,w){if(w.destroy){try{w.destroy()}catch(x){alert("销毁Tab出错: "+x)}}});this.selectTab(t,true)},load:function(u,w,t){var v=this,s=Ext.get(w);s.cmps={};v.showLoading(s);Ext.Ajax.request({url:Ext.urlAppend(u,"_vw="+this.width+"&_vh="+(this.height-this.head.getHeight())),success:function(x,z){var C;try{C=Ext.decode(x.responseText)}catch(D){}if(C&&C.success==false){if(C.error){if(C.error.code&&C.error.code=="session_expired"){$A.showErrorMessage(_lang["ajax.error"],_lang["session.expired"])}else{$A.manager.fireEvent("ajaxfailed",$A.manager,z.url,z.para,C);var y=C.error.stackTrace,B=C.error.message;y=y?y.replaceAll("\r\n","</br>"):"";$A.showErrorMessage(_lang["window.error"],B?B+"</br>"+y:y,null,400,B&&y==""?150:250)}}return}var A=x.responseText;v.clearLoading(s);s.update(A,true,function(){v.fireEvent(o,v,t)},s)}})},setWidth:function(A){A=Math.max(A,2);if(this.width==A){return}$A.Tab.superclass.setWidth.call(this,A);var v=this.body,y=this.head,z=this.script,t=this.scrollLeft,s=this.scrollRight;v.setWidth(A-2);z.setWidth(A-38);if(A-38<y.getWidth()){t.setStyle({display:r});s.setStyle({display:r});z.setStyle(p,"1px");var u=z.getScroll().left,B=z.getWidth(),x=y.getWidth();if(u<=0){t.addClass(a)}else{t.removeClass(a)}if(u+B>=x){if(!s.hasClass(a)){s.addClass(a)}else{z.scrollTo(n,x-B)}}else{s.removeClass(a)}}else{t.setStyle({display:l});s.setStyle({display:l});z.setStyle(p,"0").scrollTo(n,0)}Ext.each(v.dom.children,function(w){Ext.fly(w).setWidth(A-4)})},setHeight:function(t){t=Math.max(t,25);if(this.height==t){return}$A.Tab.superclass.setHeight.call(this,t);var s=this.body;s.setHeight(t-26);Ext.each(s.dom.children,function(u){Ext.fly(u).setHeight(t-28)})}})})();