(function(m){var f=true,r=false,i="none",b="td",n="div",c="icon",t="text",s="line",d="clip",l="checkbox",q="element",v="child",x="checked",g="_type_",o="_root",j="_text",p="_td",a="click",h="dblclick",w="render",y="collapse",z="expand",e="div.item-node";function k(A){return new RegExp(A.replace(/[+?*.^$\[\](){}\\|]/g,function(B){return"\\"+B}))}function u(A){return document.createElement(A)}m.Tree=Ext.extend(m.Component,{showSkeleton:f,sw:18,constructor:function(A){m.Tree.superclass.constructor.call(this,A);this.context=A.context||""},initComponent:function(A){var B=this;B.nodeHash={};m.Tree.superclass.initComponent.call(B,A);B.body=B.wrap.child("div[atype=tree.body]");if(B.searchfield){B.searchInput=$(B.id+"_search_field")}},processListener:function(A){var B=this;m.Tree.superclass.processListener.call(B,A);B.wrap[A](a,B.onClick,B)[A](h,B.onDblclick,B);if(B.searchInput){B.searchInput[A]("change",B.onSearch,B);B.searchInput[A]("keyup",B.onSearch,B)}},initEvents:function(){m.Tree.superclass.initEvents.call(this);this.addEvents(w,y,z,a,h)},processDataSetLiestener:function(A){var B=this,C=B.dataset;if(C){C[A]("update",B.onUpdate,B);C[A]("load",B.onLoad,B);C[A]("indexchange",B.onIndexChange,B);C[A]("add",B.onAdd,B);C[A]("remove",B.onRemove,B)}},bind:function(B){if(Ext.isString(B)){B=$(B);if(!B){return}}var A=this;A.dataset=B;A.processDataSetLiestener("on");m.onReady(function(){A.onLoad()})},onSearch:function(G,F){var C=this,E=C.dataset,B=F&&F.keyCode,D=G.getRawValue().trim(),A=C.searchInterval;if(!Ext.isDefined(B)||B>40||(B<37&&B!=13&&B!=27&&B!=9&&B!=17)){if(A){clearTimeout(A)}C.searchInterval=function(){if(D.length>0){var H=k(D),I=C.searchfield,J=C.displayfield;E.filter(function(L,M){var K=C.getNodeById(L.id);if(!K){if(H.test(L.get(I))){M.push(L)}}else{if(!K.childNodes.length&&H.test(K.record.get(I))){K.bubble(function(O,N){(N=O.record).get(J)!=o&&M.add(N)})}}return r},C);C.filterKey=D}else{E.clearFilter();delete C.filterKey}C.onLoad();delete C.searchInterval}.defer(500)}},onAdd:function(D,I){var K=this,E=K.dataset.getAll(),H=I.get(K.parentfield),J,B=K.sequencefield,L=I.get(B),C;if(!Ext.isEmpty(H)){for(var G=0,F=E.length;G<F;G++){var A=E[G];if(A.get(K.idfield)===H){J=K.getNodeById(A.id);break}}}if(!J){if(K.showRoot){K.onLoad();K.root.firstChild.expand();return}else{J=K.root}}Ext.each(J.childNodes,function(N){var M=N.record.get(B);if(M&&M>L){C=N;return r}});J.insertBefore(K.createTreeNode(K.createNode(I)),C);J.isExpand=r},onRemove:function(C,E){var H=this,A=E.id,D=H.getNodeById(A);if(D){var K=D.parentNode,F=D.previousSibling,I=D.nextSibling;if(K){H.unregisterNode(D,f);K.removeChild(D);if(!H.focusNode||H.focusNode===D){var G=-1,J=K.data.children;Ext.each(J,function(M,L){if(M.record.id==A){G=L;return r}});if(G!=-1){var C=E.ds,B;J.remove(J[G]);C.locate(C.indexOf((B=J[G-1])&&B.record||(B=J[G])&&B.record||K.record)+1)}}}}},onUpdate:function(F,A,B,E){var D=this,C=D.nodeHash[A.id];if(D.parentfield==B||B==D.sequencefield){D.onLoad();F.locate(F.indexOf(A)+1)}else{C&&C.paintText()}},onIndexChange:function(C,A){var B=this.nodeHash[A.id];if(B){this.setFocusNode(B)}},onClick:function(G,B){var F=Ext.fly(B).findParent(b);if(!F){return}var A=F[g];if(!Ext.isDefined(A)){return}F=Ext.fly(B).findParent(e);var E=this,D=E.nodeHash[F.indexId];if(A==d){if(D){if(D.isExpand){D.collapse();E.fireEvent(y,E,D)}else{D.expand();E.fireEvent(z,E,D)}}}else{if(A==c||A==t){var H=E.dataset,C=D.record;if(E.fireEvent(a,E,C,D)!==r){E.setFocusNode(D);H.locate(H.indexOf(C)+1,f)}}else{if(A==x){D.onCheck()}}}},onDblclick:function(G,B){var F=Ext.fly(B).findParent(b);if(!F){return}var E=this,A=F[g];if(!Ext.isDefined(A)){return}F=Ext.fly(B).findParent(e);if(A==c||A==t){var D=E.nodeHash[F.indexId];if(D&&D.childNodes.length){if(D.isExpand){D.collapse();E.fireEvent(y,E,D)}else{D.expand();E.fireEvent(z,E,D)}}E.setFocusNode(D);var H=E.dataset,C=D.record;H.locate(H.indexOf(C)+1,f);E.fireEvent(h,E,C,D)}},getRootNode:function(){return this.root},setRootNode:function(B){var A=B.ownerTree=this;A.root=B;A.registerNode(B);B.cascade((function(C){A.registerNode(C)}))},getNodeById:function(A){return this.nodeHash[A]},registerNode:function(A){this.nodeHash[A.id]=A},unregisterNode:function(B,C){var A=this;delete A.nodeHash[B.id];if(C){Ext.each(B.childNodes,function(D){A.unregisterNode(D,C)})}},setFocusNode:function(A){var B=this.focusNode,C=A.parentNode;if(B){B.unselect()}this.focusNode=A;if(C&&!C.isExpand){C.expand()}A.select()},createNode:function(A){return{record:A,children:[]}},buildTree:function(){var J=this,K=[],I={},H={},F=1,C=J.dataset,B;function A(Q){var P=Q.children,O=0,R=0;Ext.each(P,function(S){if(S.children.length>0){A(S)}});Ext.each(P,function(S){if(S.checked==2){R=1}else{if(S.checked==1){O++;R=1}}});if(O==0&&R==0){Q.checked=0}else{if(P.length==O){Q.checked=1}else{if(R!=0){Q.checked=2}}}}Ext.each(C.data,function(O){var Q=O.get(J.idfield),P=J.createNode(O);if(Ext.isEmpty(Q)){Q="EMPTY_"+F++}P.checked=(O.get(J.checkfield)=="Y")?1:0;P.expanded=O.get(J.expandfield)=="Y";I[Q]=P;H[Q]=P});for(var N in H){var D=H[N],M=H[D.record.get(J.parentfield)];if(M){M.children.push(D);delete I[N]}}for(var N in I){K.push(H[N])}if(!(m.DynamicTree&&this instanceof m.DynamicTree)&&K.length==1){J.showRoot=f;B=K[0]}else{var E={};E[J.displayfield]=o;var G=new m.Record(E),L=J.createNode(G);G.setDataSet(C);Ext.each(K,function(O){L.children.push(O)});J.showRoot=r;B=L}Ext.each(K,function(O){if(O.children.length){A(O)}});J.sortChildren(B.children,J.sequencefield);return B},sortChildren:function(B,C){if(C){var A=Number.MAX_VALUE;B.sort(function(E,D){E=E.record.get(C)||A;D=D.record.get(C)||A;if(isNaN(E)||isNaN(D)){return E>D?1:-1}else{return E-D}})}else{B.sort()}Ext.each(B,function(D){this.sortChildren(D.children,C)},this)},createTreeNode:function(A){return new m.Tree.TreeNode(A)},onLoad:function(){var B=this,A=B.buildTree();if(!A){return}B.setRootNode(B.createTreeNode(A));B.body.update("");B.root.render();B.fireEvent(w,B,A)},getIconByType:function(A){return A},onNodeSelect:function(A){if(A){A[this.displayfield+j].style.backgroundColor="#dfeaf5"}},onNodeUnSelect:function(A){if(A){A[this.displayfield+j].style.backgroundColor=""}},initColumns:function(A){}});m.Tree.TreeNode=function(A){this.init(A)};m.Tree.TreeNode.prototype={init:function(B){var A=this;A.data=B;A.record=B.record;A.id=A.record.id;A.els=A.parentNode=A.lastChild=A.firstChild=A.previousSibling=A.nextSibling=null;A.childNodes=[];A.childrenRendered=r;A.isExpand=B.expanded;A.checked=B.checked;Ext.each(B.children,function(C){A.appendChild(A.createNode(C))})},createNode:function(A){return new m.Tree.TreeNode(A)},createCellEl:function(B){var A=this.els;A[B+p].appendChild(A[B+j]=u(n))},initEl:function(){var H=this,P=H.getOwnerTree(),K=P.displayfield,L=H.record.get(K),A=u(n),B=u(n),M=u("table"),F=u("tbody"),I=u("tr"),G,E=H.els={element:A,itemNodeTable:M,itemNodeTbody:F,itemNodeTr:I,child:B};A.className="item-node";M.border=M.cellSpacing=M.cellPadding=0;F.appendChild(I);M.appendChild(F);A.appendChild(M);if(P.showSkeleton){var O=I.insertCell(-1),C=I.insertCell(-1),J=u(H.icon?"img":n),N=I.insertCell(-1);G=I.insertCell(-1);O[g]=s;O.className=s;C[g]=d;C.innerHTML="&#160";N[g]=c;G[g]=x;G.innerHTML="&#160";Ext.fly(N).setWidth(18);N.appendChild(J);Ext.apply(E,{line:O,clip:C,icon:J,iconTd:N,checkbox:G})}var D=I.insertCell(-1);E[K+p]=D;H.createCellEl(K);D.className="node-text";P.initColumns(H);A.noWrap="true";D[g]=t;if(P.showcheckbox===r&&G){G.style.display=i}if(H.isRoot()&&L==o){M.style.display=i}A.appendChild(B);B.className="item-child";B.style.display=i},render:function(){var D=this,A=D.getOwnerTree();D.icon=D.record.get(A.iconfield);if(!D.els){D.initEl()}var B=D.els,C=B[q];if(D.isRoot()){A.body.appendChild(C);if(A.showRoot==r&&A.showSkeleton){B[c].style.display=B[l].style.display=B[A.displayfield+j].style.display=i}D.expand()}else{D.parentNode.els[v].appendChild(C);if(A.filterKey||D.isExpand){D.expand()}}D.paintPrefix();C.indexId=D.id;D.paintCheckboxImg()},setWidth:function(B,A){var C=this;if(C.width==A){return}C.width=A;C.doSetWidth(B,A);if(C.childrenRendered){Ext.each(C.childNodes,function(D){D.setWidth(B,A)})}},doSetWidth:function(D,B){if(!B){return}var F=this;if(F.isRoot()&&F.getOwnerTree().showRoot==r){return}var E=F.els,A=F.getOwnerTree(),G=B-(D==A.displayfield&&A.showSkeleton?((A.showcheckbox?1:0)+F.getPathNodes().length)*A.sw:0);Ext.fly(E[D+p]).setWidth(Math.max(G,0));var C=(Ext.fly(E[D+j].id)||Ext.fly(E[D+j]));C.setWidth(Math.max((G-(C.hasClass("cell-editor")?3:1)),0))},paintPrefix:function(){var A=this;A.paintLine();A.paintClipIcoImg();A.paintCheckboxImg();A.paintIconImg();A.paintText()},paintLine:function(){var D=this,I=D.getOwnerTree();if(!I.showSkeleton){return}var F=D.getPathNodes(),H=(F.length-2)*I.sw,J=D.els[s],G=u(n);J.innerHTML="";Ext.fly(J).setWidth(H);if(H<=0){J.style.display=i}Ext.fly(G).setWidth(H);for(var C=1,E=F.length-1;C<E;C++){var B=F[C],A=u(n);A.className=B.isLast()?"node-empty":"node-line";Ext.fly(A).setWidth(I.sw);G.appendChild(A)}J.appendChild(G)},paintClipIcoImg:function(){var D=this,A=D.getOwnerTree();if(!A.showSkeleton){return}var C=D.els[d],E="empty",B;if(D.isRoot()){C.style.display=i;return}else{E=D.isLeaf()&&"join"||D.isExpand&&"minus"||"plus";B=D.isLast()&&"Bottom"||D.isFirst()&&"Top"||""}C.className="node-clip clip-"+E+B;C.innerHTML='<DIV class="tree_s"> </DIV>'},paintIconImg:function(){var D=this,A=D.getOwnerTree();if(!A.showSkeleton){return}var E=D.data,B=E.icon,C=D.els[c];if(D.icon){C.className="node-icon";C.src=A.context+D.icon}else{if(!B&&!(B=A.getIconByType(E.type))){if(D.isRoot()){B="root"}else{if(D.isLeaf()){B="node"}else{if(D.isExpand){B="folderOpen"}else{B="folder"}}}}C.className="node-icon icon-"+B}},paintCheckboxImg:function(){var C=this,B=C.els;if(!B||!C.getOwnerTree().showSkeleton){return}var A=B[l];A.className=l+(C.checked||0);A.innerHTML='<DIV class="tree_s"> </DIV>'},paintText:function(){var E=this,C=E.els;if(!C){return}var A=E.getOwnerTree(),D=E.record,H=A.displayfield,F=A.renderer,B=A.filterKey,G=D.get(H);if(!Ext.isEmpty(F)&&(F=window[F])){G=F.call(E,G,D,E)}C[H+j].innerHTML=B?G.replace(k(B),function(I){return'<span style="background:yellow">'+I+"</span>"}):G},paintChildren:function(){var A=this;if(!A.childrenRendered){A.childrenRendered=f;Ext.each(A.childNodes,function(B){B.render()})}},collapse:function(){var A=this;A.isExpand=r;if(!A.isRoot()){A.record.set(A.getOwnerTree().expandfield,"N",f)}A.els[v].style.display=i;A.paintIconImg();A.paintClipIcoImg();A.refreshDom()},expand:function(){var A=this,B=A.parentNode;if(B&&B.isExpand==r){B.expand()}if(!A.isLeaf()&&A.childNodes.length){if(!A.isRoot()){A.record.set(A.getOwnerTree().expandfield,"Y",f)}A.isExpand=f;A.paintChildren();A.els[v].style.display="block"}A.paintIconImg();A.paintClipIcoImg();A.refreshDom()},refreshDom:function(){this.getOwnerTree().wrap.addClass("a").removeClass("a")},select:function(){var B=this,A=B.getOwnerTree();B.isSelect=f;A&&A.onNodeSelect(this.els)},unselect:function(){var B=this,A=B.getOwnerTree();B.isSelect=r;A&&A.onNodeUnSelect(B.els)},getEl:function(){return this.els},setCheckStatus:function(E){var D=this,H;if(E==2||E==3){var F=D.childNodes,C=F.length;if(C==0){H=E==2?0:1}else{var A=0,G=0;for(var B=0;B<C;B++){var E=F[B].checked;if(E==1){A++}else{if(E==2){G++}}}H=(F.length==A)?1:(A>0||G>0)?2:0}}else{H=E}D.checked=H;if(!D.isRoot()||D.showRoot!=r){D.record.set(D.getOwnerTree().checkfield,H==1||H==2?"Y":"N")}D.paintCheckboxImg()},setCheck:function(C){var B=C?1:0,A=B+2;this.cascade(function(D){D.setCheckStatus(B)});this.bubble(function(D){D.setCheckStatus(A)})},onCheck:function(){this.setCheck(this.checked==0)},isRoot:function(){return this.ownerTree&&this.ownerTree.root===this},isLeaf:function(){return this.childNodes.length===0},isLast:function(){var A=this.parentNode;return !A?f:A.childNodes[A.childNodes.length-1]==this},isFirst:function(){var A=this.getOwnerTree(),B=this.parentNode;return B==A.getRootNode()&&!A.showRoot&&B.childNodes[0]==this},hasChildNodes:function(){return this.childNodes.length>0},setFirstChild:function(A){this.firstChild=A},setLastChild:function(A){this.lastChild=A},appendChild:function(C){if(!Ext.isArray(C)&&arguments.length>1){C=arguments}var B=this,A=B.getOwnerTree();Ext.each(C,function(F){var E=F.parentNode,G=B.childNodes,D=G.length,H=G[D-1];E&&E.removeChild(F);!D&&B.setFirstChild(F);G.push(F);F.parentNode=B;if(H){F.previousSibling=H;H.nextSibling=F}else{F.previousSibling=null}F.nextSibling=null;B.setLastChild(F);F.setOwnerTree(A);B.childrenRendered&&F.render();B.els&&B.cascade(function(I){I.paintPrefix();if(!I.childrenRendered){return r}})});return C},removeChild:function(D){var C=this,E=C.childNodes,A=E.indexOf(D);if(A==-1){return r}E.splice(A,1);var F=D.previousSibling,H=D.nextSiblin,B,G;if(F){F.nextSibling=H}if(H){H.previousSibling=F}C.firstChild==D&&C.setFirstChild(H);C.lastChild==D&&C.setLastChild(F);D.setOwnerTree(null);D.parentNode=D.previousSibling=D.nextSibling=null;if(C.childrenRendered){(B=D.els)&&(G=B[q])&&C.els[v].removeChild(G);!E.length&&C.collapse()}C.els&&C.cascade(function(I){I.paintPrefix();if(!I.childrenRendered){return r}});return D},insertBefore:function(D,A){if(!A){return this.appendChild(D)}if(D==A){return r}var C=this,E=C.childNodes,F=E.indexOf(A),B=D.parentNode;if(B==C&&E.indexOf(D)<F){F--}B&&B.removeChild(D);!F&&C.setFirstChild(D);E.splice(F,0,D);D.parentNode=C;var G=E[F-1];if(G){D.previousSibling=G;G.nextSibling=D}else{D.previousSibling=null}D.nextSibling=A;A.previousSibling=D;D.setOwnerTree(C.getOwnerTree());if(C.childrenRendered){C.childrenRendered=r;C.paintChildren()}C.els&&C.paintPrefix();return D},replaceChild:function(A,B){this.insertBefore(A,B);this.removeChild(B);return B},indexOf:function(A){return this.childNodes.indexOf(A)},getOwnerTree:function(){var A=this;if(!A.ownerTree){A.bubble(function(B){if(B.ownerTree){A.ownerTree=B.ownerTree;return r}})}return A.ownerTree},setOwnerTree:function(A){var C=this,B=C.ownerTree;if(A!=B){B&&B.unregisterNode(C);C.ownerTree=A;Ext.each(C.childNodes,function(D){D.setOwnerTree(A)});A&&A.registerNode(C)}},getPathNodes:function(){var A=[];this.bubble(function(){A.unshift(this)});return A},bubble:function(C,B,A){var D=this;while(D){if(C.call(B||D,A||D)===r){break}D=D.parentNode}},cascade:function(F,E,B){if(F.call(E||this,B||this)!==r){var D=this.childNodes;for(var C=0,A=D.length;C<A;C++){D[C].cascade(F,E,B)}}},findChild:function(A,B){var C=null;Ext.each(this.childNodes,function(D){if(D.attributes[A]==B){C=D;return r}});return C},findChildBy:function(B,A){var C=null;Ext.each(this.childNodes,function(D){if(B.call(A||D,D)===f){C=D;return r}});return C},sort:function(D,C){var B=this.childNodes,A=B.length;if(A){B.sort(C?D.createDelegate(C):D);Ext.each(B,function(F,E){F.previousSibling=B[E-1];F.nextSibling=B[E+1];!E&&sf.setFirstChild(F);E==A-1&&sf.setLastChild(F)})}},toString:function(){return"[Node"+(this.id?" "+this.id:"")+"]"}};m.Tree.revision="$Rev: 8095 $"})($A);