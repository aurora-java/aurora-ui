(function(ad){var ay=document.documentElement,Q=Ext.each,R=Ext.isEmpty,v=false,O=true,aa=null,P="_",e="__",f="-",l=".",i=" ",m="",q="]",ac="-c",W="-u",a="td",T="none",b="left",u="display",d="outline",ao="1px dotted blue",p="recordid",M="row-selected",B="required",D="dataindex",ag="item-notBlank",X="item-invalid",c="table-row-alt",z="table-rowbox",r=l+z,ai="table.rowcheck",al="table.rowradio",ab="table-ckb ",ak="table-select-all",S="multiple",Z="checkedvalue",n="-readonly",an="desc",g="asc",aq="table-desc",J="table-asc",t="item-ckb",H=t+"-self",ax=l+H,af=t+W,am=t+ac,x=t+n+W,G=t+n+ac,I="item-radio-img",at=I+ac,aj=I+W,E=I+n+ac,s=I+n+W,aw=ax+i+l+am,au="table-cell",ae=au+"-editor",y="cellcheck",K="rowcheck",h="click",w="cellclick",k="render",av="rowclick",Y="editorshow",F="nexteditorshow",ar="keydown",V="select",o="mousedown",ap="resize",L="未找到",ah="方法!",j="div[atype=table.headcheck]",N="td[dataindex=";ad.Table=Ext.extend(ad.Component,{initComponent:function(A){ad.Table.superclass.initComponent.call(this,A);var U=this,C=U.wrap;U.th=C.child("thead tr.table-head");U.tbody=C.child("tbody");U.fb=C.child("tfoot");U.initTemplate()},processListener:function(A){var C=this;ad.Table.superclass.processListener.call(C,A);C.tbody[A](h,C.onClick,C);C.wrap[A]("focus",C.onFocus,C)[A]("blur",C.onBlur,C)[A](Ext.isOpera?"keypress":ar,C.handleKeyUp,C)[A]("keyup",C.handleKeyUp,C)[A](o,C.onMouseDown,C);if(C.canwheel){C.tbody[A]("mousewheel",C.onMouseWheel,C)}if(C.th){C.th[A](h,C.onHeadClick,C)}C[A](w,C.onCellClick,C)},processDataSetLiestener:function(A){var C=this,U=C.dataset;if(U){U[A]("ajaxfailed",C.onAjaxFailed,C);U[A]("metachange",C.onLoad,C);U[A]("update",C.onUpdate,C);U[A]("reject",C.onUpdate,C);U[A]("add",C.onAdd,C);U[A]("submit",C.onBeforSubmit,C);U[A]("submitfailed",C.onAfterSuccess,C);U[A]("submitsuccess",C.onAfterSuccess,C);U[A]("query",C.onBeforeLoad,C);U[A]("load",C.onLoad,C);U[A]("loadfailed",C.onAjaxFailed,C);U[A]("valid",C.onValid,C);U[A]("beforeremove",C.onBeforeRemove,C);U[A]("remove",C.onRemove,C);U[A]("clear",C.onLoad,C);U[A]("refresh",C.onLoad,C);U[A]("fieldchange",C.onFieldChange,C);U[A]("indexchange",C.onIndexChange,C);U[A]("select",C.onSelect,C);U[A]("unselect",C.onUnSelect,C);U[A]("selectall",C.onSelectAll,C);U[A]("unselectall",C.onUnSelectAll,C)}},initEvents:function(){ad.Table.superclass.initEvents.call(this);this.addEvents(k,w,av,Y,F)},bind:function(A){if(Ext.isString(A)){A=$(A);if(!A){return}}this.dataset=A;this.processDataSetLiestener("on");this.onLoad()},handleKeyUp:function(A){if(A.getKey()==9){this.showEditorByRecord()}},initTemplate:function(){this.cellTpl=new Ext.Template(['<div class="',au,' {cellcls}" id="',this.id,"_{name}_{",p,'}">{text}</div>']);this.cbTpl=new Ext.Template(['<center><div class="{cellcls}" id="',this.id,"_{name}_{",p,'}"></div></center>'])},createRow:function(U,aC,az){var aB=this,aE=aB.tbody.dom.insertRow(aC),aA=aB.parseCss(aB.renderRow(U,aC));aE.id=aB.id+f+U.id;aE.style.cssText=aA.style;aE.className=(aC%2==1?c+i:m)+aA.cls;Q(aB.columns,function(aF){aB.createCell(aE,aF,U)});if(az){var aD=aB.wrap.query("tbody tr");for(var C=aC+1,A=aD.length;C<A;C++){Ext.fly(aD[C]).toggleClass(c).select(r).each(function(aF){aB.setSelectStatus(aB.dataset.findById(aF.getAttributeNS(m,p)))})}}},createEmptyRow:function(){var A=this;A.emptyRow=A.tbody.dom.insertRow(-1);Q(A.columns,function(C){Ext.fly(A.emptyRow.insertCell(-1)).set({atype:au,dataindex:C.name}).setStyle({"text-align":C.align||b,display:C.hidden?T:m}).update("&#160;")})},removeEmptyRow:function(){var A=this;if(A.emptyRow){A.tbody.dom.removeChild(A.emptyRow);A.emptyRow=aa}},getCheckBoxStatus:function(A,az,U){var aB=this.dataset.getField(az),C=aB.getPropertity(Z),aA=A.data[az];return t+(U?n:m)+((aA&&aA==C)?ac:W)},createCell:function(aF,A,aA){var aB=this,aC=aB.getEditor(A,aA),C=A.type,aE=A.name,az,aH=m,U;if(aF.tagName.toLowerCase()=="tr"){U=aF.insertCell(-1)}else{U=Ext.fly(aF).parent(a).dom}if(aC!=m){var aD=ad.CmpManager.get(aC);if(aD&&(aD instanceof ad.CheckBox)){C=y}else{aH=ae}}else{if(aE&&Ext.isDefined(aA.getField(aE).get(Z))){C=y;az=O}}if(C==K||C=="rowradio"){az=aB.dataset.execSelectFunction(aA)?m:n;Ext.fly(U).set({atype:C==K?ai:al,recordid:aA.id}).addClass(z);U.innerHTML=aB.cbTpl.applyTemplate({cellcls:C==K?ab+t+az+W:"table-radio "+I+az+W,name:aE,recordid:aA.id})}else{Ext.fly(U).set({atype:au,recordid:aA.id,dataindex:aE}).setStyle({"text-align":A.align||b,display:A.hidden?T:m});if(C==y){U.innerHTML=aB.cbTpl.applyTemplate({cellcls:ab+aB.getCheckBoxStatus(aA,aE,az),name:aE,recordid:aA.id})}else{var aG=aA.getMeta().getField(aE);if(aG&&R(aA.data[aE])&&aA.isNew==O&&aG.get(B)==O){aH=aH+i+ag}U.innerHTML=aB.cellTpl.applyTemplate({text:aB.renderText(aA,A,aA.data[aE]),cellcls:aH,name:aE,recordid:aA.id})}}},onSelect:function(az,C,aA){if(!C||aA){return}var U=this,A=Ext.get(U.id+e+C.id);A.parent(r).addClass(H);if(A){if(U.selectionmodel==S){U.setCheckBoxStatus(A,O)}else{U.setRadioStatus(A,O);az.locate((az.currentPage-1)*az.pagesize+az.indexOf(C)+1)}U.setSelectStatus(C)}},onUnSelect:function(az,C,aA){if(!C||aA){return}var U=this,A=Ext.get(U.id+e+C.id);A.parent(r).addClass(H);if(A){if(U.selectionmodel==S){U.setCheckBoxStatus(A,v)}else{U.setRadioStatus(A,v)}U.setSelectStatus(C)}},onSelectAll:function(){var A=this;A.clearChecked();A.isSelectAll=O;A.isUnSelectAll=v;A.wrap.addClass(ak)},onUnSelectAll:function(){var A=this;A.clearChecked();A.isSelectAll=v;A.isUnSelectAll=O;A.wrap.removeClass(ak)},clearChecked:function(){var A=this.wrap;A.select(aw).replaceClass(am,af);A.select(ax).removeClass(H)},setRadioStatus:function(A,C){if(!C){A.removeClass(at).addClass(aj)}else{A.addClass(at).removeClass(aj)}},setCheckBoxStatus:function(A,C){if(!C){A.removeClass(am).addClass(af)}else{A.addClass(am).removeClass(af)}},setSelectDisable:function(U,C){var A=this.dataset.selected.indexOf(C)==-1;if(this.selectionmodel==S){U.removeClass([am,af]).addClass(A?x:G)}else{U.removeClass([at,aj,E,s]).addClass(A?s:E)}},setSelectEnable:function(U,C){var A=this.dataset.selected.indexOf(C)==-1;if(this.selectionmodel==S){U.removeClass([x,G]).addClass(A?af:am)}else{U.removeClass([aj,at,s,E]).addClass(A?aj:at)}},setSelectStatus:function(C){var U=this,az=U.dataset;if(az.selectfunction){var A=Ext.get(U.id+e+C.id);if(!az.execSelectFunction(C)){U.setSelectDisable(A,C)}else{U.setSelectEnable(A,C)}}},onHeadClick:function(aD,U){var aB=this,aC=aB.dataset;U=Ext.get(U);if(U.is(j)){var aA=U.hasClass(am);aB.setCheckBoxStatus(U,!aA);if(!aA){aC.selectAll()}else{aC.unSelectAll()}}else{if(U.is(".table-hc")){var C=U.getAttributeNS(m,D),A=aB.findColByName(C);if(A&&A.sortable===O){if(aC.isModified()){ad.showInfoMessage("提示","有未保存数据!");return}var az=m;if(aB.currentSortTarget){aB.currentSortTarget.removeClass([J,aq])}aB.currentSortTarget=U;if(R(A.sorttype)){A.sorttype=an;U.removeClass(J).addClass(aq);az=an}else{if(A.sorttype==an){A.sorttype=g;U.removeClass(aq).addClass(J);az=g}else{A.sorttype=m;U.removeClass([aq,J])}}aC.sort(C,az)}}}},setEditor:function(C,U){var az=this,A=az.findColByName(C),aA=Ext.get([az.id,C,az.selectedId].join(P));A.editor=U;if(aA){az.focusdiv=aA;if(U==m){aA.removeClass(ae)}else{if(!$(U) instanceof ad.CheckBox){aA.addClass(ae)}}}},getEditor:function(az,C){var U=az.editor||m;if(az.editorfunction){var A=window[az.editorfunction];if(A==aa){alert(L+az.editorfunction+ah);return aa}U=A.call(window,C,az.name)||m}return U},showEditor:function(aE,A,aD){if(aE==-1){return}var aB=this,U=aB.findColByName(A);if(!U){return}var C=aB.dataset,az=C.getAt(aE);if(!az){return}if(az.id!=aB.selectedId){aB.selectRow(aE)}var aC=aB.getEditor(U,az);aB.setEditor(A,aC);if(aC!=m){var aA=$(aC);(function(){var aH=az.get(A),aM=Ext.get([aB.id,A,az.id].join(P)),aL=aM.getXY(),aG;aA.bind(C,A);aA.render(az);aA.el.on(ar,aB.onEditorKeyDown,aB);Ext.fly(ay).on(o,aB.onEditorBlur,aB);aG=aB.currentEditor={record:az,ov:aH,name:A,editor:aA};aB.positionEditor();if(aA instanceof ad.CheckBox){var aF=aB._begin;if(aF){var aK=C.indexOf(aF),aJ=C.indexOf(az);if(aK>aJ){var aI=aJ;aJ=aK;aK=aI}aJ++;for(;aK<aJ;aK++){C.getAt(aK).set(A,aF.get(A))}delete aB._begin}else{if(aD){aA.focus()}else{aA.onClick()}}}else{if(aA instanceof ad.Field&&!aA instanceof ad.TextArea){aA.el.setStyle("text-align",U.align||b)}else{if(aA instanceof ad.Lov){aA.on("fetching",aB.onFetching,aB)}}aA.isEditor=O;aA.isFireEvent=O;aA.isHidden=v;aA.focus();aA.on(V,aB.onEditorSelect,aB);if(Ext.isFunction(aD)){aD(aA)}aB.fireEvent(Y,aB,aA,aE,A,az)}aB.editing=O;Ext.fly(window).on(ap,aB.positionEditor,aB)}).defer(10)}},showEditorByRecord:function(A){var C=this,U=C.dataset,az=A?U.indexOf(A):0;A=A||U.getAt(0);Q(C.columns,function(aA){if(aA.hidden!=O&&C.getEditor(aA,A)!=m){C.fireEvent(w,C,az,aA.name,A,function(){});C.fireEvent(av,C,az,A);return v}})},onEditorSelect:function(){(function(){this.hideEditor()}).defer(1,this)},onEditorKeyDown:function(aA,C){var U=this,az=aA.keyCode;ced=U.currentEditor;if(az==27){if(ced){var A=ced.editor;if(A){A.clearInvalid();A.render(A.binder.ds.getCurrentRecord())}}U.hideEditor()}else{if(az==13){if(!(ced&&ced.editor&&ced.editor instanceof ad.TextArea)){U.showEditorBy(39)}}else{if(az==9){aA.stopEvent();U.showEditorBy(aA.shiftKey?37:39)}else{if(aA.ctrlKey&&(az==37||az==38||az==39||az==40)){U.showEditorBy(az);aA.stopEvent()}}}}},findEditorBy:function(aC){var aF=this,C,aE;if((C=aF.currentEditor)&&(aE=C.editor)){var aI=aF.columns,aG=v,aB=aF.dataset,aA=aE.binder.name,A=aE.record,aK=aB.data.indexOf(A),U=aa,aH=v,aD=O,aJ=v,az;if(aK!=-1){if(aC==37||aC==38){aI=[].concat(aI).reverse();aD=v}if(aC==38||aC==40){aJ=O;az=aF.findColByName(aA)}while(A){if(!aJ){Q(aI,function(aL){if(aG){if(aL.hidden!=O&&aF.getEditor(aL,A)!=m){U=aL.name;return v}}else{if(aL.name==aA){aG=O}}})}if(U){return{row:aK,name:U,record:A}}A=aB.getAt(aD?++aK:--aK);if(aD&&!A&&!aH&&aF.autoappend!==v){aF.hideEditor();aB.create();A=aB.getAt(aK);aH=O}if(aJ&&A&&aF.getEditor(az,A)!=m){U=aA}}}}return aa},showEditorBy:function(U){var az=this,aB=O,C=az.findEditorBy(U);if(C){az.hideEditor();var aA=C.row,A=C.record;az.fireEvent(w,az,aA,C.name,A,aB);az.fireEvent(av,az,aA,A)}},positionEditor:function(){var C=this,A=C.currentEditor.editor,az=C.focusdiv,U=az.getXY();if(A instanceof ad.CheckBox){A.move(U[0],U[1]-3)}else{A.setHeight(az.getHeight()-2);A.setWidth(az.getWidth()-5<22?22:(az.getWidth()-5));A.move(U[0],U[1])}if(A.isExpanded&&A.isExpanded()){if(Ext.isIE){if(C.t){clearTimeout(C.t)}C.t=(function(){A.syncPopup()}).defer(1)}else{A.syncPopup()}}},hideEditor:function(){var az=this,U=az.currentEditor;if(U){var C=U.editor;if(C){if(!C.canHide||C.canHide()){C.el.un(ar,az.onEditorKeyDown,az);C.un(V,az.onEditorSelect,az);Ext.fly(ay).un(o,az.onEditorBlur,az);Ext.fly(window).un(ap,az.positionEditor,az);C.move(-10000,-10000);var A=C.autocompleteview;if(A){A.hide()}C.blur();C.onBlur();C.isFireEvent=v;C.isHidden=O;az.editing=v;if(C.collapse){C.collapse()}}}}},selectRow:function(aB,C){var az=this,aA=az.dataset,A=aA.getAt(aB),U=(aA.currentPage-1)*aA.pagesize+aB+1;az.selectedId=A.id;if(az.selectTr){az.selectTr.removeClass(M)}az.selectTr=Ext.get(az.id+f+A.id);if(az.selectTr){az.selectTr.addClass(M)}if(C!==v&&U!=aa){aA.locate.defer(5,aA,[U,v])}},drawFootBar:function(C){var A=this;if(!A.fb){return}Q([].concat((C)?C:A.columns),function(aC){var aA=Ext.isString(aC)?A.findColByName(aC):aC;if(aA&&aA.footerrenderer){var aB=ad.getRenderer(aA.footerrenderer);if(aB==aa){alert(L+aA.footerrenderer+ah);return}var az=aA.name,U=aB.call(window,A.dataset.data,az);if(!R(U)){A.fb.child(N+az+q).update(U)}}})},showColumn:function(C){var A=this.findColByName(C);if(A){if(A.hidden===O){delete A.hidden;this.wrap.select(N+C+q).setStyle(u,m)}}},hideColumn:function(C){var A=this.findColByName(C);if(A){if(A.hidden!==O){this.wrap.select(N+C+q).setStyle(u,T);A.hidden=O}}},findColByName:function(A){var C;if(A){Q(this.columns,function(U){if(U.name&&U.name.toLowerCase()===A.toLowerCase()){C=U;return v}})}return C},parseCss:function(U){var aA=m,A=m;if(Ext.isArray(U)){for(var C=0;C<U.length;C++){var az=this.parseCss(U[C]);aA+=";"+az.style;A+=i+az.cls}}else{if(Ext.isString(U)){var aB=!!U.match(/^([^,:;]+:[^:;]+;)*[^,:;]+:[^:;]+;*$/);A=aB?m:U;aA=aB?U:m}}return{style:aA,cls:A}},renderText:function(A,C,aA){var az=C.renderer;if(az){var U=ad.getRenderer(az);if(U==aa){alert(L+az+ah);return aA}aA=U.call(window,aA,A,C.name);return aA==aa?m:aA}return aA==aa?m:aA},renderRow:function(A,aA){var az=this.rowrenderer,C=aa;if(az){var U=ad.getRenderer(az);if(U==aa){alert(L+az+ah);return C}C=U.call(window,A,aA);return !C?m:C}return C},renderEditor:function(az,A,U,C){this.createCell(az.dom,U,A)},onClick:function(aD,aG){var aC=this,A=(aG=Ext.fly(aG)).dom.tagName.toLowerCase()==a,aE=A?aG:aG.parent(a);if(aE){var az=aE.getAttributeNS(m,"atype"),aF=aE.getAttributeNS(m,p),U=aC.dataset;if(az==au){var aB=U.findById(aF),aH=U.indexOf(aB),C=aE.getAttributeNS(m,D);aC.fireEvent(w,aC,aH,C,aB,!aG.hasClass("table-ckb"));aC.fireEvent(av,aC,aH,aB)}else{if(az==ai){var aA=Ext.get(aC.id+e+aF);if(aA.hasClass(x)||aA.hasClass(G)){return}if(aC.isSelectAll&&!aA.parent(ax)){aA.replaceClass(af,am)}else{if(aC.isUnselectAll&&!aA.parent(ax)){aA.replaceClass(am,af)}}aA.hasClass(am)?U.unSelect(aF):U.select(aF)}else{if(az==al){var aA=Ext.get(aC.id+e+aF);if(aA.hasClass(s)||aA.hasClass(E)){return}U.select(aF)}}}}},onCellClick:function(U,az,C,A,aA){this.showEditor(az,C,aA)},onUpdate:function(aB,A,C,aA){this.setSelectStatus(A);var az=this,aD=Ext.get([az.id,C,A.id].join(P));if(aD){var aC=az.findColByName(C),U=az.getEditor(aC,A);if(U!=m&&($(U) instanceof ad.CheckBox)){az.renderEditor(aD,A,aC,U)}else{aD.update(az.renderText(A,aC,aA))}}Q(az.columns,function(aF){if(aF.name!=C){var aE=Ext.get([az.id,aF.name,A.id].join(P));if(aE){if(aF.editorfunction){az.renderEditor(aE,A,aF,az.getEditor(aF,A))}if(aF.renderer){aE.update(az.renderText(A,aF,A.get(aF.name)))}}}});az.drawFootBar(C)},onLoad:function(){var aA=this,az=aA.wrap,aB=aA.dataset.data,A=az.removeClass(ak).child(j);aA.clearBody();if(A&&aA.selectable&&aA.selectionmodel==S){aA.setCheckBoxStatus(A,v)}var C=aB.length;if(C==0){aA.createEmptyRow()}else{for(var U=0;U<C;U++){aA.createRow(aB[U],U)}}aA.drawFootBar();ad.Masker.unmask(az);aA.fireEvent(k,aA)},onValid:function(az,A,C,U){var aB=this.findColByName(C);if(aB){var aA=Ext.get([this.id,C,A.id].join(P));if(aA){if(U==v){aA.addClass(X)}else{aA.removeClass([ag,X])}}}},onAdd:function(az,A,C){var U=this,az=U.dataset;U.removeEmptyRow();U.createRow(A,C,C!==az.data.length-1);U.selectRow(az.indexOf(A));U.setSelectStatus(A)},onRemove:function(az,A,C){var U=this,aA=Ext.get(U.id+f+A.id);if(aA){aA.remove()}U.selectTr=aa;ad.Masker.unmask(U.wrap);U.drawFootBar()},onMouseDown:function(aA,U){U=(U=Ext.fly(U)).is(a)?U:U.parent(a);var az=this,C=U.getAttribute("atype"),A;if((A=az.currentEditor)&&A.editor instanceof ad.CheckBox&&C==au&&U.getAttribute(D)==A.name){if(aA.shiftKey){az._begin=A.record;aA.stopEvent()}else{if((U=U.child(".table-ckb"))&&U.dom.className.search(/readonly/)==-1){aA.stopEvent();A.editor.focus.defer(Ext.isIE?1:0,A.editor)}}}},focus:function(){this.wrap.focus()},onFocus:function(){this.hasFocus=O},blur:function(){this.wrap.blur()},onBlur:function(){this.hasFocus=v},clearBody:function(){var A=this.tbody.dom;while(A.childNodes.length){A.removeChild(A.firstChild)}this.emptyRow=aa},getDataIndex:function(U){for(var C=0,az=this.dataset.data,A=az.length;C<A;C++){if(az[C].id==U){return C}}return -1},onEditorBlur:function(az,C){var U=this,A=U.currentEditor;if(A&&!A.editor.isEventFromComponent(C)){U.hideEditor.defer(Ext.isIE9?10:0,U)}},onMouseWheel:function(C){C.stopEvent();if(this.editing==O){return}var U=C.getWheelDelta(),A=this.dataset;if(U>0){A.pre()}else{if(U<0){A.next()}}},onIndexChange:function(U,C){var A=this.getDataIndex(C.id);if(A==-1){return}this.selectRow(A,v)},onFieldChange:function(az,A,aA,C,U){if(C==B){var aB=Ext.get([this.id,aA.name,A.id].join(P));if(aB){aB[U==O?"addClass":"removeClass"](ag)}}},onBeforeRemove:function(){ad.Masker.mask(this.wrap,_lang["grid.mask.remove"])},onBeforeLoad:function(){ad.Masker.mask(this.wrap,_lang["grid.mask.loading"])},onAfterSuccess:function(){ad.Masker.unmask(this.wrap)},onBeforSubmit:function(A){ad.Masker.mask(this.wrap,_lang["grid.mask.submit"])},onFetching:function(A){var C=this;C.isFetching=true;ad.Masker.mask(C.wrap,_lang["grid.mask.fetching"]);A.on("fetched",C.onFetched,C)},onFetched:function(A){var C=this;C.isFetching=false;ad.Masker.unmask(C.wrap);A.un("fetched",C.onFetched,C);A.un("fetching",C.onFetching,C)},onAjaxFailed:function(C,A){ad.Masker.unmask(this.wrap)},destroy:function(){ad.Table.superclass.destroy.call(this);this.processDataSetLiestener("un")}});ad.Table.revision="$Rev: 8378 $"})($A);