$A=Aurora={version:"1.0",revision:"$Rev$"};$A.fireWindowResize=function(){$A.Cover.resizeCover()};Ext.EventManager.on(window,"resize",$A.fireWindowResize,this);$A.cache={};$A.cmps={};$A.onReady=Ext.onReady;$A.get=Ext.get;$A.focusWindow;$A.center=function(b){var e;if(typeof(b)=="string"){var c=$A.CmpManager.get(b);if(c){if(c.wrap){e=c.wrap}}else{e=Ext.get(b)}}else{e=Ext.get(b)}var d=$A.getViewportWidth();var g=$A.getViewportHeight();var a=Math.max(0,(d-e.getWidth())/2);var f=Math.max(0,(g-e.getHeight())/2);e.setStyle("position","absolute");e.moveTo(a,f)};$A.setTheme=function(a){if(a){var b=new Date();b.setTime(b.getTime()+24*3600*1000);document.cookie="app_theme="+escape(a)+";expires="+b.toGMTString();window.location.reload()}};$A.CmpManager=function(){return{put:function(b,a){if($A.focusWindow){$A.focusWindow.cmps[b]=a}if(!this.cache){this.cache={}}if(this.cache[b]!=null){alert("错误: ID为' "+b+" '的组件已经存在!");return}this.cache[b]=a;a.on("mouseover",$A.CmpManager.onCmpOver,$A.CmpManager);a.on("mouseout",$A.CmpManager.onCmpOut,$A.CmpManager)},onCmpOver:function(i,g){if($A.validInfoType!="tip"){return}if($A.Grid&&i instanceof $A.Grid){var c=i.dataset;if(!c||c.isValid==true){return}var h=Ext.fly(g.target).findParent("td");if(h){var d=Ext.fly(h).getAttributeNS("","atype");if(d=="grid-cell"){var l=Ext.fly(h).getAttributeNS("","recordid");var f=c.findById(l);if(f){var a=Ext.fly(h).getAttributeNS("","dataindex");var b=f.valid[a];if(Ext.isEmpty(b)){return}$A.ToolTip.show(h,b)}}}}else{if(i.binder){var c=i.binder.ds;if(!c||c.isValid==true){return}var f=i.record;if(!f){return}var b=f.valid[i.binder.name];if(Ext.isEmpty(b)){return}$A.ToolTip.show(i.id,b)}}},onCmpOut:function(a,b){if($A.validInfoType!="tip"){return}$A.ToolTip.hide()},getAll:function(){return this.cache},remove:function(b){var a=this.cache[b];a.un("mouseover",$A.CmpManager.onCmpOver,$A.CmpManager);a.un("mouseout",$A.CmpManager.onCmpOut,$A.CmpManager);delete this.cache[b]},get:function(a){if(!this.cache){return null}return this.cache[a]}}}();Ext.Ajax.on("requestexception",function(f,c,e){if($A.slideBarEnable){$A.SideBar.enable=$A.slideBarEnable}$A.manager.fireEvent("ajaxerror",$A.manager,c.status,c);if($A.logWindow){var a=$("HTTPWATCH_DATASET").getCurrentRecord();var d=$A._startTime;var b=new Date();a.set("spend",b-d);a.set("status",c.status);a.set("result",c.statusText);a.set("response",c.statusText)}switch(c.status){case 404:$A.showErrorMessage("404错误",'未找到 "'+c.statusText+'"',null,400,150);break;case 500:$A.showErrorMessage(c.status+"错误",c.responseText,null,500,300);break;default:$A.showErrorMessage("错误",c.statusText);break}},this);$=$A.getCmp=function(b){var a=$A.CmpManager.get(b);if(a==null){alert("未找到组件:"+b)}return a};$A.setCookie=function(a,b){document.cookie=a+"="+escape(b)};$A.getCookie=function(b){var a=document.cookie.match(new RegExp("(^| )"+b+"=([^;]*)(;|$)"));if(a!=null){return unescape(a[2])}return null};$A.getViewportHeight=function(){if(Ext.isIE){return Ext.isStrict?document.documentElement.clientHeight:document.body.clientHeight}else{return self.innerHeight}};$A.getViewportWidth=function(){if(Ext.isIE){return Ext.isStrict?document.documentElement.clientWidth:document.body.clientWidth}else{return self.innerWidth}};$A.post=function(d,c){var b=Ext.getBody().createChild({tag:"form",method:"post",action:d});for(var a in c){if(c[a]){b.createChild({tag:"input",type:"hidden",name:a,value:c[a]})}}b.dom.submit()};$A.request=function(c){var b=c.url,a=c.para,f=c.success,g=c.error,d=c.scope,h=c.failure;var e=Ext.apply({},c.opts);$A.manager.fireEvent("ajaxstart",b,a);if($A.logWindow){$A._startTime=new Date();$("HTTPWATCH_DATASET").create({url:b,request:Ext.util.JSON.encode({parameter:a})})}Ext.Ajax.request({url:b,method:"POST",params:{_request_data:Ext.util.JSON.encode({parameter:a})},opts:e,success:function(m,p){if($A.logWindow){var o=$A._startTime;var l=new Date();var i=$("HTTPWATCH_DATASET").getCurrentRecord();i.set("spend",l-o);i.set("result",m.statusText);i.set("status",m.status);i.set("response",m.responseText)}$A.manager.fireEvent("ajaxcomplete",b,a,m);if(m){var r=null;try{r=Ext.decode(m.responseText)}catch(t){$A.showErrorMessage("错误","返回格式不正确!");return}if(r&&!r.success){$A.manager.fireEvent("ajaxfailed",$A.manager,b,a,r);if(r.error){var o=r.error.stackTrace;o=(o)?o.replaceAll("\r\n","</br>"):"";if(r.error.message){var s=(o=="")?150:250;$A.showErrorMessage("错误",r.error.message+"</br>"+o,null,400,s)}else{$A.showErrorMessage("错误",o,null,400,250)}if(g){g.call(d,r,p)}}}else{$A.manager.fireEvent("ajaxsuccess",$A.manager,b,a,r);if(f){f.call(d,r,p)}}}},failure:function(i,l){if(h){h.call(d,i,l)}},scope:d})};Aurora.dateFormat=function(){var a={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};var b=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,c=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,e=/[^-+\dA-Z]/g,d=function(g,f){g=String(g);f=f||2;while(g.length<f){g="0"+g}return g};return function(i,B,w){if(arguments.length==1&&(typeof i=="string"||i instanceof String)&&!/\d/.test(i)){B=i;i=undefined}i=i?new Date(i):new Date();if(isNaN(i)){throw new SyntaxError("invalid date")}B=String(a[B]||B||a["default"]);if(B.slice(0,4)=="UTC:"){B=B.slice(4);w=true}var z=w?"getUTC":"get",r=i[z+"Date"](),f=i[z+"Day"](),l=i[z+"Month"](),u=i[z+"FullYear"](),x=i[z+"Hours"](),p=i[z+"Minutes"](),A=i[z+"Seconds"](),t=i[z+"Milliseconds"](),g=w?0:i.getTimezoneOffset(),h={d:r,dd:d(r),m:l+1,mm:d(l+1),yy:String(u).slice(2),yyyy:u,h:x%12||12,hh:d(x%12||12),H:x,HH:d(x),M:p,MM:d(p),s:A,ss:d(A),l:d(t,3),L:d(t>99?Math.round(t/10):t),t:x<12?"a":"p",tt:x<12?"am":"pm",T:x<12?"A":"P",TT:x<12?"AM":"PM",Z:w?"UTC":(String(i).match(c)||[""]).pop().replace(e,""),o:(g>0?"-":"+")+d(Math.floor(Math.abs(g)/60)*100+Math.abs(g)%60,4),S:["th","st","nd","rd"][r%10>3?0:(r%100-r%10!=10)*r%10]};return B.replace(b,function(m){return m in h?h[m]:m.slice(1,m.length-1)})}}();Ext.applyIf(String.prototype,{trim:function(){return this.replace(/(^\s*)|(\s*$)/g,"")}});Ext.applyIf(Date.prototype,{format:function(a,b){return Aurora.dateFormat(this,a,b)}});Ext.applyIf(Array.prototype,{add:function(a){if(this.indexOf(a)==-1){this[this.length]=a}}});Ext.applyIf(String.prototype,{replaceAll:function(b,a){return this.replace(new RegExp(b,"gm"),a)}});$A.TextMetrics=function(){var a;return{measure:function(b,c,d){if(!a){a=$A.TextMetrics.Instance(b,d)}a.bind(b);a.setFixedWidth(d||"auto");return a.getSize(c)}}}();$A.TextMetrics.Instance=function(b,d){var c=new Ext.Element(document.createElement("div"));document.body.appendChild(c.dom);c.position("absolute");c.setLeft(-1000);c.setTop(-1000);c.hide();if(d){c.setWidth(d)}var a={getSize:function(f){c.update(f);var e=new Object();e.width=c.getWidth();e.height=c.getHeight();c.update("");return e},bind:function(h){var f=new Array("font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing");var e=f.length,l={};for(var g=0;g<e;g++){l[f[g]]=Ext.fly(h).getStyle(f[g])}c.setStyle(l)},setFixedWidth:function(e){c.setWidth(e)}};a.bind(b);return a};$A.ToolTip=function(){q={init:function(){var a=this;Ext.onReady(function(){var b=Ext.DomHelper.append(Ext.getBody(),{tag:"div",cls:"tip-wrap",children:[{tag:"div",cls:"tip-body"}]});var c=Ext.DomHelper.append(Ext.getBody(),{tag:"div",cls:"item-shadow"});a.tip=Ext.get(b);a.shadow=Ext.get(c);a.body=a.tip.first("div.tip-body")})},show:function(a,d){if(this.tip==null){this.init()}this.tip.show();this.shadow.show();this.body.update(d);var c;if(typeof(a)=="string"){if(this.sid==a){return}this.sid=a;var b=$A.CmpManager.get(a);if(b){if(b.wrap){c=b.wrap}}}else{c=Ext.get(a)}this.shadow.setWidth(this.tip.getWidth());this.shadow.setHeight(this.tip.getHeight());this.correctPosition(c)},correctPosition:function(c){var b=$A.getViewportWidth();var a=c.getX()+c.getWidth()+5;var d=c.getX()+c.getWidth()+7;if(a+this.tip.getWidth()>b){a=c.getX()-this.tip.getWidth()-5;d=c.getX()-this.tip.getWidth()-3}this.tip.setX(a);this.tip.setY(c.getY());this.shadow.setX(d);this.shadow.setY(this.tip.getY()+2)},hide:function(){this.sid=null;if(this.tip!=null){this.tip.hide()}if(this.shadow!=null){this.shadow.hide()}}};return q}();$A.SideBar=function(){var a={enable:true,bar:null,show:function(d){if(!this.enable){return}var b=this;if(parent.showSideBar){parent.showSideBar(d)}else{this.hide();var c='<div class="item-slideBar">'+d+"</div>";this.bar=Ext.get(Ext.DomHelper.append(Ext.getBody(),c));this.bar.setStyle("z-index",999999);this.bar.animate({height:{to:50,from:0}},0.35,function(){setTimeout(function(){b.hide()},2000)},"easeOut","run")}},hide:function(){if(parent.hideSideBar){parent.hideSideBar()}else{if(this.bar){Ext.fly(this.bar).remove();this.bar=null}}}};return a}();$A.Status=function(){var a={bar:null,enable:true,show:function(c){if(!this.enable){return}this.hide();if(parent.showStatus){parent.showStatus(c)}else{var b='<div class="item-statusBar" unselectable="on">'+c+"</div>";this.bar=Ext.get(Ext.DomHelper.append(Ext.getBody(),b));this.bar.setStyle("z-index",999998)}},hide:function(){if(parent.hideStatus){parent.hideStatus()}else{if(this.bar){Ext.fly(this.bar).remove();this.bar=null}}}};return a}();$A.Cover=function(){var a={bodyOverflow:null,sw:null,sh:null,container:{},cover:function(d){$A.Cover.bodyOverflow=Ext.getBody().getStyle("overflow");var b=Ext.isStrict?document.documentElement.scrollWidth:document.body.scrollWidth;var c=Ext.isStrict?document.documentElement.scrollHeight:document.body.scrollHeight;var e=Math.max(b,$A.getViewportWidth());var h=Math.max(c,$A.getViewportHeight());var g='<DIV class="aurora-cover" style="left:0px;top:0px;width:'+(e)+"px;height:"+(h)+'px;" unselectable="on"></DIV>';var f=Ext.get(Ext.DomHelper.append(Ext.getBody(),g));f.setStyle("z-index",Ext.fly(d).getStyle("z-index")-1);Ext.getBody().setStyle("overflow","hidden");$A.Cover.container[d.id]=f},uncover:function(b){var d=$A.Cover.container[b.id];if(d){Ext.fly(d).remove();$A.Cover.container[b.id]=null;delete $A.Cover.container[b.id]}var c=true;for(key in $A.Cover.container){if($A.Cover.container[key]){c=false;break}}if(c&&$A.Cover.bodyOverflow){Ext.getBody().setStyle("overflow",$A.Cover.bodyOverflow)}},resizeCover:function(){var b=Ext.isStrict?document.documentElement.scrollWidth:document.body.scrollWidth;var c=Ext.isStrict?document.documentElement.scrollHeight:document.body.scrollHeight;var d=Math.max(b,$A.getViewportWidth());var f=Math.max(c,$A.getViewportHeight());if($A.Cover.sw==d&&$A.Cover.sh==f){return}$A.Cover.sw=d;$A.Cover.sh=f;for(key in $A.Cover.container){var e=$A.Cover.container[key];Ext.fly(e).setWidth(d);Ext.fly(e).setHeight(f)}}};return a}();$A.Masker=function(){var a={container:{},mask:function(e,f){if($A.Masker.container[e.id]){return}f=f||"正在操作...";var e=Ext.get(e);var i=e.getWidth();var g=e.getHeight();var b='<div class="aurora-mask"  style="left:0px;top:0px;width:'+i+"px;height:"+g+'px;position: absolute;"><div unselectable="on"></div><span style="top:'+(g/2-11)+'px">'+f+"</span></div>";var d=Ext.get(Ext.DomHelper.append(e.parent(),b));var m=e.getStyle("z-index")=="auto"?0:e.getStyle("z-index");d.setStyle("z-index",m+1);d.setXY(e.getXY());var c=d.child("span");var l=$A.TextMetrics.measure(c,f);c.setLeft((i-l.width)/2);$A.Masker.container[e.id]=d},unmask:function(b){var c=$A.Masker.container[b.id];if(c){Ext.fly(c).remove();$A.Masker.container[b.id]=null;delete $A.Masker.container[b.id]}}};return a}();Ext.util.JSON.encodeDate=function(b){var a=function(c){return c<10?"0"+c:c};return'"'+b.getFullYear()+"-"+a(b.getMonth()+1)+"-"+a(b.getDate())+'"'};Ext.Element.prototype.update=function(html,loadScripts,callback){if(typeof html=="undefined"){html=""}if(loadScripts!==true){this.dom.innerHTML=html;if(typeof callback=="function"){callback()}return this}var id=Ext.id();var dom=this.dom;html+='<span id="'+id+'"></span>';Ext.lib.Event.onAvailable(id,function(){var links=[];var scripts=[];var hd=document.getElementsByTagName("head")[0];for(var i=0;i<hd.childNodes.length;i++){var he=hd.childNodes[i];if(he.tagName=="LINK"){links.push(he.href)}else{if(he.tagName=="SCRIPT"){scripts.push(he.src)}}}var jsre=/(?:<script([^>]*)?>)((\n|\r|.)*?)(?:<\/script>)/ig;var jsSrcRe=/\ssrc=([\'\"])(.*?)\1/i;var cssre=/(?:<link([^>]*)?>)((\n|\r|.)*?)/ig;var cssHreRe=/\shref=([\'\"])(.*?)\1/i;var cssm;while(cssm=cssre.exec(html)){var attrs=cssm[1];var srcMatch=attrs?attrs.match(cssHreRe):false;if(srcMatch&&srcMatch[2]){var included=false;for(var i=0;i<links.length;i++){var link=links[i];if(link.indexOf(srcMatch[2])!=-1){included=true;break}}if(!included){var s=document.createElement("link");s.type="text/css";s.rel="stylesheet";s.href=srcMatch[2];hd.appendChild(s)}}}var match;var jslink=[];var jsscript=[];while(match=jsre.exec(html)){var attrs=match[1];var srcMatch=attrs?attrs.match(jsSrcRe):false;if(srcMatch&&srcMatch[2]){var included=false;for(var i=0;i<scripts.length;i++){var script=scripts[i];if(script.indexOf(srcMatch[2])!=-1){included=true;break}}if(!included){jslink[jslink.length]={src:srcMatch[2],type:"text/javascript"}}}else{if(match[2]&&match[2].length>0){jsscript[jsscript.length]=match[2]}}}var loaded=0;for(var i=0,l=jslink.length;i<l;i++){var js=jslink[i];var s=document.createElement("script");s.src=js.src;s.type=js.type;s[Ext.isIE?"onreadystatechange":"onload"]=function(){var isready=Ext.isIE?(!this.readyState||this.readyState=="loaded"||this.readyState=="complete"):true;if(isready){loaded++;if(loaded==jslink.length){for(j=0,k=jsscript.length;j<k;j++){var jst=jsscript[j];if(window.execScript){window.execScript(jst)}else{window.eval(jst)}}}}};hd.appendChild(s)}if(jslink.length==0){for(j=0,k=jsscript.length;j<k;j++){var jst=jsscript[j];if(window.execScript){window.execScript(jst)}else{window.eval(jst)}}}var el=document.getElementById(id);if(el){Ext.removeNode(el)}Ext.fly(dom).setStyle("display","block");if(typeof callback=="function"){callback()}});Ext.fly(dom).setStyle("display","none");dom.innerHTML=html.replace(/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/ig,"").replace(/(?:<link.*?>)((\n|\r|.)*?)/ig,"");return this};Ext.EventObjectImpl.prototype.isSpecialKey=function(){var a=this.keyCode;return(this.type=="keypress"&&this.ctrlKey)||a==8||a==46||a==9||a==13||a==40||a==27||a==44||(a==16)||(a==17)||(a>=18&&a<=20)||(a>=33&&a<=35)||(a>=36&&a<=39)};$A.parseDate=function(b){if(typeof b=="string"){var a=b.match(/^ *(\d{4})-(\d{1,2})-(\d{1,2}) *$/);if(a&&a.length>3){return new Date(parseInt(a[1]),parseInt(a[2],10)-1,parseInt(a[3],10))}a=b.match(/^ *(\d{4})-(\d{1,2})-(\d{1,2}) +(\d{1,2}):(\d{1,2}):(\d{1,2}) *$/);if(a&&a.length>6){return new Date(parseInt(a[1]),parseInt(a[2],10)-1,parseInt(a[3],10),parseInt(a[4],10),parseInt(a[5],10),parseInt(a[6],10))}}return null};$A.getRenderer=function(b){if(!b){return null}var a;if(b.indexOf("Aurora.")!=-1){a=$A[b.substr(7,b.length)]}else{a=window[b]}return a};$A.formatDate=function(a){if(!a){return""}return a.format("isoDate")};$A.formatDateTime=function(a){if(!a){return""}if(a.getFullYear){return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()}else{return a}};$A.formatNumber=function(d){if(!d){return""}var e=String(d).split(".");var a=(e.length==2)?"."+e[1]:"";var c=e[0];var b=/(\d+)(\d{3})/;while(b.test(c)){c=c.replace(b,"$1,$2")}v=c+a;return v};$A.removeNumberFormat=function(a){a=String(a||"");while(a.indexOf(",")!=-1){a=a.replace(",","")}return isNaN(a)?parseFloat(a):a};$A.EventManager=Ext.extend(Ext.util.Observable,{constructor:function(){$A.EventManager.superclass.constructor.call(this);this.initEvents()},initEvents:function(){this.addEvents("ajaxerror","ajaxsuccess","ajaxfailed","ajaxstart","ajaxcomplete","valid","timeout")}});$A.manager=new $A.EventManager();$A.manager.on("ajaxstart",function(){$A.Status.show("正在请求数据....")});$A.manager.on("timeout",function(){$A.Status.hide()});$A.manager.on("ajaxerror",function(){$A.Status.hide()});$A.manager.on("ajaxcomplete",function(){$A.Status.hide()});$A.manager.on("ajaxsuccess",function(){$A.SideBar.show("操作成功!")});$A.regEvent=function(b,a){$A.manager.on(b,a)};$A.validInfoType="area";$A.validInfoTypeObj="";$A.setValidInfoType=function(a,b){$A.validInfoType=a;$A.validInfoTypeObj=b};$A.invalidRecords={};$A.addInValidReocrd=function(f,a){var b=$A.invalidRecords[f];if(!b){$A.invalidRecords[f]=b=[]}var c=false;for(var d=0;d<b.length;d++){var e=b[d];if(e.id==a.id){c=true;break}}if(!c){b.add(a)}};$A.removeInvalidReocrd=function(e,a){var b=$A.invalidRecords[e];if(!b){return}for(var c=0;c<b.length;c++){var d=b[c];if(d.id==a.id){b.remove(d);break}}};$A.getInvalidRecords=function(a){var c=[];for(var d in $A.invalidRecords){var e=$A.CmpManager.get(d);if(e.pageid==a){var b=$A.invalidRecords[d];c=c.concat(b)}}return c};$A.isInValidReocrdEmpty=function(a){var e=true;for(var c in $A.invalidRecords){var d=$A.CmpManager.get(c);if(d.pageid==a){var b=$A.invalidRecords[c];if(b.length!=0){e=false;break}}}return e};$A.manager.on("valid",function(a,c,b){switch($A.validInfoType){case"area":$A.showValidTopMsg(c);break;case"message":$A.showValidWindowMsg(c);break}});$A.showValidWindowMsg=function(g){var f=$A.isInValidReocrdEmpty(g.pageid);if(f==true){if($A.validWindow){$A.validWindow.close()}}if(!$A.validWindow&&f==false){$A.validWindow=$A.showWarningMessage("校验失败","",400,200);$A.validWindow.on("close",function(){$A.validWindow=null})}var h=[];var b=$A.getInvalidRecords(g.pageid);for(var d=0;d<b.length;d++){var e=b[d];var c=e.ds.data.indexOf(e)+1;h[h.length]='记录<a href="#" onclick="$(\''+e.ds.id+"').locate("+c+')">('+e.id+")</a>:";for(var a in e.valid){h[h.length]=e.valid[a]+";"}h[h.length]="<br/>"}if($A.validWindow){$A.validWindow.body.child("div").update(h.join(""))}};$A.pageids=[];$A.showValidTopMsg=function(b){var g=$A.isInValidReocrdEmpty(b.pageid);if(g==true){var l=Ext.get(b.pageid+"_msg");if(l){l.hide();l.setStyle("display","none");l.update("")}return}var e=$A.getInvalidRecords(b.pageid);var m=[];for(var f=0;f<e.length;f++){var a=e[f];var h=a.ds.data.indexOf(a)+1;m[m.length]='记录<a href="#" onclick="$(\''+a.ds.id+"').locate("+h+')">('+a.id+")</a>:";for(var c in a.valid){m[m.length]=a.valid[c]+";"}m[m.length]="<br/>"}var l=Ext.get(b.pageid+"_msg");if(l){l.update(m.join(""));l.show(true)}};$A.setValidInfoType("tip");$A.AUTO_ID=1000;$A.DataSet=Ext.extend(Ext.util.Observable,{constructor:function(a){$A.DataSet.superclass.constructor.call(this);a=a||{};if(a.listeners){this.on(a.listeners)}this.pageid=a.pageid;this.spara={};this.selected=[];this.pagesize=a.pagesize||10;this.submiturl=a.submiturl||"";this.queryurl=a.queryurl||"";this.fetchall=a.fetchall||false;this.selectable=a.selectable||false;this.selectionmodel=a.selectionmodel||"multiple";this.autocount=a.autocount;this.bindtarget=a.bindtarget;this.bindname=a.bindname;this.loading=false;this.qpara={};this.fields={};this.resetConfig();this.id=a.id||Ext.id();$A.CmpManager.put(this.id,this);if(this.bindtarget&&this.bindname){this.bind($(this.bindtarget),this.bindname)}this.qds=Ext.isEmpty(a.querydataset)?null:$(a.querydataset);if(this.qds!=null&&this.qds.getCurrentRecord()==null){this.qds.create()}this.initEvents();if(a.fields){this.initFields(a.fields)}if(a.datas&&a.datas.length!=0){this.loadData(a.datas)}if(a.autoquery===true){var b=this;Ext.onReady(function(){b.query()})}if(a.autocreate==true){if(this.data.length==0){this.create()}}},destroy:function(){if(this.bindtarget&&this.bindname){var a=$A.CmpManager.get(this.bindtarget);if(a){a.clearBind()}}$A.CmpManager.remove(this.id);delete $A.invalidRecords[this.id]},reConfig:function(a){this.resetConfig();Ext.apply(this,a)},clearBind:function(){var a=this.bindname;var b=this.fields[a].pro.dataset;if(b){b.processBindDataSetListener(this,"un")}delete this.fields[a]},processBindDataSetListener:function(c,b){var a=this.onDataSetModify;this[b]("add",a,this);this[b]("remove",a,this);this[b]("update",a,this);this[b]("clear",a,this);this[b]("load",this.onDataSetLoad,this);this[b]("reject",a,this);c[b]("indexchange",this.onDataSetIndexChange,this)},bind:function(b,a){if(b.fields[a]){alert("重复绑定 "+a);return}this.processBindDataSetListener(b,"un");this.processBindDataSetListener(b,"on");var c=new $A.Record.Field({name:a,type:"dataset",dataset:this});b.fields[a]=c},onDataSetIndexChange:function(b,a){if(!a.get(this.bindname)&&a.isNew!=true){this.qpara={};Ext.apply(this.qpara,a.data);this.query(1,{record:a})}},onDataSetModify:function(){var a=$A.CmpManager.get(this.bindtarget);if(a){this.refreshBindDataSet(a.getCurrentRecord(),this.getConfig())}},onDataSetLoad:function(d,c){var a;if(c){a=c.opts.record}else{var b=$A.CmpManager.get(this.bindtarget);if(b){a=b.getCurrentRecord()}}if(a){this.refreshBindDataSet(a,d.getConfig())}},refreshBindDataSet:function(a,b){if(!a){return}a.set(this.bindname,b,true)},beforeCreate:function(c,a,b){if(this.data.length==0){this.create({},false)}},resetConfig:function(){this.data=[];this.selected=[];this.gotoPage=1;this.currentPage=1;this.currentIndex=1;this.totalCount=0;this.totalPage=0;this.isValid=true},getConfig:function(){var a={};a.xtype="dataset";a.data=this.data;a.selected=this.selected;a.isValid=this.isValid;a.gotoPage=this.gotoPage;a.currentPage=this.currentPage;a.currentIndex=this.currentIndex;a.totalCount=this.totalCount;a.totalPage=this.totalPage;return a},initEvents:function(){this.addEvents("ajaxfailed","beforecreate","metachange","fieldchange","add","remove","beforeremove","update","clear","beforeload","load","loadfailed","refresh","valid","indexchange","select","unselect","reject","submit","submitsuccess","submitfailed")},initFields:function(b){for(var c=0,a=b.length;c<a;c++){var d=new $A.Record.Field(b[c]);this.fields[d.name]=d}},getField:function(a){return this.fields[a]},loadData:function(e,d,o){this.data=[];this.selected=[];if(d){this.totalCount=d}else{this.totalCount=e.length}this.totalPage=Math.ceil(this.totalCount/this.pagesize);for(var b=0,f=e.length;b<f;b++){var a=e[b].data||e[b];for(var m in this.fields){var h=this.fields[m];if(h){a[m]=this.processData(a[m],h)}}var c=new $A.Record(a,e[b].field);c.setDataSet(this);this.data.add(c)}if(this.sortInfo){this.sort()}var l=true;if(this.bindtarget&&o){var g=$A.CmpManager.get(this.bindtarget).getCurrentRecord();if(o.opts.record&&g!=o.opts.record){this.refreshBindDataSet(o.opts.record,this.getConfig());l=false}}if(l){this.fireEvent("load",this,o)}},sort:function(a,b){},create:function(f,e){this.fireEvent("beforecreate",this);f=f||{};var a={};for(var c in this.fields){var g=this.fields[c];var d=g.getPropertity("defaultvalue");if(d&&!f[g.name]){a[g.name]=d}}var f=Ext.apply(f||{},a);var b=new $A.Record(f);this.add(b);return b},getNewRecrods:function(){var d=this.getAll();var e=[];for(var c=0,b=d.length;c<b;c++){var a=d[c];if(a.isNew==true){e.add(a)}}return e},add:function(a){a.isNew=true;a.setDataSet(this);var b=this.data.length;this.data.add(a);var b=(this.currentPage-1)*this.pagesize+this.data.length;this.currentIndex=b;this.fireEvent("add",this,a,b);this.locate(b,true)},getCurrentRecord:function(){if(this.data.length==0){return null}return this.data[this.currentIndex-(this.currentPage-1)*this.pagesize-1]},insert:function(c,b){b=[].concat(b);var e=this.data.splice(c,this.data.length);for(var d=0,a=b.length;d<a;d++){b[d].setDataSet(this);this.data.add(b[d])}this.data=this.data.concat(e);this.fireEvent("add",this,b,c)},remove:function(a){if(!a){a=this.getCurrentRecord()}if(!a){return}this.fireEvent("beforeremove",this);var b=[].concat(a);var e=[];for(var c=0;c<b.length;c++){var d=b[c];if(d.isNew){this.removeLocal(d)}else{e[e.length]=d}}this.removeRemote(e)},removeRemote:function(e){if(this.submiturl==""){return}var c=[];for(var g=0;g<e.length;g++){var a=e[g];for(var m in this.fields){var i=this.fields[m];if(i&&i.type=="dataset"){delete a.data[m]}}var l=Ext.apply({},a.data);l._id=a.id;l._status="delete";c[g]=Ext.apply(l,this.spara)}if(c.length>0){var b;if(this.bindtarget){var h=$A.CmpManager.get(this.bindtarget);b={record:h.getCurrentRecord(),dataSet:this}}$A.request({url:this.submiturl,para:c,success:this.onRemoveSuccess,error:this.onSubmitError,scope:this,failure:this.onAjaxFailed,opts:b})}},onRemoveSuccess:function(e,c){if(e.result.record){var a=[].concat(e.result.record);if(this.bindtarget){var h=$A.CmpManager.get(this.bindtarget);if(h.getCurrentRecord()==c.opts.record){for(var d=0;d<a.length;d++){var g=a[d];this.removeLocal(this.findById(g._id),true)}}else{var b=c.opts.record.get(this.bindname);var f=new $A.DataSet({});f.reConfig(b);for(var d=0;d<a.length;d++){var g=a[d];f.removeLocal(f.findById(g._id),true)}this.refreshBindDataSet(c.opts.record,f.getConfig());delete f}}else{for(var d=0;d<a.length;d++){var g=a[d];this.removeLocal(this.findById(g._id),true)}}}},removeLocal:function(a,c){$A.removeInvalidReocrd(this.id,a);var b=this.data.indexOf(a);if(b==-1){return}this.data.remove(a);if(c){this.totalCount--}this.selected.remove(a);if(this.data.length==0){this.removeAll();return}var d=this.currentIndex-(this.currentPage-1)*this.pagesize;if(d<0){return}if(d<=this.data.length){this.locate(this.currentIndex,true)}else{this.pre()}this.fireEvent("remove",this,a,b)},getAll:function(){return this.data},find:function(c,b){var a=null;this.each(function(d){var e=d.get(c);if(e==b){a=d;return false}},this);return a},findById:function(d){var c=null;for(var b=0,a=this.data.length;b<a;b++){if(this.data[b].id==d){c=this.data[b];break}}return c},removeAll:function(){this.currentIndex=1;this.data=[];this.selected=[];this.fireEvent("clear",this)},indexOf:function(a){return this.data.indexOf(a)},getAt:function(a){return this.data[a]},each:function(e,d){var b=[].concat(this.data);for(var c=0,a=b.length;c<a;c++){if(e.call(d||b[c],b[c],c,a)===false){break}}},processCurrentRow:function(){var b=this.getCurrentRecord();for(var a in this.fields){var d=this.fields[a];if(d.type=="dataset"){var c=d.pro.dataset;if(b&&b.data[d.name]){c.reConfig(b.data[d.name])}else{c.resetConfig()}c.fireEvent("refresh",c);c.processCurrentRow()}}if(b){this.fireEvent("indexchange",this,b)}},getSelected:function(){return this.selected},selectAll:function(){for(var b=0,a=this.data.length;b<a;b++){this.select(this.data[b])}},unSelectAll:function(){for(var b=0,a=this.data.length;b<a;b++){this.unSelect(this.data[b])}},select:function(a){if(typeof(a)=="string"){a=this.findById(a)}if(this.selectable&&this.selectionmodel=="multiple"){if(this.selected.indexOf(a)==-1){this.selected.add(a);this.fireEvent("select",this,a)}}else{if(this.selected.indexOf(a)==-1){var b=this.selected[0];this.unSelect(b);this.selected=[];this.selected.add(a);this.fireEvent("select",this,a)}}},unSelect:function(a){if(typeof(a)=="string"){a=this.findById(a)}if(this.selectable){if(this.selected.indexOf(a)!=-1){this.selected.remove(a);this.fireEvent("unselect",this,a)}}},locate:function(a,c){if(this.currentIndex==a&&c!==true){return}if(a<=0||(a>this.totalCount+this.getNewRecrods().length)){return}var b=a-(this.currentPage-1)*this.pagesize;if(this.data[b-1]){this.currentIndex=a}else{if(this.isModified()){$A.showInfoMessage("提示","有未保存数据!")}else{this.currentIndex=a;this.currentPage=Math.ceil(a/this.pagesize);this.query(this.currentPage);return}}this.processCurrentRow()},goPage:function(b){if(b>0){this.gotoPage=b;var a=(b-1)*this.pagesize+this.getNewRecrods().length+1;this.locate(a)}},first:function(){this.locate(1)},pre:function(){this.locate(this.currentIndex-1)},next:function(){this.locate(this.currentIndex+1)},firstPage:function(){this.goPage(1)},prePage:function(){this.goPage(this.currentPage-1)},nextPage:function(){this.goPage(this.currentPage+1)},lastPage:function(){this.goPage(this.totalPage)},validate:function(b){this.isValid=true;var m=this.getCurrentRecord();var e=this.getAll();var t={};var i=false;var s=null;for(var g in this.fields){var p=this.fields[g];if(p.type=="dataset"){i=true;var o=p.pro.dataset;t[p.name]=o}}for(var g=0,f=e.length;g<f;g++){var h=e[g];if(!h.validateRecord()){this.isValid=false;s=h;$A.addInValidReocrd(this.id,h)}else{$A.removeInvalidReocrd(this.id,h)}if(this.isValid==false){if(i){break}}else{for(key in t){var c=t[key];if(h.data[key]){c.reConfig(h.data[key]);if(!c.validate(false)){this.isValid=false;s=h}c.reConfig(m.data[key])}}if(this.isValid==false){break}}}if(s!=null){var a=this.indexOf(s);if(a!=-1){this.locate(a+1)}}if(b!==false){$A.manager.fireEvent("valid",$A.manager,this,this.isValid)}if(!this.isValid){$A.showInfoMessage("提示","验证不通过!")}return this.isValid},setQueryUrl:function(a){this.queryurl=a},setQueryParameter:function(a,b){this.qpara[a]=b},setQueryDataSet:function(a){this.qds=a;if(this.qds.getCurrentRecord()==null){this.qds.create()}},setSubmitUrl:function(a){this.submiturl=a},setSubmitParameter:function(a,b){this.spara[a]=b},query:function(h,f){$A.slideBarEnable=$A.SideBar.enable;$A.SideBar.enable=false;var e;if(this.qds){if(this.qds.getCurrentRecord()==null){this.qds.create()}if(!this.qds.validate()){return}e=this.qds.getCurrentRecord()}if(!this.queryurl){return}if(!h){this.currentIndex=1}this.currentPage=h||1;var g={};if(e!=null){Ext.apply(g,e.data)}Ext.apply(g,this.qpara);for(var c in g){var b=g[c];if(Ext.isEmpty(b,false)){delete g[c]}}var a="pagesize="+this.pagesize+"&pagenum="+this.currentPage+"&_fetchall="+this.fetchall+"&_autocount="+this.autocount;var d="";if(this.queryurl.indexOf("?")==-1){d=this.queryurl+"?"+a}else{d=this.queryurl+"&"+a}this.loading=true;this.fireBindDataSetEvent("beforeload",this);$A.request({url:d,para:g,success:this.onLoadSuccess,error:this.onLoadError,scope:this,failure:this.onAjaxFailed,opts:f})},isModified:function(){var e=false;var d=this.getAll();for(var c=0,b=d.length;c<b;c++){var a=d[c];if(a.dirty==true||a.isNew==true){e=true;break}else{for(var f in this.fields){var h=this.fields[f];if(h.type=="dataset"){var g=h.pro.dataset;g.reConfig(a.data[h.name]);if(g.isModified()){e=true;break}}}}}return e},getJsonData:function(f){var h=[];var o=this.data;if(f){o=this.getSelected()}for(var g=0,c=o.length;g<c;g++){var a=o[g];var p=a.dirty||a.isNew;var m=Ext.apply({},a.data);m._id=a.id;m._status=a.isNew?"insert":"update";for(var e in a.data){var s=m[e];if(s&&s.xtype=="dataset"){var b=new $A.DataSet({});b.reConfig(s);p=p==false?b.isModified():p;m[e]=b.getJsonData()}}if(p||f){h.push(m)}}return h},doSubmit:function(b,a){if(!this.validate()){return}this.submiturl=b||this.submiturl;if(this.submiturl==""){return}var h=a;for(var d=0;d<h.length;d++){var g=h[d];for(var c in g){var e=this.fields[c];if(e&&e.type!="dataset"&&g[c]==""){g[c]=null}}h[d]=Ext.apply(h[d],this.spara)}this.fireBindDataSetEvent("submit");$A.request({url:this.submiturl,para:h,success:this.onSubmitSuccess,error:this.onSubmitError,scope:this,failure:this.onAjaxFailed})},submitSelected:function(a){this.doSubmit(a,this.getJsonData(true))},submit:function(a){this.doSubmit(a,this.getJsonData())},fireBindDataSetEvent:function(b){this.fireEvent(b,this);for(var a in this.fields){var d=this.fields[a];if(d.type=="dataset"){var c=d.pro.dataset;if(c){c.fireBindDataSetEvent(b)}}}},afterEdit:function(a,b,c){this.fireEvent("update",this,a,b,c)},afterReject:function(a,b,c){this.fireEvent("reject",this,a,b,c)},onSubmitSuccess:function(b){var a=[];if(b.result.record){a=[].concat(b.result.record);this.commitRecords(a,true)}this.fireBindDataSetEvent("submitsuccess")},commitRecords:function(o,b){for(var m=0,e=o.length;m<e;m++){var h=o[m];var a=this.findById(h._id);if(a.isNew){this.totalCount++}if(!a){return}a.commit();for(var g in h){var t=g;var p=this.fields[t];if(p&&p.type=="dataset"){var c=p.pro.dataset;c.reConfig(a.data[p.name]);if(h[g].record){c.commitRecords([].concat(h[g].record),this.getCurrentRecord()==a)}}else{var d=a.get(t);var s=h[g];if(t=="_id"||t=="_status"||t=="__parameter_parsed__"){continue}if(p){s=this.processData(s,p)}if(d!=s){if(b){a.set(t,s,true)}else{a.data[t]=s}}}}}},processData:function(c,d){var b=d.getPropertity("datatype");b=b?b.toLowerCase():"";var a=c;switch(b){case"date":a=$A.parseDate(a);break;case"java.util.date":a=$A.parseDate(a);break;case"java.sql.date":a=$A.parseDate(a);break;case"int":a=parseInt(a);break}return a},onSubmitError:function(a){this.fireBindDataSetEvent("submitfailed")},onLoadSuccess:function(f,d){if(f==null){return}if(!f.result.record){f.result.record=[]}var c=[].concat(f.result.record);var h=f.result.totalCount;var a=[];if(c.length>0){for(var e=0,b=c.length;e<b;e++){var g={data:c[e]};a.push(g)}}else{if(c.length==0){this.currentIndex=1}}this.loading=false;this.loadData(a,h,d);this.locate(this.currentIndex,true);$A.SideBar.enable=$A.slideBarEnable},onAjaxFailed:function(b,a){this.fireBindDataSetEvent("ajaxfailed")},onLoadError:function(b,a){this.fireBindDataSetEvent("loadfailed",this);this.loading=false;$A.SideBar.enable=$A.slideBarEnable},onFieldChange:function(a,d,b,c){this.fireEvent("fieldchange",this,a,d,b,c)},onMetaChange:function(a,d,b,c){this.fireEvent("metachange",this,a,d,b,c)},onRecordValid:function(a,b,c){if(c==false&&this.isValid!==false){this.isValid=false}this.fireEvent("valid",this,a,b,c)}});$A.Record=function(b,a){this.id=++$A.AUTO_ID;this.data=b;this.fields={};this.valid={};this.isValid=true;this.isNew=false;this.dirty=false;this.editing=false;this.modified=null;this.meta=new $A.Record.Meta(this);if(a){this.initFields(a)}};$A.Record.prototype={commit:function(){this.editing=false;this.valid={};this.isValid=true;this.isNew=false;this.dirty=false;this.modified=null},initFields:function(a){for(var c=0,b=a.length;c<b;c++){var d=new $A.Record.Field(a[c]);d.record=this;this.fields[d.name]=d}},validateRecord:function(){this.isValid=true;this.valid={};var f=this.ds.fields;var d=this.fields;var e=[];for(var b in f){if(f[b].type!="dataset"){e.add(b)}}for(var b in d){if(e.indexOf(b)==-1){if(d[b].type!="dataset"){e.add(b)}}}for(var c=0,a=e.length;c<a;c++){if(this.isValid==true){this.isValid=this.validate(e[c])}else{this.validate(e[c])}}return this.isValid},validate:function(c){var e=true;var b=this.get(c);var f=this.getMeta().getField(c);var d=f.get("validator");if(Ext.isEmpty(b)&&f.get("required")==true){this.valid[c]="当前字段不能为空!";e=false}else{var a=true;if(d){d=window[d];a=d.call(window,this,c,b);if(a!==true){e=false;this.valid[c]=a}}}if(e==true){delete this.valid[c]}this.ds.onRecordValid(this,c,e);return e},setDataSet:function(a){this.ds=a},getField:function(a){return this.getMeta().getField(a)},getMeta:function(){return this.meta},copy:function(a){if(a==this){alert("不能copy自身!");return}if(a.dirty){for(var b in a.modified){this.set(b,a.get(b))}}},set:function(a,c,b){if(this.data[a]!=c){if(!b){this.dirty=true;if(!this.modified){this.modified={}}if(typeof this.modified[a]=="undefined"){this.modified[a]=this.data[a]}}this.data[a]=c;if(!this.editing&&this.ds){this.ds.afterEdit(this,a,c)}}this.validate(a)},get:function(a){return this.data[a]},reject:function(b){var a=this.modified;for(var c in a){if(typeof a[c]!="function"){this.data[c]=a[c];this.ds.afterReject(this,c,a[c])}}delete this.modified;this.editing=false;this.dirty=false},onFieldChange:function(a,b,c){var d=this.getMeta().getField(a);this.ds.onFieldChange(this,d,b,c)},onFieldClear:function(a){var b=this.getMeta().getField(a);this.ds.onFieldChange(this,b)},onMetaChange:function(c,a,b){this.ds.onMetaChange(this,c,a,b)},onMetaClear:function(a){this.ds.onMetaChange(this,a)}};$A.Record.Meta=function(a){this.record=a;this.pro={}};$A.Record.Meta.prototype={clear:function(){this.pro={};this.record.onMetaClear(this)},getField:function(a){if(!a){return null}var c=this.record.fields[a];var e=this.record.ds.fields[a];var b;if(!c){if(e){c=new $A.Record.Field({name:e.name,type:e.type||"string"})}else{c=new $A.Record.Field({name:a,type:"string"})}c.record=this.record;this.record.fields[c.name]=c}var d={};if(e){d=Ext.apply(d,e.pro)}d=Ext.apply(d,this.pro);d=Ext.apply(d,c.pro);delete d.name;delete d.type;c.snap=d;return c},setRequired:function(a){var b=this.pro.required;if(b!==a){this.pro.required=a;this.record.onMetaChange(this,"required",a)}},setReadOnly:function(a){var b=this.pro.readonly;if(b!==a){this.pro.readonly=a;this.record.onMetaChange(this,"readonly",a)}}};$A.Record.Field=function(a){this.name=a.name;this.type=a.type;this.pro=a||{};this.record};$A.Record.Field.prototype={clear:function(){this.pro={};this.record.onFieldClear(this.name)},setPropertity:function(a,b){var c=this.pro[a];if(c!==b){this.pro[a]=b;this.record.onFieldChange(this.name,a,b)}},get:function(b){var a=null;if(this.snap){a=this.snap[b]}return a},getPropertity:function(a){return this.pro[a]},setRequired:function(a){this.setPropertity("required",a)},isRequired:function(){return this.getPropertity("required")},setReadOnly:function(a){this.setPropertity("readonly",a)},isReadOnly:function(){return this.getPropertity("readonly")},setOptions:function(a){this.setPropertity("options",a)},getOptions:function(){return this.getPropertity("options")},setMapping:function(a){this.setPropertity("mapping",a)},getMapping:function(){return this.getPropertity("mapping")},setTitle:function(a){this.setPropertity("title",a)},setLovWidth:function(a){this.setPropertity("lovwidth",a)},setLovHeight:function(a){this.setPropertity("lovheight",a)},setLovGridHeight:function(a){this.setPropertity("lovgridheight",a)},setLovModel:function(a){this.setPropertity("lovmodel",a)},setLovService:function(a){this.setPropertity("lovservice",a)},setLovUrl:function(a){this.setPropertity("lovurl",a)},setLovPara:function(a,b){var c=this.getPropertity("lovpara");if(!c){c={};this.setPropertity("lovpara",c)}if(b==null){delete c[a]}else{c[a]=b}}};$A.Component=Ext.extend(Ext.util.Observable,{constructor:function(a){$A.Component.superclass.constructor.call(this);this.id=a.id||Ext.id();$A.CmpManager.put(this.id,this);this.initConfig=a;this.isHidden=false;this.isFireEvent=false;this.initComponent(a);this.initEvents()},initComponent:function(a){a=a||{};Ext.apply(this,a);this.wrap=Ext.get(this.id);if(this.listeners){this.on(this.listeners)}},processListener:function(a){this.processMouseOverOut(a);if(this.marginwidth||this.marginheight){Ext.EventManager[a](window,"resize",this.windowResizeListener,this)}},processMouseOverOut:function(a){this.wrap[a]("mouseover",this.onMouseOver,this);this.wrap[a]("mouseout",this.onMouseOut,this)},initEvents:function(){this.addEvents("focus","blur","change","valid","mouseover","mouseout");this.processListener("on")},windowResizeListener:function(){if(this.marginwidth){var b=Aurora.getViewportWidth();this.setWidth(b-this.marginwidth)}if(this.marginheight){var a=Aurora.getViewportHeight();this.setHeight(a-this.marginheight)}},isEventFromComponent:function(a){return this.wrap.contains(a)},move:function(a,b){this.wrap.setX(a);this.wrap.setY(b)},getBindName:function(){return this.binder?this.binder.name:null},getBindDataSet:function(){return this.binder?this.binder.ds:null},bind:function(c,b){this.clearBind();if(typeof(c)=="string"){c=$(c)}if(!c){return}this.binder={ds:c,name:b};this.record=c.getCurrentRecord();var d=c.fields[this.binder.name];if(d){var a={};Ext.apply(a,this.initConfig);Ext.apply(a,d.pro);delete a.name;delete a.type;this.initComponent(a)}c.on("metachange",this.onRefresh,this);c.on("valid",this.onValid,this);c.on("remove",this.onRemove,this);c.on("clear",this.onClear,this);c.on("update",this.onUpdate,this);c.on("reject",this.onUpdate,this);c.on("fieldchange",this.onFieldChange,this);c.on("indexchange",this.onRefresh,this);this.onRefresh(c)},clearBind:function(){if(this.binder){var a=this.binder.ds;a.un("metachange",this.onRefresh,this);a.un("valid",this.onValid,this);a.un("remove",this.onRemove,this);a.un("clear",this.onClear,this);a.un("update",this.onUpdate,this);a.un("reject",this.onUpdate,this);a.un("fieldchange",this.onFieldChange,this);a.un("indexchange",this.onRefresh,this)}this.binder=null;this.record=null},destroy:function(){this.processListener("un");$A.CmpManager.remove(this.id);this.clearBind();delete this.wrap},onMouseOver:function(a){this.fireEvent("mouseover",this,a)},onMouseOut:function(a){this.fireEvent("mouseout",this,a)},onRemove:function(b,a){if(this.binder.ds==b&&this.record==a){this.clearValue()}},onCreate:function(b,a){this.clearInvalid();this.record=b.getCurrentRecord();this.setValue("",true)},onRefresh:function(a){if(this.isFireEvent==true||this.isHidden==true){return}this.clearInvalid();this.render(a.getCurrentRecord())},render:function(a){this.record=a;if(this.record){var c=this.record.get(this.binder.name);var d=this.record.getMeta().getField(this.binder.name);var b={};Ext.apply(b,this.initConfig);Ext.apply(b,d.snap);this.initComponent(b);if(this.record.valid[this.binder.name]){this.markInvalid()}if(!Ext.isEmpty(c,true)){this.setValue(c,true)}else{this.clearValue()}}else{this.setValue("",true)}},onValid:function(d,a,b,c){if(this.binder.ds==d&&this.binder.name==b&&this.record==a){if(c){this.fireEvent("valid",this,this.record,this.binder.name,true);this.clearInvalid()}else{this.fireEvent("valid",this,this.record,this.binder.name,false);this.markInvalid()}}},onUpdate:function(d,a,b,c){if(this.binder.ds==d&&this.record==a&&this.binder.name==b&&this.getValue()!=c){this.setValue(c,true)}},onFieldChange:function(b,a,c){if(this.binder.ds==b&&this.record==a&&this.binder.name==c.name){this.onRefresh(b)}},onClear:function(a){this.clearValue()},setValue:function(b,a){var c=this.value;this.value=b;if(a===true){return}if(this.binder){this.record=this.binder.ds.getCurrentRecord();if(this.record==null){this.record=this.binder.ds.create({},false)}this.record.set(this.binder.name,b);if(Ext.isEmpty(b,true)){delete this.record.data[this.binder.name]}}if(c!=b){this.fireEvent("change",this,b,c)}},getValue:function(){var a=this.value;a=(a===null||a===undefined?"":a);return a},setWidth:function(a){this.width=a;this.wrap.setWidth(a)},setHeight:function(a){this.height=a;this.wrap.setHeight(a)},clearInvalid:function(){},markInvalid:function(){},clearValue:function(){},initMeta:function(){},setDefault:function(){},setRequired:function(){},onDataChange:function(){},setWidth:function(a){this.wrap.setStyle("width",a+"px")},setHeight:function(a){this.wrap.setStyle("height",a+"px")}});$A.Field=Ext.extend($A.Component,{validators:[],requiredCss:"item-notBlank",focusCss:"item-focus",readOnlyCss:"item-readOnly",emptyTextCss:"item-emptyText",invalidCss:"item-invalid",constructor:function(a){a.required=a.required||false;a.readonly=a.readonly||false;$A.Field.superclass.constructor.call(this,a)},initElements:function(){this.el=this.wrap.child("input[atype=field.input]")},initComponent:function(a){$A.Field.superclass.initComponent.call(this,a);this.initElements();this.originalValue=this.getValue();this.applyEmptyText();this.initStatus();if(this.hidden==true){this.setVisible(false)}},processListener:function(a){$A.Field.superclass.processListener.call(this,a);this.el[a]("focus",this.onFocus,this);this.el[a]("blur",this.onBlur,this);this.el[a]("change",this.onChange,this);this.el[a]("keyup",this.onKeyUp,this);this.el[a]("keydown",this.onKeyDown,this);this.el[a]("keypress",this.onKeyPress,this)},processMouseOverOut:function(a){this.el[a]("mouseover",this.onMouseOver,this);this.el[a]("mouseout",this.onMouseOut,this)},initEvents:function(){$A.Field.superclass.initEvents.call(this);this.addEvents("keydown","keyup","keypress","enterdown")},destroy:function(){$A.Field.superclass.destroy.call(this);delete this.el},setWidth:function(a){this.wrap.setStyle("width",(a+3)+"px");this.el.setStyle("width",a+"px")},setHeight:function(a){this.wrap.setStyle("height",a+"px");this.el.setStyle("height",(a-2)+"px")},setVisible:function(a){if(a==true){this.wrap.show()}else{this.wrap.hide()}},initStatus:function(){this.clearInvalid();this.initRequired(this.required);this.initReadOnly(this.readonly)},onChange:function(a){},onKeyUp:function(a){this.fireEvent("keyup",this,a)},onKeyDown:function(c){this.fireEvent("keydown",this,c);var b=c.keyCode;if(b==13||b==27){this.blur();if(b==13){var a=this;setTimeout(function(){a.fireEvent("enterdown",a,c)},5)}}},onKeyPress:function(a){this.fireEvent("keypress",this,a)},onFocus:function(a){(Ext.isGecko||Ext.isGecko2||Ext.isGecko3)?this.select():this.select.defer(10,this);if(this.readonly){return}if(!this.hasFocus){this.hasFocus=true;this.startValue=this.getValue();if(this.emptytext){if(this.el.dom.value==this.emptytext){this.setRawValue("")}this.wrap.removeClass(this.emptyTextCss)}this.wrap.addClass(this.focusCss);this.fireEvent("focus",this)}},processValue:function(a){return a},onBlur:function(a){if(this.readonly){return}if(this.hasFocus){this.hasFocus=false;var b=this.getRawValue();b=this.processValue(b);this.setValue(b);this.wrap.removeClass(this.focusCss);this.fireEvent("blur",this)}},setValue:function(b,a){$A.Field.superclass.setValue.call(this,b,a);if(this.emptytext&&this.el&&b!==undefined&&b!==null&&b!==""){this.wrap.removeClass(this.emptyTextCss)}this.setRawValue(this.formatValue((b===null||b===undefined?"":b)));this.applyEmptyText()},formatValue:function(a){return a},getRawValue:function(){var a=this.el.getValue();if(a===this.emptytext||a===undefined){a=""}return a},initRequired:function(a){if(this.crrentRequired==a){return}this.clearInvalid();this.crrentRequired=a;if(a){this.wrap.addClass(this.requiredCss)}else{this.wrap.removeClass(this.requiredCss)}},initReadOnly:function(a){if(this.currentReadOnly==a){return}this.currentReadOnly=a;this.el.dom.readOnly=a;if(a){this.wrap.addClass(this.readOnlyCss)}else{this.wrap.removeClass(this.readOnlyCss)}},applyEmptyText:function(){if(this.emptytext&&this.getRawValue().length<1){this.setRawValue(this.emptytext);this.wrap.addClass(this.emptyTextCss)}},clearInvalid:function(){this.invalidMsg=null;this.wrap.removeClass(this.invalidCss)},markInvalid:function(a){this.invalidMsg=a;this.wrap.addClass(this.invalidCss)},select:function(f,a){var c=this.getRawValue();if(c.length>0){f=f===undefined?0:f;a=a===undefined?c.length:a;var e=this.el.dom;if(e.setSelectionRange){e.setSelectionRange(f,a)}else{if(e.createTextRange){var b=e.createTextRange();b.moveStart("character",f);b.moveEnd("character",a-c.length);b.select()}}}},setRawValue:function(a){return this.el.dom.value=(a===null||a===undefined?"":a)},reset:function(){this.setValue(this.originalValue);this.clearInvalid();this.applyEmptyText()},focus:function(){if(this.readonly){return}this.el.dom.focus();this.fireEvent("focus",this)},blur:function(){if(this.readonly){return}this.el.blur();this.fireEvent("blur",this)},clearValue:function(){this.setValue("",true);this.clearInvalid();this.applyEmptyText()}});$A.Box=Ext.extend($A.Component,{constructor:function(a){this.errors=[];$A.Box.superclass.constructor.call(this,a)},initEvents:function(){},onValid:function(e,a,d,b){if(b){this.clearError(e.id)}else{var c=a.errors[d];if(c){this.showError(e.id,c.message)}}},showError:function(b,a){Ext.fly(b+"_vmsg").update(a)},clearError:function(a){Ext.fly(a+"_vmsg").update("")},clearAllError:function(){for(var a=0;a<this.errors.length;a++){this.clearError(this.errors[a])}}});$A.ImageCode=Ext.extend($A.Component,{processListener:function(a){$A.ImageCode.superclass.processListener.call(this,a);this.wrap[a]("click",this.onClick,this)},onClick:function(){this.refresh()},refresh:function(){this.wrap.dom.src="imagecode?r="+Math.random()}});$A.Label=Ext.extend($A.Component,{onUpdate:function(d,a,b,c){if(this.binder.ds==d&&this.binder.name==b){this.updateLabel(a,b,c)}},render:function(a){this.record=a;if(this.record){var b=this.record.get(this.binder.name);this.updateLabel(this.record,this.binder.name,b)}},updateLabel:function(a,b,d){var c=$A.getRenderer(this.renderer);if(c!=null){d=c.call(window,d,a,b)}this.wrap.update(d)}});$A.Button=Ext.extend($A.Component,{disableCss:"item-btn-disabled",overCss:"item-btn-over",pressCss:"item-btn-pressed",disabled:false,constructor:function(a){$A.Button.superclass.constructor.call(this,a)},initComponent:function(a){$A.Button.superclass.initComponent.call(this,a);this.el=this.wrap.child("button[atype=btn]");if(this.hidden==true){this.setVisible(false)}if(this.disabled==true){this.disable()}},processListener:function(a){$A.Button.superclass.processListener.call(this,a);this.wrap[a]("click",this.onClick,this);this.wrap[a]("mousedown",this.onMouseDown,this)},initEvents:function(){$A.Button.superclass.initEvents.call(this);this.addEvents("click")},destroy:function(){$A.Button.superclass.destroy.call(this);delete this.el},setVisible:function(a){if(a==true){this.wrap.show()}else{this.wrap.hide()}},focus:function(){if(this.disabled){return}this.el.dom.focus()},blur:function(){if(this.disabled){return}this.el.dom.blur()},disable:function(){this.disabled=true;this.wrap.addClass(this.disableCss);this.el.dom.disabled=true},enable:function(){this.disabled=false;this.wrap.removeClass(this.disableCss);this.el.dom.disabled=false},onMouseDown:function(a){if(!this.disabled){this.wrap.addClass(this.pressCss);Ext.get(document.documentElement).on("mouseup",this.onMouseUp,this)}},onMouseUp:function(a){if(!this.disabled){Ext.get(document.documentElement).un("mouseup",this.onMouseUp,this);this.wrap.removeClass(this.pressCss)}},onClick:function(a){if(!this.disabled){a.stopEvent();this.fireEvent("click",this,a)}},onMouseOver:function(a){if(!this.disabled){this.wrap.addClass(this.overCss)}},onMouseOut:function(a){if(!this.disabled){this.wrap.removeClass(this.overCss)}}});$A.Button.getTemplate=function(c,b,a){return'<TABLE class="item-btn " id="'+c+'" style="WIDTH: '+(a||60)+'px" cellSpacing="0"><TBODY><TR><TD class="item-btn-tl"><I></I></TD><TD class="item-btn-tc"></TD><TD class="item-btn-tr"><I></I></TD></TR><TR><TD class="item-btn-ml"><I></I></TD><TD class="item-btn-mc"><BUTTON hideFocus style="HEIGHT: 17px" atype="btn">'+b+'</BUTTON></TD><TD class="item-btn-mr"><I></I></TD></TR><TR><TD class="item-btn-bl"><I></I></TD><TD class="item-btn-bc"></TD><TD class="item-btn-br"><I></I></TD></TR></TBODY></TABLE><script>new Aurora.Button({"id":"'+c+'"});<\/script>'};$A.CheckBox=Ext.extend($A.Component,{checkedCss:"item-ckb-c",uncheckedCss:"item-ckb-u",readonyCheckedCss:"item-ckb-readonly-c",readonlyUncheckedCss:"item-ckb-readonly-u",constructor:function(a){a.checked=a.checked||false;a.readonly=a.readonly||false;$A.CheckBox.superclass.constructor.call(this,a)},initComponent:function(a){this.checkedvalue="Y";this.uncheckedvalue="N";$A.CheckBox.superclass.initComponent.call(this,a);this.wrap=Ext.get(this.id);this.el=this.wrap.child("div[atype=checkbox]")},processListener:function(a){this.wrap[a]("click",this.onClick,this)},initEvents:function(){$A.CheckBox.superclass.initEvents.call(this);this.addEvents("click")},destroy:function(){$A.CheckBox.superclass.destroy.call(this);delete this.el},onClick:function(a){if(!this.readonly){this.checked=this.checked?false:true;this.setValue(this.checked);this.fireEvent("click",this,this.checked)}},setValue:function(b,a){if(typeof(b)==="boolean"){this.checked=b?true:false}else{this.checked=(""+b==""+this.checkedvalue)}this.initStatus();var c=this.checked==true?this.checkedvalue:this.uncheckedvalue;$A.CheckBox.superclass.setValue.call(this,c,a)},getValue:function(){var a=this.value;a=(a===null||a===undefined?"":a);return a},initStatus:function(){this.el.removeClass(this.checkedCss);this.el.removeClass(this.uncheckedCss);this.el.removeClass(this.readonyCheckedCss);this.el.removeClass(this.readonlyUncheckedCss);if(this.readonly){this.el.addClass(this.checked?this.readonyCheckedCss:this.readonlyUncheckedCss)}else{this.el.addClass(this.checked?this.checkedCss:this.uncheckedCss)}}});$A.Radio=Ext.extend($A.Component,{ccs:"item-radio-img-c",ucs:"item-radio-img-u",rcc:"item-radio-img-readonly-c",ruc:"item-radio-img-readonly-u",imgCss:"item-radio-img",valueField:"value",constructor:function(a){a.checked=a.checked||false;a.readonly=a.readonly||false;$A.Radio.superclass.constructor.call(this,a)},initComponent:function(a){$A.Radio.superclass.initComponent.call(this,a);this.wrap=Ext.get(this.id);this.nodes=Ext.DomQuery.select(".item-radio-option",this.wrap.dom);this.initStatus()},processListener:function(a){this.wrap[a]("click",this.onClick,this);this.wrap[a]("keydown",this.onKeyDown,this)},focus:function(){this.wrap.focus()},onKeyDown:function(f){this.fireEvent("keydown",this,f);var d=f.keyCode;if(d==13){var c=this;setTimeout(function(){c.fireEvent("enterdown",c,f)},5)}else{if(d==40){var g=this.getValueItem();var b=this.options.indexOf(g);if(b+1<this.options.length){var a=this.options[b+1][this.valueField];this.setValue(a)}}else{if(d==38){var g=this.getValueItem();var b=this.options.indexOf(g);if(b-1>=0){var a=this.options[b-1][this.valueField];this.setValue(a)}}}}},initEvents:function(){$A.Radio.superclass.initEvents.call(this);this.addEvents("click","keydown","enterdown")},setValue:function(b,a){if(b==""){return}$A.Radio.superclass.setValue.call(this,b,a);this.initStatus();this.focus()},getItem:function(){var a=this.getValueItem();if(a!=null){a=new $A.Record(a)}return a},getValueItem:function(){var b=this.getValue();var a=this.options.length;var d=null;for(var c=0;c<a;c++){var e=this.options[c];if(e[this.valueField]==b){d=e;break}}return d},select:function(b){var a=this.getItemValue(b);if(a){this.setValue(a)}},getValue:function(){var a=this.value;a=(a===null||a===undefined?"":a);return a},initStatus:function(){var a=this.nodes.length;for(var b=0;b<a;b++){var c=Ext.fly(this.nodes[b]).child("."+this.imgCss);c.removeClass(this.ccs);c.removeClass(this.ucs);c.removeClass(this.rcc);c.removeClass(this.ruc);var d=Ext.fly(this.nodes[b]).getAttributeNS("","itemvalue");if((b==0&&!this.value)||d===this.value){this.readonly?c.addClass(this.rcc):c.addClass(this.ccs)}else{this.readonly?c.addClass(this.ruc):c.addClass(this.ucs)}}},getItemValue:function(b){var c=Ext.fly(this.nodes[b]);if(!c){return null}var a=c.getAttributeNS("","itemvalue");return a},onClick:function(f){if(!this.readonly){var a=this.nodes.length;for(var c=0;c<a;c++){var d=Ext.fly(this.nodes[c]);if(d.contains(f.target)){var b=d.getAttributeNS("","itemvalue");this.setValue(b);this.fireEvent("click",this,b);break}}}}});$A.TextField=Ext.extend($A.Field,{constructor:function(a){$A.TextField.superclass.constructor.call(this,a)},initComponent:function(a){$A.TextField.superclass.initComponent.call(this,a)},initEvents:function(){$A.TextField.superclass.initEvents.call(this);if(this.typecase){this.el.on("paste",this.onPaste,this)}},onPaste:function(b){if(window.clipboardData){var a=window.clipboardData.getData("text");if(this.typecase=="upper"){window.clipboardData.setData("text",a.toUpperCase())}else{if(this.typecase=="lower"){window.clipboardData.setData("text",a.toLowerCase())}}}else{b.stopEvent()}},destroy:function(){if(this.typecase){this.el.un("paste",this.onPaste,this)}$A.TextField.superclass.destroy.call(this)},isCapsLock:function(c){var b=c.getKey();var a=c.shiftKey;if(((b>=65&&b<=90)&&!a)||((b>=97&&b<=122)&&a)){if(this.dcl!=true){$A.showWarningMessage("警告","大些锁定打开!")}this.dcl=true}else{this.dcl=false}},onKeyPress:function(g){$A.TextField.superclass.onKeyPress.call(this,g);if(this.detectCapsLock){this.isCapsLock(g)}var f=g.getKey();var c=f;if(this.typecase){if(this.typecase=="upper"){if(f>=97&&f<=122){c=f-32}}else{if(this.typecase=="lower"){if(f>=65&&f<=90){c=f+32}}}if(Ext.isIE){g.browserEvent.keyCode=c}else{if((f>=97&&f<=122)||(f>=65&&f<=90)){var a=String.fromCharCode(c);g.stopEvent();var h=this.el.dom;var i=this.getRawValue();var b=h.selectionStart;var g=h.selectionEnd;i=i.substring(0,b)+a+i.substring(g,i.length);this.setRawValue(i);h.selectionStart=b+1;h.selectionEnd=h.selectionStart}}}}});$A.NumberField=Ext.extend($A.TextField,{allowdecimals:true,allownegative:true,allowformat:true,baseChars:"0123456789",decimalSeparator:".",decimalprecision:2,constructor:function(a){$A.NumberField.superclass.constructor.call(this,a)},initComponent:function(a){$A.NumberField.superclass.initComponent.call(this,a);this.allowed=this.baseChars+"";if(this.allowdecimals){this.allowed+=this.decimalSeparator}if(this.allownegative){this.allowed+="-"}},initEvents:function(){$A.NumberField.superclass.initEvents.call(this)},onKeyPress:function(b){var a=b.getKey();if(b.isSpecialKey()){return}var d=b.getCharCode();if(this.allowed.indexOf(String.fromCharCode(d))===-1){b.stopEvent();return}$A.NumberField.superclass.onKeyPress.call(this,b)},formatValue:function(a){var b=this.fixPrecision(this.parseValue(a));if(this.allowformat){b=$A.formatNumber(b)}return b},processValue:function(a){return this.fixPrecision(this.parseValue(a))},onFocus:function(a){if(this.allowformat){this.setRawValue($A.removeNumberFormat(this.getRawValue()))}$A.NumberField.superclass.onFocus.call(this,a)},parseValue:function(a){a=String(a);if(!this.allownegative){a=a.replace("-","")}if(!this.allowdecimals){a=a.indexOf(".")==-1?a:a.substring(0,a.indexOf("."))}a=parseFloat(a.replace(this.decimalSeparator,"."));return isNaN(a)?"":a},fixPrecision:function(b){var a=isNaN(b);if(!this.allowdecimals||this.decimalprecision==-1||a||!b){return a?"":b}return parseFloat(parseFloat(b).toFixed(this.decimalprecision))}});$A.TriggerField=Ext.extend($A.TextField,{constructor:function(a){$A.TriggerField.superclass.constructor.call(this,a)},initComponent:function(a){$A.TriggerField.superclass.initComponent.call(this,a);this.trigger=this.wrap.child("div[atype=triggerfield.trigger]");this.initPopup()},initPopup:function(){if(this.initpopuped==true){return}this.popup=this.wrap.child("div[atype=triggerfield.popup]");this.shadow=this.wrap.child("div[atype=triggerfield.shadow]");Ext.getBody().insertFirst(this.popup);Ext.getBody().insertFirst(this.shadow);this.initpopuped=true},initEvents:function(){$A.TriggerField.superclass.initEvents.call(this);this.trigger.on("click",this.onTriggerClick,this,{preventDefault:true})},isExpanded:function(){var a=this.popup.getXY();return !(a[0]==-1000||a[1]==-1000)},setWidth:function(a){this.wrap.setStyle("width",(a+3)+"px");this.el.setStyle("width",(a-20)+"px")},onFocus:function(){if(this.readonly){return}$A.TriggerField.superclass.onFocus.call(this);if(!this.isExpanded()){this.expand()}},onBlur:function(a){this.hasFocus=false;this.wrap.removeClass(this.focusCss);this.fireEvent("blur",this)},onKeyDown:function(a){$A.TriggerField.superclass.onKeyDown.call(this,a);if(a.browserEvent.keyCode==9||a.keyCode==27){if(this.isExpanded()){this.collapse()}}},isEventFromComponent:function(b){var a=$A.TriggerField.superclass.isEventFromComponent.call(this,b);return a||this.popup.contains(b)},destroy:function(){if(this.isExpanded()){this.collapse()}this.trigger.un("click",this.onTriggerClick,this);this.shadow.remove();this.popup.remove();delete this.trigger;delete this.popup;$A.TriggerField.superclass.destroy.call(this)},triggerBlur:function(a){if(!this.popup.contains(a.target)&&!this.wrap.contains(a.target)){if(this.isExpanded()){this.collapse()}}},setVisible:function(a){$A.TriggerField.superclass.setVisible.call(this,a);if(a==false&&this.isExpanded()){this.collapse()}},collapse:function(){Ext.get(document.documentElement).un("mousedown",this.triggerBlur,this);this.popup.moveTo(-1000,-1000);this.shadow.moveTo(-1000,-1000)},expand:function(){Ext.get(document.documentElement).on("mousedown",this.triggerBlur,this);var a=this.wrap.getXY();this.popup.moveTo(a[0],a[1]+23);this.shadow.moveTo(a[0]+3,a[1]+26)},onTriggerClick:function(){if(this.readonly){return}if(this.isExpanded()){this.collapse()}else{this.expand();this.el.focus()}}});$A.ComboBox=Ext.extend($A.TriggerField,{maxHeight:200,blankOption:true,rendered:false,selectedClass:"item-comboBox-selected",currentNodeClass:"item-comboBox-current",constructor:function(a){$A.ComboBox.superclass.constructor.call(this,a)},initComponent:function(a){$A.ComboBox.superclass.initComponent.call(this,a);if(a.options){this.setOptions(a.options)}else{this.clearOptions()}},initEvents:function(){$A.ComboBox.superclass.initEvents.call(this);this.addEvents("select")},onTriggerClick:function(){this.doQuery("",true);$A.ComboBox.superclass.onTriggerClick.call(this)},onBlur:function(c){$A.ComboBox.superclass.onBlur.call(this,c);if(!this.isExpanded()){var b=this.getRawValue();var a=this.getRecordByDisplay(b);if(a!=null){this.setValue(a.get(this.displayfield))}else{this.setValue("")}}},getRecordByDisplay:function(e){if(!this.optionDataSet){return null}var a=this.optionDataSet.getAll();var c=a.length;var b=null;for(var f=0;f<c;f++){var g=a[f];var h=g.get(this.displayfield);if(h==e){b=g;break}}return b},expand:function(){if(!this.optionDataSet){return}if(this.rendered===false){this.initQuery()}this.correctViewSize();$A.ComboBox.superclass.expand.call(this);var a=this.getValue();this.currentIndex=this.getIndex(a);if(!this.currentIndex){return}if(!Ext.isEmpty(a)){if(this.selectedIndex){Ext.fly(this.getNode(this.selectedIndex)).removeClass(this.selectedClass)}var b=this.getNode(this.currentIndex);if(b){Ext.fly(b).addClass(this.currentNodeClass)}this.selectedIndex=this.currentIndex}},collapse:function(){$A.ComboBox.superclass.collapse.call(this);if(this.currentIndex!==undefined){Ext.fly(this.getNode(this.currentIndex)).removeClass(this.currentNodeClass)}},clearOptions:function(){this.processDataSet("un");this.optionDataSet=null},setOptions:function(a){var b=a;if(typeof(a)==="string"){b=$(a)}if(this.optionDataSet!=b){this.optionDataSet=b;this.processDataSet("un");this.processDataSet("on");this.rendered=false;if(!Ext.isEmpty(this.value)){this.setValue(this.value,true)}}},processDataSet:function(a){if(this.optionDataSet){this.optionDataSet[a]("load",this.onDataSetLoad,this);this.optionDataSet[a]("add",this.onDataSetLoad,this);this.optionDataSet[a]("update",this.onDataSetLoad,this);this.optionDataSet[a]("remove",this.onDataSetLoad,this);this.optionDataSet[a]("clear",this.onDataSetLoad,this);this.optionDataSet[a]("reject",this.onDataSetLoad,this)}},onDataSetLoad:function(){this.rendered=false;this.expand()},onRender:function(){if(!this.view){this.popup.update("<ul></ul>");this.view=this.popup.child("ul");this.view.on("click",this.onViewClick,this);this.view.on("mousemove",this.onViewMove,this)}if(this.optionDataSet){this.initList();this.rendered=true}},correctViewSize:function(){var f=[];var e=this.wrap.getWidth();for(var c=0;c<this.view.dom.childNodes.length;c++){var a=this.view.dom.childNodes[c];var d=$A.TextMetrics.measure(a,a.innerHTML).width;e=Math.max(e,d)||e}this.popup.setWidth(e);var b=Math.min(this.popup.child("ul").getHeight()+2,this.maxHeight);this.popup.setHeight(b<20?20:b);this.shadow.setWidth(e);this.shadow.setHeight(b<20?20:b)},onViewClick:function(b,a){if(a.tagName!="LI"){return}this.onSelect(a);this.collapse()},onViewOver:function(b,a){this.inKeyMode=false},onViewMove:function(c,b){if(this.inKeyMode){return}var a=b.tabIndex;this.selectItem(a)},onSelect:function(e){var b=e.tabIndex;if(b==-1){return}var a=this.optionDataSet.getAt(b);var c=a.get(this.valuefield);var d=this.getRenderText(a);this.setValue(d);this.fireEvent("select",this,c,d,a)},initQuery:function(){this.doQuery(this.getText())},doQuery:function(b,a){if(b===undefined||b===null){b=""}this.onRender()},initList:function(){this.refresh();if(this.optionDataSet.loading==true){this.view.update('<li tabIndex="-1">正在加载...</li>')}else{var a=this.optionDataSet.getAll();var b=a.length;var f=[];for(var c=0;c<b;c++){var d=$A.getRenderer(this.renderer);var e=this.getRenderText(a[c]);f.add('<li tabIndex="'+c+'">'+e+"</li>")}if(b!=0){this.view.update(f.join(""))}}},getRenderText:function(a){var b=$A.getRenderer(this.renderer);var c="&#160;";if(b){c=b.call(window,this,a)}else{c=a.get(this.displayfield)}return c},refresh:function(){this.view.update("");this.selectedIndex=null},selectItem:function(a){if(Ext.isEmpty(a)){return}var b=this.getNode(a);if(b&&b.tabIndex!=this.selectedIndex){if(!Ext.isEmpty(this.selectedIndex)){Ext.fly(this.getNode(this.selectedIndex)).removeClass(this.selectedClass)}this.selectedIndex=b.tabIndex;Ext.fly(b).addClass(this.selectedClass)}},getNode:function(a){return this.view.dom.childNodes[a]},destroy:function(){if(this.view){this.view.un("click",this.onViewClick,this);this.view.un("mousemove",this.onViewMove,this)}delete this.view;$A.ComboBox.superclass.destroy.call(this)},getText:function(){return this.text},setValue:function(l,f){$A.ComboBox.superclass.setValue.call(this,l,f);if(this.record){var g=this.record.getMeta().getField(this.binder.name);if(g){var a=g.get("mapping");var h=this.getRawValue();var e=this.getRecordByDisplay(h);if(a){for(var d=0;d<a.length;d++){var b=a[d];var c=e?e.get(b.from):"";if(!Ext.isEmpty(c,true)){if(f){this.record.data[b.to]=c}else{this.record.set(b.to,c)}}else{delete this.record.data[b.to]}}}}}},getIndex:function(c){var a=this.optionDataSet.getAll();var b=a.length;for(var d=0;d<b;d++){if(a[d].data[this.displayfield]==c){return d}}}});$A.DateField=Ext.extend($A.Component,{constructor:function(a){$A.DateField.superclass.constructor.call(this,a);this.draw()},initComponent:function(a){$A.DateField.superclass.initComponent.call(this,a);this.wrap=typeof(a.container)=="string"?Ext.get(a.container):a.container;this.table=this.wrap.child("table");this.tbody=this.wrap.child("tbody").dom;this.days=[];this.selectDays=this.selectDays||[];this.date=this.date||new Date();this.year=this.date.getFullYear();this.month=this.date.getMonth()+1;this.preMonthBtn=this.wrap.child("div.item-dateField-pre");this.nextMonthBtn=this.wrap.child("div.item-dateField-next");this.yearSpan=this.wrap.child("input[atype=field.year]");this.monthSpan=this.wrap.child("input[atype=field.month]");this.preYearBtn=this.wrap.child("div.item-dateField-preYear");this.nextYearBtn=this.wrap.child("div.item-dateField-nextYear");this.now=this.wrap.child("div.item-dateField-current");this.now.dom.innerHTML=this.year+"-"+this.month+"-"+this.date.getDate();this.now.set({_date:new Date(this.year,this.month-1,this.date.getDate()).getTime()})},processListener:function(a){$A.DateField.superclass.processListener.call(this,a);this.preMonthBtn[a]("click",this.preMonth,this);this.nextMonthBtn[a]("click",this.nextMonth,this);this.preYearBtn[a]("click",this.preYear,this);this.nextYearBtn[a]("click",this.nextYear,this);this.yearSpan[a]("focus",this.onDateFocus,this);this.monthSpan[a]("focus",this.onDateFocus,this);this.yearSpan[a]("blur",this.onDateBlur,this);this.monthSpan[a]("blur",this.onDateBlur,this);this.yearSpan[a]("keydown",this.onKeyDown,this);this.monthSpan[a]("keydown",this.onKeyDown,this);this.table[a]("click",this.onSelect,this);this.table[a]("mouseover",this.mouseOver,this);this.table[a]("mouseout",this.mouseOut,this);this.now[a]("click",this.onSelect,this)},initEvents:function(){$A.DateField.superclass.initEvents.call(this);this.addEvents("select","draw")},destroy:function(){$A.DateField.superclass.destroy.call(this);delete this.preYearBtn;delete this.nextYearBtn;delete this.preMonthBtn;delete this.nextMonthBtn;delete this.yearSpan;delete this.monthSpan;delete this.table;delete this.tbody},mouseOut:function(a){if(this.overTd){Ext.fly(this.overTd).removeClass("dateover")}},mouseOver:function(a){if(this.overTd){Ext.fly(this.overTd).removeClass("dateover")}if((Ext.fly(a.target).hasClass("item-day")||Ext.fly(a.target).hasClass("onToday"))&&Ext.fly(a.target).getAttribute("_date")!="0"){this.overTd=a.target;Ext.fly(this.overTd).addClass("dateover")}},onSelect:function(a){if(this.singleSelect!==false){if(this.selectedDay){Ext.fly(this.selectedDay).removeClass("onSelect")}if((Ext.fly(a.target).hasClass("item-day")||Ext.fly(a.target).hasClass("onToday"))&&Ext.fly(a.target).getAttribute("_date")!="0"){this.selectedDay=a.target;this.onSelectDay(this.selectedDay);this.fireEvent("select",this,new Date(parseInt(Ext.fly(a.target).getAttribute("_date"))))}}},onSelectDay:function(a){if(!Ext.fly(a).hasClass("onSelect")){Ext.fly(a).addClass("onSelect")}},onToday:function(a){a.className="onToday"},afterFinish:function(){for(var a=0;a<this.selectDays.length;a++){var b=this.selectDays[a];if(b.getFullYear()==this.year&&b.getMonth()+1==this.month){this.onSelectDay(this.days[b.getDate()])}}},onKeyDown:function(b){var d=b.keyCode,a=b.target;if(d==13){a.blur()}else{if(d==27){a.value=a.oldValue||"";a.blur()}else{if(d!=9&&d!=8&&d!=46&&(d<48||d>57||b.shiftKey)){b.stopEvent();return}}}},onDateFocus:function(a){Ext.fly(a.target).replaceClass("item-dateField-input","item-dateField-input-focus");a.target.select()},onDateBlur:function(a){Ext.fly(a.target).replaceClass("item-dateField-input-focus","item-dateField-input");this.predraw(new Date(this.yearSpan.dom.value,this.monthSpan.dom.value-1,1))},nowMonth:function(){this.predraw(new Date())},preMonth:function(){this.predraw(new Date(this.year,this.month-2,1))},nextMonth:function(){this.predraw(new Date(this.year,this.month,1))},preYear:function(){this.predraw(new Date(this.year-1,this.month-1,1))},nextYear:function(){this.predraw(new Date(this.year+1,this.month-1,1))},predraw:function(a){if(a==""||!a.getFullYear){a=new Date()}this.year=a.getFullYear();this.month=a.getMonth()+1;this.draw();this.fireEvent("draw",this)},draw:function(){var e=[];for(var c=1,a=new Date(this.year,this.month-1,1).getDay(),h=new Date(this.year,this.month-1,0).getDate();c<=a;c++){e.push([n=h-a+c,new Date(this.year,this.month-2,n),"item-day item-day-pre"])}for(var c=1,m=new Date(this.year,this.month,0).getDate();c<=m;c++){e.push([c,new Date(this.year,this.month-1,c),"item-day"])}for(var c=1,m=new Date(this.year,this.month,0).getDay();c<7-m;c++){e.push([c,new Date(this.year,this.month,c),"item-day item-day-next"])}this.days=[];while(this.tbody.hasChildNodes()){this.tbody.removeChild(this.tbody.firstChild)}var b=0;while(e.length){var o=document.createElement("tr");if(b%2!=0){o.className="week-alt"}b++;for(var c=1;c<=7;c++){if(e.length){var g=e.shift();if(g){var l=document.createElement("td");l.className=g[2];l.innerHTML=g[0];this.days[g[0]]=l;var f=g[1];l.title=f.format("yyyy-mm-dd");Ext.fly(l).set({_date:""+f.getTime()});this.isSame(f,new Date())&&this.onToday(l);this.selectDay&&this.isSame(f,this.selectDay)&&this.onSelectDay(l)}}o.appendChild(l)}this.tbody.appendChild(o)}this.yearSpan.dom.oldValue=this.yearSpan.dom.value=this.year;this.monthSpan.dom.oldValue=this.monthSpan.dom.value=this.month;this.afterFinish()},isSame:function(b,a){if(!a.getFullYear||!b.getFullYear){return false}return(b.getFullYear()==a.getFullYear()&&b.getMonth()==a.getMonth()&&b.getDate()==a.getDate())}});$A.DatePicker=Ext.extend($A.TriggerField,{constructor:function(a){$A.DatePicker.superclass.constructor.call(this,a)},initComponent:function(b){$A.DatePicker.superclass.initComponent.call(this,b);if(!this.dateField){var a={id:this.id+"_df",container:this.popup};this.dateField=new $A.DateField(a);this.dateField.on("select",this.onSelect,this);this.dateField.on("draw",this.onDraw,this)}},initEvents:function(){$A.DatePicker.superclass.initEvents.call(this);this.addEvents("select")},onDraw:function(){this.shadow.setWidth(this.popup.getWidth());this.shadow.setHeight(this.popup.getHeight())},onSelect:function(b,a){this.collapse();this.setValue(a);this.fireEvent("select",this,a)},onBlur:function(b){$A.DatePicker.superclass.onBlur.call(this,b);if(!this.isExpanded()){var a=this.getRawValue();if(!isNaN(new Date(a.replace(/-/g,"/")))){this.setValue(new Date(a.replace(/-/g,"/")))}else{this.setValue("")}}},formatValue:function(a){if(a instanceof Date){return Aurora.formatDate(a)}else{return a}},expand:function(){$A.DatePicker.superclass.expand.call(this);if(this.dateField.selectDay!=this.getValue()){this.dateField.selectDay=this.getValue();this.dateField.predraw(this.dateField.selectDay);var a=this.popup.getWidth();var b=this.popup.getHeight();this.shadow.setWidth(a);this.shadow.setHeight(b)}var e=$A.getViewportHeight();var b=this.popup.getHeight();var d=this.popup.getY();if(d+b>e){var c=this.wrap.getXY();this.popup.moveTo(c[0],c[1]-b);this.shadow.moveTo(c[0]+3,c[1]-b+3)}},destroy:function(){$A.DatePicker.superclass.destroy.call(this)}});$A.ToolBar=Ext.extend($A.Component,{constructor:function(a){$A.ToolBar.superclass.constructor.call(this,a)},initComponent:function(a){$A.ToolBar.superclass.initComponent.call(this,a)},initEvents:function(){$A.ToolBar.superclass.initEvents.call(this)}});$A.NavBar=Ext.extend($A.ToolBar,{constructor:function(a){$A.NavBar.superclass.constructor.call(this,a)},initComponent:function(a){$A.NavBar.superclass.initComponent.call(this,a);this.dataSet=$(this.dataSet);this.pageInput=$(this.inputId);this.pageInfo=Ext.get(this.pageId);this.navInfo=Ext.get(this.infoId);this.pageInput.setValue(1)},processListener:function(a){$A.NavBar.superclass.processListener.call(this,a);this.dataSet[a]("load",this.onLoad,this);this.pageInput[a]("keydown",this.onInputKeyPress,this)},initEvents:function(){$A.NavBar.superclass.initEvents.call(this)},onLoad:function(){this.pageInput.setValue(this.dataSet.currentPage);this.pageInfo.update("共"+this.dataSet.totalPage+"页");this.navInfo.update(this.creatNavInfo())},creatNavInfo:function(){var b=((this.dataSet.currentPage-1)*this.dataSet.pagesize+1);var a=this.dataSet.currentPage*this.dataSet.pagesize;if(a>this.dataSet.totalCount){a=this.dataSet.totalCount}if(a==0){b=0}return"显示 "+b+" - "+a+",共 "+this.dataSet.totalCount+" 条"},onInputKeyPress:function(a,c){if(c.keyCode==13){var b=parseInt(a.getRawValue());if(isNaN(b)){a.setValue(this.dataSet.currentPage)}else{if(b>0&&b<=this.dataSet.totalPage){this.dataSet.goPage(b)}else{a.setValue(this.dataSet.currentPage)}}}}});$A.WindowManager=function(){return{put:function(a){if(!this.cache){this.cache=[]}this.cache.add(a)},getAll:function(){return this.cache},remove:function(a){this.cache.remove(a)},get:function(c){if(!this.cache){return null}var b=null;for(var a=0;a<this.cache.length;a++){if(this.cache[a].id==c){b=this.cache[a];break}}return b},getZindex:function(){var c=40;var d=this.getAll();for(var b=0;b<d.length;b++){var e=d[b];var a=e.wrap.getStyle("z-index");if(a=="auto"){a=0}if(a>c){c=a}}return c}}}();$A.Window=Ext.extend($A.Component,{constructor:function(a){if($A.WindowManager.get(a.id)){return}this.draggable=true;this.closeable=true;this.modal=a.modal||true;this.cmps={};$A.focusWindow=null;$A.Window.superclass.constructor.call(this,a)},initComponent:function(b){$A.Window.superclass.initComponent.call(this,b);var d=this;$A.WindowManager.put(d);var a=new Ext.Template(d.getTemplate());var c=new Ext.Template(d.getShadowTemplate());d.width=1*(d.width||350);d.height=1*(d.height||400);d.wrap=a.append(document.body,{title:d.title,width:d.width,bodywidth:d.width-2,height:d.height,display:Ext.isIE6?"":"none"},true);d.shadow=c.append(document.body,{display:Ext.isIE6?"":"none"},true);d.focusEl=d.wrap.child("a[atype=win.focus]");d.title=d.wrap.child("div[atype=window.title]");d.head=d.wrap.child("td[atype=window.head]");d.body=d.wrap.child("div[atype=window.body]");d.closeBtn=d.wrap.child("div[atype=window.close]");if(d.draggable){d.initDraggable()}if(!d.closeable){d.closeBtn.hide()}d.center();if(d.url){d.showLoading();d.load(d.url,d.params)}},processListener:function(a){$A.Window.superclass.processListener.call(this,a);if(this.closeable){this.closeBtn[a]("click",this.onCloseClick,this);this.closeBtn[a]("mouseover",this.onCloseOver,this);this.closeBtn[a]("mouseout",this.onCloseOut,this);this.closeBtn[a]("mousedown",this.onCloseDown,this)}this.wrap[a]("click",this.toFront,this);this.focusEl[a]("keydown",this.handleKeyDown,this);if(this.draggable){this.head[a]("mousedown",this.onMouseDown,this)}},initEvents:function(){$A.Window.superclass.initEvents.call(this);this.addEvents("close","load")},handleKeyDown:function(b){b.stopEvent();var a=b.getKey();if(a==27){this.close()}},initDraggable:function(){this.head.addClass("item-draggable")},focus:function(){this.focusEl.focus()},center:function(){var c=$A.getViewportWidth();var e=$A.getViewportHeight();var a=Math.max((c-this.width)/2,0);var d=Math.max((e-this.height-23)/2,0);this.wrap.moveTo(a,d);this.wrap.show();this.shadow.setWidth(this.wrap.getWidth());this.shadow.setHeight(this.wrap.getHeight());this.shadow.moveTo(a+3,d+3);this.shadow.show();this.toFront();var b=this;setTimeout(function(){b.focusEl.focus()},10)},getShadowTemplate:function(){return['<DIV class="item-shadow" style="display:{display};"></DIV>']},getTemplate:function(){return['<TABLE class="win-wrap" style="width:{width}px;display:{display};" cellSpacing="0" cellPadding="0" border="0">',"<TBODY>",'<TR style="height:23px;" >','<TD class="win-caption">','<TABLE cellSpacing="0" unselectable="on"  onselectstart="return false;" style="height:23px;-moz-user-select:none;"  cellPadding="0" width="100%" border="0" unselectable="on">',"<TBODY>","<TR>",'<TD unselectable="on" class="win-caption-label" atype="window.head" width="99%">','<A atype="win.focus" href="#" class="win-fs" tabIndex="-1">&#160;</A><DIV unselectable="on" atype="window.title" unselectable="on">{title}</DIV>',"</TD>",'<TD unselectable="on" class="win-caption-button" noWrap>','<DIV class="win-close" atype="window.close" unselectable="on"></DIV>',"</TD>",'<TD><DIV style="width:5px;"/></TD>',"</TR>","</TBODY>","</TABLE>","</TD>","</TR>",'<TR style="height:{height}px">','<TD class="win-body" vAlign="top" unselectable="on">','<DIV class="win-content" atype="window.body" style="position:relatvie;width:{bodywidth}px;height:{height}px;" unselectable="on"></DIV>',"</TD>","</TR>","</TBODY>","</TABLE>"]},toFront:function(){var b=this.wrap.getStyle("z-index");var a=$A.WindowManager.getZindex();if(b=="auto"){b=0}if(b<a){this.wrap.setStyle("z-index",a+5);this.shadow.setStyle("z-index",a+4);if(this.modal){$A.Cover.cover(this.wrap)}}$A.focusWindow=this},onMouseDown:function(c){var a=this;a.toFront();var b=a.wrap.getXY();a.relativeX=b[0]-c.getPageX();a.relativeY=b[1]-c.getPageY();a.screenWidth=$A.getViewportWidth();a.screenHeight=$A.getViewportHeight();if(!this.proxy){this.initProxy()}this.proxy.show();Ext.get(document.documentElement).on("mousemove",a.onMouseMove,a);Ext.get(document.documentElement).on("mouseup",a.onMouseUp,a)},onMouseUp:function(b){var a=this;Ext.get(document.documentElement).un("mousemove",a.onMouseMove,a);Ext.get(document.documentElement).un("mouseup",a.onMouseUp,a);if(a.proxy){a.wrap.moveTo(a.proxy.getX(),a.proxy.getY());a.shadow.moveTo(a.proxy.getX()+3,a.proxy.getY()+3);a.proxy.hide()}},onMouseMove:function(f){f.stopEvent();var b=this.screenWidth;var d=this.screenHeight;var c=f.getPageX()+this.relativeX;var a=f.getPageY()+this.relativeY;if(c<=0){c=0}if((c+this.width)>=(b-3)){c=b-this.width-3}if(a<=0){a=0}if((a+this.height)>=(d-30)){a=Math.max(d-this.height-30,0)}this.proxy.moveTo(c,a)},showLoading:function(){this.body.update("正在加载...");this.body.setStyle("text-align","center");this.body.setStyle("line-height",5)},clearLoading:function(){this.body.update("");this.body.setStyle("text-align","");this.body.setStyle("line-height","")},initProxy:function(){var a=this;var c='<DIV style="display:none;border:1px dashed black;Z-INDEX: 10000; LEFT: 0px; WIDTH: 100%; CURSOR: default; POSITION: absolute; TOP: 0px; HEIGHT: 621px;" unselectable="on"></DIV>';a.proxy=Ext.get(Ext.DomHelper.append(Ext.getBody(),c));var b=a.wrap.getXY();a.proxy.setWidth(a.wrap.getWidth());a.proxy.setHeight(a.wrap.getHeight());a.proxy.setLocation(b[0],b[1])},onCloseClick:function(a){a.stopEvent();this.close()},onCloseOver:function(a){this.closeBtn.addClass("win-btn-over")},onCloseOut:function(a){this.closeBtn.removeClass("win-btn-over")},onCloseDown:function(a){this.closeBtn.removeClass("win-btn-over");this.closeBtn.addClass("win-btn-down");Ext.get(document.documentElement).on("mouseup",this.onCloseUp,this)},onCloseUp:function(a){this.closeBtn.removeClass("win-btn-down");Ext.get(document.documentElement).un("mouseup",this.onCloseUp,this)},close:function(){$A.WindowManager.remove(this);this.destroy();this.fireEvent("close",this)},destroy:function(){$A.focusWindow=null;var a=this.wrap;if(!a){return}if(this.proxy){this.proxy.remove()}if(this.modal){$A.Cover.uncover(this.wrap)}$A.Window.superclass.destroy.call(this);delete this.title;delete this.head;delete this.body;delete this.closeBtn;delete this.proxy;a.remove();this.shadow.remove();var b=this;setTimeout(function(){for(var c in b.cmps){var d=b.cmps[c];if(d.destroy){try{d.destroy()}catch(f){alert("销毁window出错: "+f)}}}},10)},load:function(a,b){Ext.Ajax.request({url:a,params:b||{},success:this.onLoad.createDelegate(this)})},setChildzindex:function(b){for(var a in this.cmps){var d=this.cmps[a];d.setZindex(b)}},onLoad:function(a,b){if(!this.body){return}this.clearLoading();var c=a.responseText;var d=this;this.body.update(c,true,function(){d.fireEvent("load",d)})}});$A.showMessage=function(d,c,e,b,a){return $A.showTypeMessage(d,c,b||300,a||100,"win-info",e)};$A.showWarningMessage=function(d,c,e,b,a){return $A.showTypeMessage(d,c,b||300,a||100,"win-warning",e)};$A.showInfoMessage=function(d,c,e,b,a){return $A.showTypeMessage(d,c,b||300,a||100,"win-info",e)};$A.showErrorMessage=function(d,c,e,b,a){return $A.showTypeMessage(d,c,b||300,a||100,"win-error",e)};$A.showTypeMessage=function(e,d,c,a,b,f){var d='<div class="win-icon '+b+'"><div class="win-type" style="width:'+(c-60)+"px;height:"+(a-58)+'px;">'+d+"</div></div>";return $A.showOkWindow(e,d,c,a,f)};$A.showComfirm=function(f,e,c,d,b,a){b=b||300;a=a||100;var e='<div class="win-icon win-question"><div class="win-type" style="width:'+(b-60)+"px;height:"+(a-58)+'px;">'+e+"</div></div>";return $A.showOkCancelWindow(f,e,c,d,b,a)};$A.showOkCancelWindow=function(h,c,a,d,b,i){var g=$A.CmpManager.get("aurora-msg-ok-cancel");if(g==null){var f=$A.Button.getTemplate("aurora-msg-ok","确定");var e=$A.Button.getTemplate("aurora-msg-cancel","取消");g=new $A.Window({id:"aurora-msg-ok-cancel",title:h,height:i||100,width:b||300});if(c){g.body.update(c+'<center><table cellspacing="5"><tr><td>'+f+"</td><td>"+e+"</td><tr></table></center>",true,function(){var m=$("aurora-msg-ok");var l=$("aurora-msg-cancel");g.cmps["aurora-msg-ok"]=m;g.cmps["aurora-msg-cancel"]=l;m.on("click",function(){if(a){a.call(this,g)}});l.on("click",function(){g.close();if(d){d.call(this,g)}})})}}return g};$A.showOkWindow=function(f,e,c,a,g){var d=$A.CmpManager.get("aurora-msg-ok");if(d==null){var b=$A.Button.getTemplate("aurora-msg-yes","确定");d=new $A.Window({id:"aurora-msg-ok",title:f,height:a,width:c});if(e){d.body.update(e+"<center>"+b+"</center>",true,function(){var h=$("aurora-msg-yes");d.cmps["aurora-msg-yes"]=h;h.on("click",function(){if(g){g.call(this,d)}d.close()});h.focus()})}}return d};$A.Lov=Ext.extend($A.TextField,{constructor:function(a){this.isWinOpen=false;this.fetching=false;this.context=a.context||"";$A.Lov.superclass.constructor.call(this,a)},initComponent:function(b){$A.Lov.superclass.initComponent.call(this,b);this.para={};var a=this.lovservice.indexOf("?");if(a!=-1){this.para=Ext.urlDecode(this.lovservice.substring(a+1,this.lovservice.length));this.lovservice=this.lovservice.substring(0,a)}this.trigger=this.wrap.child("div[atype=triggerfield.trigger]")},processListener:function(a){$A.Lov.superclass.processListener.call(this,a);this.trigger[a]("click",this.showLovWindow,this,{preventDefault:true})},initEvents:function(){$A.Lov.superclass.initEvents.call(this);this.addEvents("commit")},destroy:function(){$A.Lov.superclass.destroy.call(this)},setWidth:function(a){this.wrap.setStyle("width",(a+3)+"px");this.el.setStyle("width",(a-20)+"px")},onChange:function(a){this.fetchRecord()},canHide:function(){return this.isWinOpen==false},commit:function(e,b){if(this.win){this.win.close()}var a=b?b:this.record;if(a){var c=this.getMapping();for(var d=0;d<c.length;d++){var f=c[d];a.set(f.to,e.get(f.from)||"")}}this.fireEvent("commit",this,a,e)},getMapping:function(){var a;if(this.record){var b=this.record.getMeta().getField(this.binder.name);if(b){a=b.get("mapping")}}return a?a:[{from:this.binder.name,to:this.binder.name}]},onWinClose:function(){this.isWinOpen=false;this.win=null;this.focus()},getLovPara:function(){var a=Ext.apply({},this.para);var c;if(this.record){c=this.record.getMeta().getField(this.binder.name)}if(c){var b=c.get("lovpara");if(b){Ext.apply(a,b)}}return a},fetchRecord:function(){if(this.readonly==true){return}if(!Ext.isEmpty(this.lovurl)){this.showLovWindow();return}this.fetching=true;var b=this.getRawValue();if(!Ext.isEmpty(this.lovservice)){url=this.context+"sys_lov.svc?svc="+this.lovservice+"&pagesize=1&pagenum=1&_fetchall=false&_autocount=false&"+Ext.urlEncode(this.getLovPara())}else{if(!Ext.isEmpty(this.lovmodel)){url=this.context+"autocrud/"+this.lovmodel+"/query?pagesize=1&pagenum=1&_fetchall=false&_autocount=false&"+Ext.urlEncode(this.getLovPara())}}var a=this.record;var f={};var c=this.getMapping();for(var d=0;d<c.length;d++){var e=c[d];if(this.binder.name==e.to){f[e.from]=b}a.set(e.to,"")}$A.slideBarEnable=$A.SideBar.enable;$A.SideBar.enable=false;this.setRawValue("正在查询...");$A.request({url:url,para:f,success:function(h){var i=new $A.Record({});if(h.result.record){var g=[].concat(h.result.record);if(g.length>0){var l=g[0];i=new $A.Record(l)}}this.fetching=false;this.commit(i,a);$A.SideBar.enable=$A.slideBarEnable},error:this.onFetchFailed,scope:this})},onFetchFailed:function(a){this.fetching=false;$A.SideBar.enable=$A.slideBarEnable},showLovWindow:function(c){c.stopEvent();if(this.fetching||this.isWinOpen||this.readonly){return}this.isWinOpen=true;var a=this.getRawValue();this.blur();var b;if(!Ext.isEmpty(this.lovurl)){b=this.lovurl+"?"}else{if(!Ext.isEmpty(this.lovservice)){b=this.context+"sys_lov.screen?url="+encodeURIComponent(this.context+"sys_lov.svc?svc="+this.lovservice+"&"+Ext.urlEncode(this.getLovPara()))+"&service="+this.lovservice+"&"}else{b=this.context+"sys_lov.screen?url="+encodeURIComponent(this.context+"autocrud/"+this.lovmodel+"/query?"+Ext.urlEncode(this.getLovPara()))+"&service="+this.lovmodel+"&"}}this.win=new $A.Window({title:this.title||"Lov",url:b+"lovid="+this.id+"&key="+encodeURIComponent(a)+"&gridheight="+(this.lovgridheight||350)+"&innerwidth="+((this.lovwidth||400)-30),height:this.lovheight||400,width:this.lovwidth||400});this.win.on("close",this.onWinClose,this)}});$A.TextArea=Ext.extend($A.Field,{constructor:function(a){$A.TextArea.superclass.constructor.call(this,a)},initComponent:function(a){$A.TextArea.superclass.initComponent.call(this,a)},initEvents:function(){$A.TextArea.superclass.initEvents.call(this)},initElements:function(){this.el=this.wrap},setRawValue:function(a){this.el.update(a===null||a===undefined?"":a)}});