(function(){var B=function(I,K,J){return Array.prototype.slice.call(I,K||0,J||I.length)};Function.prototype.methodize=function(K){var J=this,I=Number(K||0);return function(){return J.apply(this,new Array(I).concat(B(arguments)))}};var d=document,e=0,a="http://www.w3.org/2000/svg",t="urn:schemas-microsoft-com:vml",r="http://www.w3.org/1999/xlink",k=!Ext.isIE9&&!!d.createElementNS&&!!d.createElementNS(a,"svg").createSVGRect,D="<v:fill color='{fillColor}' opacity='{fillOpacity}' angle='{angle}' colors='{colors}' type='{type}'></v:fill>",j="<v:stroke startarrow='{startArrow}' endarrow='{endArrow}' color='{strokeColor}' joinstyle='miter' weight='{strokeWidth}px' opacity='{strokeOpacity}'></v:stroke>",i="<v:shadow on='t' opacity='0.5' offset='0px,3px'></v:shadow>",h=/\w|[\s\d-+.,]*/g,f=/[\d-+.]+/g,E=Math.cos,u=Math.sin,z=Math.PI,b=parseInt,A,F,n=function(I){return(I=I.trim()).toLowerCase().replace(/^./,I.charAt(0).toUpperCase())},g=function(I,K){var J=d.createElementNS(a,I);if(!Ext.isEmpty(K)){J.id=K}return Ext.get(J)},w=function(I,K){var J=d.createElement(I);if(!Ext.isEmpty(K)){J.id=K}return Ext.get(J)},s=function(I){if(k){I=I.dom||I;return I.namespaceURI==a}return false},c=function(I){if(!k){I=I.dom||I;return !!I.tagUrn&&I.tagUrn==t}return false},o=function(M,L){var J,K,I=[];if(!Ext.isObject(M)){J={};J[M]=L;M=J}for(K in M){L=M[K];I.push(K);I.push(":");I.push(L);I.push(";")}return I.join("")},H=function(Q){var L=[],T,K=false,O,N,R;function S(V){if(!V){L=[0,0,0,1]}else{if(V=="transparent"){L=[0,0,0,0]}else{if(V=="none"){L="none"}else{if(/gradient/i.test(V)){K=true;var W=/^gradient\((.*)\)$/.exec(V)[1],U=/^([^stop]*),[^,]*stop/.exec(W)[1];O=/^[^,]*/.exec(U)[0];N=U.match(/[-\d%]+/g);R=function(Y){var X=[];Ext.each(Y,function(ab){var Z=/\(([^\)]*\))\)$/.exec(ab)[1],aa=/^([^,]*),(.*)$/.exec(Z);X.push([aa[1],aa[2]])});return X}(W.match(/stop\([^\)]*\)\)/mg))}else{T=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]?(?:\.[0-9]+)?)\s*\)/.exec(V);if(T){L=[b(T[1]),b(T[2]),b(T[3]),parseFloat(T[4],10)]}else{T=/^#([a-fA-F0-9]{1,2})([a-fA-F0-9]{1,2})([a-fA-F0-9]{1,2})$/.exec(V);if(T){L=[b(M(T[1]),16),b(M(T[2]),16),b(M(T[3]),16),1]}}}}}}}function M(U){return U.length==1?U+U:U}function J(V){var U=1;if(K){if(V==="gradient"){U={isGradient:K,type:O,linear:N,stops:R}}else{U=""}}else{if(V==="a"){if(!isNaN(L[3])){U=L[3]}}else{if(L&&!isNaN(L[0])){if(V==="rgb"){U="rgb("+L[0]+","+L[1]+","+L[2]+")"}else{U="rgba("+L.join(",")+")"}}else{if(L=="none"){U=L}else{U=Q}}}}return U}function P(V){if(L!="none"&&isNumber(V)&&V!==0){var U;for(U=0;U<3;U++){L[U]+=b(V*255);if(L[U]<0){L[U]=0}if(L[U]>255){L[U]=255}}}return this}function I(U){if(Q=="transparent"||L=="none"){return this}L[3]=U||1;return this}S(Q);return{get:J,brighten:P,setOpacity:I}},C=function(){var I={};return function(J,T){if(I[J]){return I[J]}T=T||1;var Q=J.match(h),S=[0,0],R=[0,0],U=[],O=function(X,Y){var V=Ext.isArray(X)?X:X.match(f);for(var W=0;W<V.length;W++){if(!Y||W/2%3==2){R[0]+=L(V[W]);R[1]+=L(V[++W]);U=U.concat(R)}else{U=U.concat([R[0]+L(V[W]),R[1]+L(V[++W])])}}},N=function(ak,ai){var ab=ak.match(f);while(ab.length&&ab.length%7==0){var X=L(ab.shift()),W=L(ab.shift()),aa=Number(ab.shift()),Y=Number(ab.shift()),af=Number(ab.shift()),ae=L(ab.shift()),ad=L(ab.shift()),Z,ah,V,ac;if(ai){ae+=R[0];ad+=R[1]}var aj=Math.abs(ae-R[0]),ag=Math.abs(ad-R[1]);X=aj;W=ag;U.push(af?"wa":"at");if((af^Y)^ae<R[0]){if(ad<R[1]){Z=R[0];ah=R[1]-W}else{Z=R[0]-X;ah=R[1]}}else{if(ad<R[1]){Z=R[0]-X;ah=R[1]-(W<<1)}else{Z=R[0]-(X<<1);ah=R[1]-W}}V=Z+(X<<1);ac=ah+(W<<1);U.push(Z,ah,V,ac,R[0],R[1],ae,ad);R=[ae,ad]}},M=function(W){var V=W.match(f).slice(-2);return[L(V[0]),L(V[1])]},L=function(V){return Math.floor(V*T)},K=function(X){for(var W=0,V=X.match(f);W<V.length;W++){U.push(L(V[W]))}};for(var P=0;P<Q.length;P++){switch(Q[P]){case"M":S=M(Q[P+1]);case"C":case"L":R=M(Q[P+1]);U.push(Q[P]);K(Q[++P]);break;case"m":U.push("M");O(Q[++P]);S=[].concat(R);break;case"c":U.push("C");O(Q[++P],true);break;case"l":U.push("L");O(Q[++P]);break;case"h":U.push("L");O(Q[++P]+" 0");break;case"v":U.push("L");O("0 "+Q[++P]);break;case"H":U.push("L");R[0]=L(Q[++P]);U.push(R[0],R[1]);break;case"V":U.push("L");R[1]=L(Q[++P]);U.push(R[0],R[1]);break;case"A":N(Q[++P]);break;case"a":N(Q[++P],true);break;case"Z":case"z":U.push("X");R=[].concat(S);break}}U.push("E");I[J]=U.join(" ");return I[J]}}(),m=function(I){var J=Ext.util.JSON.decode("{"+(I.get("config")||"").replace(/^{|}$/g,"")+"}");for(var L in J){var K=String(L).toLowerCase();if(K!==L){J[K]=J[L];delete J[L]}}return J},q=k?function(){var M,I=Ext.toArray(arguments);if(I.length&&Ext.isObject(I[0])){var L=I.shift();M=L.dom||L}else{M=this.wrap.dom}var J=M.getAttribute("transform");if(!J){J="translate(0,0) scale(1,1) rotate(0,0 0)"}var K=J.split("rotate");M.setAttribute("transform",(K[0].replace(/\(([-.\d]+)\)/g,"($1,$1)")+"rotate"+K[1].replace(/\(([-.\d]+)\)/,"($1,0 0)")).replace(/[-.\d]+/g,function(N){var O=I.shift();return Ext.isEmpty(O)?N:O}))}:function(){var M,I=Ext.toArray(arguments),J={};if(I.length&&Ext.isObject(I[0])){var K=I.shift();M=K.dom||K}else{M=this.wrap.dom}if(!Ext.isEmpty(I[0])){M.style.left=I[0]+"px"}if(!Ext.isEmpty(I[1])){M.style.top=I[1]+"px"}if(!Ext.isEmpty(I[2])&&!Ext.isEmpty(I[3])){M.coordsize.value=100/I[2]+","+100/I[3]}if(!Ext.isEmpty(I[4])){M=Ext.fly(M);var L=M.getXY();M.setStyle({rotation:I[4]})}},G=function(){var J=1,I;return function(K){K=Ext.get(K);if(I!=K){I=K;if(s(I)){I.parent().appendChild(I)}else{I.setStyle("z-index",J++)}}}}();$A.Graphics=Ext.extend($A.Component,{constructor:function(I){this.root=I.root;this.top=I.top||this;this.cmps=[];$A.Graphics.superclass.constructor.call(this,I);return this},initComponent:function(I){$A.Graphics.superclass.initComponent.call(this,I);if(!this.wrap){this["init"+(k?"SVG":"VML")+"Wrap"]()}this["init"+(k?"SVG":"VML")+"Element"]()},initEvents:function(){$A.Graphics.superclass.initEvents.call(this);this.addEvents("click","drop","move","drawn")},processListener:function(I){$A.Graphics.superclass.processListener.call(this,I);this.wrap[I]("click",this.onClick,this,{preventDefault:true});this.wrap[I]("mouseover",this.onMouseOver,this,{preventDefault:true});this.wrap[I]("mouseout",this.onMouseOut,this,{preventDefault:true});this.wrap[I]("mousedown",this.onMouseDown,this)},processDataSetLiestener:function(I){ds=this.dataset;if(ds){ds[I]("load",this.onLoad,this);ds[I]("update",this.onUpdate,this);ds[I]("add",this.onAdd,this);ds[I]("remove",this.onRemove,this);ds[I]("indexchange",this.onIndexChange,this)}},initSVGElement:function(){var I=g("svg");I.setStyle({height:"100%",width:"100%"});this.root=g("g");this.wrap.appendChild(I);I.appendChild(this.root)},initVMLElement:function(){if(!d.namespaces.hcv){d.namespaces.add("v",t);d.createStyleSheet().cssText="v\\:shadow,v\\:roundrect,v\\:oval,v\\:image,v\\:polyline,v\\:line,v\\:group,v\\:fill,v\\:path,v\\:shape,v\\:stroke{ behavior:url(#default#VML); display: inline-block; } "}this.root=w("v:group");this.root.setStyle({position:"absolute",width:100+"px",height:100+"px"});this.root.set({coordsize:"100,100"});this.wrap.appendChild(this.root)},initProxy:function(){if(k){var J=this.wrap.dom.cloneNode(true);J.id=this.id+"_proxy";this.proxy=Ext.get(J)}else{var J=this.wrap.dom.cloneNode(false);J.id=this.id+"_proxy";this.proxy=Ext.get(J);var I=this.wrap.dom.innerHTML.replace(/^<\?xml[^\/]*\/>/i,"").replace(/id\=([\S]*)/img,"id=$1_proxy");new Ext.Template(I).append(J,{},true)}this.proxy.setStyle({"background-color":"transparent",border:"none",position:"absolute","z-index":"99999"});Ext.getBody().insertFirst(this.proxy)},onMouseDown:function(M,J){this.fire("mousedown",M,J);if(this.candrawline){this.startLine(M,J)}else{if(this.dataset){var K=this.getGElement(J);if(K&&K.record){this.dataset.locate(this.dataset.getAll().indexOf(K.record)+1)}}else{this.focus(J)}if(this.dropto||this.moveable){var L=this.wrap.getXY();if(s(this.wrap)){var I=this.top.wrap.getXY();L[0]=this.x+I[0];L[1]=this.y+I[1]}this.relativeX=L[0]-M.getPageX();this.relativeY=L[1]-M.getPageY();A=$A.getViewportWidth();F=$A.getViewportHeight();if(this.dropto){if(!this.dropEl){this.dropEl=$(this.dropto)}if(!this.proxy){this.initProxy()}this.proxy.moveTo(L[0],L[1])}else{this.proxy=this.wrap}if(this.moveable){G(this.proxy)}Ext.get(d).on("mousemove",this.onMouseMove,this);Ext.get(d).on("mouseup",this.onMouseUp,this)}}},onMouseMove:function(N){N.stopEvent();var K=N.getPageX()+this.relativeX,J=N.getPageY()+this.relativeY,O=this.width||this.rx*2,M=this.height||this.ry*2,I=d[Ext.isStrict&&!Ext.isWebKit?"documentElement":"body"].scrollLeft,Q=d[Ext.isStrict&&!Ext.isWebKit?"documentElement":"body"].scrollTop,P=I+A,L=Q+F;if(K<0){K=0}else{if((K+O)>=P){K=Math.max(P-O,0)}}if(J<0){J=0}else{if((J+M)>=L){J=Math.max(L-M,0)}}if(this.moveable){this.fireEvent("move",this,this.dataset,null,K,J)}this.proxy.moveTo(K,J)},onMouseUp:function(M){Ext.get(d).un("mousemove",this.onMouseMove,this);Ext.get(d).un("mouseup",this.onMouseUp,this);if(this.dropto){var J=this.dropEl.wrap,Q=J.getXY(),K=Q[0],P=Q[1],I=K+J.getWidth(),O=P+J.getHeight(),N=M.getPageX(),L=M.getPageY();if(N>=Q[0]&&L>=Q[1]&&N<=I&&L<=O){this.dropEl.fireEvent("drop",this.proxy,this.top.dataset,N+this.relativeX-K+(k?4:0),L+this.relativeY-P+(k?4:0))}this.proxy.moveTo(-1000,-1000)}},onMouseOver:function(J,I){this.fire("mouseover",J,I)},onMouseOut:function(J,I){this.fire("mouseout",J,I)},onClick:function(J,I){this.fire("click",J,I)},getGElement:function(K){var J=K.id.match(/(.*)_(\d+)(_.*)*$/),M,L,I;if(J){M=J[2];if(M){L=this.top.dataset;if(L){I=L.findById(M)}if(J[1]){K=$(J[1]+"_"+M)}return{el:K,record:I}}}},fire:function(I,L,J){if(!J){return}var K=this.getGElement(J);if(K){this.fireEvent(I,L,K.el,this.dataset,K.record);return K.el}this.fireEvent(I,L,J)},create:function(L){var K=L.get("type"),J=m(L);J.id=this.id+"_"+L.id;if(this.renderer){var M=$A.getRenderer(this.renderer);if(M==null){alert("未找到"+this.renderer+"方法!");return}var I=M.call(window,L,K,J);if(!Ext.isEmpty(I)){if(!Ext.isObject(I)){I="{"+String(I).replace(/^{|}$/g,"").toLowerCase()+"}"}else{I=Ext.util.JSON.encode(I).toLowerCase()}Ext.apply(J,Ext.util.JSON.decode(I))}}this.createGElement(J.type||K,J)},resizeSVG:function(){if(k){var I=this.top.wrap;var O=I.getXY();var K=d[Ext.isStrict&&!Ext.isWebKit?"documentElement":"body"].scrollLeft;var Q=d[Ext.isStrict&&!Ext.isWebKit?"documentElement":"body"].scrollTop;var N=this.root.dom;var M=N.ownerSVGElement;var L=N.getBoundingClientRect();var J=L.left-O[0]+L.width+K;var P=L.top-O[1]+L.height+Q;Ext.fly(M).set({width:J,height:P})}},moveTo:function(I,K){if(s(this.wrap)){q(this.wrap,I,K)}else{var J=this.top.wrap.getXY();this.wrap.moveTo(J[0]+I,J[1]+K)}},syncFocusMask:function(I){if(!I.moveable){return this.focusMask}var J=I.strokewidth/2+3;return this.focusMask.setStyle({left:I.x-J+"px",top:I.y-J+"px"}).setWidth(I.width+J*2).setHeight(I.height+J*2)},focus:function(I){I=this.fire("focus",null,I);if(I){if(this.focusItem){this.blur()}if(this.editable){if(I.editable){I.showEditors()}if(I.moveable){if(!this.focusMask){this.focusMask=new Ext.Template('<div style="-moz-user-select:none;-webkit-user-select:none;cursor:pointer;background:none;position:absolute;border:1px dashed #000;z-index:999;"></div>').insertFirst(this.wrap.dom,{},true)}this.syncFocusMask(I).show().on("mousedown",I.onMouseDown,I)}}this.focusItem=I}else{this.fireEvent("focus")}},blur:function(){var I=this.focusItem;if(I){if(I.editable){I.hideEditors()}if(I.moveable){if(this.focusMask){this.focusMask.hide().un("mousedown",I.onMouseDown,I)}}this.fire("blur",null,I);this.focusItem=null}},startLine:function(L,J){var K=this.getGElement(J);if(K){var I=this.wrap.getXY();this.startEl=K;this.drawLinePoints=[L.getPageX()-I[0],L.getPageY()-I[1]];Ext.get(d).on("mousemove",this.drawLine,this);Ext.get(d).on("mouseup",this.endLine,this)}},drawLine:function(M){var O=this.wrap.getXY();var K=this.drawLinePoints[0],R=this.drawLinePoints[1],J=M.getPageX()-O[0],Q=M.getPageY()-O[1],V=J-K,U=Q-R,N=10;if(V==0){Q+=U>0?-N:N}else{if(U==0){J+=V>0?-N:N}else{var P=Math.sqrt(V*V+U*U);J=(P-N)/P*V+K;Q=(P-N)/P*U+R}}var T=K+","+R+" "+Math.round(J)+","+Math.round(Q);if(!this.newline){var I=this.startEl.record,S=I.get(this.tableidfield)||I.get("table_id");this.newline=this.dataset.create({type:"line",config:'strokewidth:1,strokecolor:"#aaaaaa",strokeopacity:"1",titlecolor:"black",titlesize:14,titlex:0,titley:0,endarrow:"classic",points:"'+T+'",editable:true'+(Ext.isEmpty(S)?"":(",from:"+S))})}else{var L=m(this.newline);L.points=T;this.newline.set("config",Ext.util.JSON.encode(L))}},endLine:function(M,J){Ext.get(d).un("mousemove",this.drawLine,this);Ext.get(d).un("mouseup",this.endLine,this);if(this.newline){var K=this.getGElement(J);if(!K||K.el==this.startEl.el||K.record==this.newline){this.dataset.remove(this.newline)}else{var L=K.record,N=L.get(this.tableidfield)||L.get("table_id"),I=m(this.newline);I.to=N;this.newline.set("config",Ext.util.JSON.encode(I));this.focus($(this.id+"_"+this.newline.id));this.fireEvent("drawn")}}delete this.drawLinePoints;delete this.newline;delete this.startEl},bind:function(J,I){this.dataset=$(J);this.tableidfield=I||"table_id";this.processDataSetLiestener("on");this.onLoad()},onLoad:function(){this.clear();var N=this.dataset,O=[],J=N.getAll();J.sort(function(R,Q){var P=R.get("type"),S=Q.get("type");if(P==="line"){return 1}else{if(S==="line"){return -1}else{return 0}}});for(var K=0,I=J.length;K<I;K++){var M=J[K],L=M.get("type");if(!L){M.data.type="rect";M.isNew=true}this.create(M)}},onAdd:function(K,I,J){this.create(I)},onRemove:function(L,I,J){var K=$(this.id+"_"+I.id);if(this.focusItem==K){this.focusItem=null}K.destroy()},onIndexChange:function(J,I){this.focus($(this.id+"_"+I.id))},onUpdate:function(T,K,Z,U,P){var I=$(this.id+"_"+K.id),X=m(K),L=K.get("type");X.type=L,x=I.x,y=I.y;if(v[n(L)].processConfig&&v[n(L)].processConfig(X)==false){K.set(Z,P);return}for(var Y in I.initConfig){if(Y!="dataset"&&Y!="top"&&Y!="root"&&Y!="id"){if(!Y in X){delete I[Y]}}}Ext.apply(I,X);I.initConfig=X;I.processListener("un");I.el.remove();if(I.text){I.text.remove()}I["init"+(k?"SVG":"VML")+"Element"]=v[L=="image"?"Image":"Path"].prototype["init"+(k?"SVG":"VML")+"Element"];if(!k){I.vmlTpl=v[L=="image"?"Image":"Path"].prototype.vmlTpl}I.initComponent(X);if(Ext.isWebKit){I.wrap.dom.setAttribute("transform",I.wrap.dom.getAttribute("transform"))}I.syncLineEditors(I.x-x,I.y-y);if(I==this.focusItem&&this.focusMask){this.syncFocusMask(I)}I.processListener("on");if(I.editors&&I.points){var W=0,S=I.editors;var Q=S[S.length-1],J=!!Q.bindEl;if(J){var V=Q.bindEl.lineEditors;V.splice(V.indexOf(Q),1);delete Q.bindEl}for(p=I.points,l=p.length;W<l;W++){var N=S[W];if(N){var O=N.width/2,M=N.height/2,R=N.strokewidth;N.x=p[W][0]-O;N.y=p[W][1]-M;if(k&&R%2==1&&I.shadow){O-=0.5;M-=0.5}N.moveTo(p[W][0]-O,p[W][1]-M)}else{I.createEditor(p[W][0],p[W][1])}}while(S.length>W){var N=S.pop();N.un("move",I.editorMove,I);N.destroy()}I.bindEditor(I.to)}},createGElement:function(J,I){var K=new v[n(J)](Ext.apply(I||{},{type:J,root:(I&&Ext.get(I.root))||this.root,top:this.top}));this.top.cmps.push(K);return K},createElement:function(I){var J=k?g(I):w(I);this.root.appendChild(J);return J},clear:function(){while(this.cmps.length){this.cmps.pop().destroy();this.focusItem=null}},destroy:function(){this.wrap.remove();if(this.proxy&&this.proxy!=this.wrap){this.proxy.remove()}$A.Graphics.superclass.destroy.call(this);this.processDataSetLiestener("un")},translate:q.methodize(),scale:q.methodize(2),rotate:q.methodize(4)});var v={Path:Ext.extend($A.Graphics,{zoom:10000,constructor:function(I){this.lineEditors=[];return v.Path.superclass.constructor.call(this,I)},initComponent:function(I){I.fillcolor=H(I.fillcolor).setOpacity(I.fillopacity);I.fillopacity=I.fillcolor.get("a");I.strokecolor=H(I.strokecolor).setOpacity(I.strokeopacity);I.strokeopacity=I.strokecolor.get("a");v.Path.superclass.initComponent.call(this,I);if(this.title){this["init"+(k?"SVG":"VML")+"Title"]()}this["init"+(k?"SVG":"VML")+"Info"]();if(k&&this.shadow){this.initSVGShadow()}var J=this.top.wrap.getXY()},initSVGWrap:function(){this.wrap=g("g",this.id);this.root.appendChild(this.wrap)},initVMLWrap:function(){this.wrap=w("v:group",this.id);this.root.appendChild(this.wrap)},initSVGElement:function(){var O=this.createGradient(this.fillcolor.get("gradient")),N=this.fillcolor.get(),L=this.strokecolor.get();if(this.x||this.y){if(this.strokewidth&&this.strokewidth%2==1&&!this.shadow){q(this.wrap,this.x+0.5,this.y+0.5)}else{q(this.wrap,this.x,this.y)}}this.el=g("path",this.id+"_el");this.el.dom.style.cssText=o({fill:N,"fill-opacity":this.fillopacity,stroke:L,"stroke-width":this.strokewidth,"stroke-opacity":this.strokeopacity,cursor:this.cursor||"pointer"})+this.style;var M={d:this.d,fill:O};if(this.strokewidth){if(!this.el.dom.style.stroke){L=this.el.dom.style.stroke="rgba(0,0,0,0)"}if(this.startarrow||this.endarrow){var K=this.d.match(f),J=K.length;var P="-"+L+"-"+this.strokeopacity*100;if(Ext.isIE9){P+="-"+this.strokewidth}if(this.startarrow){M["marker-start"]="url(#start-arrow-"+this.startarrow+P+")";var I=this.convertArrow(Number(K[0]),y1=Number(K[1]),x2=Number(K[2]),y2=Number(K[3]));K[0]=I.x;K[1]=I.y;M.d=M.d.replace(/[\d-+.]+\s+[\d-+.]+/,I.x+" "+I.y)}if(this.endarrow){M["marker-end"]="url(#end-arrow-"+this.endarrow+P+")";var I=this.convertArrow(Number(K[J-2]),y1=Number(K[J-1]),x2=Number(K[J-4]),y2=Number(K[J-3]));M.d=M.d.replace(/([\d-+.]+\s+[\d-+.]+)[^\d]*$/,I.x+" "+I.y)}new v.Arrow({color:L,width:this.strokewidth,opacity:this.strokeopacity,endarrow:this.endarrow,startarrow:this.startarrow,root:this.root})}}this.el.set(M);this.wrap.insertFirst(this.el)},initVMLElement:function(){var N=this.createGradient(this.fillcolor.get("gradient")),J=this.fillcolor.get("rgb"),I=this.strokecolor.get("rgb");var M=true,L=true,K=true;if(Ext.isEmpty(this.strokewidth)){this.strokewidth=1}if(I=="none"||this.strokeopacity==0||this.strokewidth==0){M=false}if(J=="none"){L=false}this.wrap.setStyle({position:"absolute",width:100+"px",height:100+"px",left:(this.x||0)+"px",top:(this.y||0)+"px"});this.wrap.set({coordsize:"100,100"});this.el=new Ext.Template(this.getVmlTpl(M,L,this.shadow)).insertFirst(this.wrap.dom,Ext.apply({id:this.id+"_el",style:this.style,path:this.path||C(this.d,this.zoom),zoom:this.zoom,fillColor:J,fillOpacity:this.fillopacity,strokeColor:I,strokeWidth:this.strokewidth,strokeOpacity:this.strokeopacity,endArrow:this.endarrow,startArrow:this.startarrow,cursor:this.cursor||"pointer"},N),true);this.wrap.set({title:this.info||""})},createGradient:k?function(K){if(!K.isGradient){return"none"}var N="graphics-gradient"+e++,I=this.root.child("defs");if(!I){I=g("defs");this.root.insertFirst(I)}var M=g(K.type+"Gradient",N),J=K.linear,L=K.stops;M.set({x1:J[0],y1:J[1],x2:J[2],y2:J[3],gradientUnits:"userSpaceOnUse"});I.appendChild(M);Ext.each(L,function(Q){var O=H(Q[1]),P=g("stop");P.set({offset:Q[0],"stop-color":O.get("rgb"),"stop-opacity":O.get("a")});M.appendChild(P)});return"url("+location.href+"#"+N+")"}:function(L){if(!L.isGradient){return{}}var N=L.type=="linear"?"gradient":"",K=L.linear,O=L.stops,M=this.top.width,I=this.top.height,P,J="";Ext.each(K,function(S,Q,R){if(/\%/.test(S)){S=b(S)/100;R[Q]=(Q%2==0?M:I)*S}});P=Math.atan((K[2]-K[0])/(K[3]-K[1]))*180/z+180;Ext.each(O,function(R){var Q=H(R[1]);J+=R[0]+" "+Q.get("rgb")+";"});return{type:N,angle:P,colors:J,fillOpacity:1}},initSVGShadow:function(){var K="graphics-filter-shadow";if(!Ext.get(K)){var M=this.root.child("defs");if(!M){M=g("defs");this.root.insertFirst(M)}var I=g("filter",K);I.set({x:-0.25,y:-0.25,width:1.5,height:1.5,"color-interpolation-filters":"sRGB"});M.appendChild(I);var O=g("feGaussianBlur");O.set({result:"blur",stdDeviation:1,"in":"SourceAlpha"});var J=g("feColorMatrix");J.set({values:"1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.6 0 ",type:"matrix",result:"bluralpha"});var Q=g("feOffset");Q.set({result:"offsetBlur",dx:0,dy:3,"in":"bluralpha"});var P=g("feMerge");I.appendChild(O);I.appendChild(J);I.appendChild(Q);I.appendChild(P);var N=g("feMergeNode");N.set({"in":"offsetBlur"});var L=g("feMergeNode");L.set({"in":"SourceGraphic"});P.appendChild(N);P.appendChild(L)}this.el.setStyle({filter:"url(#"+K+")"})},initSVGTitle:function(){this.text=v.Text.prototype.initSVGElement.call({text:this.title,id:this.id+"_title",size:this.titlesize||14,dx:this.titlex||0,dy:this.titley||0,color:this.titlecolor,wrap:this.wrap,style:"cursor:pointer;-webkit-user-select:none"})},initVMLTitle:function(){var I=this.titlex||0,M=this.titley||0,L=this.titlesize||14,J=this.wrap;if(this.type=="line"){I+=this.x;M+=this.y;J=this.top.wrap}else{var K=this.strokewidth;I+=K/2;M+=K/2}this.text=v.Text.prototype.initVMLElement.call({text:this.title,id:this.id+"_title",size:L,dx:I,dy:M,color:this.titlecolor,wrap:J,vmlTpl:v.Text.prototype.vmlTpl})},initSVGInfo:function(){if(this.info){if(!this.infoEl){this.infoEl=g("title");this.wrap.appendChild(this.infoEl)}this.infoEl.dom.textContent=this.info}else{if(this.infoEl){this.infoEl.remove();this.infoEl=null}}},initVMLInfo:function(){this.wrap.set({title:this.info||""})},convertArrow:function(L,N,K,M){var J=L-K,I=N-M,P=this.strokewidth*3/2;if(J==0){N+=I>0?-P:P}else{if(I==0){L+=J>0?-P:P}else{var O=Math.sqrt(J*J+I*I);L=(O-P)/O*J+K;N=(O-P)/O*I+M}}return{x:L,y:N}},createEditors:function(){if(this.editable){this.editors=[];var K=this.points;for(var J=0;J<K.length;J++){var I=K[J][0],L=K[J][1];this.createEditor(I,L)}this.bindEditor(this.from,true);this.bindEditor(this.to)}},bindEditor:function(O,I){if(!Ext.isEmpty(O)){var N=this.editors,M=this.top.dataset;var L=M.find(this.top.tableidfield,O);if(L){var K=$(this.top.id+"_"+L.id);if(K){var J=N[I?0:N.length-1];J.bindEl=K;K.lineEditors.add(J)}}}},syncLineEditors:function(L,J){for(var M=0,I=this.lineEditors.length;M<I;M++){var K=this.lineEditors[M];K.x+=L;K.y+=J;K.moveTo(K.x,K.y);K.fireEvent("move")}},createEditor:function(I,L){var K=this.editors,J=K.length;K[J]=new v.Oval({id:this.id+"_editor"+J,x:I-5,y:L-5,height:10,width:10,strokewidth:1,strokecolor:"rgba(0,0,0,1)",fillcolor:"transparent",root:this.root,top:this.top,moveable:true});K[J].on("move",this.editorMove,this)},editorMove:function(I,J,N,Q,P){var N=this.getRecord();var K=m(N),R="";for(var M=0,L=this.editors.length;M<L;M++){var O=this.editors[M];R+=(O.x+5)+","+(O.y+5)+" "}K.points=R;N.set("config",Ext.util.JSON.encode(K))},showEditors:function(){if(this.editors){for(var J=0,I=this.editors.length;J<I;J++){G(this.editors[J].wrap);this.editors[J].wrap.show()}}},hideEditors:function(){if(this.editors){for(var J=0,I=this.editors.length;J<I;J++){this.editors[J].wrap.hide()}}},clearEditors:function(){if(this.editors){while(this.editors.length){var I=this.editors.pop(),J=I.bindEl;if(J&&J.lineEditors){J.lineEditors.remove(I)}I.un("move",this.editorMove,this);I.destroy()}}this.editors=null},onMouseDown:function(L,J){if(this.top.editable&&!this.top.candrawline){if(this.dropto||this.moveable){var K=this.wrap.getXY();if(s(this.wrap)){var I=this.top.wrap.getXY();K[0]=this.x+I[0];K[1]=this.y+I[1]}this.relativeX=K[0]-L.getPageX();this.relativeY=K[1]-L.getPageY();if(this.dropto){if(!this.dropEl){this.dropEl=$(this.dropto)}if(!this.proxy){this.initProxy()}this.proxy.moveTo(K[0],K[1])}else{this.proxy=this.wrap}if(this.moveable){G(this.proxy)}Ext.get(d).on("mousemove",this.onMouseMove,this);Ext.get(d).on("mouseup",this.onMouseUp,this)}else{if(this.editable){G(this.wrap)}}}},onMouseMove:function(Q){Q.stopEvent();var V=this.width||this.rx*2,O=this.height||this.ry*2,I=this.top.wrap,W=I.getWidth(),P=I.getHeight(),X=this.strokewidth||0,R=I.getXY(),M=Q.getPageX()+this.relativeX-R[0],L=Q.getPageY()+this.relativeY-R[1],T=0;if(X&&c(this.wrap)){T=-X/2}if(M<=T){M=T}else{if(M+this.width-T>W-2){M=W-2-this.width+T}}if(L<=T){L=T}else{if(L+this.height-T>P-2){L=P-2-this.height+T}}var U=this.x,S=this.y;this.x=Math.round(M-T);this.y=Math.round(L-T);if(this.moveable){var K=this.top.dataset,N=K.getCurrentRecord(),J=m(N),X=J.strokewidth/2;J.x=this.x;J.y=this.y;this.top.syncFocusMask(J);N.data.config=Ext.util.JSON.encode(J).replace(/^{|}$/g,"");N.dirty=true;this.fireEvent("move",this,K,N,J.x-T,J.y-T);this.top.fireEvent("move",this,K,N,J.x-T,J.y-T)}if(s(this.wrap)){if(X%2==1&&!this.shadow){M+=0.5;L+=0.5}q(this.proxy,M,L)}else{M+=R[0];L+=R[1];this.proxy.moveTo(M,L)}this.syncLineEditors(this.x-U,this.y-S)},getRecord:function(){var I=this.id.match(/(.*)_(\d+)(_.*)*$/),J;if(I){J=I[2];if(this.top.dataset){return this.top.dataset.findById(J)}}},destroy:function(){this.clearEditors();if(this.focusMask){this.focusMask.un("mousedown",this.onMouseDown,this);this.focusMask.remove()}v.Path.superclass.destroy.call(this)},getVmlTpl:function(J,K,L){var I=["<v:shape id='{id}' filled='"+K+"' stroked='"+J+"' coordsize='{zoom},{zoom}' style='position:absolute;left:0;top:0;width:1px;height:1px;cursor:{cursor};{style}' path='{path}'>"];if(K){I.push(D)}if(J){I.push(j)}if(L){I.push(i)}I.push("</v:shape>");return I}}),Group:Ext.extend($A.Graphics,{initSVGWrap:function(){this.wrap=g("g",this.id);this.root.appendChild(this.wrap)},initVMLWrap:function(){this.wrap=w("v:group",this.id);this.wrap.setStyle({position:"absolute",width:100+"px",height:100+"px"});this.wrap.set({coordsize:"100,100"});this.root.appendChild(this.wrap)},initSVGElement:function(){},initVMLElement:function(){}}),Line:function(J){if(v.Line.processConfig(J)==false){return}var I=new v.Path(J);I.createEditors();I.hideEditors();return I},Oval:function(I){v.Oval.processConfig(I);return new v.Path(I)},Arc:function(I){v.Arc.processConfig(I);return new v.Path(I)},Rect:function(I){v.Rect.processConfig(I);return new v.Path(I)},Diamond:function(I){v.Diamond.processConfig(I);return new v.Path(I)},Arrow:function(M){if(!M.startarrow&&!M.endarrow){return}var O=M.root.child("defs");if(!O){O=g("defs");M.root.insertFirst(O)}var N=M.color||"rgba(0,0,0,1)",Q=M.opacity||1,K=M.width||2,J="-"+N+"-"+Q*100,R="0 0 100 100";if(Ext.isIE9){J+="-"+K;var L=K/2*Math.sqrt(5);R=-L+" "+(-L)+" "+(100+2*L)+" "+(100+2*L)}if(M.startarrow){var I="start-arrow-"+M.startarrow+J,P=Ext.get(I);if(!P){P=g("marker",I);P.set({viewBox:R,refX:50,refY:50,orient:"auto"});O.appendChild(P);new v.Path({fillcolor:N,fillopacity:Q,d:"M 100 0 L 0 50 L 100 100 L 66.66 50 z",root:P})}}if(M.endarrow){var I="end-arrow-"+M.endarrow+J,P=Ext.get(I);if(!P){P=g("marker",I);P.set({viewBox:R,refX:50,refY:50,orient:"auto"});O.appendChild(P);new v.Path({fillcolor:N,fillopacity:Q,d:"M 0 0 L 100 50 L 0 100 L 33.33 50 z",root:P})}}}};Ext.apply(v,{Image:Ext.extend(v.Path,{initSVGElement:function(){if(this.x||this.y){q(this.wrap,this.x,this.y)}this.el=g("image",this.id+"_el");this.el.dom.style.cssText=o({stroke:this.strokecolor,"stroke-width":this.strokewidth,"stroke-opacity":this.strokeopacity,"-moz-user-select":"none"})+this.style;this.el.dom.setAttributeNS(r,"xlink:href",this.image);this.el.set({x:0,y:0,width:this.width,height:this.height});this.wrap.appendChild(this.el)},initVMLElement:function(){this.wrap.setStyle({position:"absolute",width:100+"px",height:100+"px",left:this.x+"px",top:this.y+"px"});this.wrap.set({coordsize:"100,100"});this.el=new Ext.Template(this.vmlTpl).append(this.wrap.dom,{id:this.id+"_el",src:this.image,style:this.style,width:this.width,height:this.height,strokeColor:this.strokecolor||"none",strokeWidth:this.strokecolor?this.strokewidth:0,strokeOpacity:this.strokecolor?(this.strokeopacity||1):0},true)},vmlTpl:["<v:image id='{id}' src='{src}' style='position:absolute;left:0;top:0;width:{width}px;height:{height}px;{style}'>",j,"</v:image>"]}),Text:Ext.extend(v.Path,{initSVGWrap:function(){this.wrap=g("g",this.id);this.root.appendChild(this.wrap)},initVMLWrap:function(){this.wrap=w("v:group",this.id);this.root.appendChild(this.wrap)},initSVGElement:function(){var I=this.size||14;this.el=g("text",this.id+"_el");this.el.dom.style.cssText=o({fill:this.color,"font-size":I+"px","line-height":I+"px",cursor:"text"})+this.style;this.el.set({dx:this.dx+1,dy:this.dy+I-2});this.el.dom.textContent=this.text;this.wrap.appendChild(this.el)},initVMLElement:function(){var I=this.size||14;this.el=new Ext.Template(this.vmlTpl).append(this.wrap.dom,{id:this.id+"_el",style:o({"line-height":I+"px","font-size":I+"px"})+this.style,left:this.dx,top:this.dy,color:this.color||"black"},true);this.el.update(this.text);return this.el},vmlTpl:"<span id='{id}' unselectable='on'  onselectstart='return false;' style='position:absolute;left:{left}px;top:{top}px;color:{color};cursor:pointer;white-space:nowrap;{style}'></span>"})});v.Line.processConfig=function(L){var K=L.points.match(f),N=[];if(!K){return false}for(var M=0,J=K.length;M<J;M+=2){N.push([K[M],K[M+1]])}if(N.length<2){return false}var I=N[0][0],O=N[0][1];K=["M",0,0,"L"];for(var M=1,J=N.length;M<J;M++){K.push(N[M][0]-I,N[M][1]-O)}L.d=K.join(" ");if(L.strokewidth==1){L.strokewidth=2}L.fillcolor="none";L.points=N;L.x=Number(I);L.y=Number(O)};v.Rect.processConfig=function(M){var N=Number(M.height)||200,P=Number(M.width)||200,J=Math.min(Number(M.rx)||0,P/2),I=Math.min(Number(M.ry)||0,N/2),Q=J>0&&I>0,L=J!=P/2,K=I!=N/2,O=["M",0,Q?I:0];if(Q){O.push("A",J,I,0,0,1,J,0)}if(L){O.push("H",P-(Q?J:0))}if(Q){O.push("A",J,I,0,0,1,P,I)}if(K){O.push("V",N-(Q?I:0))}if(Q){O.push("A",J,I,0,0,1,P-J,N)}if(L){O.push("H",Q?J:0)}if(Q){O.push("A",J,I,0,0,1,0,N-I)}if(K){O.push("Z")}M.d=O.join(" ")};v.Oval.processConfig=function(I){I.height=I.height||I.ry*2;I.width=I.width||I.rx*2;I.ry=I.height/2;I.rx=I.width/2;v.Rect.processConfig(I)};v.Arc.processConfig=k?function(U){var S=U.x,R=U.y,K=U.start%(2*z),P=U.r,L=U.end%(2*z)-0.000001,Q=U.innerR||0,N=U.open,O=E(K),I=u(K),J=E(L),T=u(L),M=(L>K?L:L+2*z)-K<z?0:1;U.d=["M",P*O,-P*I,"A",P,P,0,M,0,P*J,-P*T,N?"M":"L",Q*J,-Q*T,"A",Q,Q,0,M,1,Q*O,-Q*I,N?"":"Z"].join(" ")}:function(W){var U=W.zoom||10000,S=W.x*U,R=W.y*U,K=W.start,L=W.end,O=W.r*U,N=E(K),I=u(K),J=E(L),T=u(L),Q=(W.innerR||0)*U,V=0.08/O,M=(Q&&0.1/Q)||0,P;if(L-K===0){return["x"]}P=["at",b(-O),b(-O),b(O),b(O),b(O*N),b(-O*I),b(O*J),b(-O*T)];if(Q){P.push("wa",b(-Q),b(-Q),b(Q),b(Q),b(Q*J),b(-Q*T),b(Q*N),b(-Q*I))}P.push("x","e");W.path=P.join(" ")};v.Diamond.processConfig=function(J){var K=Number(J.height)||100,I=Number(J.width)||200,L=["M",0,K/2,"L",I/2,0,I,K/2,I/2,K,"Z"];J.d=L.join(" ")}})();