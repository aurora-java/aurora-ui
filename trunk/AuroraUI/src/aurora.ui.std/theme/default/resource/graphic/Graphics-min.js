(function(){Function.prototype.methodize=function(G){var F=this,E=Number(G||0);return function(){return F.apply(this,new Array(E).concat(Ext.toArray(arguments)))}};var e=document,b="http://www.w3.org/2000/svg",u="urn:schemas-microsoft-com:vml",o="none",w="transparent",k="px",m=!Ext.isIE9&&!!e.createElementNS&&!!e.createElementNS(b,"svg").createSVGRect,B="<v:fill color='{fillColor}' opacity='{fillOpacity}' angle='{angle}' colors='{colors}' type='{type}'></v:fill>",j="<v:stroke startarrow='{startArrow}' endarrow='{endArrow}' color='{strokeColor}' joinstyle='miter' weight='{strokeWidth}px' opacity='{strokeOpacity}'></v:stroke>",i="<v:shadow on='t' opacity='0.5' offset='5px,5px'></v:shadow>",f=/[\d-+.e]+/g,C=Math.cos,x=Math.sin,A=Math.PI,c=parseInt,s=Ext.isEmpty,p=function(E){return(E=E.trim()).replace(/^./,E.charAt(0).toUpperCase())},g=function(E,G){var F=e.createElementNS(b,E);if(!s(G)){F.id=G}return Ext.get(F)},z=function(E,G){var F=e.createElement(E);if(!s(G)){F.id=G}return Ext.get(F)},t=function(E){if(m){E=E.dom||E;return E.namespaceURI==b}return false},d=function(E){if(!m){E=E.dom||E;return !!E.tagUrn&&E.tagUrn==u}return false},q=function(I,H){var F={},G,E=[];if(!Ext.isObject(I)){F[I]=H;I=F}for(G in I){E.push(G,":",I[G],";")}return E.join("")},v=function(E){if(!E){return{}}return Ext.util.JSON.decode("{"+E.replace(/^{|}$/g,"").replace(/[^:,]+:/g,function(F){return F.toLowerCase()})+"}")},n=function(E){return v(E.get("config"))},r=m?function(){var H,E=Ext.toArray(arguments);if(E.length&&Ext.isObject(E[0])){H=E.shift()}else{H=this.el||this.wrap}H=H.dom||H;var F=H.getAttribute("transform");if(!F){F="translate(0,0) scale(1,1) rotate(0,0 0)"}var G=F.split("rotate");H.setAttribute("transform",(G[0].replace(/\(([-.\d]+)\)/g,"($1,$1)")+"rotate"+G[1].replace(/\(([-.\d]+)\)/,"($1,0 0)")).replace(/[-.\d]+/g,function(I){var J=E.shift();return s(J)?I:J}))}:function(){var W,E=Ext.toArray(arguments),F={};if(E.length&&Ext.isObject(E[0])){W=Ext.get(E.shift())}else{W=this.el||this.wrap}if(!s(E[0])){W.setStyle("left",E[0]+k)}if(!s(E[1])){W.setStyle("top",E[1]+k)}if(!s(E[2])&&!s(E[3])){W.dom.coordsize.value=100/E[2]+","+100/E[3]}if(!s(E[4])){var I=W.getXY(),M=c(W.getStyle("left")||0),L=c(W.getStyle("top")||0),U=W.getWidth(),S=W.getHeight(),V=E[4],Z=V*A/180,Y=C(Z),K=x(Z),J=C(-Z),Q=x(-Z),H=C(-Z-A/2),O=x(-Z-A/2),P=W.dx||M,N=W.dy||L,T=Math.sqrt(P*P+N*N),X=Math.atan(-N/P)-Z,M=M-P+T*C(X),L=L-N-T*x(X),G,R;if(Q>=0){if(J>=0){G=M;R=L-U*Q}else{G=M+S*H;R=L-U*Q}}else{if(J>=0){G=M+S*H;R=L}else{G=M+U*J;R=L-S*O}}if(W.dom.tagName=="SPAN"){W.setStyle({filter:!s(V)?["progid:DXImageTransform.Microsoft.Matrix(M11=",Y,", M12=",-K,", M13=100",", M21=",K,", M22=",Y,", sizingMethod='auto expand')"].join(""):o,left:G+k,top:R+k})}else{W.setStyle({rotation:V})}}},h=function(H){if(Ext.isString(H)){var F=H.match(f);H=[];if(!F){return false}for(var G=0,E=F.length;G<E;G+=2){H.push([Number(F[G]),Number(F[G+1])])}}return H},D=function(){var F=1,E;return function(G){G=Ext.get(G);if(E!=G){E=G;if(t(E)){E.parent().appendChild(E)}else{E.setStyle("z-index",F++)}}}}();$A.Graphics=Ext.extend($A.Component,{constructor:function(E){var F=this;F.root=E.root;F.top=E.top||F;F.cmps=[];$A.Graphics.superclass.constructor.call(F,E);return F},initComponent:function(E){var F=this;$A.Graphics.superclass.initComponent.call(F,E);if(m){if(!F.wrap){F.initSVGWrap()}F.initSVGElement()}else{if(!F.wrap){F.initVMLWrap()}F.initVMLElement()}},initEvents:function(){$A.Graphics.superclass.initEvents.call(this);this.addEvents("click","drop","move","drawn")},processListener:function(F){var G=this,E={preventDefault:true};$A.Graphics.superclass.processListener.call(G,F);G.wrap[F]("click",G.onClick,G,E)[F]("mouseover",G.onMouseOver,G,E)[F]("mouseout",G.onMouseOut,G,E)[F]("mousedown",G.onMouseDown,G)[F]("keydown",G.onKeyDown,G)[F]("blur",G.onBlur,G)},processDataSetLiestener:function(E){var F=this,G=F.dataset;if(G){G[E]("load",F.onLoad,F);G[E]("update",F.onUpdate,F);G[E]("add",F.onAdd,F);G[E]("remove",F.onRemove,F);G[E]("indexchange",F.onIndexChange,F)}},initSVGElement:function(){this.root=g("g").appendTo(g("svg").setStyle({height:"100%",width:"100%",position:"relative"}).appendTo(this.wrap))},initVMLElement:function(){if(!e.namespaces.hcv){e.namespaces.add("v",u);e.createStyleSheet().cssText="v\\:shadow,v\\:roundrect,v\\:oval,v\\:image,v\\:polyline,v\\:line,v\\:group,v\\:fill,v\\:path,v\\:shape,v\\:stroke{ behavior:url(#default#VML); display: inline-block; } "}this.root=z("v:group").setStyle({position:"absolute",width:100+k,height:100+k}).set({coordsize:"100,100"}).appendTo(this.wrap)},initProxy:function(){var F=this,E=F.wrap,G=E.dom.cloneNode(!!m);G.id=F.id+"_proxy";if(!m){new Ext.Template(E.dom.innerHTML.replace(/^<\?xml[^\/]*\/>/i,"").replace(/id\=([\S]*)/img,"id=$1_proxy")).append(G,{})}F.proxy=Ext.getBody().insertFirst(Ext.fly(G).setStyle({"background-color":w,border:o,position:"absolute","z-index":"99999"}))},onMouseDown:function(J,E){var H=this;H.fire("mousedown",J,E);if(H.candrawline){H.startLine(J,E)}else{var I=H.dataset,F=H.getGElement(E),G;if(I&&F&&(G=F.record)&&G!=I.getCurrentRecord()){I.locate(I.getAll().indexOf(G)+1)}else{(function(){H.focus(E)}).defer(m&&Ext.isIE10?1:0)}if(H.dropto||H.moveable){H.sw=$A.getViewportWidth();H.sh=$A.getViewportHeight();H.beforeMove(J)}}},beforeMove:function(J){var H=this,G=H.wrap,F=H.dropto,I=G.getXY();if(t(G)){var E=H.top.wrap.getXY();I[0]=H.x+E[0];I[1]=H.y+E[1]}H.relativeX=I[0]-J.getPageX();H.relativeY=I[1]-J.getPageY();if(F){if(!H.dropEl){H.dropEl=$(F)}if(!H.proxy){H.initProxy()}H.proxy.moveTo(I[0],I[1])}else{H.proxy=G}if(H.moveable){D(H.proxy)}Ext.fly(e).on("mousemove",H.onMouseMove,H).on("mouseup",H.onMouseUp,H)},onMouseMove:function(K){K.stopEvent();var J=this,G=K.getPageX()+J.relativeX,F=K.getPageY()+J.relativeY,N=J.width||J.rx*2,I=J.height||J.ry*2,L=Ext.fly(document).getScroll(),E=L.left,O=L.top,M=E+J.sw,H=O+J.sh;if(G<0){G=0}else{if((G+N)>=M){G=Math.max(M-N,0)}}if(F<0){F=0}else{if((F+I)>=H){F=Math.max(H-I,0)}}if(J.moveable){J.fireEvent("move",J,J.dataset,null,G,F)}J.proxy.moveTo(G,F)},onMouseUp:function(J,M){var H=this;H.fire("mouseup",J,M);Ext.fly(e).un("mousemove",H.onMouseMove,H).un("mouseup",H.onMouseUp,H);if(H.dropto){var F=H.dropEl.wrap,N=F.getXY(),G=N[0],M=N[1],E=G+F.getWidth(),L=M+F.getHeight(),K=J.getPageX(),I=J.getPageY();if(K>=N[0]&&I>=N[1]&&K<=E&&I<=L){H.dropEl.fireEvent("drop",H.proxy,H.top.dataset,K+H.relativeX-G+(m?4:0),I+H.relativeY-M+(m?4:0))}H.proxy.moveTo(-1000,-1000)}},onMouseOver:function(F,E){this.fire("mouseover",F,E)},onMouseOut:function(F,E){this.fire("mouseout",F,E)},onClick:function(F,E){this.fire("click",F,E)},onKeyDown:function(J){var I=this,G=I.focusItem;if(G){var E=G.x,K=G.y,F=I.dataset.getCurrentRecord(),H=J.ctrlKey?10:1;switch(J.keyCode){case 37:E-=H;break;case 38:K-=H;break;case 39:E+=H;break;case 40:K+=H;break;case 46:if(I.focusItem){I.remove()}default:return}if(!m){E--;K--}G.onMouseMove({x:E,y:K},G);J.stopEvent()}},onBlur:function(){this.blur()},getGElement:function(G){var F=G.id.match(/(.*)_(\d+)(_.*)*$/);if(F){var I=F[2];if(I){var H=this.top.dataset,E;if(H){E=H.findById(I)}if(F[1]){I=F[1]+"_"+I;G=$(I)}return{el:G,record:E}}}},fire:function(E,H,F){if(!F){return}var G=this.getGElement(F);if(G){this.fireEvent(E,H,G.el,this.dataset,G.record);return G.el}this.fireEvent(E,H,F)},create:function(I){var H=this,G=I.get("type"),F=n(I),J=H.renderer;F.id=H.id+"_"+I.id;if(J){var K=$A.getRenderer(J);if(K==null){alert("未找到"+J+"方法!");return}var E=K(I,G,F);if(!s(E)){if(Ext.isObject(E)){E=Ext.util.JSON.encode(E)}Ext.apply(F,v(E))}}H.createGElement(F.type||G,F)},moveTo:function(E,J){var H=this,G=H.wrap,F=H.parent;Ext.apply(H.initConfig,{x:(H.x=E),y:(H.y=J)});if(t(G)){if(H.strokewidth%2==1&&H.shadow){E+=0.5;J+=0.5}if(F){E-=F.x;J-=F.y}r(G,E,J)}else{var I=this.top.wrap.getXY();G.moveTo(I[0]+E,I[1]+J)}},syncFocusMask:function(G){var F=this.focusMask;if(!G.moveable){return F}var K=G.strokewidth/2+3,I=K,J=K,E=G.width,H=G.height;return F.setStyle({left:G.x-I+k,top:G.y-J+k}).setWidth(E+I*2).setHeight(H+J*2).set({title:G.info||""})},focus:function(E){var F=this;E=F.fire("focus",null,E);if(E){if(F.focusItem){if(F.focusItem==E){return}F.blur()}if(F.editable){if(E.editable){E.showEditors()}if(E.moveable){if(!F.focusMask){F.focusMask=new Ext.Template('<div style="-moz-user-select:none;-webkit-user-select:none;background:none;position:absolute;border:1px dashed #000;"></div>').insertFirst(F.wrap.dom,{},true)}F.syncFocusMask(E).show()}}F.focusItem=E}F.wrap.focus()},blur:function(){var G=this,F=G.focusItem,E=G.focusMask;if(F){if(F.editable){F.hideEditors()}if(F.moveable){if(E){E.hide()}}G.fire("blur",null,F);G.focusItem=null}},startLine:function(J,G){var I=this,H=I.getGElement(G),F=I.wrap.getXY(),E=J.getPageX()-F[0],L=J.getPageY()-F[1],K;if(H){K=H.el.findConnect(J);if(K){E=K.x+K.width/2;L=K.y+K.height/2;I.startEl=H}}I.drawLinePoints=[E,L];Ext.fly(e).on("mousemove",I.drawLine,I).on("mouseup",I.endLine,I)},drawLine:function(S,L){var W=this,R=W.wrap.getXY(),Q=W.drawLinePoints[0],I=W.drawLinePoints[1],P=W.getGElement(L),E=W.startEl,O,H,M,G,J,N,T,V,F;if(P&&(M=P.record)!=W.newline&&(G=P.el)!=(E&&E.el)){G.showConnects();T=G.findConnect(S)}if(T){F=M.get(W.tableidfield)||M.get("table_id");O=T.x+T.width/2;H=T.y+T.height/2}else{O=S.getPageX()-R[0],H=S.getPageY()-R[1]}O=Math.round(O);H=Math.round(H);if(!W.newline){N=[[Q,I],[O,H]].join(" ");if(E){V=(M=E.record).get(W.tableidfield)||M.get("table_id")}W.newline=W.dataset.create({type:"zLine",config:'strokewidth:1,strokecolor:"#aaaaaa",strokeopacity:"1",titlecolor:"black",titlesize:14,titlex:0,titley:0,endarrow:"classic",points:"'+N+'",editable:true,connectable:false'+(s(V)?"":(",from:"+V))+(s(F)?"":(",to:"+F))});var K=$(W.id+"_"+W.newline.id).editors;(function(){K[K.length-1].wrap.hide()}).defer(Ext.isIE9?1:0)}else{var U=n(W.newline);N=h(U.points);N.pop();N.push([O,H]);U.points=N.join(" ");if(!F){delete U.to}else{U.to=F}W.newline.set("config",Ext.util.JSON.encode(U))}},endLine:function(G,E){var F=this;Ext.fly(e).un("mousemove",F.drawLine,F).un("mouseup",F.endLine,F);if(F.newline){var H=$(F.id+"_"+F.newline.id).editors;(function(){H[H.length-1].wrap.show()}).defer(Ext.isIE9?1:0);F.fireEvent("drawn")}delete F.drawLinePoints;delete F.newline;delete F.startEl},bind:function(G,E){var F=this;F.dataset=$(G);F.tableidfield=E||"table_id";F.processDataSetLiestener("on");F.onLoad()},onLoad:function(){var E=this;(function(F){m?F():$A.onReady(F)})(function(){E.clear();Ext.each(E.dataset.getAll().sort(function(H,G){var F=H.get("type"),I=G.get("type");if(F==I){return 0}else{if(F==="line"||F==="zLine"){return 1}else{return -1}}}),function(F){if(!F.get("type")){F.data.type="rect";F.isNew=true}E.create(F)})})},onAdd:function(G,E,F){this.create(E)},onRemove:function(H,E,F){var G=$(this.id+"_"+E.id);if(this.focusItem==G){this.focusItem=null}G.destroy()},onIndexChange:function(G,E){var F=this;(function(){F.focus($(F.id+"_"+E.id))}).defer(m&&Ext.isIE10?1:0)},onUpdate:function(G,J,E,M,I){var K=this,F=$(K.id+"_"+J.id),H=n(J),L=J.get("type");H.type=L;if(F.changeConfig(H,J)==false){J.set(E,I)}},createGElement:function(F,E){var G=new y[p(F)](Ext.apply(E||{},{type:F,root:(E&&Ext.get(E.root))||this.root,top:this.top}));this.top.cmps.push(G);return G},createElement:function(E){return this.root.appendChild(m?g(E):z(E))},remove:function(){var G=this.dataset,F=G.getCurrentRecord(),H=F.get("table_id"),E=F.get("type");if(H!==0&&H!==-1){if(E=="line"||E=="zLine"||F.isNew){G.remove()}else{$A.showConfirm("确认","确认删除选中的图形？",function(){G.remove()})}}},clear:function(){var E=this.cmps;while(E.length){E.pop().destroy()}this.focusItem=null},destroy:function(){var E=this;E.wrap.remove();if(E.proxy&&E.proxy!=E.wrap){E.proxy.remove()}$A.Graphics.superclass.destroy.call(E);E.processDataSetLiestener("un")},translate:r.methodize(),scale:r.methodize(2),rotate:r.methodize(4),setTopCmp:D,hasSVG:m});var y=function(){var F=0,G=function(Q){if(Ext.isObject(Q)){return Q}var L=[],T,K=false,O,N,R;function S(V){if(!V){L=[0,0,0,1]}else{if(V==w){L=[0,0,0,0]}else{if(V==o){L=o}else{if(/gradient/i.test(V)){K=true;var W=/^gradient\((.*)\)$/.exec(V)[1],U=/^([^stop]*),[^,]*stop/.exec(W)[1];O=/^[^,]*/.exec(U)[0];N=U.match(/[-\d%]+/g);R=function(Y){var X=[];Ext.each(Y,function(ab){var Z=/\(([^\)]*\))\)$/.exec(ab)[1],aa=/^([^,]*),(.*)$/.exec(Z);X.push([aa[1],aa[2]])});return X}(W.match(/stop\([^\)]*\)\)/mg))}else{T=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]?(?:\.[0-9]+)?)\s*\)/.exec(V);if(T){L=[c(T[1]),c(T[2]),c(T[3]),parseFloat(T[4],10)]}else{T=/^#([a-fA-F0-9]{1,2})([a-fA-F0-9]{1,2})([a-fA-F0-9]{1,2})$/.exec(V);if(T){L=[c(M(T[1]),16),c(M(T[2]),16),c(M(T[3]),16),1]}}}}}}}function M(U){return U.length==1?U+U:U}function J(V){var U=1;if(K){if(V==="gradient"){U={isGradient:K,type:O,linear:N,stops:R}}else{U=""}}else{if(V==="a"){if(!isNaN(L[3])){U=L[3]}}else{if(L&&!isNaN(L[0])){if(V==="hex"){U="#"+M(Number(L[0]).toString(16))+M(Number(L[1]).toString(16))+M(Number(L[2]).toString(16))}else{if(V==="rgb"){U="rgb("+L[0]+","+L[1]+","+L[2]+")"}else{U="rgba("+L.join(",")+")"}}}else{if(L==o){U=L}else{U=Q}}}}return U}function P(V){if(L!=o&&isNumber(V)&&V!==0){var U;for(U=0;U<3;U++){L[U]+=c(V*255);if(L[U]<0){L[U]=0}if(L[U]>255){L[U]=255}}}return this}function I(U){if(Q==w||L==o||s(U)){return this}L[3]=U;return this}S(Q);return{get:J,brighten:P,setOpacity:I}},E=function(P,J,N,I,M){var Q=J-I,O=N-M,K=P*3/2;if(Q==0){N+=O>0?-K:K}else{if(O==0){J+=Q>0?-K:K}else{var L=Math.sqrt(Q*Q+O*O);J=(L-K)/L*Q+I;N=(L-K)/L*O+M}}return{x:J,y:N}},H=function(){var I={};return function(J,T){J=J||this.d;if(I[J]){return I[J]}T=T||this.zoom||10000;var Q=J.match(/\w|[\s\d-+.,e]*/g),S=[0,0],R=[0,0],U=[],O=function(aa,ab){var V=Ext.isArray(aa)?aa:aa.match(f);for(var Z=0,W=V.length;Z<W;Z++){var Y=R[0]+L(V[Z]),X=R[1]+L(V[++Z]);if(!ab||Z/2%3==2){R[0]=Y;R[1]=X}U=U.concat([Y,X])}},N=function(ak,ai){var ab=ak.match(f);while(ab.length&&ab.length%7==0){var X=L(ab.shift()),W=L(ab.shift()),aa=Number(ab.shift()),Y=Number(ab.shift()),af=Number(ab.shift()),ae=L(ab.shift()),ad=L(ab.shift()),Z,ah,V,ac;if(ai){ae+=R[0];ad+=R[1]}var aj=Math.abs(ae-R[0]),ag=Math.abs(ad-R[1]);X=aj;W=ag;U.push(af?"wa":"at");if((af^Y)^ae<R[0]){if(ad<R[1]){Z=R[0];ah=R[1]-W}else{Z=R[0]-X;ah=R[1]}}else{if(ad<R[1]){Z=R[0]-X;ah=R[1]-(W<<1)}else{Z=R[0]-(X<<1);ah=R[1]-W}}V=Z+(X<<1);ac=ah+(W<<1);U.push(Z,ah,V,ac,R[0],R[1],ae,ad);R=[ae,ad]}},M=function(W){var V=W.match(f).slice(-2);return[L(V[0]),L(V[1])]},L=function(V){return Number(Number(V*T).toFixed(0))},K=function(Y){for(var X=0,W=Y.match(f),V=W.length;X<V;X++){U.push(L(W[X]))}};for(var P=0;P<Q.length;P++){switch(Q[P]){case"M":S=M(Q[P+1]);case"C":case"L":R=M(Q[P+1]);U.push(Q[P]);K(Q[++P]);break;case"m":U.push("M");O(Q[++P]);S=[].concat(R);break;case"c":U.push("C");O(Q[++P],true);break;case"l":U.push("L");O(Q[++P]);break;case"h":U.push("L");O(Q[++P]+" 0");break;case"v":U.push("L");O("0 "+Q[++P]);break;case"H":U.push("L");R[0]=L(Q[++P]);U.push(R[0],R[1]);break;case"V":U.push("L");R[1]=L(Q[++P]);U.push(R[0],R[1]);break;case"A":N(Q[++P]);break;case"a":N(Q[++P],true);break;case"Z":case"z":U.push("X");R=[].concat(S);break}}U.push("E");I[J]=U.join(" ");return I[J]}}();return{Path:Ext.extend($A.Graphics,{zoom:10000,constructor:function(I){var J=this;J.lineEditors=[];J.editors=[];return y.Path.superclass.constructor.call(J,I)},initComponent:function(I){I.fillcolor=G(I.fillcolor).setOpacity(I.fillopacity);I.fillopacity=I.fillcolor.get("a");I.strokecolor=G(I.strokecolor).setOpacity(I.strokeopacity);I.strokeopacity=I.strokecolor.get("a");y.Path.superclass.initComponent.call(this,I);var J=this,K=J.title;if(m){if(K){J.initSVGTitle()}J.initSVGInfo();if(J.shadow){J.initSVGShadow()}}else{if(K){J.initVMLTitle()}J.initVMLInfo()}},initSVGWrap:function(){this.wrap=this.root.appendChild(g("g",this.id))},initVMLWrap:function(){this.wrap=this.root.appendChild(z("v:group",this.id))},initSVGElement:function(){var Y=this,K=Y.parent,N=Y.wrap,V=Y.d,X={d:V,fill:Y.createGradient(Y.fillcolor.get("gradient"))},Z=Y.fillcolor.get(),M=Y.strokecolor.get("hex"),J=Y.strokewidth,I=Y.strokeopacity,U=Y.startarrow,S=Y.endarrow,T=(Y.el=g("path",Y.id+"_el")).dom.style,O=Y.x,L=Y.y;if(O||L){if(J&&J%2==1&&!Y.shadow){O+=0.5;L+=0.5}if(K){O-=K.x;L-=K.y}r(N,O,L)}T.cssText=q({fill:Z,"fill-opacity":Y.fillopacity,stroke:M,"stroke-width":J,"stroke-opacity":J?I:0,cursor:Y.cursor||"pointer"})+Y.style;if(J){if(!T.stroke){M=T.stroke="#000";I=T.strokeOpacity=0}if(U||S){var W=V.match(f),R=W.length,P="-"+M+"-"+I*100;if(U){X["marker-start"]="url(#start-arrow-"+U+P+")";var Q=E(J,Number(W[0]),Number(W[1]),Number(W[2]),Number(W[3]));W[0]=Q.x;W[1]=Q.y;X.d=X.d.replace(/[\d-+.]+\s+[\d-+.]+/,Q.x+" "+Q.y)}if(S){X["marker-end"]="url(#end-arrow-"+S+P+")";var Q=E(J,Number(W[R-2]),Number(W[R-1]),Number(W[R-4]),Number(W[R-3]));X.d=X.d.replace(/([\d-+.]+\s+[\d-+.]+)[^\d]*$/,Q.x+" "+Q.y)}new y.Arrow({color:M,width:J,opacity:I,endarrow:S,startarrow:U,root:Y.root})}}N.insertFirst(Y.el.set(X))},initVMLElement:function(){var K=this,J=K.fillcolor.get("rgb"),I=K.strokecolor.get("rgb"),O=true,P=true,R=true,Q=K.zoom,N=K.parent,M=K.x,L=K.y;if(N){M-=N.x;L-=N.y}if(s(K.strokewidth)){K.strokewidth=1}if(I==o||K.strokeopacity==0||K.strokewidth==0){O=false}if(J==o){P=false}K.wrap.setStyle({position:"absolute",width:100+k,height:100+k,left:(M||0)+k,top:(L||0)+k}).set({coordsize:"100,100",title:K.info||""});K.el=new Ext.Template(K.getVmlTpl(O,P,K.shadow)).insertFirst(K.wrap.dom,Ext.apply({id:K.id+"_el",style:K.style,path:K.path||H.call(K),zoom:Q,fillColor:J,fillOpacity:K.fillopacity,strokeColor:I,strokeWidth:K.strokewidth,strokeOpacity:K.strokeopacity,endArrow:K.endarrow,startArrow:K.startarrow,cursor:K.cursor||"pointer"},K.createGradient(K.fillcolor.get("gradient"))),true)},createGradient:m?function(K){if(!K.isGradient){return o}var M="graphics-gradient"+F++,J=K.linear,I=this.root,L=(I.child("defs")||I.insertFirst(g("defs"))).appendChild(g(K.type+p("gradient"),M).set({x1:J[0],y1:J[1],x2:J[2],y2:J[3],gradientUnits:"userSpaceOnUse"}));Ext.each(K.stops,function(O){var N=G(O[1]);L.appendChild(g("stop").set({offset:O[0],"stop-color":N.get("rgb"),"stop-opacity":N.get("a")}))});return"url("+location.href+"#"+M+")"}:function(L){if(!L.isGradient){return{}}var N=L.type=="linear"?"gradient":"",K=L.linear,O=this.top,M=O.width,I=O.height,J=[];Ext.each(K,function(Q,P){if(/\%/.test(Q)){Q=c(Q)/100;K[P]=(P%2==0?M:I)*Q}});Ext.each(L.stops,function(P){J.push(P[0]," ",G(P[1]).get("rgb"),";")});return{type:N,angle:Math.atan((K[2]-K[0])/(K[3]-K[1]))/(A/180)+180,colors:J.join(""),fillOpacity:1}},initSVGShadow:function(){var L="graphics-filter-shadow";if(!Ext.get(L)){var I=this.root,J=(I.child("defs")||I.insertFirst(g("defs"))).appendChild(g("filter",L).set({x:-0.25,y:-0.25,width:1.5,height:1.5,"color-interpolation-filters":"sRGB"}));J.appendChild(g("feGaussianBlur").set({result:"blur",stdDeviation:1,"in":"SourceAlpha"}));J.appendChild(g("feColorMatrix").set({values:"1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.6 0 ",type:"matrix",result:"bluralpha"}));J.appendChild(g("feOffset").set({result:"offsetBlur",dx:5,dy:5,"in":"bluralpha"}));var K=J.appendChild(g("feMerge"));K.appendChild(g("feMergeNode").set({"in":"offsetBlur"}));K.appendChild(g("feMergeNode").set({"in":"SourceGraphic"}))}this.el.setStyle({filter:"url(#"+L+")"})},initSVGTitle:function(){var I=this;I.text=y.Text.prototype.initSVGElement.call({text:I.title,id:I.id+"_title",size:I.titlesize||14,dx:I.titlex||0,dy:I.titley||0,color:I.titlecolor,fontfamily:I.titlefontfamily,rotation:I.titlerotation,wrap:I.wrap,style:"cursor:pointer;-webkit-user-select:none"})},initVMLTitle:function(){var M=this,I=M.titlex||0,N=M.titley||0,L=M.titlesize||14,J=M.wrap;if(M.type=="line"||M.type=="path"){I+=M.x;N+=M.y;J=M.top.wrap}else{var K=M.strokewidth;I+=K/2;N+=K/2}M.text=y.Text.prototype.initVMLElement.call({text:M.title,id:M.id+"_title",size:L,dx:I,dy:N,color:M.titlecolor,fontfamily:M.titlefontfamily,rotation:M.titlerotation,wrap:J,positionwrap:M,vmlTpl:y.Text.prototype.vmlTpl})},initSVGInfo:function(){var I=this,J=I.info;if(J){if(!I.infoEl){I.wrap.appendChild(I.infoEl=g("title"))}I.infoEl.dom.textContent=J}else{if(I.infoEl){I.infoEl.remove();I.infoEl=null}}},initVMLInfo:function(){this.wrap.set({title:this.info||""})},createEditors:function(){var N=this,P=N.top;if(P.editable){var M=[].concat(N.points);switch(N.type){case"line":Ext.each(M,function(Q){N.createEditor(Q)});break;case"zLine":var J=M.shift(),L=M.pop();N.createEditor(J);N.createEditor(L);for(var K=0,I=M.length;K<I;K++){var O=M[K+1];if(O){N.createEditor(M[K],O)}}}N.bindEditor(N.from,true);N.bindEditor(N.to)}},bindEditor:function(O,I){if(!s(O)){var N=this.editors,L=this.top;tr=L.dataset.find(L.tableidfield,O);if(tr){var K=$(L.id+"_"+tr.id);if(K){var J=N[I?0:N.length-1],M=K.findNearlyConnect([J.x,J.y]);J.bindEl=M;M.lineEditors.push(J);J.addConfig({fillcolor:"rgb(255,0,0)",fillopacity:"0.9"})}}}},clearBindEditor:function(){Ext.each(this.editors,function(I){var K=I.bindEl;if(K){var J=K.lineEditors;J.splice(J.indexOf(I),1);delete I.bindEl;I.addConfig({fillcolor:"rgb(0,0,0)",fillopacity:"0"})}})},syncLineEditors:function(I,J){Ext.each(this.lineEditors,function(K){K.moveTo(I,J);K.fireEvent("move")})},syncEditors:function(){var R=this;if(R.editors.length&&R.points){var O=0,L=R.editors,K=[].concat(R.points);R.clearBindEditor();if(R.type=="zLine"){var Q=L[0],V=Q.width/2,P=Q.height/2,J=K.shift(),S=K.pop(),N=R.zEditors;Q.moveTo(J[0]-V,J[1]-P);L[1].moveTo(S[0]-V,S[1]-P);for(;K[O+1];O++){var I=N[O],U=K[O],T=K[O+1],X,W;if(I){if(T[0]==U[0]){I.movedir="h";X=U[0];W=(U[1]+T[1])/2}else{if(T[1]==U[1]){I.movedir="v";X=(U[0]+T[0])/2;W=U[1]}}I.moveTo(X-I.width/2,W-I.height/2)}else{R.createEditor(U,T)}}while(N.length>O){var Q=N.pop();Q.un("move",R.editorMove,R);Q.destroy()}}else{for(var M=K.length;O<M;O++){var Q=L[O],U=K[O];if(Q){var X=U[0]-Q.width/2,W=U[1]-Q.height/2;Q.moveTo(X,W)}else{R.createEditor(U)}}while(L.length>O){var Q=L.pop();Q.un("move",R.editorMove,R);Q.destroy()}}!Ext.isEmpty(R.to)&&R.bindEditor(R.to);!Ext.isEmpty(R.from)&&R.bindEditor(R.from,true)}},createEditor:function(Q,R){var N=this,I=N.editors,J=N.zEditors,L=N.getRecord(),K=I.length+J.length,M,O="Oval",T,S=Q[0],P=Q[1];if(R){O="Diamond";if(R[0]==S){P=(R[1]+P)/2;T="h"}else{if(R[1]==P){S=(R[0]+S)/2;T="v"}}}M=new y[O]({type:"oval",connectable:false,id:N.id+"_editor"+K,x:S-5,y:P-5,height:10,width:10,strokewidth:1,strokecolor:"rgba(0,0,0,1)",fillcolor:w,root:N.wrap,parent:N,top:N.top,moveable:true,movedir:T});if(R){J.push(M)}else{I.push(M);if(K==0){M.isFrom=true}M.on("mousedown",N.editorDown,N)}M.on("move",N.editorMove,N);if(L!=N.top.dataset.getCurrentRecord()){(function(){M.wrap.hide()}).defer(Ext.isIE9?1:0)}},showEditors:function(){Ext.each(this.editors.concat(this.zEditors||[]),function(I){I.wrap.show()})},hideEditors:function(){Ext.each(this.editors.concat(this.zEditors||[]),function(I){I.wrap.hide()})},clearEditors:function(){var I=this;Ext.each(I.editors.concat(I.zEditors||[]),function(J){var K=J.bindEl;if(K&&K.lineEditors){K.lineEditors.remove(J)}J.un("move",I.editorMove,I);J.destroy()});I.editors=[];I.zEditors=[]},createConnects:function(){var K=this,M=K.top;if(M.editable){K.connects=[];var I=K.height,O=K.width,N=K.x,L=K.y,Q=K.strokewidth/2,P=Q,J=Q;K.createConnect(N+O/2,L-J,1);K.createConnect(N+O+P,L+I/2,2);K.createConnect(N+O/2,L+I+J,3);K.createConnect(N-P,L+I/2,4)}},createConnect:function(I,N,J){var L=this,M=L.connects,K=M.length;M[K]=new y.Rect({type:"rect",connectable:false,id:L.id+"_connect"+K,x:I-4,y:N-4,height:8,width:8,strokewidth:1,strokecolor:"rgba(0,0,0,1)",fillcolor:"rgba(255,0,0,0.8)",parent:L,root:L.wrap,top:L.top,dir:J})},showConnects:function(){Ext.each(this.connects,function(I){I.wrap.show()})},hideConnects:function(){Ext.each(this.connects,function(I){I.wrap.hide()})},clearConnects:function(){var I=this;Ext.each(I.connects,function(J){J.destroy()});I.connects=null},findConnect:function(N){var L=this,M=N.xy,J=L.top.wrap.getXY(),I=M[0]-J[0],P=M[1]-J[1],O=Math.pow(Math.min(L.height/3,L.width/3),2),K=null;Ext.each(L.connects,function(S){var R=I-S.x,Q=P-S.y;if(R*R+Q*Q<O){K=S;return false}});return K},findNearlyConnect:function(J){var I,K=Number.MAX_VALUE;Ext.each(this.connects,function(O){var N=O.x-J[0],M=O.y-J[1],L=N*N+M*M;if(L<K){K=L;I=O}});return I},syncConnects:function(Q,P,I,M){var L=this,K=L.connects,O,N,J;if(!I&&!M){Ext.each(K,function(R){R.moveTo(O=R.x+Q,N=R.y+P);R.syncLineEditors(O,N)})}else{(J=L.connects[0]).moveTo(O=J.x+Q+I/2,N=J.y+P);J.syncLineEditors(O,N);(J=L.connects[1]).moveTo(O=J.x+Q+I,N=J.y+P+M/2);J.syncLineEditors(O,N);(J=L.connects[2]).moveTo(O=J.x+Q+I/2,N=J.y+P+M);J.syncLineEditors(O,N);(J=L.connects[3]).moveTo(O=J.x+Q,N=J.y+P+M/2);J.syncLineEditors(O,N)}},editorDown:function(K){var J=this,L=K.target.id,I=J.currentEditor=$(L.substring(0,L.indexOf("_el")));I.hide();J.top.editing=true;I.on("mouseup",J.editorUp,J)},editorMove:function(K,L,Q,V,U){var T=this,Q=T.getRecord(),M=n(Q),X=[],J=T.editors,N=K&&K.movedir,O=T.zEditors;if(N&&O&&O.length){X=T.points;var S=O.indexOf(K),Y=X[S+1],W=X[S+2],P=K.height/2,V=K.x+K.width/2,U=K.y+K.height/2,I,R;if(N=="v"){Y[1]=W[1]=U}else{Y[0]=W[0]=V}if(R=O[S-1]){I=X[S];if(I[0]==Y[0]){R.moveTo(I[0]-R.width/2,(I[1]+Y[1])/2-R.height/2)}else{R.moveTo((I[0]+Y[0])/2-R.width/2,I[1]-R.height/2)}}if(R=O[S+1]){I=X[S+3];if(I[0]==W[0]){R.moveTo(I[0]-R.width/2,(I[1]+W[1])/2-R.height/2)}else{R.moveTo((I[0]+W[0])/2-R.width/2,I[1]-R.height/2)}}M.generate=false}else{Ext.each(J,function(Z){X.push([Z.x+Z.width/2,Z.y+Z.height/2])})}M.points=X.join(" ");Q.set("config",Ext.util.JSON.encode(M))},editorUp:function(){var J=this,I=J.currentEditor;I.show();I.un("mouseup",J.editorUp,J);J.top.editing=false;delete J.currentEditor},onMouseDown:function(L,I){var J=this,K=J.top;J.fire("mousedown",L,I);if(K.editable&&!K.candrawline){D(J.wrap);if(J.dropto||J.moveable){J.beforeMove(L)}}},onMouseMove:function(af,T){af.stopEvent&&af.stopEvent();var am=this,P=am.wrap,W=am.top,R=am.width||am.rx*2,ac=am.height||am.ry*2,N=am.parent,U=W.wrap,Y=U.getWidth(),ak=U.getHeight(),M=am.strokewidth||0,ae=U.getXY(),al=af.x||(af.getPageX()+am.relativeX-ae[0]),ai=af.y||(af.getPageY()+am.relativeY-ae[1]),Q=am.x,O=am.y,ab,aa,ag,S,ah=0,L=am.type,Z=ah,J=ah;if(W.editing){var ad=am.getGElement(T),I,V;if(ad){(I=ad.el).showConnects();if(!am.movedir){ag=I.findConnect(af)}}}if(ag){S=(V=ad.record).get(am.tableidfield)||V.get("table_id");ab=am.x=ag.x;aa=am.y=ag.y;al=ab+Z;ai=aa+Z}else{if(M&&d(P)){Z=J=ah=-M/2}if(al<=Z){al=Z}else{if(al+R-Z>Y-2){al=Y-2-R+Z}}if(ai<=J){ai=J}else{if(ai+ac-J>ak-2){ai=ak-2-ac+J}}ab=am.x=Math.round(al-Z);aa=am.y=Math.round(ai-J)}if(am.moveable){var X=W.dataset,K=X.getCurrentRecord(),aj=n(K);aj.x=ab;aj.y=aa;if(!am.movedir){if(!Ext.isEmpty(S)){aj[am.isFrom?"from":"to"]=S}else{delete aj[am.isFrom?"from":"to"]}}W.syncFocusMask(aj);K.data.config=Ext.util.JSON.encode(aj).replace(/^{|}$/g,"");K.dirty=true;am.fireEvent("move",am,X,K,ab-Z,aa-J);W.fireEvent("move",am,X,K,ab-Z,aa-J)}if(t(P)){if(M%2==1&&!am.shadow){al+=0.5;ai+=0.5}if(N){al-=N.x;ai-=N.y}if(am.movedir=="h"){ai=null}else{if(am.movedir=="v"){al=null}}r(am.proxy,al,ai)}else{if(am.connectable!=false){al-=3;ai-=3}if(am.movedir&&N){al-=N.x;ai-=N.y}if(am.movedir=="v"){am.proxy.setStyle("top",ai+"px")}else{if(am.movedir=="h"){am.proxy.setStyle("left",al+"px")}else{am.proxy.moveTo(al+ae[0],ai+ae[1])}}}am.syncConnects(ab-Q,aa-O)},onMouseOver:function(L,I){var J=this,K=J.top;if((K.candrawline||K.editing)&&J.connectable!=false){J.showConnects()}},onMouseOut:function(K){var I=this,J=I.top;if(I.connectable!=false){I.hideConnects()}},getRecord:function(){var I=this.id.match(/(.*)_(\d+)(_.*)*$/),J=this.top.dataset;if(I&&J){return J.findById(I[2])}},destroy:function(){var J=this,I=J.focusMask,K=J.text;J.clearEditors();J.clearConnects();Ext.each(J.lineEditors,function(L){delete L.bindEl;L.addConfig({fillcolor:"rgb(0,0,0)",fillopacity:"0"})});I&&I.remove();K&&K.remove&&K.remove();y.Path.superclass.destroy.call(J)},getVmlTpl:function(J,K,L){var I=['<v:shape id="{id}" filled="',K,'" stroked="',J,'" coordsize="{zoom},{zoom}" style="position:absolute;left:0;top:0;width:1px;height:1px;cursor:{cursor};{style}" path="{path}">'];if(K){I.push(B)}if(J){I.push(j)}if(L){I.push(i)}I.push("</v:shape>");return I},addConfig:function(I){this.changeConfig(Ext.apply(this.initConfig,I))},changeConfig:function(J,L){var I=this,M=I.top,P=J.type,N=y[P=="image"?"Image":"Path"].prototype,U=y[p(P)].processConfig,R=I.x,Q=I.y,S=I.width,K=I.height;J.top=I.top;if(P=="zLine"){if(J.generate!=false){y.ZLine.generate(J)}if(L){var O=n(L);delete O.generate;if(Ext.isArray(J.points)){O.points=J.points.join(" ")}L.data.config=Ext.util.JSON.encode(O).replace(/^{|}$/g,"");L.dirty=true}}if(U&&U(J)==false){return false}for(var T in I.initConfig){if(T!="dataset"&&T!="top"&&T!="root"&&T!="id"){if(!(T in J)){delete I[T]}}}Ext.apply(I,J);I.initConfig=J;I.processListener("un");I.el.remove();if(I.text){I.text.remove()}if(m){I.initSVGElement=N.initSVGElement}else{I.initVMLElement=N.initVMLElement;I.vmlTpl=N.vmlTpl}I.initComponent(J);I.syncConnects(I.x-R,I.y-Q,I.width-S,I.height-K);I.syncEditors();if(I==M.focusItem&&M.focusMask){M.syncFocusMask(I)}I.processListener("on")}}),Group:Ext.extend($A.Graphics,{initSVGWrap:function(){this.wrap=this.root.appendChild(g("g",this.id))},initVMLWrap:function(){this.wrap=this.root.appendChild(z("v:group",this.id).setStyle({position:"absolute",width:100+k,height:100+k}).set({coordsize:"100,100"}))},initSVGElement:function(){},initVMLElement:function(){}}),Line:function(){function I(K){if(y.Line.processConfig(K)==false){return}var J=new y.Path(K);J.createEditors();return J}I.processConfig=function(K){var L=h(K.points);if(L.length<2){return false}var J=Number(L[0][0]),M=Number(L[0][1]);a=["M",0,0,"L"];Ext.each(L,function(N){a.push(N[0]-J,N[1]-M)});K.d=a.join(" ");if(K.strokewidth==1){K.strokewidth=2}K.fillcolor=o;K.points=L;K.x=J;K.y=M};return I}(),ZLine:function(){var O=Array.prototype.push,M=25;function K(Q,P){return Q>P}function I(Q,P){return Q<P}function L(P,R,Q){return !s(P)&&(Q=R.dataset.find(R.tableidfield,P))&&$(R.id+"_"+Q.id)}function J(Q,P,R){if(R){return[Q[0],P[1]]}else{return[P[0],Q[1]]}}function N(R,Y,Q,ad){if(!R){return}var ab=R.findNearlyConnect(ad?Y:Q);if(!ab){return}var V=R.x,U=R.y,W=R.width,ae=R.height,ag=ad?Y[0]:Q[0],T=ad?Y[1]:Q[1],af=ad?Q[0]:Y[0],S=ad?Q[1]:Y[1],Z=ab.dir,aa=ad?"push":"unshift",ac=[Y],ai,aj,P,ak=K,X,ah;if((P=Z==1)||Z==3){if(P){X=V+W;l=V;ah=U+ae;aj=M}else{ak=I;aj=-M;W=-W;X=V;l=V-W;ah=U}ai=aj*2;if(ak(T-S,ai)){ac[aa]([ag,(T+S)/2],[af,(T+S)/2])}else{if(ak(T,S)){ac[aa]([ag,S])}else{if(ak(af-X,ai)){ac[aa]([ag,T-aj],[(X+af)/2,T-aj],[(X+af)/2,S])}else{if(ak(-ai,af-l)){ac[aa]([ag,T-aj],[(l+af)/2,T-aj],[(l+af)/2,S])}else{if(ak(af,X)||ak(X-W,af)){ac[aa]([ag,T-aj],[af,T-aj])}else{ac[aa]([ag,T-aj],[X+aj,T-aj],[X+aj,(ah+S)/2],[af,(ah+S)/2])}}}}}}else{P=Z==2;if(P){X=U+ae;l=U;ah=V;aj=M}else{ak=I;aj=-M;ae=-ae;X=U;l=U-ae;ah=V+W}ai=aj*2;if(ak(af-ag,ai)){ac[aa]([(ag+af)/2,T],[(ag+af)/2,S])}else{if(ak(af,ag)){ac[aa]([af,T])}else{if(ak(S-X,ai)){ac[aa]([ag+aj,T],[ag+aj,(X+S)/2],[af,(X+S)/2])}else{if(ak(-ai,S-l)){ac[aa]([ag+aj,T],[ag+aj,(l+S)/2],[af,(l+S)/2])}else{if(ak(S,X)||ak(X-ae,S)){ac[aa]([ag+aj,T],[ag+aj,S])}else{ac[aa]([ag+aj,T],[ag+aj,X+aj],[(ah+af)/2,X+aj],[(ah+af)/2,S])}}}}}}ac[aa](Q);if(aa=="unshift"){ac.reverse()}ac.dir=Z;return ac}return Ext.apply(function(Q){if(y.ZLine.processConfig(Q)==false){return}var P=new y.Path(Q);P.zEditors=[];P.createEditors();return P},{processConfig:function(Q){var R=h(Q.points);if(R.length<2){return false}var P=R[0][0],S=R[0][1];a=["M",0,0,"L"];Ext.each(R,function(T){a.push(T[0]-P,T[1]-S)});Q.d=a.join(" ");if(Q.strokewidth==1){Q.strokewidth=2}Q.fillcolor=o;Q.points=R;Q.x=P;Q.y=S},generate:function(aw){var ak=aw.top,aq=h(aw.points),ap=aw.from,Y=aw.to,am=aq[0],T=aq.pop(),at=am[0],aa=am[1],ar=T[0],Z=T[1],ao,ag;if(!ap&&!Y){if(Math.abs(ar-at)<Math.abs(Z-aa)){aq=[am,[at,(aa+Z)/2],[ar,(aa+Z)/2],T]}else{aq=[am,[(at+ar)/2,aa],[(at+ar)/2,Z],T]}}else{ao=N(ap=L(ap,ak),am,T,true);ag=N(Y=L(Y,ak),am,T);if(ao&&ag){ao.pop();ag.shift();var X=ao.length,au=ag.length,U=ao.dir,P=ag.dir,ai=ap.x,ah=ap.y,aj=ap.width,av=ap.height,S=Y.x,R=Y.y,W=Y.width,af=Y.height,ae=U==1||U==3,Q=X>au,V=(P-U+4)%4,ad=am[0]>T[0],ac=am[1]>T[1],al=[],an;if(V==0){switch(X*au){case 16:ao.splice(2,2);ag.splice(0,2);break;case 15:if(Q){ag.splice(0,2)}else{ao.splice(1,2)}break;case 12:ao.splice(2,2);ag.splice(0,2);al.push(J(ag[0],ao[ao.length-1],!ae^Q));break;case 9:if(ae?(U==1?!ac:ac):(U==2?ad:!ad)){ag.splice(0,2)}else{ao.splice(1,2)}break;case 8:if(Q){ao.splice(2,2);ag.splice(0,1)}else{ao.splice(1,1);ag.splice(0,2)}al.push(J(ag[0],ao[ao.length-1],!ae^Q))}}else{if(V==2){switch(X*au){case 25:case 15:case 12:ao.splice(2,X-2);ag.splice(0,au-2);if(ae){if(ad){an=Math.max(ai+aj,S+W)+M}else{an=Math.min(ai,S)-M}}else{if(ac){an=Math.max(ah+av,R+af)+M}else{an=Math.min(ah,R)-M}}al.push(J([an,an],ao[ao.length-1],ae),J(ag[0],[an,an],!ae));break;case 16:ao.splice(2,2);ag.splice(0,2);if(ae){if(ad){an=(S+W+ai)/2}else{an=(ai+aj+S)/2}}else{if(ac){an=(R+af+ah)/2}else{an=(ah+av+R)/2}}al.push(J([an,an],ao[ao.length-1],ae),J(ag[0],[an,an],!ae));break;case 9:ao.splice(2,1);ag.splice(0,1);if(ae?ac^U==1:!ad^U==2){if(ae){if(ad){an=Math.max(ai+aj,S+W)+M}else{an=Math.min(ai,S)-M}}else{if(ac){an=Math.max(ah+av,R+af)+M}else{an=Math.min(ah,R)-M}}al.push(J([an,an],ao[ao.length-1],ae),J(ag[0],[an,an],!ae))}break;case 4:ao.splice(1,1);ag.splice(0,1);if(ae){an=(ao[ao.length-1][1]+ag[0][1])/2}else{an=(ao[ao.length-1][0]+ag[0][0])/2}al.push(J([an,an],ao[ao.length-1],!ae),J(ag[0],[an,an],ae))}}else{var ab=V==3;switch(X*au){case 25:if(ab){ao.splice(1,4);ag.splice(0,2)}else{ao.splice(3,2);ag.splice(0,4)}al.push(J(ag[0],ao[ao.length-1],!ae));break;case 10:case 20:if(ab^Q){if(ab){ao.splice(1,X-1);ag.splice(0,2)}else{ao.splice(3,2);ag.splice(0,au-1)}al.push(J(ag[0],ao[ao.length-1],!ae))}else{if(ab){ao.splice(2,3);ag.splice(0,au-1);if(U==1){an=ai-M}else{if(U==2){an=ah-M}else{if(U==3){an=ai+aj+M}else{an=ah+av+M}}}}else{ao.splice(1,X-1);ag.splice(0,3);if(U==1){an=R-M}else{if(U==2){an=S+W+M}else{if(U==3){an=R+af+M}else{an=S-M}}}}al.push(J([an,an],ao[ao.length-1],ab^!ae),J(ag[0],[an,an],ab^ae))}break;case 16:ao.splice(2,2);ag.splice(0,2);al.push(J(ag[0],ao[ao.length-1],ae));break;case 15:if(ab){if(Q){ao.splice(2,3);ag.splice(0,1)}else{ao.splice(2,2);ag.splice(0,2)}}else{if(Q){ao.splice(3,2);ag.splice(0,2)}else{ao.splice(2,1);ag.splice(0,3)}}al.push(J(ag[0],ao[ao.length-1],ab^(ae^Q)));break;case 12:if(Q){if(ae?ab^(ad^(U==1)):ab^(ac^(U==2))){ao.splice(2,2);ag.splice(0,1);al.push(J(ag[0],ao[ao.length-1],ae))}else{ag.splice(0,2)}}else{if(ae?ac^U==1:!ad^U==2){ao.splice(2,1);ag.splice(0,2);al.push(J(ag[0],ao[ao.length-1],ae))}else{ao.splice(1,2)}}break;case 9:if(ae^(ab^(ad^ac))){ao.splice(1,2);ag.splice(0,2);al.push(J(ag[0],ao[ao.length-1],ae?U==1^(ab^ad):U==2^ad))}else{if(ae?U==1^(ab^ad):U==2^ad){ao.splice(1,2);ag.splice(0,1);if(ae){if(ab^ad){an=(R+ao[0][1])/2}else{an=(R+af+ao[0][1])/2}}else{if(ad){an=(S+W+ao[0][0])/2}else{an=(S+ao[0][0])/2}}al.push(J([an,an],ao[ao.length-1],!ae),J(ag[0],[an,an],ae))}else{ao.splice(2,1);ag.splice(0,2);if(ae){if(ad){an=(ai+ag[0][0])/2}else{an=(ai+aj+ag[0][0])/2}}else{if(ab^ad){an=(ah+ag[0][1])/2}else{an=(ah+av+ag[0][1])/2}}al.push(J([an,an],ao[ao.length-1],ae),J(ag[0],[an,an],!ae))}}break;case 6:if(Q){if(ae?!ac^U==1:ad^U==2){ao.splice(1,2)}else{ao.splice(2,1);ag.splice(0,1);if(ab){if(U==1){an=(ag[0][0]+ai+aj)/2}else{if(U==2){an=(ag[0][1]+ah+av)/2}else{if(U==3){an=(ag[0][0]+ai)/2}else{an=(ag[0][1]+ah)/2}}}}else{if(U==1){an=(ag[0][0]+ai)/2}else{if(U==2){an=(ag[0][1]+ah)/2}else{if(U==3){an=(ag[0][0]+ai+aj)/2}else{an=(ag[0][1]+ah+av)/2}}}}al.push(J([an,an],ao[ao.length-1],ae),J(ag[0],[an,an],!ae))}}else{if(ae?ab^(!ad^U==1):ab^(!ac^U==2)){ag.splice(0,2)}else{ao.splice(1,1);ag.splice(0,1);if(U==1){an=(ao[0][1]+R+af)/2}else{if(U==2){an=(ao[0][0]+S)/2}else{if(U==3){an=(ao[0][1]+R)/2}else{an=(ao[0][0]+S+W)/2}}}al.push(J([an,an],ao[ao.length-1],!ae),J(ag[0],[an,an],ae))}}}}}al.length&&O.apply(ao,al);aq=ao.concat(ag)}else{if(ao){aq=ao}else{aq=ag}}}aw.points=aq}})}(),Oval:Ext.apply(function(I){y.Oval.processConfig(I);var J=new y.Path(I);if(I.connectable!=false){J.createConnects();(function(){J.hideConnects()}).defer(Ext.isIE9?1:0)}return J},{processConfig:function(I){I.height=I.height||I.ry*2;I.width=I.width||I.rx*2;I.ry=I.height/2;I.rx=I.width/2;y.Rect.processConfig(I)}}),Arc:function(I){function J(){J.processConfig(I);new y.Path(I)}J.processConfig=m?function(W){var U=W.x,T=W.y,M=W.start%(2*A),R=W.r,N=W.end%(2*A)-0.000001,S=W.innerR||0,P=W.open,Q=C(M),K=x(M),L=C(N),V=x(N),O=(N>M?N:N+2*A)-M<A?0:1;W.d=["M",U+R*Q,T-R*K,"A",R,R,0,O,0,U+R*L,T-R*V,P?"M":"L",U+S*L,T-S*V,"A",S,S,0,O,1,U+S*Q,T-S*K,P?"":"Z"].join(" ");W.x=0;W.y=0}:function(Y){var W=Y.zoom||10000,U=Y.x*W,T=Y.y*W,M=Y.start,N=Y.end,Q=Y.r*W,P=C(M),K=x(M),L=C(N),V=x(N),S=(Y.innerR||0)*W,X=0.08/Q,O=(S&&0.1/S)||0,R;if(N-M===0){return["x"]}R=["at",c(-Q),c(-Q),c(Q),c(Q),c(Q*P),c(-Q*K),c(Q*L),c(-Q*V)];if(S){R.push("wa",c(-S),c(-S),c(S),c(S),c(S*L),c(-S*V),c(S*P),c(-S*K))}R.push("x","e");Y.path=R.join(" ")};return J}(),Rect:function(){function I(J){I.processConfig(J);var K=new y.Path(J);if(J.connectable!=false){K.createConnects();K.hideConnects()}return K}I.processConfig=function(N){var O=Number(N.height)||200,Q=Number(N.width)||200,K=Math.min(Number(N.rx)||0,Q/2),J=Math.min(Number(N.ry)||0,O/2),R=K>0&&J>0,M=K!=Q/2,L=J!=O/2,P=["M",0,R?J:0];if(R){P.push("A",K,J,0,0,1,K,0)}if(M){P.push("H",Q-(R?K:0))}if(R){P.push("A",K,J,0,0,1,Q,J)}if(L){P.push("V",O-(R?J:0))}if(R){P.push("A",K,J,0,0,1,Q-K,O)}if(M){P.push("H",R?K:0)}if(R){P.push("A",K,J,0,0,1,0,O-J)}if(L){P.push("Z")}N.d=P.join(" ")};return I}(),Diamond:function(){function I(J){I.processConfig(J);var K=new y.Path(J);if(J.connectable!=false){K.createConnects();K.hideConnects()}return K}I.processConfig=function(K){var L=Number(K.height)||100,J=Number(K.width)||200,M=["M",0,L/2,"L",J/2,0,J,L/2,J/2,L,"Z"];K.d=M.join(" ")};return I}(),Arrow:function(){var I,L,P,N,O={viewBox:"0 0 100 100",refX:50,refY:50,orient:"auto"},J="start-arrow-",M="end-arrow-",K="M 100 0 L 0 50 L 100 100 L 66.66 50 z",R="M 0 0 L 100 50 L 0 100 L 33.33 50 z",Q=function(U,T){if(U){var S=(T?J:M)+U+I;Ext.get(S)||new y.Path({fillcolor:L,fillopacity:P,d:T?K:R,root:N.appendChild(g("marker",S).set(O))})}};return function(T){if(!T.startarrow&&!T.endarrow){return}var S=T.root;N=S.child("defs")||S.insertFirst(g("defs"));L=T.color||"#000000";P=T.opacity||1;I="-"+L+"-"+P*100;Q(T.startarrow,true);Q(T.endarrow)}}()}}();Ext.apply(y,{Image:Ext.extend(y.Path,{initSVGElement:function(){var H=this,G=H.parent,F=H.wrap,E=H.x,J=H.y,I=(H.el=F.appendChild(g("image",H.id+"_el").set({x:0,y:0,width:H.width,height:H.height}))).dom;I.style.cssText=q({stroke:H.strokecolor,"stroke-width":H.strokewidth,"stroke-opacity":H.strokeopacity,"-moz-user-select":o})+H.style;I.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",H.image);if(E||J){if(G){E-=G.x;J-=G.y}r(F,E,J)}},initVMLElement:function(){var H=this,F=H.strokecolor,G=H.parent,E=H.x,I=H.y;if(G){E-=G.x;I-=G.y}H.el=new Ext.Template(H.vmlTpl).append(H.wrap.setStyle({position:"absolute",width:100+k,height:100+k,left:E+k,top:I+k}).set({coordsize:"100,100"}).dom,{id:H.id+"_el",src:H.image,style:H.style,width:H.width,height:H.height,strokeColor:F||o,strokeWidth:F?H.strokewidth:0,strokeOpacity:F?(H.strokeopacity||1):0},true)},vmlTpl:['<v:image id="{id}" src="{src}" style="position:absolute;left:0;top:0;width:{width}px;height:{height}px;{style}">',j,"</v:image>"]}),Text:Ext.extend(y.Path,{initSVGWrap:function(){this.wrap=this.root.appendChild(g("g",this.id))},initVMLWrap:function(){this.wrap=this.root.appendChild(z("v:group",this.id))},initSVGElement:function(){var G=this,F=G.rotation,E=G.size||14,H=(G.el=G.wrap.appendChild(g("text",G.id+"_el").set({dx:G.dx+1,dy:G.dy+E-2}))).dom;H.style.cssText=q({fill:G.color,"font-size":E+k,"font-family":G.fontfamily,cursor:"text"})+G.style;H.textContent=G.text;if(!s(F)){r(G.el,null,null,null,null,F)}return G.el},initVMLElement:function(){var J=this,H=J.size||14,G=J.rotation,F=J.positionwrap,I=J.el=new Ext.Template(J.vmlTpl).append(J.wrap.dom,{id:J.id+"_el",style:q({"font-size":H+k,"font-family":J.fontfamily})+J.style,left:J.dx,top:J.dy,color:J.color||"black"},true).update(J.text);if(!s(G)){var E,K;if(F){E=F.x;K=F.y;I.dx=F.titlex;I.dy=F.titley}r(I,null,null,null,null,G,E,K)}return I},vmlTpl:"<span id='{id}' unselectable='on'  onselectstart='return false;' style='position:absolute;left:{left}px;top:{top}px;color:{color};cursor:pointer;white-space:nowrap;{style}'></span>"})});$A.Graphics.revision="$Rev: 8064 $"})();