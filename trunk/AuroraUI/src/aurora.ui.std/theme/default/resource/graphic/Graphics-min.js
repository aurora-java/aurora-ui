(function(){var e=document,b="http://www.w3.org/2000/svg",t="urn:schemas-microsoft-com:vml",n="none",v="transparent",j="px",g="<v:stroke startarrow='{startArrow}' endarrow='{endArrow}' color='{strokeColor}' joinstyle='miter' weight='{strokeWidth}px' opacity='{strokeOpacity}'></v:stroke>",k=!Ext.isIE9&&!!e.createElementNS&&!!e.createElementNS(b,"svg").createSVGRect,f=/[\d-+.e]+/g,A=Math.cos,w=Math.sin,z=Math.PI,c=parseInt,r=Ext.isEmpty,q=k?function(){var G,C=Ext.toArray(arguments);if(C.length&&Ext.isObject(C[0])){G=C.shift()}else{G=this.el||this.wrap}G=G.dom||G;var F="transform",D=G.getAttribute(F)||"translate(0,0) scale(1,1) rotate(0,0 0)",E=D.split("rotate");G.setAttribute(F,(E[0].replace(/\(([-.\d]+)\)/g,"($1,$1)")+"rotate"+E[1].replace(/\(([-.\d]+)\)/,"($1,0 0)")).replace(/[-.\d]+/g,function(H,I){return r(I=C.shift())?H:I}))}:function(){var R,C=Ext.toArray(arguments),D={};if(C.length&&Ext.isObject(C[0])){R=Ext.get(C.shift())}else{R=this.el||this.wrap}if(!r(C[0])){R.setStyle("left",C[0]+j)}if(!r(C[1])){R.setStyle("top",C[1]+j)}if(!r(C[2])&&!r(C[3])){R.dom.coordsize.value=100/C[2]+","+100/C[3]}if(!r(C[4])){var I=c(R.getStyle("left")||0),H=c(R.getStyle("top")||0),P=R.getWidth(),N=R.getHeight(),Q=C[4],U=Q*z/180,T=A(U),G=w(U),F=A(-U),M=w(-U),E=A(-U-z/2),K=w(-U-z/2),L=R.dx||I,J=R.dy||H,O=Math.sqrt(L*L+J*J),S=Math.atan(-J/L)-U,I=I-L+O*A(S),H=H-J-O*w(S);if(M>=0){if(F>=0){H=H-P*M}else{I=I+N*E;H=H-P*M}}else{if(F>=0){I=I+N*E}else{I=I+P*F;H=H-N*K}}R.setStyle(d(R)?{rotation:Q}:{filter:!r(Q)?["progid:DXImageTransform.Microsoft.Matrix(M11=",T,", M12=",-G,", M13=100",", M21=",G,", M22=",T,", sizingMethod='auto expand')"].join(""):n,left:I+j,top:H+j})}},B=function(){var D=1,C;return function(E){if(C!=(E=Ext.get(E))){if(s(C=E)){C.parent().appendChild(C)}else{C.setStyle("z-index",D++)}}}}();function o(C){return(C=C.trim()).replace(/^./,C.charAt(0).toUpperCase())}function h(C,E){var D=e.createElementNS(b,C);if(!r(E)){D.id=E}return Ext.get(D)}function y(C,E){var D=e.createElement(C);if(!r(E)){D.id=E}return Ext.get(D)}function s(C){if(k){C=C.dom||C;return C.namespaceURI==b}return false}function d(C){if(!k){C=C.dom||C;return !!C.tagUrn&&C.tagUrn==t}return false}function p(G,F){var D={},E,C=[];if(!Ext.isObject(G)){D[G]=F;G=D}for(E in G){C.push(E,":",G[E],";")}return C.join("")}function u(C){if(!C){return{}}return Ext.util.JSON.decode("{"+C.replace(/^{|}$/g,"").replace(/[^:,]+:/g,function(D){return D.toLowerCase()})+"}")}function m(C){return u(C.get("config"))}function i(F){if(Ext.isString(F)){var D=F.match(f);F=[];if(!D){return false}for(var E=0,C=D.length;E<C;E+=2){F.push([Number(D[E]),Number(D[E+1])])}}return F}Function.prototype.methodize=function(E){var D=this,C=Number(E||0);return function(){return D.apply(this,new Array(C).concat(Ext.toArray(arguments)))}};$A.Graphics=Ext.extend($A.Component,{constructor:function(C){var D=this;D.root=C.root;D.top=C.top||D;D.cmps=[];$A.Graphics.superclass.constructor.call(D,C);return D},initComponent:function(C){var D=this;$A.Graphics.superclass.initComponent.call(D,C);if(k){if(!D.wrap){D.initSVGWrap()}D.initSVGElement()}else{if(!D.wrap){D.initVMLWrap()}D.initVMLElement()}},initEvents:function(){$A.Graphics.superclass.initEvents.call(this);this.addEvents("click","dblclick","drop","move","drawn")},processListener:function(D){var E=this,C={preventDefault:true};$A.Graphics.superclass.processListener.call(E,D);E.wrap[D]("click",E.onClick,E,C)[D]("dblclick",E.onDblClick,E,C)[D]("mouseover",E.onMouseOver,E,C)[D]("mouseout",E.onMouseOut,E,C)[D]("mousedown",E.onMouseDown,E)[D]("keydown",E.onKeyDown,E)[D]("blur",E.onBlur,E)},processDataSetLiestener:function(C){var D=this,E=D.dataset;if(E){E[C]("load",D.onLoad,D);E[C]("update",D.onUpdate,D);E[C]("add",D.onAdd,D);E[C]("remove",D.onRemove,D);E[C]("indexchange",D.onIndexChange,D)}},initSVGElement:function(){this.root=h("g").appendTo(h("svg").setStyle({height:"100%",width:"100%",position:"relative"}).appendTo(this.wrap))},initVMLElement:function(){if(!e.namespaces.hcv){e.namespaces.add("v",t);e.createStyleSheet().cssText="v\\:shadow,v\\:roundrect,v\\:oval,v\\:image,v\\:polyline,v\\:line,v\\:group,v\\:fill,v\\:path,v\\:shape,v\\:stroke{ behavior:url(#default#VML); display: inline-block; } "}this.root=y("v:group").setStyle({position:"absolute",width:100+j,height:100+j}).set({coordsize:"100,100"}).appendTo(this.wrap)},initProxy:function(){var D=this,C=D.wrap,E=C.dom.cloneNode(!!k);E.id=D.id+"_proxy";if(!k){new Ext.Template(C.dom.innerHTML.replace(/^<\?xml[^\/]*\/>/i,"").replace(/id\=([\S]*)/img,"id=$1_proxy")).append(E,{})}D.proxy=Ext.getBody().insertFirst(Ext.fly(E).setStyle({"background-color":v,border:n,position:"absolute","z-index":"99999"}))},onMouseDown:function(H,C){var F=this;F.fire("mousedown",H,C);if(F.candrawline){F.startLine(H,C)}else{var G=F.dataset,D=F.getGElement(C),E;if(G&&D&&(E=D.record)&&E!=G.getCurrentRecord()){G.locate(G.getAll().indexOf(E)+1)}else{(function(){F.focus(C)}).defer(k&&Ext.isIE10?1:0)}if(F.dropto||F.moveable){F.sw=$A.getViewportWidth();F.sh=$A.getViewportHeight();F.beforeMove(H)}}},beforeMove:function(H){var F=this,E=F.wrap,D=F.dropto,G=E.getXY();if(s(E)){var C=F.top.wrap.getXY();G[0]=F.x+C[0];G[1]=F.y+C[1]}F.relativeX=G[0]-H.getPageX();F.relativeY=G[1]-H.getPageY();if(D){if(!F.dropEl){F.dropEl=$(D)}if(!F.proxy){F.initProxy()}F.proxy.moveTo(G[0],G[1])}else{F.proxy=E}if(F.moveable){B(F.proxy)}Ext.fly(e).on("mousemove",F.onMouseMove,F).on("mouseup",F.onMouseUp,F)},onMouseMove:function(I){I.stopEvent();var H=this,E=I.getPageX()+H.relativeX,D=I.getPageY()+H.relativeY,L=H.width||H.rx*2,G=H.height||H.ry*2,J=Ext.fly(e).getScroll(),C=J.left,M=J.top,K=C+H.sw,F=M+H.sh;if(E<0){E=0}else{if((E+L)>=K){E=Math.max(K-L,0)}}if(D<0){D=0}else{if((D+G)>=F){D=Math.max(F-G,0)}}if(H.moveable){H.fireEvent("move",H,H.dataset,null,E,D)}H.proxy.moveTo(E,D)},onMouseUp:function(H,K){var F=this;F.fire("mouseup",H,K);Ext.fly(e).un("mousemove",F.onMouseMove,F).un("mouseup",F.onMouseUp,F);if(F.dropto){var D=F.dropEl.wrap,L=D.getXY(),E=L[0],K=L[1],C=E+D.getWidth(),J=K+D.getHeight(),I=H.getPageX(),G=H.getPageY();if(I>=L[0]&&G>=L[1]&&I<=C&&G<=J){F.dropEl.fireEvent("drop",F.proxy,F.top.dataset,I+F.relativeX-E+(k?4:0),G+F.relativeY-K+(k?4:0))}F.proxy.moveTo(-1000,-1000)}},onMouseOver:function(D,C){this.fire("mouseover",D,C)},onMouseOut:function(D,C){this.fire("mouseout",D,C)},onClick:function(D,C){this.fire("click",D,C)},onDblClick:function(D,C){this.fire("dblclick",D,C)},onKeyDown:function(H){var G=this,E=G.focusItem;if(E){var C=E.x,I=E.y,D=G.dataset.getCurrentRecord(),F=H.ctrlKey?10:1;switch(H.keyCode){case 37:C-=F;break;case 38:I-=F;break;case 39:C+=F;break;case 40:I+=F;break;case 46:if(G.focusItem){G.remove()}default:return}if(!k){C--;I--}E.onMouseMove({x:C,y:I},E);H.stopEvent()}},onBlur:function(){this.blur()},getGElement:function(E){var D=E.id.match(/(.*)_(\d+)(_.*)*$/);if(D){var G=D[2];if(G){var F=this.top.dataset,C;if(F){C=F.findById(G)}if(D[1]){G=D[1]+"_"+G;E=$(G)}return{el:E,record:C}}}},fire:function(C,F,D){if(!D){return}var E=this.getGElement(D);if(E){this.fireEvent(C,F,E.el,this.dataset,E.record);return E.el}this.fireEvent(C,F,D)},create:function(G){var F=this,E=G.get("type"),D=m(G),H=F.renderer;D.id=F.id+"_"+G.id;if(H){var I=$A.getRenderer(H);if(I==null){alert("未找到"+H+"方法!");return}var C=I(G,E,D);if(!r(C)){if(Ext.isObject(C)){C=Ext.util.JSON.encode(C)}Ext.apply(D,u(C))}}F.createGElement(D.type||E,D)},moveTo:function(C,H){var F=this,E=F.wrap,D=F.parent;Ext.apply(F.initConfig,{x:(F.x=C),y:(F.y=H)});if(s(E)){if(F.strokewidth%2==1&&F.shadow){C+=0.5;H+=0.5}if(D){C-=D.x;H-=D.y}q(E,C,H)}else{var G=this.top.wrap.getXY();E.moveTo(G[0]+C,G[1]+H)}},syncFocusMask:function(E){var D=this.focusMask;if(!E.moveable){return D}var I=(E.strokewidth||0)/2+3,G=I,H=I,C=E.width,F=E.height;return D.setStyle({left:E.x-G+j,top:E.y-H+j}).setWidth(C+G*2).setHeight(F+H*2).set({title:E.info||""})},focus:function(C){var D=this;C=D.fire("focus",null,C);if(C){if(D.focusItem){if(D.focusItem==C){return}D.blur()}if(D.editable){if(C.editable){C.showEditors()}if(C.moveable){if(!D.focusMask){D.focusMask=new Ext.Template('<div style="-moz-user-select:none;-webkit-user-select:none;background:none;position:absolute;border:1px dashed #000;"></div>').insertFirst(D.wrap.dom,{},true)}D.syncFocusMask(C).show()}}D.focusItem=C}D.wrap.focus()},blur:function(){var E=this,D=E.focusItem,C=E.focusMask;if(D){if(D.editable){D.hideEditors()}if(D.moveable){if(C){C.hide()}}E.fire("blur",null,D);E.focusItem=null}},startLine:function(H,E){var G=this,F=G.getGElement(E),D=G.wrap.getXY(),C=H.getPageX()-D[0],J=H.getPageY()-D[1],I;if(F){I=F.el.findConnect(H);if(I){C=I.x+I.width/2;J=I.y+I.height/2;G.startEl=F}}G.drawLinePoints=[C,J];Ext.fly(e).on("mousemove",G.drawLine,G).on("mouseup",G.endLine,G)},drawLine:function(Q,J){var U=this,P=U.wrap.getXY(),O=U.drawLinePoints[0],G=U.drawLinePoints[1],N=U.getGElement(J),C=U.startEl,M,F,K,E,H,L,R,T,D;if(N&&(K=N.record)!=U.newline&&(E=N.el)!=(C&&C.el)){E.showConnects();R=E.findConnect(Q)}if(R){D=K.get(U.tableidfield)||K.get("table_id");M=R.x+R.width/2;F=R.y+R.height/2}else{M=Q.getPageX()-P[0],F=Q.getPageY()-P[1]}M=Math.round(M);F=Math.round(F);if(!U.newline){L=[[O,G],[M,F]].join(" ");if(C){T=(K=C.record).get(U.tableidfield)||K.get("table_id")}U.newline=U.dataset.create({type:"zLine",config:'strokewidth:1,strokecolor:"#aaaaaa",strokeopacity:"1",titlecolor:"black",titlesize:14,titlex:0,titley:0,endarrow:"classic",points:"'+L+'",editable:true,connectable:false'+(r(T)?"":(",from:"+T))+(r(D)?"":(",to:"+D))});var I=$(U.id+"_"+U.newline.id).editors;(function(){I[I.length-1].wrap.hide()}).defer(Ext.isIE9?1:0)}else{var S=m(U.newline);L=i(S.points);L.pop();L.push([M,F]);S.points=L.join(" ");if(!D){delete S.to}else{S.to=D}U.newline.set("config",Ext.util.JSON.encode(S))}},endLine:function(E,C){var D=this;Ext.fly(e).un("mousemove",D.drawLine,D).un("mouseup",D.endLine,D);if(D.newline){var F=$(D.id+"_"+D.newline.id).editors;(function(){F[F.length-1].wrap.show()}).defer(Ext.isIE9?1:0);D.fireEvent("drawn")}delete D.drawLinePoints;delete D.newline;delete D.startEl},bind:function(E,C){var D=this;D.dataset=$(E);D.tableidfield=C||"table_id";D.processDataSetLiestener("on");D.onLoad()},onLoad:function(){var C=this;(function(D){k?D():$A.onReady(D)})(function(){C.clear();Ext.each(C.dataset.getAll().sort(function(F,E){var D=F.get("type"),G=E.get("type");if(D==G){return 0}else{if(D==="line"||D==="zLine"){return 1}else{return -1}}}),function(D){if(!D.get("type")){D.data.type="rect";D.isNew=true}C.create(D)})})},onAdd:function(E,C,D){this.create(C)},onRemove:function(F,C,D){var E=$(this.id+"_"+C.id);if(this.focusItem==E){this.focusItem=null}E.destroy()},onIndexChange:function(E,C){var D=this;(function(){D.focus($(D.id+"_"+C.id))}).defer(k&&Ext.isIE10?1:0)},onUpdate:function(E,H,C,K,G){var I=this,D=$(I.id+"_"+H.id),F=m(H),J=H.get("type");F.type=J;if(D.changeConfig(F,H)==false){H.set(C,G)}},createGElement:function(D,C){var E=new x[o(D)](Ext.apply(C||{},{type:D,root:(C&&Ext.get(C.root))||this.root,top:this.top}));this.top.cmps.push(E);return E},createElement:function(C){return this.root.appendChild(k?h(C):y(C))},remove:function(){var E=this.dataset,D=E.getCurrentRecord(),F=D.get("table_id"),C=D.get("type");if(F!==0&&F!==-1){if(C=="line"||C=="zLine"||D.isNew){E.remove()}else{$A.showConfirm("确认","确认删除选中的图形？",function(){E.remove()})}}},clear:function(){var C=this.cmps;while(C.length){C.pop().destroy()}this.focusItem=null},destroy:function(){var C=this;C.wrap.remove();if(C.proxy&&C.proxy!=C.wrap){C.proxy.remove()}$A.Graphics.superclass.destroy.call(C);C.processDataSetLiestener("un")},translate:q.methodize(),scale:q.methodize(2),rotate:q.methodize(4),setTopCmp:B,hasSVG:k});var x=function(){var D=0,E=function(O){if(Ext.isObject(O)){return O}var J=[],R,I=false,M,L,P;function Q(T){if(!T){J=[0,0,0,1]}else{if(T==v){J=[0,0,0,0]}else{if(T==n){J=n}else{if(/gradient/i.test(T)){I=true;var U=/^gradient\((.*)\)$/.exec(T)[1],S=/^([^stop]*),[^,]*stop/.exec(U)[1];M=/^[^,]*/.exec(S)[0];L=S.match(/[-\d%]+/g);P=function(W){var V=[];Ext.each(W,function(Z){var X=/\(([^\)]*\))\)$/.exec(Z)[1],Y=/^([^,]*),(.*)$/.exec(X);V.push([Y[1],Y[2]])});return V}(U.match(/stop\([^\)]*\)\)/mg))}else{R=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]?(?:\.[0-9]+)?)\s*\)/.exec(T);if(R){J=[c(R[1]),c(R[2]),c(R[3]),parseFloat(R[4],10)]}else{R=/^#([a-fA-F0-9]{1,2})([a-fA-F0-9]{1,2})([a-fA-F0-9]{1,2})$/.exec(T);if(R){J=[c(K(R[1]),16),c(K(R[2]),16),c(K(R[3]),16),1]}}}}}}}function K(S){return S.length==1?S+S:S}function H(T){var S=1;if(I){if(T==="gradient"){S={isGradient:I,type:M,linear:L,stops:P}}else{S=""}}else{if(T==="a"){if(!isNaN(J[3])){S=J[3]}}else{if(J&&!isNaN(J[0])){if(T==="hex"){S="#"+K(Number(J[0]).toString(16))+K(Number(J[1]).toString(16))+K(Number(J[2]).toString(16))}else{if(T==="rgb"){S="rgb("+J[0]+","+J[1]+","+J[2]+")"}else{S="rgba("+J.join(",")+")"}}}else{if(J==n){S=J}else{S=O}}}}return S}function N(T){if(J!=n&&isNumber(T)&&T!==0){var S;for(S=0;S<3;S++){J[S]+=c(T*255);if(J[S]<0){J[S]=0}if(J[S]>255){J[S]=255}}}return this}function G(S){if(O==v||J==n||r(S)){return this}J[3]=S;return this}Q(O);return{get:H,brighten:N,setOpacity:G}},F=function(){var G={};return function(H,R){H=H||this.d;if(G[H]){return G[H]}R=R||this.zoom||10000;var O=H.match(/\w|[\s\d-+.,e]*/g),Q=[0,0],P=[0,0],S=[],M=function(Y,Z){var T=Ext.isArray(Y)?Y:Y.match(f);for(var X=0,U=T.length;X<U;X++){var W=P[0]+J(T[X]),V=P[1]+J(T[++X]);if(!Z||X/2%3==2){P[0]=W;P[1]=V}S=S.concat([W,V])}},L=function(ai,ag){var Z=ai.match(f);while(Z.length&&Z.length%7==0){var V=J(Z.shift()),U=J(Z.shift()),Y=Number(Z.shift()),W=Number(Z.shift()),ad=Number(Z.shift()),ac=J(Z.shift()),ab=J(Z.shift()),X,af,T,aa;if(ag){ac+=P[0];ab+=P[1]}var ah=Math.abs(ac-P[0]),ae=Math.abs(ab-P[1]);V=ah;U=ae;S.push(ad?"wa":"at");if((ad^W)^ac<P[0]){if(ab<P[1]){X=P[0];af=P[1]-U}else{X=P[0]-V;af=P[1]}}else{if(ab<P[1]){X=P[0]-V;af=P[1]-(U<<1)}else{X=P[0]-(V<<1);af=P[1]-U}}T=X+(V<<1);aa=af+(U<<1);S.push(X,af,T,aa,P[0],P[1],ac,ab);P=[ac,ab]}},K=function(U){var T=U.match(f).slice(-2);return[J(T[0]),J(T[1])]},J=function(T){return Number(Number(T*R).toFixed(0))},I=function(W){for(var V=0,U=W.match(f),T=U.length;V<T;V++){S.push(J(U[V]))}};for(var N=0;N<O.length;N++){switch(O[N]){case"M":Q=K(O[N+1]);case"C":case"L":P=K(O[N+1]);S.push(O[N]);I(O[++N]);break;case"m":S.push("M");M(O[++N]);Q=[].concat(P);break;case"c":S.push("C");M(O[++N],true);break;case"l":S.push("L");M(O[++N]);break;case"h":S.push("L");M(O[++N]+" 0");break;case"v":S.push("L");M("0 "+O[++N]);break;case"H":S.push("L");P[0]=J(O[++N]);S.push(P[0],P[1]);break;case"V":S.push("L");P[1]=J(O[++N]);S.push(P[0],P[1]);break;case"A":L(O[++N]);break;case"a":L(O[++N],true);break;case"Z":case"z":S.push("X");P=[].concat(Q);break}}S.push("E");G[H]=S.join(" ");return G[H]}}();function C(N,H,L,G,K){var O=H-G,M=L-K,I=N*3/2;if(!O){L+=M>0?-I:I}else{if(!M){H+=O>0?-I:I}else{var J=Math.sqrt(O*O+M*M);H=(J-I)/J*O+G;L=(J-I)/J*M+K}}return{x:H,y:L}}return{Path:Ext.extend($A.Graphics,{zoom:10000,constructor:function(G){var H=this;H.lineEditors=[];H.editors=[];return x.Path.superclass.constructor.call(H,G)},initComponent:function(G){G.fillcolor=E(G.fillcolor).setOpacity(G.fillopacity);G.fillopacity=G.fillcolor.get("a");G.strokecolor=E(G.strokecolor).setOpacity(G.strokeopacity);G.strokeopacity=G.strokecolor.get("a");G.strokewidth=G.strokewidth||0;x.Path.superclass.initComponent.call(this,G);var H=this,I=H.title;if(k){if(I){H.initSVGTitle()}H.initSVGInfo();if(H.shadow){H.initSVGShadow()}}else{if(I){H.initVMLTitle()}H.initVMLInfo()}},initSVGWrap:function(){this.wrap=this.root.appendChild(h("g",this.id))},initVMLWrap:function(){this.wrap=this.root.appendChild(y("v:group",this.id))},initSVGElement:function(){var W=this,I=W.parent,L=W.wrap,T=W.d,V={d:T,fill:W.createGradient(W.fillcolor.get("gradient"))},X=W.fillcolor.get(),K=W.strokecolor.get("hex"),H=W.strokewidth,G=W.strokeopacity,S=W.startarrow,Q=W.endarrow,R=(W.el=h("path",W.id+"_el")).dom.style,M=W.x,J=W.y;if(M||J){if(H&&H%2==1&&!W.shadow){M+=0.5;J+=0.5}if(I){M-=I.x;J-=I.y}q(L,M,J)}R.cssText=p({fill:X,"fill-opacity":W.fillopacity,stroke:K,"stroke-width":H,"stroke-opacity":H?G:0,cursor:W.cursor||"pointer"})+W.style;if(H){if(!R.stroke){K=R.stroke="#000";G=R.strokeOpacity=0}if(S||Q){var U=T.match(f),P=U.length,N="-"+K+"-"+G*100;if(S){V["marker-start"]="url(#start-arrow-"+S+N+")";var O=C(H,Number(U[0]),Number(U[1]),Number(U[2]),Number(U[3]));U[0]=O.x;U[1]=O.y;V.d=V.d.replace(/[\d-+.]+\s+[\d-+.]+/,O.x+" "+O.y)}if(Q){V["marker-end"]="url(#end-arrow-"+Q+N+")";var O=C(H,Number(U[P-2]),Number(U[P-1]),Number(U[P-4]),Number(U[P-3]));V.d=V.d.replace(/([\d-+.]+\s+[\d-+.]+)[^\d]*$/,O.x+" "+O.y)}new x.Arrow({color:K,width:H,opacity:G,endarrow:Q,startarrow:S,root:W.root})}}L.insertFirst(W.el.set(V))},initVMLElement:function(){var I=this,H=I.fillcolor.get("rgb"),G=I.strokecolor.get("rgb"),M=true,N=true,P=true,O=I.zoom,L=I.parent,K=I.x,J=I.y;if(L){K-=L.x;J-=L.y}if(r(I.strokewidth)){I.strokewidth=1}if(G==n||I.strokeopacity==0||I.strokewidth==0){M=false}if(H==n){N=false}I.wrap.setStyle({position:"absolute",width:100+j,height:100+j,left:(K||0)+j,top:(J||0)+j}).set({coordsize:"100,100",title:I.info||""});I.el=new Ext.Template(I.getVmlTpl(M,N,I.shadow)).insertFirst(I.wrap.dom,Ext.apply({id:I.id+"_el",style:I.style,path:I.path||F.call(I),zoom:O,fillColor:H,fillOpacity:I.fillopacity,strokeColor:G,strokeWidth:I.strokewidth,strokeOpacity:I.strokeopacity,endArrow:I.endarrow,startArrow:I.startarrow,cursor:I.cursor||"pointer"},I.createGradient(I.fillcolor.get("gradient"))),true)},createGradient:k?function(I){if(!I.isGradient){return n}var K="graphics-gradient"+D++,H=I.linear,G=this.root,J=(G.child("defs")||G.insertFirst(h("defs"))).appendChild(h(I.type+o("gradient"),K).set({x1:H[0],y1:H[1],x2:H[2],y2:H[3],gradientUnits:"userSpaceOnUse"}));Ext.each(I.stops,function(M){var L=E(M[1]);J.appendChild(h("stop").set({offset:M[0],"stop-color":L.get("rgb"),"stop-opacity":L.get("a")}))});return"url("+location.href+"#"+K+")"}:function(J){if(!J.isGradient){return{}}var L=J.type=="linear"?"gradient":"",I=J.linear,M=this.top,K=M.width,G=M.height,H=[];Ext.each(I,function(O,N){if(/\%/.test(O)){O=c(O)/100;I[N]=(N%2==0?K:G)*O}});Ext.each(J.stops,function(N){H.push(N[0]," ",E(N[1]).get("rgb"),";")});return{type:L,angle:Math.atan((I[2]-I[0])/(I[3]-I[1]))/(z/180)+180,colors:H.join(""),fillOpacity:1}},initSVGShadow:function(){var J="graphics-filter-shadow";if(!Ext.get(J)){var G=this.root,H=(G.child("defs")||G.insertFirst(h("defs"))).appendChild(h("filter",J).set({x:-0.25,y:-0.25,width:1.5,height:1.5,"color-interpolation-filters":"sRGB"}));H.appendChild(h("feGaussianBlur").set({result:"blur",stdDeviation:1,"in":"SourceAlpha"}));H.appendChild(h("feColorMatrix").set({values:"1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.6 0 ",type:"matrix",result:"bluralpha"}));H.appendChild(h("feOffset").set({result:"offsetBlur",dx:5,dy:5,"in":"bluralpha"}));var I=H.appendChild(h("feMerge"));I.appendChild(h("feMergeNode").set({"in":"offsetBlur"}));I.appendChild(h("feMergeNode").set({"in":"SourceGraphic"}))}this.el.setStyle({filter:"url(#"+J+")"})},initSVGTitle:function(){var G=this;G.text=x.Text.prototype.initSVGElement.call({text:G.title,id:G.id+"_title",size:G.titlesize||14,dx:G.titlex||0,dy:G.titley||0,color:G.titlecolor,fontfamily:G.titlefontfamily,rotation:G.titlerotation,wrap:G.wrap,style:"cursor:pointer;-webkit-user-select:none"})},initVMLTitle:function(){var K=this,G=K.titlex||0,L=K.titley||0,J=K.titlesize||14,H=K.wrap;if(K.type=="line"||K.type=="path"){G+=K.x;L+=K.y;H=K.top.wrap}else{var I=K.strokewidth;G+=I/2;L+=I/2}K.text=x.Text.prototype.initVMLElement.call({text:K.title,id:K.id+"_title",size:J,dx:G,dy:L,color:K.titlecolor,fontfamily:K.titlefontfamily,rotation:K.titlerotation,wrap:H,positionwrap:K,vmlTpl:x.Text.prototype.vmlTpl})},initSVGInfo:function(){var G=this,H=G.info;if(H){if(!G.infoEl){G.wrap.appendChild(G.infoEl=h("title"))}G.infoEl.dom.textContent=H}else{if(G.infoEl){G.infoEl.remove();G.infoEl=null}}},initVMLInfo:function(){this.wrap.set({title:this.info||""})},createEditors:function(){var L=this,N=L.top;if(N.editable){var K=[].concat(L.points);switch(L.type){case"line":Ext.each(K,function(O){L.createEditor(O)});break;case"zLine":var H=K.shift(),J=K.pop();L.createEditor(H);L.createEditor(J);for(var I=0,G=K.length;I<G;I++){var M=K[I+1];if(M){L.createEditor(K[I],M)}}}L.bindEditor(L.from,true);L.bindEditor(L.to)}},bindEditor:function(M,G){if(!r(M)){var L=this.editors,J=this.top;tr=J.dataset.find(J.tableidfield,M);if(tr){var I=$(J.id+"_"+tr.id);if(I){var H=L[G?0:L.length-1],K=I.findNearlyConnect([H.x,H.y]);H.bindEl=K;K.lineEditors.push(H);H.addConfig({fillcolor:"rgb(255,0,0)",fillopacity:"0.9"})}}}},clearBindEditor:function(){Ext.each(this.editors,function(G){var I=G.bindEl;if(I){var H=I.lineEditors;H.splice(H.indexOf(G),1);delete G.bindEl;G.addConfig({fillcolor:"rgb(0,0,0)",fillopacity:"0"})}})},syncLineEditors:function(G,H){Ext.each(this.lineEditors,function(I){I.moveTo(G,H);I.fireEvent("move")})},syncEditors:function(){var P=this;if(P.editors.length&&P.points){var M=0,J=P.editors,I=[].concat(P.points);P.clearBindEditor();if(P.type=="zLine"){var O=J[0],T=O.width/2,N=O.height/2,H=I.shift(),Q=I.pop(),L=P.zEditors;O.moveTo(H[0]-T,H[1]-N);J[1].moveTo(Q[0]-T,Q[1]-N);for(;I[M+1];M++){var G=L[M],S=I[M],R=I[M+1],V,U;if(G){if(R[0]==S[0]){G.movedir="h";V=S[0];U=(S[1]+R[1])/2}else{if(R[1]==S[1]){G.movedir="v";V=(S[0]+R[0])/2;U=S[1]}}G.moveTo(V-G.width/2,U-G.height/2)}else{P.createEditor(S,R)}}while(L.length>M){var O=L.pop();O.un("move",P.editorMove,P);O.destroy()}}else{for(var K=I.length;M<K;M++){var O=J[M],S=I[M];if(O){var V=S[0]-O.width/2,U=S[1]-O.height/2;O.moveTo(V,U)}else{P.createEditor(S)}}while(J.length>M){var O=J.pop();O.un("move",P.editorMove,P);O.destroy()}}!r(P.to)&&P.bindEditor(P.to);!r(P.from)&&P.bindEditor(P.from,true)}},createEditor:function(O,P){var L=this,G=L.editors,H=L.zEditors,J=L.getRecord(),I=G.length+H.length,K,M="Oval",R,Q=O[0],N=O[1];if(P){M="Diamond";if(P[0]==Q){N=(P[1]+N)/2;R="h"}else{if(P[1]==N){Q=(P[0]+Q)/2;R="v"}}}K=new x[M]({type:"oval",connectable:false,id:L.id+"_editor"+I,x:Q-5,y:N-5,height:10,width:10,strokewidth:1,strokecolor:"rgba(0,0,0,1)",fillcolor:v,root:L.wrap,parent:L,top:L.top,moveable:true,movedir:R});if(P){H.push(K)}else{G.push(K);if(I==0){K.isFrom=true}K.on("mousedown",L.editorDown,L)}K.on("move",L.editorMove,L);if(J!=L.top.dataset.getCurrentRecord()){(function(){K.wrap.hide()}).defer(Ext.isIE9?1:0)}},showEditors:function(){Ext.each(this.editors.concat(this.zEditors||[]),function(G){G.wrap.show()})},hideEditors:function(){Ext.each(this.editors.concat(this.zEditors||[]),function(G){G.wrap.hide()})},clearEditors:function(){var G=this;Ext.each(G.editors.concat(G.zEditors||[]),function(H){var I=H.bindEl;if(I&&I.lineEditors){I.lineEditors.remove(H)}H.un("move",G.editorMove,G);H.destroy()});G.editors=[];G.zEditors=[]},createConnects:function(){var I=this,K=I.top;if(K.editable){I.connects=[];var G=I.height,M=I.width,L=I.x,J=I.y,O=I.strokewidth/2,N=O,H=O;I.createConnect(L+M/2,J-H,1);I.createConnect(L+M+N,J+G/2,2);I.createConnect(L+M/2,J+G+H,3);I.createConnect(L-N,J+G/2,4)}},createConnect:function(G,L,H){var J=this,K=J.connects,I=K.length;K[I]=new x.Rect({type:"rect",connectable:false,id:J.id+"_connect"+I,x:G-4,y:L-4,height:8,width:8,strokewidth:1,strokecolor:"rgba(0,0,0,1)",fillcolor:"rgba(255,0,0,0.8)",parent:J,root:J.wrap,top:J.top,dir:H})},showConnects:function(){Ext.each(this.connects,function(G){G.wrap.show()})},hideConnects:function(){Ext.each(this.connects,function(G){G.wrap.hide()})},clearConnects:function(){var G=this;Ext.each(G.connects,function(H){H.destroy()});G.connects=null},findConnect:function(L){var J=this,K=L.xy,H=J.top.wrap.getXY(),G=K[0]-H[0],N=K[1]-H[1],M=Math.pow(Math.min(J.height/3,J.width/3),2),I=null;Ext.each(J.connects,function(Q){var P=G-Q.x,O=N-Q.y;if(P*P+O*O<M){I=Q;return false}});return I},findNearlyConnect:function(H){var G,I=Number.MAX_VALUE;Ext.each(this.connects,function(M){var L=M.x-H[0],K=M.y-H[1],J=L*L+K*K;if(J<I){I=J;G=M}});return G},syncConnects:function(O,N,G,K){var J=this,I=J.connects,M,L,H;if(!G&&!K){Ext.each(I,function(P){P.moveTo(M=P.x+O,L=P.y+N);P.syncLineEditors(M,L)})}else{(H=J.connects[0]).moveTo(M=H.x+O+G/2,L=H.y+N);H.syncLineEditors(M,L);(H=J.connects[1]).moveTo(M=H.x+O+G,L=H.y+N+K/2);H.syncLineEditors(M,L);(H=J.connects[2]).moveTo(M=H.x+O+G/2,L=H.y+N+K);H.syncLineEditors(M,L);(H=J.connects[3]).moveTo(M=H.x+O,L=H.y+N+K/2);H.syncLineEditors(M,L)}},editorDown:function(I){var H=this,J=I.target.id,G=H.currentEditor=$(J.substring(0,J.indexOf("_el")));G.hide();H.top.editing=true;G.on("mouseup",H.editorUp,H)},editorMove:function(I,J,O,T,S){var R=this,O=R.getRecord(),K=m(O),V=[],H=R.editors,L=I&&I.movedir,M=R.zEditors;if(L&&M&&M.length){V=R.points;var Q=M.indexOf(I),W=V[Q+1],U=V[Q+2],N=I.height/2,T=I.x+I.width/2,S=I.y+I.height/2,G,P;if(L=="v"){W[1]=U[1]=S}else{W[0]=U[0]=T}if(P=M[Q-1]){G=V[Q];if(G[0]==W[0]){P.moveTo(G[0]-P.width/2,(G[1]+W[1])/2-P.height/2)}else{P.moveTo((G[0]+W[0])/2-P.width/2,G[1]-P.height/2)}}if(P=M[Q+1]){G=V[Q+3];if(G[0]==U[0]){P.moveTo(G[0]-P.width/2,(G[1]+U[1])/2-P.height/2)}else{P.moveTo((G[0]+U[0])/2-P.width/2,G[1]-P.height/2)}}K.generate=false}else{Ext.each(H,function(X){V.push([X.x+X.width/2,X.y+X.height/2])})}K.points=V.join(" ");O.set("config",Ext.util.JSON.encode(K))},editorUp:function(){var H=this,G=H.currentEditor;G.show();G.un("mouseup",H.editorUp,H);H.top.editing=false;delete H.currentEditor},onMouseDown:function(J,G){var H=this,I=H.top;H.fire("mousedown",J,G);if(I.editable&&!I.candrawline){B(H.wrap);if(H.dropto||H.moveable){H.beforeMove(J)}}},onMouseMove:function(ad,R){ad.stopEvent&&ad.stopEvent();var ak=this,N=ak.wrap,U=ak.top,P=ak.width||ak.rx*2,aa=ak.height||ak.ry*2,L=ak.parent,S=U.wrap,W=S.getWidth(),ai=S.getHeight(),K=ak.strokewidth||0,ac=S.getXY(),aj=ad.x||(ad.getPageX()+ak.relativeX-ac[0]),ag=ad.y||(ad.getPageY()+ak.relativeY-ac[1]),O=ak.x,M=ak.y,Z,Y,ae,Q,af=0,J=ak.type,X=af,H=af;if(U.editing){var ab=ak.getGElement(R),G,T;if(ab){(G=ab.el).showConnects();if(!ak.movedir){ae=G.findConnect(ad)}}}if(ae){Q=(T=ab.record).get(ak.tableidfield)||T.get("table_id");Z=ak.x=ae.x;Y=ak.y=ae.y;aj=Z+X;ag=Y+X}else{if(K&&d(N)){X=H=af=-K/2}if(aj<=X){aj=X}else{if(aj+P-X>W-2){aj=W-2-P+X}}if(ag<=H){ag=H}else{if(ag+aa-H>ai-2){ag=ai-2-aa+H}}Z=ak.x=Math.round(aj-X);Y=ak.y=Math.round(ag-H)}if(ak.moveable){var V=U.dataset,I=V.getCurrentRecord(),ah=m(I);ah.x=Z;ah.y=Y;if(!ak.movedir){if(!r(Q)){ah[ak.isFrom?"from":"to"]=Q}else{delete ah[ak.isFrom?"from":"to"]}}U.syncFocusMask(ah);I.data.config=Ext.util.JSON.encode(ah).replace(/^{|}$/g,"");I.dirty=true;ak.fireEvent("move",ak,V,I,Z-X,Y-H);U.fireEvent("move",ak,V,I,Z-X,Y-H)}if(s(N)){if(K%2==1&&!ak.shadow){aj+=0.5;ag+=0.5}if(L){aj-=L.x;ag-=L.y}if(ak.movedir=="h"){ag=null}else{if(ak.movedir=="v"){aj=null}}q(ak.proxy,aj,ag)}else{if(ak.connectable!=false){aj-=3;ag-=3}if(ak.movedir&&L){aj-=L.x;ag-=L.y}if(ak.movedir=="v"){ak.proxy.setStyle("top",ag+j)}else{if(ak.movedir=="h"){ak.proxy.setStyle("left",aj+j)}else{ak.proxy.moveTo(aj+ac[0],ag+ac[1])}}}ak.syncConnects(Z-O,Y-M)},onMouseOver:function(J,G){var H=this,I=H.top;if((I.candrawline||I.editing)&&H.connectable!=false){H.showConnects()}},onMouseOut:function(I){var G=this,H=G.top;if(G.connectable!=false){G.hideConnects()}},getRecord:function(){var G=this.id.match(/(.*)_(\d+)(_.*)*$/),H=this.top.dataset;if(G&&H){return H.findById(G[2])}},destroy:function(){var H=this,G=H.focusMask,I=H.text;H.clearEditors();H.clearConnects();Ext.each(H.lineEditors,function(J){delete J.bindEl;J.addConfig({fillcolor:"rgb(0,0,0)",fillopacity:"0"})});G&&G.remove();I&&I.remove&&I.remove();x.Path.superclass.destroy.call(H)},getVmlTpl:function(H,I,J){var G=['<v:shape id="{id}" filled="',I,'" stroked="',H,'" coordsize="{zoom},{zoom}" style="position:absolute;left:0;top:0;width:1px;height:1px;cursor:{cursor};{style}" path="{path}">'];if(I){G.push("<v:fill color='{fillColor}' opacity='{fillOpacity}' angle='{angle}' colors='{colors}' type='{type}'></v:fill>")}if(H){G.push(g)}if(J){G.push("<v:shadow on='t' opacity='0.5' offset='5px,5px'></v:shadow>")}G.push("</v:shape>");return G},addConfig:function(G){this.changeConfig(Ext.apply(this.initConfig,G))},changeConfig:function(H,J){var G=this,K=G.top,N=H.type,L=x[N=="image"?"ImagePath":"Path"].prototype,S=x[o(N)].processConfig,P=G.x,O=G.y,Q=G.width,I=G.height;H.top=G.top;if(N=="zLine"){if(H.generate!=false){x.ZLine.generate(H)}if(J){var M=m(J);delete M.generate;if(Ext.isArray(H.points)){M.points=H.points.join(" ")}J.data.config=Ext.util.JSON.encode(M).replace(/^{|}$/g,"");J.dirty=true}}if(S&&S(H)==false){return false}for(var R in G.initConfig){if(R!="dataset"&&R!="top"&&R!="root"&&R!="id"){if(!(R in H)){delete G[R]}}}Ext.apply(G,H);G.initConfig=H;G.processListener("un");G.el.remove();if(G.text){G.text.remove()}if(k){G.initSVGElement=L.initSVGElement}else{G.initVMLElement=L.initVMLElement;G.vmlTpl=L.vmlTpl}G.initComponent(H);G.syncConnects(G.x-P,G.y-O,G.width-Q,G.height-I);G.syncEditors();if(G==K.focusItem&&K.focusMask){K.syncFocusMask(G)}G.processListener("on")}}),Group:Ext.extend($A.Graphics,{initSVGWrap:function(){this.wrap=this.root.appendChild(h("g",this.id))},initVMLWrap:function(){this.wrap=this.root.appendChild(y("v:group",this.id).setStyle({position:"absolute",width:100+j,height:100+j}).set({coordsize:"100,100"}))},initSVGElement:function(){},initVMLElement:function(){}}),Line:function(){function G(I){if(x.Line.processConfig(I)==false){return}var H=new x.Path(I);H.createEditors();return H}G.processConfig=function(J){var K=i(J.points);if(K.length<2){return false}var H=Number(K[0][0]),L=Number(K[0][1]),I=["M",0,0,"L"];Ext.each(K,function(M){I.push(M[0]-H,M[1]-L)});J.d=I.join(" ");if(J.strokewidth==1){J.strokewidth=2}J.fillcolor=n;J.points=K;J.x=H;J.y=L};return G}(),ZLine:function(){var M=Array.prototype.push,K=25;function I(O,N){return O>N}function G(O,N){return O<N}function J(N,P,O){return !r(N)&&(O=P.dataset.find(P.tableidfield,N))&&$(P.id+"_"+O.id)}function H(O,N,P){if(P){return[O[0],N[1]]}else{return[N[0],O[1]]}}function L(P,W,O,ab){if(!P){return}var Z=P.findNearlyConnect(ab?W:O);if(!Z){return}var T=P.x,S=P.y,U=P.width,ac=P.height,ae=ab?W[0]:O[0],R=ab?W[1]:O[1],ad=ab?O[0]:W[0],Q=ab?O[1]:W[1],X=Z.dir,Y=ab?"push":"unshift",aa=[W],ag,ah,N,ai=I,V,af;if((N=X==1)||X==3){if(N){V=T+U;l=T;af=S+ac;ah=K}else{ai=G;ah=-K;U=-U;V=T;l=T-U;af=S}ag=ah*2;if(ai(R-Q,ag)){aa[Y]([ae,(R+Q)/2],[ad,(R+Q)/2])}else{if(ai(R,Q)){aa[Y]([ae,Q])}else{if(ai(ad-V,ag)){aa[Y]([ae,R-ah],[(V+ad)/2,R-ah],[(V+ad)/2,Q])}else{if(ai(-ag,ad-l)){aa[Y]([ae,R-ah],[(l+ad)/2,R-ah],[(l+ad)/2,Q])}else{if(ai(ad,V)||ai(V-U,ad)){aa[Y]([ae,R-ah],[ad,R-ah])}else{aa[Y]([ae,R-ah],[V+ah,R-ah],[V+ah,(af+Q)/2],[ad,(af+Q)/2])}}}}}}else{N=X==2;if(N){V=S+ac;l=S;af=T;ah=K}else{ai=G;ah=-K;ac=-ac;V=S;l=S-ac;af=T+U}ag=ah*2;if(ai(ad-ae,ag)){aa[Y]([(ae+ad)/2,R],[(ae+ad)/2,Q])}else{if(ai(ad,ae)){aa[Y]([ad,R])}else{if(ai(Q-V,ag)){aa[Y]([ae+ah,R],[ae+ah,(V+Q)/2],[ad,(V+Q)/2])}else{if(ai(-ag,Q-l)){aa[Y]([ae+ah,R],[ae+ah,(l+Q)/2],[ad,(l+Q)/2])}else{if(ai(Q,V)||ai(V-ac,Q)){aa[Y]([ae+ah,R],[ae+ah,Q])}else{aa[Y]([ae+ah,R],[ae+ah,V+ah],[(af+ad)/2,V+ah],[(af+ad)/2,Q])}}}}}}aa[Y](O);if(Y=="unshift"){aa.reverse()}aa.dir=X;return aa}return Ext.apply(function(O){if(x.ZLine.processConfig(O)==false){return}var N=new x.Path(O);N.zEditors=[];N.createEditors();return N},{processConfig:function(O){var P=i(O.points);if(P.length<2){return false}var N=P[0][0],Q=P[0][1];a=["M",0,0,"L"];Ext.each(P,function(R){a.push(R[0]-N,R[1]-Q)});O.d=a.join(" ");if(O.strokewidth==1){O.strokewidth=2}O.fillcolor=n;O.points=P;O.x=N;O.y=Q},generate:function(au){var ai=au.top,ao=i(au.points),an=au.from,W=au.to,ak=ao[0],R=ao.pop(),aq=ak[0],Y=ak[1],ap=R[0],X=R[1],am,ae;if(!an&&!W){if(Math.abs(ap-aq)<Math.abs(X-Y)){ao=[ak,[aq,(Y+X)/2],[ap,(Y+X)/2],R]}else{ao=[ak,[(aq+ap)/2,Y],[(aq+ap)/2,X],R]}}else{am=L(an=J(an,ai),ak,R,true);ae=L(W=J(W,ai),ak,R);if(am&&ae){am.pop();ae.shift();var V=am.length,ar=ae.length,S=am.dir,N=ae.dir,ag=an.x,af=an.y,ah=an.width,at=an.height,Q=W.x,P=W.y,U=W.width,ad=W.height,ac=S==1||S==3,O=V>ar,T=(N-S+4)%4,ab=ak[0]>R[0],aa=ak[1]>R[1],aj=[],al;if(T==0){switch(V*ar){case 16:am.splice(2,2);ae.splice(0,2);break;case 15:if(O){ae.splice(0,2)}else{am.splice(1,2)}break;case 12:am.splice(2,2);ae.splice(0,2);aj.push(H(ae[0],am[am.length-1],!ac^O));break;case 9:if(ac?(S==1?!aa:aa):(S==2?ab:!ab)){ae.splice(0,2)}else{am.splice(1,2)}break;case 8:if(O){am.splice(2,2);ae.splice(0,1)}else{am.splice(1,1);ae.splice(0,2)}aj.push(H(ae[0],am[am.length-1],!ac^O))}}else{if(T==2){switch(V*ar){case 25:case 15:case 12:am.splice(2,V-2);ae.splice(0,ar-2);if(ac){if(ab){al=Math.max(ag+ah,Q+U)+K}else{al=Math.min(ag,Q)-K}}else{if(aa){al=Math.max(af+at,P+ad)+K}else{al=Math.min(af,P)-K}}aj.push(H([al,al],am[am.length-1],ac),H(ae[0],[al,al],!ac));break;case 16:am.splice(2,2);ae.splice(0,2);if(ac){if(ab){al=(Q+U+ag)/2}else{al=(ag+ah+Q)/2}}else{if(aa){al=(P+ad+af)/2}else{al=(af+at+P)/2}}aj.push(H([al,al],am[am.length-1],ac),H(ae[0],[al,al],!ac));break;case 9:am.splice(2,1);ae.splice(0,1);if(ac?aa^S==1:!ab^S==2){if(ac){if(ab){al=Math.max(ag+ah,Q+U)+K}else{al=Math.min(ag,Q)-K}}else{if(aa){al=Math.max(af+at,P+ad)+K}else{al=Math.min(af,P)-K}}aj.push(H([al,al],am[am.length-1],ac),H(ae[0],[al,al],!ac))}break;case 4:am.splice(1,1);ae.splice(0,1);if(ac){al=(am[am.length-1][1]+ae[0][1])/2}else{al=(am[am.length-1][0]+ae[0][0])/2}aj.push(H([al,al],am[am.length-1],!ac),H(ae[0],[al,al],ac))}}else{var Z=T==3;switch(V*ar){case 25:if(Z){am.splice(1,4);ae.splice(0,2)}else{am.splice(3,2);ae.splice(0,4)}aj.push(H(ae[0],am[am.length-1],!ac));break;case 10:case 20:if(Z^O){if(Z){am.splice(1,V-1);ae.splice(0,2)}else{am.splice(3,2);ae.splice(0,ar-1)}aj.push(H(ae[0],am[am.length-1],!ac))}else{if(Z){am.splice(2,3);ae.splice(0,ar-1);if(S==1){al=ag-K}else{if(S==2){al=af-K}else{if(S==3){al=ag+ah+K}else{al=af+at+K}}}}else{am.splice(1,V-1);ae.splice(0,3);if(S==1){al=P-K}else{if(S==2){al=Q+U+K}else{if(S==3){al=P+ad+K}else{al=Q-K}}}}aj.push(H([al,al],am[am.length-1],Z^!ac),H(ae[0],[al,al],Z^ac))}break;case 16:am.splice(2,2);ae.splice(0,2);aj.push(H(ae[0],am[am.length-1],ac));break;case 15:if(Z){if(O){am.splice(2,3);ae.splice(0,1)}else{am.splice(2,2);ae.splice(0,2)}}else{if(O){am.splice(3,2);ae.splice(0,2)}else{am.splice(2,1);ae.splice(0,3)}}aj.push(H(ae[0],am[am.length-1],Z^(ac^O)));break;case 12:if(O){if(ac?Z^(ab^(S==1)):Z^(aa^(S==2))){am.splice(2,2);ae.splice(0,1);aj.push(H(ae[0],am[am.length-1],ac))}else{ae.splice(0,2)}}else{if(ac?aa^S==1:!ab^S==2){am.splice(2,1);ae.splice(0,2);aj.push(H(ae[0],am[am.length-1],ac))}else{am.splice(1,2)}}break;case 9:if(ac^(Z^(ab^aa))){am.splice(1,2);ae.splice(0,2);aj.push(H(ae[0],am[am.length-1],ac?S==1^(Z^ab):S==2^ab))}else{if(ac?S==1^(Z^ab):S==2^ab){am.splice(1,2);ae.splice(0,1);if(ac){if(Z^ab){al=(P+am[0][1])/2}else{al=(P+ad+am[0][1])/2}}else{if(ab){al=(Q+U+am[0][0])/2}else{al=(Q+am[0][0])/2}}aj.push(H([al,al],am[am.length-1],!ac),H(ae[0],[al,al],ac))}else{am.splice(2,1);ae.splice(0,2);if(ac){if(ab){al=(ag+ae[0][0])/2}else{al=(ag+ah+ae[0][0])/2}}else{if(Z^ab){al=(af+ae[0][1])/2}else{al=(af+at+ae[0][1])/2}}aj.push(H([al,al],am[am.length-1],ac),H(ae[0],[al,al],!ac))}}break;case 6:if(O){if(ac?!aa^S==1:ab^S==2){am.splice(1,2)}else{am.splice(2,1);ae.splice(0,1);if(Z){if(S==1){al=(ae[0][0]+ag+ah)/2}else{if(S==2){al=(ae[0][1]+af+at)/2}else{if(S==3){al=(ae[0][0]+ag)/2}else{al=(ae[0][1]+af)/2}}}}else{if(S==1){al=(ae[0][0]+ag)/2}else{if(S==2){al=(ae[0][1]+af)/2}else{if(S==3){al=(ae[0][0]+ag+ah)/2}else{al=(ae[0][1]+af+at)/2}}}}aj.push(H([al,al],am[am.length-1],ac),H(ae[0],[al,al],!ac))}}else{if(ac?Z^(!ab^S==1):Z^(!aa^S==2)){ae.splice(0,2)}else{am.splice(1,1);ae.splice(0,1);if(S==1){al=(am[0][1]+P+ad)/2}else{if(S==2){al=(am[0][0]+Q)/2}else{if(S==3){al=(am[0][1]+P)/2}else{al=(am[0][0]+Q+U)/2}}}aj.push(H([al,al],am[am.length-1],!ac),H(ae[0],[al,al],ac))}}}}}aj.length&&M.apply(am,aj);ao=am.concat(ae)}else{if(am){ao=am}else{ao=ae}}}au.points=ao}})}(),Oval:Ext.apply(function(G){x.Oval.processConfig(G);var H=new x.Path(G);if(G.connectable!=false){H.createConnects();(function(){H.hideConnects()}).defer(Ext.isIE9?1:0)}return H},{processConfig:function(G){G.height=G.height||G.ry*2;G.width=G.width||G.rx*2;G.ry=G.height/2;G.rx=G.width/2;x.Rect.processConfig(G)}}),Arc:function(G){function H(){H.processConfig(G);new x.Path(G)}H.processConfig=k?function(U){var S=U.x,R=U.y,K=U.start%(2*z),P=U.r,L=U.end%(2*z)-0.000001,Q=U.innerR||0,N=U.open,O=A(K),I=w(K),J=A(L),T=w(L),M=(L>K?L:L+2*z)-K<z?0:1;U.d=["M",S+P*O,R-P*I,"A",P,P,0,M,0,S+P*J,R-P*T,N?"M":"L",S+Q*J,R-Q*T,"A",Q,Q,0,M,1,S+Q*O,R-Q*I,N?"":"Z"].join(" ");U.x=0;U.y=0}:function(W){var U=W.zoom||10000,S=W.x*U,R=W.y*U,K=W.start,L=W.end,O=W.r*U,N=A(K),I=w(K),J=A(L),T=w(L),Q=(W.innerR||0)*U,V=0.08/O,M=(Q&&0.1/Q)||0,P;if(L-K===0){return["x"]}P=["at",c(-O),c(-O),c(O),c(O),c(O*N),c(-O*I),c(O*J),c(-O*T)];if(Q){P.push("wa",c(-Q),c(-Q),c(Q),c(Q),c(Q*J),c(-Q*T),c(Q*N),c(-Q*I))}P.push("x","e");W.path=P.join(" ")};return H}(),Rect:function(){function G(H){G.processConfig(H);var I=new x.Path(H);if(H.connectable!=false){I.createConnects();I.hideConnects()}return I}G.processConfig=function(L){var M=Number(L.height)||200,O=Number(L.width)||200,I=Math.min(Number(L.rx)||0,O/2),H=Math.min(Number(L.ry)||0,M/2),P=I>0&&H>0,K=I!=O/2,J=H!=M/2,N=["M",0,P?H:0];if(P){N.push("A",I,H,0,0,1,I,0)}if(K){N.push("H",O-(P?I:0))}if(P){N.push("A",I,H,0,0,1,O,H)}if(J){N.push("V",M-(P?H:0))}if(P){N.push("A",I,H,0,0,1,O-I,M)}if(K){N.push("H",P?I:0)}if(P){N.push("A",I,H,0,0,1,0,M-H)}if(J){N.push("Z")}L.d=N.join(" ")};return G}(),Diamond:function(){function G(H){G.processConfig(H);var I=new x.Path(H);if(H.connectable!=false){I.createConnects();I.hideConnects()}return I}G.processConfig=function(I){var J=Number(I.height)||100,H=Number(I.width)||200,K=["M",0,J/2,"L",H/2,0,H,J/2,H/2,J,"Z"];I.d=K.join(" ")};return G}(),Arrow:function(){var G,J,N,L,M={viewBox:"0 0 100 100",refX:50,refY:50,orient:"auto"},H="start-arrow-",K="end-arrow-",I="M 100 0 L 0 50 L 100 100 L 66.66 50 z",P="M 0 0 L 100 50 L 0 100 L 33.33 50 z",O=function(S,R){if(S){var Q=(R?H:K)+S+G;Ext.get(Q)||new x.Path({fillcolor:J,fillopacity:N,d:R?I:P,root:L.appendChild(h("marker",Q).set(M))})}};return function(R){if(!R.startarrow&&!R.endarrow){return}var Q=R.root;L=Q.child("defs")||Q.insertFirst(h("defs"));J=R.color||"#000000";N=R.opacity||1;G="-"+J+"-"+N*100;O(R.startarrow,true);O(R.endarrow)}}(),Image:function(){function G(H){G.processConfig(H);var I=new x.ImagePath(H);if(H.connectable!=false){I.createConnects();I.hideConnects()}return I}G.processConfig=function(H){};return G}()}}();Ext.apply(x,{ImagePath:Ext.extend(x.Path,{initSVGElement:function(){var F=this,E=F.parent,D=F.wrap,C=F.x,H=F.y,G=(F.el=D.appendChild(h("image",F.id+"_el").set({x:0,y:0,width:F.width,height:F.height}))).dom;G.style.cssText=p({stroke:F.strokecolor,"stroke-width":F.strokewidth,"stroke-opacity":F.strokeopacity,"-moz-user-select":n})+F.style;G.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",F.image);if(C||H){if(E){C-=E.x;H-=E.y}q(D,C,H)}},initVMLElement:function(){var F=this,D=F.strokecolor,E=F.parent,C=F.x,G=F.y;if(E){C-=E.x;G-=E.y}F.el=new Ext.Template(F.vmlTpl).append(F.wrap.setStyle({position:"absolute",width:100+j,height:100+j,left:C+j,top:G+j}).set({coordsize:"100,100"}).dom,{id:F.id+"_el",src:F.image,style:F.style,width:F.width,height:F.height,strokeColor:D||n,strokeWidth:D?F.strokewidth:0,strokeOpacity:D?(F.strokeopacity||1):0},true)},vmlTpl:['<v:image id="{id}" src="{src}" style="position:absolute;left:0;top:0;width:{width}px;height:{height}px;{style}">',g,"</v:image>"]}),Text:Ext.extend(x.Path,{initSVGWrap:function(){this.wrap=this.root.appendChild(h("g",this.id))},initVMLWrap:function(){this.wrap=this.root.appendChild(y("v:group",this.id))},initSVGElement:function(){var F=this,E=F.rotation,D=F.size||14,C=F.dx,G=(F.el=F.wrap.appendChild(h("text",F.id+"_el").set({dx:C,dy:F.dy+D-2,"text-anchor":"middle"}))).dom;G.style.cssText=p({fill:F.color,"font-size":D+j,"font-family":F.fontfamily,cursor:"text"})+F.style;Ext.each(F.text.split(/\n/),function(I,H){var J=h("tspan");if(!H){J.set({dx:C})}else{J.set({x:C,dy:H*D})}J.dom.textContent=I;F.el.appendChild(J)});if(!r(E)){q(F.el,null,null,null,null,E)}C+=F.el.getWidth()/2;F.el.set({dx:C}).select("tspan").each(function(I,J,H){if(!H){I.set({dx:C})}else{I.set({x:C})}});return F.el},initVMLElement:function(){var H=this,F=H.size||14,E=H.rotation,D=H.positionwrap,G=H.el=new Ext.Template(H.vmlTpl).append(H.wrap.dom,{id:H.id+"_el",style:p({"font-size":F+j,"font-family":H.fontfamily,"text-align":"center"})+H.style,left:H.dx,top:H.dy,color:H.color||"black"},true).update(H.text.split(/\n/).join("<br/>"));if(!r(E)){var C,I;if(D){C=D.x;I=D.y;G.dx=D.titlex;G.dy=D.titley}q(G,null,null,null,null,E,C,I)}return G},vmlTpl:"<span id='{id}' unselectable='on'  onselectstart='return false;' style='position:absolute;left:{left}px;top:{top}px;color:{color};cursor:pointer;white-space:nowrap;{style}'></span>"})});$A.Graphics.revision="$Rev: 8435 $"})();