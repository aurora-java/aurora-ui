(function(a){var c="selected",d="item-accordion-btn",e="strip-over",b="select";a.Accordion=Ext.extend(a.Component,{constructor:function(f){a.Accordion.superclass.constructor.call(this,f)},initComponent:function(f){a.Accordion.superclass.initComponent.call(this,f);var h=this,g=h.wrap;h.selectedItems=[];h.frequency=h.frequency||20;h.actionTimes=h.actionTimes||2;h.currentTime=1;h.accordions=g.select("div.item-accordion");h.strips=g.select("div.accordion-strip");h.bodys=g.select("div.item-accordion-body");h.stripheight=h.stripheight||25;h.accordions.each(function(j,l,m,k){Ext.isIE6&&j.setWidth("100%");if(j.hasClass(c)){h.selectedItems.push(Ext.get(j.dom));h.load.call(h,m)}});Ext.isIE6&&h.bodys.setWidth("100%")},processListener:function(f){var g=this;a.Accordion.superclass.processListener.call(g,f);g.wrap[f]("click",g.onClick,g)},initEvents:function(){a.Accordion.superclass.initEvents.call(this);this.addEvents(b)},selectAccordionIndex:function(h){var j=this,g=Ext.get(j.accordions.elements[h]);if(!g){return}if(g.hasClass(c)){j.close(g,h)}else{j.singlemode&&Ext.each(j.selectedItems,function(l){j.close(l,j.accordions.elements.indexOf(l.dom))},j);var f=j.bodys.item(h),k=!!f.dom.style.height,i=f.select("*");if(i.elements.length==0&&f.dom.innerHTML){k=true}i.each(function(l){if(l.getHeight()){k=true}});j.selectedItems.push(g.addClass(c).setHeight(j.stripheight+(k?f.show().getHeight():0),{duration:0.2,callback:function(){k&&g.setStyle({height:""});j.load(h)}}))}},close:function(f,g){var h=this;f.removeClass(c).setHeight(h.stripheight,{duration:0.2,callback:function(){h.bodys.item(g).hide()}});h.selectedItems.remove(f)},onClick:function(g,f){f=(f=Ext.fly(f)).hasClass("accordion-strip")?f:f.parent(".accordion-strip");if(f){this.strips.each(function(k,h,j){if(f.dom==k.dom){this.selectAccordionIndex(j);return false}},this)}},onMouseOver:function(g,f){(f=Ext.fly(f)).hasClass(d)&&f.parent().addClass(e);a.Accordion.superclass.onMouseOver.call(this,g,f)},onMouseOut:function(g,f){(f=Ext.fly(f)).hasClass(d)&&f.parent().removeClass(e);a.Accordion.superclass.onMouseOut.call(this,g,f)},showLoading:function(f){f.update(_lang["accordion.loading"]).setStyle({"text-align":"center","line-height":5})},clearLoading:function(f){f.update("").setStyle({"text-align":"","line-height":""})},load:function(g){var h=this,f=h.items[g].ref,i=Ext.get(h.bodys.elements[g]);if(!f||i.isLoaded){h.fireEvent(b,h,g);return}i.isLoaded=true;i.cmps={};h.showLoading(i);Ext.Ajax.request({url:Ext.urlAppend(f,"_vw="+h.width+"&_vh="+(h.height-h.strips.item(0).getHeight())),success:function(j,k){h.clearLoading(i);i.update(j.responseText,true,function(){h.fireEvent(b,h,g)},i)}})},setHeight:function(j){if(this.height==j){return}var m=this,i=m.bodys,g=i.elements.length,k=m.stripheight,j=Math.max(j,k*g),f=m.singlemode;m.height=j;i.setHeight((j-k*g)/(f?1:g));Ext.each(m.selectedItems,function(h){h.setHeight(f?(j-k*(g-1)):(j/g))})},destroy:function(){Ext.each(this.bodys,function(f){Ext.iterate(Ext.get(f).cmps,function(g,h){try{h.destroy&&h.destroy()}catch(i){alert("销毁Accordion出错: "+i)}})});a.Accordion.superclass.destroy.call(this)}})})($A);