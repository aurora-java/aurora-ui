(function(a){var g="100%",d="selected",e="item-accordion-btn",f="strip-over",c="select",b="beforeselect";a.Accordion=Ext.extend(a.Component,{constructor:function(h){a.Accordion.superclass.constructor.call(this,h)},initComponent:function(h){a.Accordion.superclass.initComponent.call(this,h);var j=this,i=j.wrap;j.selectedItems=[];j.accordions=i.select("div.item-accordion");j.strips=i.select("div.accordion-strip");j.bodys=i.select("div.item-accordion-body");j.stripheight=j.stripheight||25;j.accordions.each(function(k,m,n,l){Ext.isIE6&&k.setWidth(g);if(k.hasClass(d)){j.selectAccordionIndex(n)}});Ext.isIE6&&j.bodys.setWidth(g)},processListener:function(h){var i=this;a.Accordion.superclass.processListener.call(i,h);i.wrap[h]("click",i.onClick,i)},initEvents:function(){a.Accordion.superclass.initEvents.call(this);this.addEvents(b,c)},selectAccordionIndex:function(k){var m=this,i=Ext.get(m.accordions.elements[k]);if(m.fireEvent(b,m,k)!=false){if(!i){return}if(m.selectedItems.indexOf(i)!=-1){m.close(i,k)}else{m.singlemode&&Ext.each(m.selectedItems,function(p){m.close(p,m.accordions.elements.indexOf(p.dom))},m);var h=Ext.get(m.bodys.elements[k]),n=!!h.dom.style.height,l=h.select("*"),j=m.items[k].ref,o=0;if(!n&&j&&!h.isLoaded){o=100;h.needResize=true}if(l.elements.length==0&&h.dom.innerHTML){n=true}l.each(function(p){if(p.getHeight()){n=true}});h.show();m.selectedItems.push(i.addClass(d).setHeight(m.stripheight+(n?h.getHeight():o),{duration:0.2,callback:function(){n&&i.setStyle({height:""});m.load(k)}}))}}},close:function(h,i){var j=this;h.removeClass(d).setHeight(j.stripheight,{duration:0.2,callback:function(){j.bodys.item(i).hide()}});j.selectedItems.remove(h)},onClick:function(i,h){h=(h=Ext.fly(h)).hasClass("accordion-strip")?h:h.parent(".accordion-strip");if(h){this.strips.each(function(l,j,k){if(h.dom==l.dom){this.selectAccordionIndex(k);return false}},this)}},onMouseOver:function(i,h){(h=Ext.fly(h)).hasClass(e)&&h.parent().addClass(f);a.Accordion.superclass.onMouseOver.call(this,i,h)},onMouseOut:function(i,h){(h=Ext.fly(h)).hasClass(e)&&h.parent().removeClass(f);a.Accordion.superclass.onMouseOut.call(this,i,h)},showLoading:function(h){h.update(_lang["accordion.loading"]).setStyle({"text-align":"center","line-height":5})},clearLoading:function(h){h.update("").setStyle({"text-align":"","line-height":""})},load:function(j){var k=this,i=k.items[j].ref,l=Ext.get(k.bodys.elements[j]),h=Ext.get(k.accordions.elements[j]);if(!i||l.isLoaded){k.fireEvent(c,k,j);return}l.isLoaded=true;l.cmps={};k.showLoading(l);Ext.Ajax.request({url:Ext.urlAppend(i,"_vw="+k.width+"&_vh="+(k.height-k.strips.item(0).getHeight())),success:function(m,n){k.clearLoading(l);l.update(m.responseText,true,function(){l.needResize&&h.setHeight(l.getHeight(),{duration:0.2,callback:function(){h.setStyle({height:""})}});k.fireEvent(c,k,j)},l)}})},setHeight:function(m){if(this.height==m){return}var o=this,k=o.bodys,j=k.elements.length,n=o.stripheight,m=Math.max(m,n*j),i=o.singlemode;o.height=m;k.setHeight((m-n*j)/(i?1:j));Ext.each(o.selectedItems,function(h){h.setHeight(i?(m-n*(j-1)):(m/j))})},destroy:function(){Ext.each(this.bodys,function(h){Ext.iterate(Ext.get(h).cmps,function(i,j){try{j.destroy&&j.destroy()}catch(k){alert("销毁Accordion出错: "+k)}})});a.Accordion.superclass.destroy.call(this)}})})($A);