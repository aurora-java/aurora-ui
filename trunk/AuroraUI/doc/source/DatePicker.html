<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />    
  <title>The source code</title>
    <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
</head>
<body  onload="prettyPrint();">
    <pre class="prettyprint lang-js">/**
 * @class Aurora.DatePicker
 * @extends Aurora.TriggerField
 * <p>DatePicker组件.
 * @author njq.niu@hand-china.com
 * @constructor
 * @param {Object} config 配置对象. 
 */
$A.DatePicker = Ext.extend($A.TriggerField,{
	constructor: function(config) {
        $A.DatePicker.superclass.constructor.call(this, config);        
    },
    initComponent : function(config){
    	$A.DatePicker.superclass.initComponent.call(this,config);
    	if(!this.dateField){
    		var cfg = {id:this.id+'_df',container:this.popup}
	    	this.dateField = new $A.DateField(cfg);
	    	this.dateField.on("select", this.onSelect, this);
	    	this.dateField.on("draw", this.onDraw, this);
    	}
    },
    initEvents : function(){
    	$A.DatePicker.superclass.initEvents.call(this);
        this.addEvents(
        <div id="event-Aurora.DatePicker-select"></div>/**
         * @event select
         * 选择事件.
         * @param {Aurora.DatePicker} datePicker 日期选择组件.
         * @param {Date} date 选择的日期.
         */
        'select');
    },
    onDraw: function(){
    	this.shadow.setWidth(this.popup.getWidth());
    	this.shadow.setHeight(this.popup.getHeight());
    },
    onSelect: function(dateField, date){
    	this.collapse();
    	this.setValue(date);
    	this.fireEvent('select',this, date);
    },
	onBlur : function(e){
		$A.DatePicker.superclass.onBlur.call(this,e);
		if(!this.isExpanded()) {
			var raw = this.getRawValue();
			if(!isNaN(new Date(raw.replace(/-/g,"/")))){
				this.setValue(new Date(raw.replace(/-/g,"/")));
			}else {
				this.setValue('');
			}
		}
    },
    formatValue : function(date){
    	if(date instanceof Date) {
    		return Aurora.formateDate(date);
    	}else{
    		return date;
    	}
    },
    expand : function(){
    	$A.DatePicker.superclass.expand.call(this);
    	if(this.dateField.selectDay != this.getValue()) {
    		this.dateField.selectDay = this.getValue()
    		this.dateField.predraw(this.dateField.selectDay);
    		var w = this.popup.getWidth();
	    	var h = this.popup.getHeight();
	    	this.shadow.setWidth(w);
	    	this.shadow.setHeight(h);
    	}
    	var screenHeight = $A.getViewportHeight();
    	var h = this.popup.getHeight();
    	var y = this.popup.getY();
    	if(y+h > screenHeight) {
    		var xy = this.wrap.getXY();
	    	this.popup.moveTo(xy[0],xy[1]-h);
	    	this.shadow.moveTo(xy[0]+3,xy[1]-h+3);
    	}
    },
    destroy : function(){
    	$A.DatePicker.superclass.destroy.call(this);
	}
});</pre>    
</body>
</html>